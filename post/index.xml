<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on Jade's Blog</title><link>https://wenjin1997.github.io/post/</link><description>Recent content in Posts on Jade's Blog</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Wed, 30 Nov 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://wenjin1997.github.io/post/index.xml" rel="self" type="application/rss+xml"/><item><title>Zero Knowledge Proofs: An illustrated primer, PartÂ 2</title><link>https://wenjin1997.github.io/2022/11/30/Zero-Knowledge-Proofs-An-illustrated-primer-Part2/</link><pubDate>Wed, 30 Nov 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/11/30/Zero-Knowledge-Proofs-An-illustrated-primer-Part2/</guid><description>&lt;img src="https://wenjin1997.github.io/img/2022-11-30-Zero-Knowledge-Proofs-An-illustrated-primer-Part2/background.jpg" alt="Featured image of post Zero Knowledge Proofs: An illustrated primer, PartÂ 2" />&lt;p>åŸæ–‡é“¾æ¥ï¼š&lt;a class="link" href="https://blog.cryptographyengineering.com/2017/01/21/zero-knowledge-proofs-an-illustrated-primer-part-2/" target="_blank" rel="noopener"
>Zero Knowledge Proofs: An illustrated primer, PartÂ 2&lt;/a>ã€‚è¿™ç¯‡åšå®¢é€šè¿‡Schnorråè®®è¯¦ç»†è®²è§£äº†é›¶çŸ¥è¯†è¯æ˜ä¸­çš„å®Œå¤‡æ€§ã€å¯é æ€§ä»¥åŠé›¶çŸ¥è¯†ï¼Œå¯¹äºå¼„æ‡‚æå–å™¨ã€æ¨¡æ‹Ÿå™¨ä»¥åŠé›¶çŸ¥è¯†ç­‰æ¦‚å¿µå¾ˆæœ‰å¸®åŠ©ã€‚ä¹‹å‰å¯¹äºæ¨¡æ‹Ÿå™¨çš„ä½œç”¨æœ‰äº›æ‡µæ‡µæ‡‚æ‡‚ï¼Œç°åœ¨çœ‹å®Œåæœ‰ä¸€ç§é€å½»çš„æ„Ÿè§‰ğŸ˜ƒã€‚&lt;/p>
&lt;p>ğŸ“ æ€»ç»“ä¸€ä¸‹ï¼š&lt;/p>
&lt;p>ä»»ä½•é›¶çŸ¥è¯†è¯æ˜å¿…é¡»æ»¡è¶³ä¸‰ä¸ªé‡è¦çš„æ€§è´¨ï¼š&lt;/p>
&lt;ol>
&lt;li>å®Œå¤‡æ€§ã€‚ä»»ä½•è¯šå®çš„Proveræœ€ç»ˆéƒ½èƒ½å¤Ÿä½¿Verifierä¿¡æœã€‚&lt;/li>
&lt;li>å¯é æ€§ã€‚å¦‚æœèƒ½è¯´æœVerifierï¼Œé‚£ä¹ˆä¸€å®šæœ‰å‘½é¢˜æ˜¯çœŸçš„ã€‚é€†å¦å‘½é¢˜å°±æ˜¯ï¼Œå¦‚æœå‘½é¢˜ä¸ä¸ºçœŸï¼Œé‚£ä¹ˆå°±ä¸èƒ½è¯´æœVerifierã€‚&lt;/li>
&lt;li>é›¶çŸ¥è¯†ã€‚Verifieré™¤äº†çŸ¥é“å‘½é¢˜ä¸ºçœŸå¤–ä¸èƒ½è·å¾—å…¶ä»–ä»»ä½•ä¿¡æ¯ã€‚&lt;/li>
&lt;/ol>
&lt;p>å¦‚ä½•åœ¨è¯æ˜å¯é æ€§å’Œé›¶çŸ¥è¯†æ€§è´¨çš„åŒæ—¶åˆä¸ä¼šæ³„æ¼çŸ¥è¯†å‘¢ï¼Ÿç§˜è¯€å°±æ˜¯æ¨¡æ‹Ÿå™¨ï¼Œæ¨¡æ‹Ÿå™¨ä¸­æ‹¥æœ‰åœ¨å®é™…ä¸­ä¸å¯èƒ½æœ‰çš„è¶…èƒ½åŠ›ï¼Œæ¯”å¦‚è¯´æ—¶é—´æœºå™¨ã€‚è¿™æ ·å°±å¾ˆå·§å¦™çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼&lt;/p>
&lt;p>è¯æ˜å¯é æ€§ï¼Œä½¿ç”¨æ¨¡æ‹Ÿå™¨ï¼å¯é æ€§è¯´çš„æ˜¯å¦‚æœèƒ½è¯´æœVerifierï¼Œé‚£ä¹ˆä¸€å®šæœ‰å‘½é¢˜ä¸ºçœŸã€‚åšå®¢ä¸­ä¸»è¦è®¨è®ºçš„&amp;quot;statement&amp;quot;æ˜¯ä¸ªäººçŸ¥è¯†è€Œä¸æ˜¯&amp;quot;facts&amp;quot;ï¼Œä¹Ÿå°±æ˜¯â€œæˆ‘çŸ¥é“æŸä¸ªçŸ¥è¯†ï¼Œæˆ–è€…è¯´ç§˜å¯†å§â€ã€‚å…·ä½“æ¥è®²ï¼Œå¯é æ€§å°±å˜æˆäº†ï¼Œå¦‚æœèƒ½è¯´æœVerifierï¼Œé‚£ä¹ˆProverä¸€å®šæ˜¯çŸ¥é“çŸ¥è¯†çš„ã€‚ä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼Œæ¬å‡ºæå–å™¨çš„æ¦‚å¿µï¼Œæå–å™¨å……å½“Verifierçš„è§’è‰²ï¼Œå¯¹äºä»»ä½•å¯èƒ½çš„Proverï¼Œå¦‚æœéƒ½å­˜åœ¨ä¸€ä¸ªæå–å™¨èƒ½å¤Ÿæå–åˆ°çŸ¥è¯†ï¼Œé‚£ä¹ˆå°±è¯´æ˜Proverè‚¯å®šæ˜¯æœ‰çŸ¥è¯†çš„ã€‚è¿™ä¸å°±è¯æ˜äº†å¯é æ€§å˜›ï¼&lt;/p>
&lt;p>é‚£é—®é¢˜æ˜¯æå–å™¨æ€ä¹ˆæå–çŸ¥è¯†å‘¢ï¼Ÿè®©æˆ‘ä»¬ä¸Šæ¨¡æ‹Ÿå™¨ä¸­çš„è¶…èƒ½åŠ›â€”â€”æ—¶å…‰æœºå™¨ï¼æå–å™¨èƒ½å¤Ÿå›æº¯ï¼Œè¾¾åˆ°éª—Proveråœ¨ä¸¤æ¬¡è¿è¡Œä¸­ä½¿ç”¨ç›¸åŒçš„éšæœºæ•°$k$ï¼Œç„¶åè®¡ç®—å‡ºProveråŸæ¥æ‹¥æœ‰çš„å¯†é’¥$a$ã€‚&lt;/p>
&lt;p>è¯æ˜é›¶çŸ¥è¯†ï¼Œä½¿ç”¨æ¨¡æ‹Ÿå™¨ï¼è¦è¯æ˜ç°å®ä¸­çš„Verifieré™¤äº†çŸ¥é“ProverçŸ¥é“çŸ¥è¯†è¿™ä¸€ç‚¹å¤–ä¸èƒ½è·å–åˆ°å…¶ä»–ä»»ä½•ä¿¡æ¯ï¼Œæˆ‘ä»¬æ„é€ ä¸€ä¸ªå‹æ ¹å°±ä¸çŸ¥é“å¯†é’¥$a$çš„Proverï¼Œå®ƒå’Œè¯šå®çš„Verifieräº¤äº’ï¼Œè®©Verifierç›¸ä¿¡Proveræ˜¯çŸ¥é“å¯†é’¥$a$çš„ã€‚åŒæ—¶åœ¨ç»Ÿè®¡æ„ä¹‰ä¸Šï¼Œæ¨¡æ‹Ÿå™¨ä¸­äº¤äº’çš„è¾“å‡ºåˆ†å¸ƒå’ŒçœŸå®Proverå’ŒVerifieräº¤äº’çš„è¾“å‡ºåˆ†å¸ƒæ˜¯ä¸€æ ·çš„ã€‚é‚£ä¹ˆç”±äºæ¨¡æ‹Ÿå™¨ä¸­æ ¹æœ¬æ²¡æœ‰çŸ¥è¯†ï¼Œä¹Ÿå°±è¯æ˜äº†é›¶çŸ¥è¯†ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆå¦‚ä½•åœ¨æ¨¡æ‹Ÿå™¨ä¸­è®©Proverè¯´æœVerifierå‘¢ï¼Ÿä¸Šè¶…èƒ½åŠ›â€”â€”æ—¶å…‰æœºå™¨ï¼Proverå…ˆå‘ä¸€ä¸ªåˆå§‹å€¼$g^{k_1}$éª—å–åˆ°Verifierçš„éšæœºæ•°$c$ï¼Œå›æº¯Verifierï¼Œè®©å®ƒå‘é€éšæœºæ•°$z$ï¼Œè¿›è¡Œä¸€äº›è®¡ç®—å¾—åˆ°åˆå§‹å€¼ï¼Œå½“Verifierå‘èµ·éšæœºæŒ‘æˆ˜$c$æ—¶ï¼ŒProverè¾“å‡º$z$å°±èƒ½è®©Verifierç›¸ä¿¡ProverçŸ¥é“å¯†é’¥$a$ï¼Œå®é™…ä¸ŠProverä¸çŸ¥é“å¯†é’¥$a$ã€‚&lt;/p>
&lt;p>ä¸Šé¢çš„è¿‡ç¨‹éƒ½æ˜¯äº¤äº’çš„ï¼Œè½¬æ¢æˆéäº¤äº’é›¶çŸ¥è¯†è¯æ˜çš„ä¸€ä¸ªæ–¹å¼æ˜¯ç”¨å¯é çš„å“ˆå¸Œå‡½æ•°æ¥å‘èµ·éšæœºæŒ‘æˆ˜ã€‚&lt;/p>
&lt;p>å¥½çš„ï¼ä¸‹é¢å¼€å§‹è¾¹è¯»åšå®¢æ–‡ç« è¾¹åšç¬”è®°ã€‚ğŸ‘‡&lt;/p>
&lt;p>&lt;em>This post is the second in a two-part series on zero-knowledge proofs.Â &lt;a class="link" href="https://blog.cryptographyengineering.com/2014/11/zero-knowledge-proofs-illustrated-primer.html" target="_blank" rel="noopener"
>Click here&lt;/a>Â to readÂ Part 1.&lt;/em>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-30-Zero-Knowledge-Proofs-An-illustrated-primer-Part2/Untitled.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>In this post Iâ€™m going to continue the short, (relatively) non-technical overview of zero knowledge proofs that I started a couple of years ago. Yes, that was a very long time! If you didnâ€™t catch the first post, now would be anÂ &lt;a class="link" href="https://blog.cryptographyengineering.com/2014/11/zero-knowledge-proofs-illustrated-primer.html" target="_blank" rel="noopener"
>excellent time to go read it&lt;/a>.&lt;/p>
&lt;p>Before we go much further, a bit of a warning. While this series is still intended as a high-level overview, at a certain point itâ€™s necessary to dig a bit deeper into some specific algorithms. So you should expect this post to get a bit wonkier than the last.&lt;/p>
&lt;h3 id="a-quick-recap-and-a-bit-more-on-zero-knowledgeness">&lt;strong>A quick recap, and a bit more on Zero Knowledge(ness)&lt;/strong>
&lt;/h3>&lt;p>First, a brief refresher.&lt;/p>
&lt;p>In the last post we defined a zero knowledge proof as an interaction between two computer programs (or Turing machines) â€” respectively called a Prover and a Verifier â€” where the Prover works to convince the Verifier that some mathematical statement is true. We also covered a specific example:Â a clever protocol byÂ &lt;a class="link" href="http://users.softlab.ece.ntua.gr/~dvitin/zk/GMW91.pdf" target="_blank" rel="noopener"
>Goldreich, Micali and Wigderson&lt;/a>Â that allows us to prove, in zero knowledge, that a graph possessesÂ aÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/Graph_coloring" target="_blank" rel="noopener"
>three-coloring&lt;/a>.&lt;/p>
&lt;p>In the course of that discussion, we described three critical properties that any zero knowledge proof must satisfy:&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Completeness&lt;/strong>:Â If the Prover is honest, then she will eventually convince the Verifier.&lt;/li>
&lt;li>&lt;strong>Soundness:&lt;/strong>Â The Prover can only convince the Verifier if the statement is true.&lt;/li>
&lt;li>&lt;strong>Zero-knowledge(ness):&lt;/strong>Â &lt;em>The Verifier learns no information beyond the fact that the statement is true.&lt;/em>&lt;/li>
&lt;/ul>
&lt;p>The real challenge turns out to be finding a way to formally define the last property. How do you state that a Verifier learnsÂ &lt;em>nothing&lt;/em>Â beyond the truth of a statement?&lt;/p>
&lt;p>In caseÂ you didnâ€™t read theÂ &lt;a class="link" href="https://blog.cryptographyengineering.com/2014/11/27/zero-knowledge-proofs-illustrated-primer/" target="_blank" rel="noopener"
>previous post&lt;/a>Â â€” the answer to this question came from Goldwasser, Micali and Rackoff, and itâ€™s very cool. What they argued is that a protocol can be provenÂ &lt;em>zero knowledge&lt;/em>Â if for every possible Verifier, you can demonstrate the existence of an algorithm called a â€˜Simulatorâ€™, and show that this algorithm has some very special properties.&lt;/p>
&lt;p>From a purely mechanical perspective, the Simulator is like a special kind of Prover. However, unlike a real Prover â€” which starts with some special knowledge that allows it to prove the truth of a statement â€” the SimulatorÂ &lt;em>gets no special knowledge at all.&lt;/em>*Â Nonetheless, the Simulator (or Simulators) must be able to â€˜foolâ€™ every Verifier into believing that the statement is true, while producing a transcript thatâ€™s statistically identical top (or indistinguishable from) the output of a real Prover.&lt;/p>
&lt;p>ä¸Šé¢å…³äºæ¨¡æ‹Ÿå™¨çš„å™è¿°æ¯”è¾ƒé‡è¦ã€‚å¯ä»¥å°†æ¨¡æ‹Ÿå™¨çœ‹ä½œæ˜¯ç‰¹æ®Šçš„ä¸€ç§Proverã€‚æ¨¡æ‹Ÿå™¨å¿…é¡»å¯ä»¥éª—è¿‡ä»»ä½•çš„Verifierç›¸ä¿¡å‘½é¢˜æ˜¯çœŸçš„ï¼Œè€Œä¸”æ¨¡æ‹Ÿå™¨äº§ç”Ÿçš„ç»“æœå’Œä¸ä¸€ä¸ªçœŸå®çš„Proveräº¤äº’å¾—åˆ°çš„ç»“æœåœ¨ç»Ÿè®¡ä¸Šæ˜¯ä¸å¯åŒºåˆ†çš„ã€‚&lt;/p>
&lt;p>The logic here flows pretty cleanly: sinceÂ Simulator has no â€˜knowledgeâ€™ to extract in the first place, then clearly a VerifierÂ &lt;em>canâ€™t&lt;/em>Â obtain any meaningful amount of information after interacting with it. Moreover, ifÂ the transcript of the interaction is distributed identically to a real protocol run with a normal Prover, then the VerifierÂ &lt;em>canâ€™t&lt;/em>Â do better against the real prover than it can do against the Simulator. (If the VerifierÂ &lt;em>could&lt;/em>Â do better, then that would imply that the distributions were not statistically identical.) Ergo, the Verifier canâ€™t extract useful information from the real protocol run.&lt;/p>
&lt;p>This is incredibly wonky, and worse, it seems contradictory! Weâ€™re asking that a protocol be bothÂ &lt;em>sound&lt;/em>Â â€” meaning that a bogusï¼ˆè™šå‡çš„ï¼‰ Prover canâ€™t trick some Verifier into accepting a statement unless it has special knowledge allowing it to prove the statement â€” but weâ€™re also asking for the existence of an algorithm (the simulator) that can literally cheat. Clearly both properties canâ€™t hold at the same time.&lt;/p>
&lt;p>The solution to this problem is that both propertiesÂ &lt;em>donâ€™t&lt;/em>Â hold at the same time.&lt;/p>
&lt;p>To build our simulator, weâ€™re allowed to do things to the Verifier that would never happen in the real world. The example that I gave in the previous post was to use a â€˜time machineâ€™ â€” that is, our â€˜Simulatorâ€™ can rewind the Verifier programâ€™s execution in order to â€˜foolâ€™ it. Thus, in a world where we can wind the Verifier back in time, itâ€™s easy to show that a Simulator exists. In the real world, of course it doesnâ€™t. This â€˜trickâ€™ gets us around the contradiction.&lt;/p>
&lt;p>çœ‹ä¼¼æ¨¡æ‹Ÿå™¨æ²¡æœ‰çŸ¥è¯†ä¹Ÿèƒ½éª—è¿‡Verifierå’ŒProveré™¤éæœ‰çŸ¥è¯†æ‰èƒ½é€šè¿‡Verifierçš„æµ‹éªŒæ˜¯çŸ›ç›¾çš„ï¼Œä½†å…¶å®è¿™ä¸¤ä¸ªä¸æ˜¯åŒæ—¶æˆç«‹çš„ã€‚æ¨¡æ‹Ÿå™¨æœ‰ä¸€äº›çœŸå®ä¸–ç•Œæ²¡æœ‰çš„è¶…èƒ½åŠ›ï¼Œæ¯”å¦‚è¯´æ—¶é—´æœºå™¨ï¼Œè¿™æ ·æ¨¡æ‹Ÿå™¨æ˜¯å¯ä»¥éª—è¿‡Verifierçš„ã€‚&lt;/p>
&lt;p>As a last reminder, to illustrate all of these ideas, we covered one of the first general zero knowledge proofs, devised byÂ &lt;a class="link" href="http://people.csail.mit.edu/silvio/Selected%20Scientific%20Papers/Zero%20Knowledge/Proofs_That_Yield_Nothing_But_Their_Validity_or_All_Languages_in_NP_Have_Zero-Knowledge_Proof_Systems.pdf" target="_blank" rel="noopener"
>Goldreich, Micali and Wigderson&lt;/a>Â (GMW). That protocol allowed us to prove, in zero knowledge, that a graph supports aÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/Graph_coloring" target="_blank" rel="noopener"
>three-coloring&lt;/a>. Of course, proving three colorings isnâ€™t terribly interesting. The real significance of the GMW result is theoretical. Since graph three coloring is known to be in the complexity classÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/NP-complete" target="_blank" rel="noopener"
>NP-complete&lt;/a>, the GMW protocol can be used to proveÂ &lt;em>any statement&lt;/em>Â in the classÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/NP_%28complexity%29" target="_blank" rel="noopener"
>NP&lt;/a>. And thatâ€™s quite powerful.&lt;/p>
&lt;p>Let me elaborate slightly on what that means:&lt;/p>
&lt;ol>
&lt;li>If there existsÂ &lt;em>any&lt;/em>Â &lt;a class="link" href="http://en.wikipedia.org/wiki/Decision_problem" target="_blank" rel="noopener"
>decision problem&lt;/a>Â (that is, a problem with a yes/no answer) whose witness (solution) can be verified in polynomial time, then:&lt;/li>
&lt;li>We can prove that said solution exists byÂ &lt;em>(1)&lt;/em>Â &lt;a class="link" href="https://www.cs.cmu.edu/~ckingsf/bioinfo-lectures/sat.pdf" target="_blank" rel="noopener"
>translating the problem into an instance of the graph three-coloring problem&lt;/a>, andÂ &lt;em>(2)&lt;/em>Â running the GMW protocol.*&lt;/li>
&lt;/ol>
&lt;p>This amazing result gives us interactive zero knowledge proofs forÂ &lt;em>every statement in NP.&lt;/em>Â TheÂ only problem is that itâ€™s almost totally unusable.&lt;/p>
&lt;p>æˆ‘ä»¬çŸ¥é“GMWä¸­çš„å›¾ä¸‰è‰²é—®é¢˜æ˜¯NPCé—®é¢˜ï¼Œè€ŒNPé—®é¢˜å¯ä»¥å½’çº¦æˆå›¾ä¸‰è‰²é—®é¢˜ï¼Œç„¶åå¯ä»¥ç”¨GMWåè®®æ¥è¿›è¡Œé›¶çŸ¥è¯†è¯æ˜ã€‚å”¯ä¸€çš„é—®é¢˜æ˜¯è¿™æ˜¯ä¸å®ç”¨çš„ã€‚&lt;/p>
&lt;h3 id="from-theory-into-practice">&lt;strong>From theory into practice&lt;/strong>
&lt;/h3>&lt;p>If youâ€™re of a practical mindset, youâ€™re probably shaking your head at all this talk of ZK proofs. Thatâ€™s because actuallyÂ &lt;em>using this approach&lt;/em>Â would be an insanely expensive and stupid thing to do. Most likely youâ€™d first represent your input problem as aÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/Boolean_circuit" target="_blank" rel="noopener"
>boolean circuit&lt;/a>Â where the circuit isÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/Circuit_satisfiability_problem" target="_blank" rel="noopener"
>satisfied&lt;/a>Â if and only if you know the correct input. Then youâ€™d have to translate your circuit into a graph, resulting in some further blowup. Finally youâ€™d need to run the GMW protocol, which is damned expensive all by itself.&lt;/p>
&lt;p>So in practice nobody does this. Itâ€™s really considered a â€˜feasibilityâ€™ï¼ˆå¯è¡Œæ€§ï¼‰ result. Once you show that something is possible, the next step is to make it efficient.&lt;/p>
&lt;p>But we do use zero knowledge proofs, almost every day. In this post Iâ€™m going to spend some time talking about the moreÂ &lt;em>practical&lt;/em>Â ZK proofs that we actually use. To do that I just need give just a tiny bit of extra background.&lt;/p>
&lt;h3 id="proofs-vs-proofs-of-knowledge">&lt;strong>Proofs vs. Proofs of Knowledge&lt;/strong>
&lt;/h3>&lt;p>Before we go on, thereâ€™s one more concept we need to cover. Specifically, we need to discussÂ &lt;em>what precisely weâ€™re proving&lt;/em>Â when we conductï¼ˆæ‰§è¡Œï¼‰ a zero knowledge proof*.*Let me explain. At a high level, there are two kinds of statement you might want to prove in zero knowledge. Roughly speaking, these break up as follows.&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>Statements about â€œfactsâ€.&lt;/strong>Â For example, I might wish to prove thatÂ â€œa specific graph has a three coloringâ€ or â€œsome numberÂ NÂ is in the set of composite numbersâ€œ.Â Each of these is a statement about some intrinsic property of the universe.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>&lt;strong>Statements about my personal knowledge.&lt;/strong>Â Alternatively, I might wish to prove that IÂ knowÂ some piece information. Examples of this kind of statement include: â€œIÂ knowÂ a three coloring for this graphâ€, or â€œIÂ knowÂ the factorization ofÂ Nâ€.Â These go beyond merely proving that a fact is true, and actually rely on what the Prover knows.&lt;/p>
&lt;/blockquote>
&lt;p>é™ˆè¿°çš„å‘½é¢˜æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯äº‹å®ï¼Œä¸€ç§æ˜¯ä¸ªäººçš„çŸ¥è¯†ã€‚åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œä¸»è¦å…³æ³¨åœ¨ç¬¬äºŒç§å‘½é¢˜ã€‚&lt;/p>
&lt;p>Itâ€™s important to recognize that thereâ€™s a big difference between these two kinds of statements! For example, it may be possible to prove that a numberÂ &lt;em>N&lt;/em>Â is compositeÂ &lt;em>even if you donâ€™t know the full factorization.&lt;/em>Â So merely proving the first statement isÂ &lt;em>not&lt;/em>Â equivalent to proving the second one.&lt;/p>
&lt;p>The second class of proof is known as a â€œproof of knowledgeâ€. It turns out to be extremely useful for proving a variety of statements that we use in real life. In this post, weâ€™ll mostly be focusing on this kind of proof.&lt;/p>
&lt;h3 id="the-schnorr-identification-protocol">&lt;strong>The Schnorr identification protocol&lt;/strong>
&lt;/h3>&lt;p>Now that weâ€™ve covered some of the required background, itâ€™s helpful to move on to a specific and very useful proof of knowledge that was invented by Claus-Peter Schnorr in the 1980s. At first glance, the Schnorr protocol may seem a bit odd, but in fact itâ€™s the basis of many of our modern signature schemes today.&lt;/p>
&lt;p>Schnorr wasnâ€™t really concerned with digital signatures, however. His concern was withÂ &lt;em>identification.&lt;/em>Â Specifically, letâ€™s imagine that Alice has published her public key to the world, and later on wants to prove that she knows the secret key corresponding to that public key. This is the exact problem that we encounter in real-world protocols such as public-key SSH, so it turns out to be well-motivated.&lt;/p>
&lt;p>Schnorr began with the assumption that the public key would be of a very specific format. Specifically, letÂ &lt;em>p&lt;/em>Â be some prime number, and letÂ &lt;em>g&lt;/em>Â be aÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/Generating_set_of_a_group" target="_blank" rel="noopener"
>generator&lt;/a>Â of aÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/Cyclic_group" target="_blank" rel="noopener"
>cyclic group&lt;/a>ï¼ˆå¾ªç¯ç¾¤ï¼‰Â of prime-orderÂ &lt;em>q&lt;/em>. To generate a keypair, Alice would first pick a random integerÂ &lt;em>a&lt;/em>Â between 1 andÂ &lt;em>q&lt;/em>, and then compute the keypair as:&lt;/p>
&lt;blockquote>
&lt;p>$PK_A=g^a\mod p,SK_A = a$&lt;/p>
&lt;/blockquote>
&lt;p>(If youâ€™ve been around the block a time or two, youâ€™ll probably notice that this is the same type of key used forÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange" target="_blank" rel="noopener"
>Diffie-Hellman&lt;/a>Â and theÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/Digital_Signature_Algorithm" target="_blank" rel="noopener"
>DSA signing&lt;/a>Â algorithm. Thatâ€™s not a coincidence, and it makes this protocol very useful.)&lt;/p>
&lt;p>Alice keeps her secret key to herself, but sheâ€™s free to publish her public key to the world. Later on, when she wants to proveÂ &lt;em>knowledge&lt;/em>Â of her secret key, she conducts the following simple interactive protocol with Bob:&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-30-Zero-Knowledge-Proofs-An-illustrated-primer-Part2/Untitled%201.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>Thereâ€™s a lot going on in here, so letâ€™s take a minute to unpack things.&lt;/p>
&lt;p>First off, we should ask ourselves if the protocol isÂ &lt;em>complete.&lt;/em>Â This is usually the easiest property to verify: if Alice performs the protocol honestly, should Bob be satisfied at the end of it? In this case, completeness is pretty easy to see just by doing a bit of substitution:&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-30-Zero-Knowledge-Proofs-An-illustrated-primer-Part2/Untitled%202.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>æ³¨æ„ï¼Œç”±äºé€‰å–çš„$k \in { 1, \dots, q }$ï¼Œå› æ­¤$k\mod q = k$ã€‚&lt;/p>
&lt;p>è¿™é‡Œè¯æ˜äº†å®Œå¤‡æ€§ï¼šè¯šå®çš„Aliceæ˜¯èƒ½å¤Ÿè¯´æœBobçš„ã€‚&lt;/p>
&lt;h3 id="proving-soundness">&lt;strong>Proving soundness&lt;/strong>
&lt;/h3>&lt;p>The harder property isÂ &lt;em>soundness.&lt;/em>Â Mainly because we donâ€™t yet have a good definition of what it means for a proof of knowledge to beÂ &lt;em>sound.&lt;/em>Â Remember that what we want to show is the following:&lt;/p>
&lt;blockquote>
&lt;p>If Alice successfully convinces Bob, thenÂ she must knowÂ the secret keyÂ a.&lt;/p>
&lt;/blockquote>
&lt;p>å¯é æ€§ï¼šå¦‚æœAliceèƒ½å¤ŸæˆåŠŸè®©Bobä¿¡æœï¼Œé‚£ä¹ˆå¥¹ä¸€å®šçŸ¥é“å¯†é’¥$a$ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœAliceä¸æ˜¯è¯šå®çš„ï¼Œå¥¹ä¸çŸ¥é“å¯†é’¥$a$çš„è¯ï¼Œé‚£ä¹ˆå¥¹è‚¯å®šä¸èƒ½è¯´æœBobã€‚&lt;/p>
&lt;p>Itâ€™s easy to look at the equations above and try to convince yourself that Aliceâ€™s only way to cheat the protocol is to knowÂ &lt;em>a&lt;/em>. But thatâ€™s hardly a proof.&lt;/p>
&lt;p>When it comes to demonstrating the soundness of a proof of knowledge, we have a really nice formal approach. Just as with the Simulator we discussed above, we need to demonstrate the existence of a special algorithm. This algorithm is called aÂ &lt;em>&lt;strong>knowledge extractor&lt;/strong>&lt;/em>, and it does exactly what it claims to. A knowledge extractor (or just â€˜Extractorâ€™ for short) is a special type of Verifier that interacts with a Prover, and â€” if the Prover succeeds in completing the proof â€” the Extractor should be able to extract the Proverâ€™s original secret.&lt;/p>
&lt;p>æƒ³è¦è¯æ˜å¯é æ€§ï¼Œå€ŸåŠ©äºçŸ¥è¯†æå–å™¨æ¥è¯æ˜ã€‚ä¸€ä¸ªçŸ¥è¯†æå–å™¨æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„Verifierï¼Œå®ƒå’ŒProverè¿›è¡Œäº¤äº’ï¼Œå¦‚æœProverèƒ½æˆåŠŸé€šè¿‡è¯æ˜ï¼Œé‚£ä¹ˆæå–å™¨å¯ä»¥æå–åˆ°ProveråŸæ¥çš„å¯†ç ã€‚&lt;/p>
&lt;p>And this answers our question above. To proveÂ &lt;em>soundness&lt;/em>Â for a proof of knowledge, we must show that an Extractor exists for every possible Prover.&lt;/p>
&lt;p>ä¸ºäº†è¯æ˜å¯é æ€§ï¼Œæˆ‘ä»¬ç°åœ¨å¿…é¡»è¯æ˜å¯¹äºæ¯ä¸€ä¸ªå¯èƒ½çš„Proverï¼Œéƒ½å­˜åœ¨è¿™æ ·ä¸€ä¸ªæå–å™¨ã€‚ç»“åˆä¸Šé¢æåˆ°çš„å¯é æ€§é™ˆè¿°ï¼Œå¦‚æœAliceèƒ½å¤ŸæˆåŠŸè®©Bobä¿¡æœï¼Œé‚£ä¹ˆå¥¹ä¸€å®šçŸ¥é“å¯†é’¥$a$ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå¯¹äºæ¯ä¸€ä¸ªå¯èƒ½è®©Bobä¿¡æœçš„Aliceï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªçŸ¥è¯†æå–å™¨æ¥ä¸Aliceäº¤äº’ï¼Œèƒ½æå–åˆ°å¯†é’¥$a$ï¼Œä¸å°±è¯´æ˜äº†Aliceè‚¯å®šçŸ¥é“å¯†é’¥$a$å˜›ï¼å› æ­¤è¯æ˜äº†å¯é æ€§ã€‚&lt;/p>
&lt;p>è¯æ˜é€»è¾‘æ˜¯ï¼šå¯¹æ¯ä¸€ä¸ªå¯èƒ½çš„Proverå­˜åœ¨ä¸€ä¸ªæå–å™¨ â‡’ å¦‚æœAliceèƒ½è®©Bobä¿¡æœï¼ŒAliceä¸€å®šçŸ¥é“åŸæ¥çš„ç§˜å¯†ï¼ˆå¯é æ€§ï¼‰&lt;/p>
&lt;p>Of course this again seems totally contradictory to the purpose of a zero knowledge protocol â€” where weâ€™reÂ &lt;em>not&lt;/em>Â supposed to be able to learn secrets from a Prover. Fortunately weâ€™ve already resolved this conundrum once for the case of the Simulator. Here again, we take the same approach. The Extractor isÂ &lt;em>not&lt;/em>Â required to exist during a normal run of the protocol. We simply show that it exists if weâ€™re allowed to take special liberties with the Prover â€” in this case, weâ€™ll use â€˜rewindingâ€™ to wind back the Proverâ€™s execution and allow us to extract secrets.&lt;/p>
&lt;p>å½“ç„¶è¿™çœ‹èµ·æ¥åˆå’Œé›¶çŸ¥è¯†è¯æ˜åè®®çš„ç›®çš„å†²çªäº†ï¼Œä½†æ˜¯æˆ‘ä»¬ä¾ç„¶å¯ä»¥ç”¨æ¨¡æ‹Ÿå™¨çš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬åªéœ€è¦è®©Proveræ‹¥æœ‰è¶…èƒ½åŠ›ï¼Œç„¶åè¿™æ ·çš„æå–å™¨æ˜¯å­˜åœ¨çš„ã€‚è¿™ä¸ªè¶…èƒ½åŠ›å¯ä»¥æ˜¯æ—¶é—´æœºå™¨ï¼Œè‚¯å®šç°å®ä¸–ç•Œä¸å­˜åœ¨æ—¶é—´æœºå™¨ï¼Œå› æ­¤ä¸ä¼šå’Œæ³„æ¼çŸ¥è¯†è¿™ä¸ªç›®çš„ç›¸å†²çªã€‚&lt;/p>
&lt;p>The extractor for the Schnorr protocol is extremely clever â€” and itâ€™s also pretty simple. Letâ€™s illustrate it in terms of a protocol diagram. Alice (the Prover) is on the left, and the Extractor is on the right:&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-30-Zero-Knowledge-Proofs-An-illustrated-primer-Part2/Untitled%203.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>The key observation here is that by rewinding Aliceâ€™s execution, the Extractor can â€˜trickâ€™ Alice into making two different proof transcripts using the sameÂ &lt;em>k&lt;/em>. This shouldnâ€™t normally happen in a real protocol run, where Alice specifically picks a newÂ &lt;em>k&lt;/em>Â for each execution of the protocol.&lt;/p>
&lt;p>å…³é”®çš„ä¸€ç‚¹æ˜¯é€šè¿‡è®©Aliceé‡æ–°æ‰§è¡Œåˆ°ç¬¬2æ­¥ï¼Œæå–å™¨å¯ä»¥éª—Aliceç»™ä¸¤ä¸ªä¸åŒçš„è¯æ˜ä½†æ˜¯ç”¨åŒä¸€ä¸ª$k$ã€‚åœ¨å®é™…çš„åè®®è¿è¡Œä¸­ï¼Œè¿™æ˜¯é€šå¸¸ä¸åº”è¯¥å‘ç”Ÿçš„ï¼ŒAliceä¼šåœ¨åè®®æ¯æ¬¡æ‰§è¡Œçš„æ—¶å€™ç‰¹åˆ«é€‰æ‹©ä¸€ä¸ªæ–°çš„$k$ã€‚&lt;/p>
&lt;p>If the Extractor can trick Alice into doing this, then he can solve the following simple equation to recover Aliceâ€™s secret:&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-30-Zero-Knowledge-Proofs-An-illustrated-primer-Part2/Untitled%204.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>å¦‚æœæå–å™¨èƒ½å¤Ÿéª—Aliceè¿™æ ·åšçš„è¯ï¼Œæå–å™¨æ˜¯å¯ä»¥æå–åˆ°Aliceæ‹¥æœ‰çš„å¯†é’¥$a$ã€‚&lt;/p>
&lt;p>æ¨å¯¼çš„è¯¦ç»†è¿‡ç¨‹ï¼š&lt;/p>
$$
\begin{array}{l}
\frac{s_1 - s_2}{c_1 - c_2} \mod q &amp; \\\
\quad = \frac{((ac_1+k) \mod q)-((ac_2 + k) \mod q)}{c_1 - c_2} \mod q \\\
\quad = \frac{(ac_1+k)-(ac_2 + k) }{c_1 - c_2} \mod q \\\
\quad = \frac{ac_1 - ac_2 }{c_1 - c_2} \mod q \\\
\quad = a \mod q
\end{array}
$$&lt;p>Itâ€™s worth taking a moment right now to note that thisÂ &lt;em>also&lt;/em>Â implies a serious vulnerabilityï¼ˆæ¼æ´ï¼‰ in bad implementations of the Schnorr protocol. If you everÂ &lt;em>accidentally&lt;/em>Â use the sameÂ &lt;em>k&lt;/em>Â for two different runs of the protocol, an attacker may be able to recover your secret key! This can happen if you use a bad random number generator.&lt;/p>
&lt;p>éœ€è¦æ³¨æ„Schnorr protocolåœ¨å®é™…ä¸­å¯èƒ½å‡ºç°çš„æ¼æ´ï¼Œé‚£å°±æ˜¯åœ¨ä¸åŒè¿è¡Œä¸­ä½¿ç”¨ç›¸åŒçš„$k$ï¼Œå› æ­¤è¦é€‰æ‹©å¥½çš„éšæœºç”Ÿæˆå™¨ã€‚&lt;/p>
&lt;p>Indeed, those with a bit more experience will notice that this is similar to aÂ *&lt;a class="link" href="https://www.schneier.com/blog/archives/2011/01/sony_ps3_securi.html" target="_blank" rel="noopener"
>real*Â attack on systems (with bad random number generators)&lt;/a>Â that implement ECDSA or DSA signatures! This is also not a coincidence. The (EC)DSA signature family is based on Schnorr. Ironicallyï¼ˆè®½åˆºåœ°ï¼‰, the developers of DSA managed to retain this vulnerability of the Schorr family of protocols whileÂ &lt;em>at the same time&lt;/em>Â ditching the security proof that makes Schnorr so nice.&lt;/p>
&lt;h3 id="proving-zero-knowledgeness-against-an-honest-verifier">&lt;strong>Proving zero-knowledge(ness) against an honest Verifier&lt;/strong>
&lt;/h3>&lt;p>Having demonstratedï¼ˆè¯æ˜ï¼‰ that Schnorr signatures are complete and sound, it remains only to prove that theyâ€™re â€˜&lt;em>zero knowledgeâ€™&lt;/em>. Remember that to do this, normally we require a Simulator that can interact with any possible Verifier and produce a â€˜simulatedâ€™ transcript of the proof, even if the Simulator doesnâ€™t know the secret itâ€™s proving it knows.&lt;/p>
&lt;p>ä¸ºäº†è¯æ˜â€œé›¶çŸ¥è¯†â€ï¼Œä¸€èˆ¬è¦æ±‚æœ‰ä¸€ä¸ªå¯ä»¥å’Œæ‰€æœ‰å¯èƒ½çš„Verifierçš„æ¨¡æ‹Ÿå™¨ï¼Œè¾“å‡ºè¯æ˜çš„ç»“æœï¼Œè€Œæ¨¡æ‹Ÿå™¨ç”šè‡³ä¸çŸ¥é“å®ƒè¦è¯æ˜çš„çŸ¥è¯†ã€‚&lt;/p>
&lt;p>The standard Schnorr protocol does not have such a Simulator, for reasons weâ€™ll get into in a second. Instead, to make the proof work we need to make a special assumption. Specifically, the Verifier needs to be â€˜honestâ€™. That is, we need to make the special assumption that it will run its part of the protocol correctly â€” namely, that it will pick its challenge â€œ&lt;em>c&lt;/em>â€Â using only its random number generator,Â &lt;em>and will not choose this value based on any input we provide it&lt;/em>. As long as it does this, we can construct a Simulator.&lt;/p>
&lt;p>æ ‡å‡†çš„Schnorråè®®æ˜¯æ²¡æœ‰è¿™æ ·çš„æ¨¡æ‹Ÿå™¨çš„ã€‚è¿™é‡Œè¦åšä¸€ä¸ªå‡è®¾ï¼ŒVerifieréœ€è¦æ˜¯â€œè¯šå®çš„â€ã€‚æˆ‘ä»¬éœ€è¦å‡è®¾åœ¨Verifieré€‰æ‹©æŒ‘æˆ˜â€œcâ€æ—¶ï¼Œåªç”¨åˆ°ä¸€ä¸ªéšæœºæ•°ç”Ÿæˆå™¨ï¼Œè€Œä¸ä¼šé€‰æ‹©é‚£äº›åŸºäºä»»ä½•æˆ‘ä»¬æä¾›çš„è¾“å…¥ç”Ÿæˆçš„å€¼ã€‚&lt;/p>
&lt;p>Hereâ€™s how the Simulator works.&lt;/p>
&lt;p>Letâ€™s say we are trying to prove knowledge of a secret $a$ for some public key $g^a \mod p$ &lt;em>â€”&lt;/em> but we donâ€™t actually know the value*.* Our Simulator assumes that the Verifier will choose some value $c$ as its challenge, and moreover, it knows that the honest Verifier will choose the value $c$ only based on its random number generator â€” and not based on any inputs the Prover has provided.&lt;/p>
&lt;ol>
&lt;li>First, output some initialÂ Â $g^{k_1}$ as the Proverâ€™s first message*,*Â and find out what challenge $c$Â Â the Verifier chooses.&lt;/li>
&lt;li>&lt;em>Rewind the Verifier&lt;/em>, and pick a random integerÂ $z$Â in the rangeÂ ${ 0, \cdots, q-1 }$&lt;em>.&lt;/em>&lt;/li>
&lt;li>ComputeÂ $g^{k_2} = g^z * g^{a(-c)}$Â **and outputÂ $g^{k_2}$Â as the Proverâ€™s new initial message.&lt;/li>
&lt;li>When the Verifier challenges onÂ $c$Â again, outputÂ $z$.&lt;/li>
&lt;/ol>
&lt;p>Notice that the transcript $g^k,c,z$ will verify correctly as a perfectly valid, well-distributed proof of knowledge of the value $a$. The Verifier will accept this output as a valid proof of knowledge of $a$, even though the Simulator does not know $a$ in the first place!&lt;/p>
&lt;p>è¯¦ç»†çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-30-Zero-Knowledge-Proofs-An-illustrated-primer-Part2/Untitled%205.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>What this proves is thatÂ &lt;em>if we can rewind a Verifier&lt;/em>, then (just as in the first post in this series) we can always trick the Verifier into believing we have knowledge of a value, even when we donâ€™t. And since the statistical distribution of our protocol is identical to the real protocol, this means that our protocol must be zero knowledge â€” against an honest Verifier.&lt;/p>
&lt;p>åœ¨æ¨¡æ‹Ÿå™¨ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬å¯ä»¥å›æº¯Verifierï¼Œè®©è¯šå®çš„Verifierç›¸ä¿¡æˆ‘ä»¬æ˜¯çŸ¥é“å¯†é’¥$a$çš„ï¼Œä½†å…¶å®æˆ‘ä»¬æ ¹æœ¬ä¸çŸ¥é“$a$æ—¶å¤šå°‘ã€‚ç”±äºåœ¨ç»Ÿè®¡åˆ†å¸ƒä¸Šæˆ‘ä»¬çš„åè®®å’ŒçœŸå®çš„åè®®æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆå¯¹äºè¯šå®çš„Verifierï¼Œæˆ‘ä»¬çš„åè®®ä¸€å®šæ˜¯é›¶çŸ¥è¯†çš„ã€‚&lt;/p>
&lt;h3 id="from-interactive-tonon-interactive">&lt;strong>From interactive toÂ &lt;em>non-interactive&lt;/em>&lt;/strong>
&lt;/h3>&lt;p>So far weâ€™ve shown how to use the Schnorr protocol to &lt;em>interactively prove knowledge&lt;/em> of a secret key $a$ that corresponds to a public key $g^a$. This is an incredibly useful protocol, but it only works if our Verifier is online and willing to interact with us.&lt;/p>
&lt;p>An obvious question is whether we can make this protocol workÂ without interaction. Specifically, can I make a proof that I can send you without you even being online. Such a proof is called aÂ &lt;a class="link" href="https://en.wikipedia.org/wiki/Non-interactive_zero-knowledge_proof" target="_blank" rel="noopener"
>non-interactive zero knowledge proof&lt;/a>Â (NIZK).Â Turning Schnorr into a non-interactive proof seems initially quiteÂ difficult â€” since the protocol fundamentally relies on the Verifier picking a random challenge. Fortunately there is a clever trick we can use.&lt;/p>
&lt;p>This techniqueÂ wasÂ developed by Fiat and Shamir in the 1980s. What they observed was thatÂ &lt;em>if you have a decent hash function lying around,&lt;/em>Â you can convert an interactive protocol into a non-interactive one by simply using the hash function to pick the challenge.&lt;/p>
&lt;p>æ€ä¹ˆå°†äº¤äº’å¼é›¶çŸ¥è¯†è¯æ˜è½¬æ¢æˆéäº¤äº’å¼é›¶çŸ¥è¯†è¯æ˜å‘¢ï¼Ÿè½¬æ¢çš„éš¾ç‚¹åœ¨äºVerifieréœ€è¦é€‰æ‹©ä¸€ä¸ªéšæœºçš„æŒ‘æˆ˜ï¼Œä¸€ä¸ªè§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨å¯é çš„å“ˆå¸Œå‡½æ•°æ¥é€‰æ‹©è¿™ä¸ªæŒ‘æˆ˜ã€‚&lt;/p>
&lt;p>Specifically, the revised protocol for proving knowledge of $a$ with respect to a public key $g^k$ looks like this:&lt;/p>
&lt;ol>
&lt;li>The Prover picksÂ Â $g^k$ (just as in the interactiveÂ protocol).&lt;/li>
&lt;li>Now, the prover computesÂ the challenge as $c = H(g^k||M)$ whereÂ $H()$Â is a hash function, and $M$ is an (optional) and arbitary message string.&lt;/li>
&lt;li>ComputeÂ $ac+k \mod q$Â (just as in the interactive protocol).&lt;/li>
&lt;/ol>
&lt;p>The upshot here is that the hash function is picking the challenge $c$ without any interaction with the Verifier. In principle, if the hash function is â€œstrong enoughâ€ (meaning, itâ€™s a &lt;a class="link" href="https://blog.cryptographyengineering.com/2011/09/29/what-is-random-oracle-model-and-why-3/" target="_blank" rel="noopener"
>random oracle&lt;/a>) then the result is a completely non-interactive proof of knowledge of the value $a$ that the Prover can send to the Verifier. The proof of this is relatively straightforward.&lt;/p>
&lt;p>The particularly neat thing about this protocol is that it isnâ€™t just a proof of knowledge, itâ€™s also a &lt;em>signature scheme.&lt;/em> That is, if you put a message into the (optional) value $M$, you obtain a signature on $M$, whichÂ can only be produced by someone who knows the secret key $a$. The resulting protocol is called the Schnorr signature scheme, and itâ€™s the basis of real-world protocols like &lt;a class="link" href="https://en.wikipedia.org/wiki/EdDSA" target="_blank" rel="noopener"
>EdDSA&lt;/a>.&lt;/p>
&lt;p>è¿™ä¸ªåè®®ä¸ä»…ä»…æ˜¯çŸ¥è¯†çš„è¯æ˜ï¼Œä¹Ÿæ˜¯ä¸€ç§ç­¾åæ–¹æ¡ˆã€‚&lt;/p>
&lt;h3 id="phew">&lt;strong>Phew.&lt;/strong>
&lt;/h3>&lt;p>Yes, this has been a long post and thereâ€™s probably a lot more to be said. Hopefully there will be more time for that in a third post â€” which should only take me another three years.&lt;/p>
&lt;p>&lt;em>Notes:&lt;/em>&lt;/p>
&lt;ul>
&lt;li>In this definition, itâ€™s necessary that the statement be literally true.&lt;/li>
&lt;/ul></description></item><item><title>å®‰æ¯”å®éªŒå®¤é›¶çŸ¥è¯†è¯æ˜ä»‹ç»ç³»åˆ—æ–‡ç« </title><link>https://wenjin1997.github.io/2022/11/30/sec-bit-zkp-summary/</link><pubDate>Wed, 30 Nov 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/11/30/sec-bit-zkp-summary/</guid><description>&lt;img src="https://wenjin1997.github.io/img/2022-11-30-sec-bit-zkp-summary/toni-osmundson-ZQtk_VAvO7Y-unsplash.jpeg" alt="Featured image of post å®‰æ¯”å®éªŒå®¤é›¶çŸ¥è¯†è¯æ˜ä»‹ç»ç³»åˆ—æ–‡ç« " />&lt;p>æœ¬ç¯‡åšå®¢è®°å½•äº†å®‰æ¯”å®éªŒå®¤çŸ¥è¯†è¯æ˜ä»‹ç»ç³»åˆ—æ–‡ç« çš„ç¬”è®°ã€‚å‡ ç¯‡æ–‡ç« å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://secbit.io/blog/2019/07/31/zero-knowledge-and-proof/" target="_blank" rel="noopener"
>åˆè¯†ã€Œé›¶çŸ¥è¯†ã€ä¸ã€Œè¯æ˜ã€&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://secbit.io/blog/2019/08/06/understand-zero-knowledge-proof-by-simulator/" target="_blank" rel="noopener"
>ä»ã€Œæ¨¡æ‹Ÿã€ç†è§£é›¶çŸ¥è¯†è¯æ˜ï¼šå¹³è¡Œå®‡å®™ä¸æ—¶å…‰å€’æµ&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://secbit.io/blog/2019/08/28/extractor-and-proof-of-knowledge/" target="_blank" rel="noopener"
>è¯»å¿ƒæœ¯ï¼šä»é›¶çŸ¥è¯†è¯æ˜ä¸­æå–ã€ŒçŸ¥è¯†ã€&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://secbit.io/blog/2019/11/01/from-interactive-zkp-to-non-interactive-zkp/" target="_blank" rel="noopener"
>äºšç‘Ÿç‹çš„ã€Œéšæœºã€æŒ‘æˆ˜ï¼šä»äº¤äº’åˆ°éäº¤äº’å¼é›¶çŸ¥è¯†è¯æ˜&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="åˆè¯†é›¶çŸ¥è¯†ä¸è¯æ˜">åˆè¯†ã€Œé›¶çŸ¥è¯†ã€ä¸ã€Œè¯æ˜ã€
&lt;/h2>&lt;p>åŸæ–‡é“¾æ¥ï¼š&lt;a class="link" href="https://www.notion.so/08ecfbfe0c254900b8da3a81ab8001b8#5df9c0fd1da0455099a234b83f0af128" target="_blank" rel="noopener"
>åˆè¯†ã€Œé›¶çŸ¥è¯†ã€ä¸ã€Œè¯æ˜ã€&lt;/a>ã€‚&lt;/p>
&lt;p>æ–‡ç« å…ˆä»‹ç»äº†â€œè¯æ˜â€çš„å†å²ã€‚&lt;/p>
&lt;ul>
&lt;li>å¤å¸Œè…Šï¼šã€Œè¯æ˜ã€ == ã€Œæ´è§ã€&lt;/li>
&lt;li>äºŒåä¸–çºªåˆï¼šã€Œè¯æ˜ã€ == ã€Œç¬¦å·æ¨ç†ã€&lt;/li>
&lt;li>å…­åå¹´ä»£ï¼šã€Œè¯æ˜ã€ == ã€Œç¨‹åºã€&lt;/li>
&lt;li>å…«åå¹´ä»£ï¼šã€Œè¯æ˜ã€ == ã€Œäº¤äº’ã€ï¼Œæ‹“å®½äº†ã€Œè¯æ˜ã€çš„æ¦‚å¿µã€‚é€šè¿‡æ„é€ ä¸¤ä¸ªå›¾çµæœºè¿›è¡Œã€Œäº¤äº’ã€è€Œä¸æ˜¯ã€Œæ¨ç†ã€ï¼Œæ¥è¯æ˜ä¸€ä¸ªå‘½é¢˜åœ¨æ¦‚ç‡ä¸Šæ˜¯å¦æˆç«‹ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>é›¶çŸ¥è¯†è¯æ˜æœ‰ä»€ä¹ˆç”¨å¤„ï¼Ÿ&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>é›¶çŸ¥è¯†è¯æ˜æŠ€æœ¯å¯ä»¥è§£å†³æ•°æ®çš„ä¿¡ä»»é—®é¢˜ï¼Œè®¡ç®—çš„ä¿¡ä»»é—®é¢˜ï¼&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>é›¶çŸ¥è¯†è¯æ˜æŠ€æœ¯å¯ä»¥ã€Œæ¨¡æ‹Ÿã€å‡ºä¸€ä¸ªç¬¬ä¸‰æ–¹ï¼Œæ¥ä¿è¯æŸä¸€ä¸ªè®ºæ–­æ˜¯å¯ä¿¡çš„ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>æ¢å¥è¯è¯´ï¼Œå½“æˆ‘ä»¬æ”¶åˆ°ä¸€ä¸ªåŠ äº†å¯†çš„æ•°æ®ï¼Œ ç„¶åè¿˜æœ‰ä¸€ä¸ªé›¶çŸ¥è¯†è¯æ˜ã€‚è¿™ä¸ªé›¶çŸ¥è¯†è¯æ˜æ˜¯è¯´ ã€Œå…³äºæ•°æ®çš„ X æ–­è¨€æˆç«‹ã€ï¼Œé‚£ä¹ˆè¿™ç­‰ä»·äºæœ‰ä¸€ä¸ªå¤©ä½¿åœ¨æˆ‘ä»¬è€³è¾¹æ‚„å£°è¯´ï¼Œã€Œå…³äºæ•°æ®çš„X æ–­è¨€æˆç«‹ã€ï¼&lt;/p>
&lt;p>å¯¹äºè¿™ä¸ªÂ X æ–­è¨€ï¼Œå¯ä»¥éå¸¸çµæ´»ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªÂ NPå¤æ‚åº¦çš„ç®—æ³•ã€‚å¤§ç™½è¯è®²åªè¦æˆ‘ä»¬èƒ½å†™ä¸€æ®µç¨‹åºï¼ˆä¸€ä¸ªå¤šé¡¹å¼æ—¶é—´çš„ç®—æ³•ï¼‰æ¥åˆ¤æ–­ä¸€ä¸ªæ•°æ®æ˜¯å¦æ»¡è¶³Â X æ–­è¨€ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–­è¨€å°±å¯ä»¥ç”¨é›¶çŸ¥è¯†è¯æ˜çš„æ–¹å¼æ¥è¡¨è¾¾ã€‚é€šä¿—ç‚¹è®²ï¼Œåªè¦æ•°æ®åˆ¤å®šæ˜¯å®¢è§‚çš„ï¼Œé‚£ä¹ˆé›¶çŸ¥è¯†è¯æ˜å°±é€‚ç”¨ã€‚&lt;/p>
&lt;p>é›¶çŸ¥è¯†è¯æ˜çš„ç”¨å¤„ï¼š&lt;/p>
&lt;ul>
&lt;li>æ•°æ®çš„éšç§ä¿æŠ¤&lt;/li>
&lt;li>è®¡ç®—å‹ç¼©ä¸åŒºå—é“¾æ‰©å®¹&lt;/li>
&lt;li>ç«¯åˆ°ç«¯çš„é€šè®¯åŠ å¯†&lt;/li>
&lt;li>èº«ä»½è®¤è¯&lt;/li>
&lt;li>å»ä¸­å¿ƒåŒ–å­˜å‚¨&lt;/li>
&lt;li>ä¿¡ç”¨è®°å½•&lt;/li>
&lt;li>æ„é€ å®Œå…¨å…¬å¹³çš„ç°å®æ•°å­—åŒ–å•†å“çš„äº¤æ˜“åè®®&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>çŸ¥è¯†å’Œä¿¡æ¯çš„åŒºåˆ«ï¼š&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>ã€ŒçŸ¥è¯†ã€æ˜¯ä¸ã€Œè®¡ç®—éš¾åº¦ã€ç›¸å…³ï¼Œè€Œã€Œä¿¡æ¯ã€åˆ™ä¸æ˜¯&lt;/li>
&lt;li>ã€ŒçŸ¥è¯†ã€æ˜¯ä¸å…¬å…±æ‰€çŸ¥çš„ä¸œè¥¿æœ‰å…³ï¼Œè€Œã€Œä¿¡æ¯ã€ä¸»è¦ä¸éƒ¨åˆ†å…¬å¼€çš„ä¸œè¥¿æœ‰å…³&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>å¯éªŒè¯è®¡ç®—ä¸ç”µè·¯å¯æ»¡è¶³æ€§é—®é¢˜ï¼š&lt;/strong>&lt;/p>
&lt;p>å¦å¤–ç”µè·¯å¯æ»¡è¶³é—®é¢˜å’Œåœ°å›¾ä¸‰æŸ“è‰²é—®é¢˜ä¸€æ ·ï¼Œæ˜¯NP-Completeé—®é¢˜ã€‚NP-Complete æ˜¯ä¸€ç±»é—®é¢˜ï¼Œä»–çš„æ±‚è§£è¿‡ç¨‹æ˜¯å¤šé¡¹å¼æ—¶é—´å†…éš¾ä»¥å®Œæˆçš„ï¼Œå³ã€Œæ±‚è§£å›°éš¾ã€ï¼Œä½†æ˜¯éªŒè¯è§£çš„è¿‡ç¨‹æ˜¯å¤šé¡¹å¼æ—¶é—´å¯ä»¥å®Œæˆçš„ï¼Œå³ã€ŒéªŒè¯ç®€å•ã€ã€‚&lt;/p>
&lt;blockquote>
&lt;p>æ‰€è°“çš„ç”µè·¯å¯æ»¡è¶³æ€§å°±æ˜¯æŒ‡ï¼Œå­˜åœ¨æ»¡è¶³ç”µè·¯çš„ä¸€ä¸ªè§£ã€‚å¦‚æœè¿™ä¸ªè§£çš„è¾“å‡ºå€¼ç­‰äºä¸€ä¸ªç¡®å®šå€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªè§£å°±èƒ½ã€Œè¡¨ç¤ºã€ç”µè·¯çš„è®¡ç®—è¿‡ç¨‹ã€‚&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>ã€Œé›¶çŸ¥è¯†çš„ç”µè·¯å¯æ»¡è¶³æ€§è¯æ˜åè®®ã€æä¾›äº†ä¸€ç§æœ€ç›´æ¥çš„ä¿æŠ¤éšç§/æ•æ„Ÿæ•°æ®çš„æŠ€æœ¯&lt;/p>
&lt;/blockquote>
&lt;h2 id="ä»æ¨¡æ‹Ÿç†è§£é›¶çŸ¥è¯†è¯æ˜å¹³è¡Œå®‡å®™ä¸æ—¶å…‰å€’æµ">ä»ã€Œæ¨¡æ‹Ÿã€ç†è§£é›¶çŸ¥è¯†è¯æ˜ï¼šå¹³è¡Œå®‡å®™ä¸æ—¶å…‰å€’æµ
&lt;/h2>&lt;p>åŸæ–‡é“¾æ¥ï¼š&lt;a class="link" href="https://secbit.io/blog/2019/08/06/understand-zero-knowledge-proof-by-simulator/" target="_blank" rel="noopener"
>ä»ã€Œæ¨¡æ‹Ÿã€ç†è§£é›¶çŸ¥è¯†è¯æ˜ï¼šå¹³è¡Œå®‡å®™ä¸æ—¶å…‰å€’æµ&lt;/a>ã€‚&lt;/p>
&lt;p>&lt;strong>å®‰å…¨çš„å®šä¹‰ä¸ä¸å¯åŒºåˆ†æ€§&lt;/strong>&lt;/p>
&lt;p>è¿™ä¸€éƒ¨åˆ†æ˜¯å¯†ç å­¦ä¸­çš„çŸ¥è¯†ã€‚&lt;/p>
&lt;p>ä¸€åˆ‡å®‰å…¨éƒ½æœ‰å‰æçš„ã€‚åªæœ‰ç»è¿‡æ•°å­¦è¯æ˜ä¹‹åï¼Œå¤§å®¶æ‰èƒ½å¤Ÿç¡®ä¿¡è¿™ä¸ª ç®—æ³•/æ–¹æ¡ˆ çš„å®‰å…¨æ€§åŸºäºä¸€äº›éå¸¸æ˜ç¡®çš„ã€Œå®‰å…¨å‡è®¾ã€ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å®Œç¾å®‰å…¨ï¼šå‡è®¾ä½ æ˜¯ä¸€ä¸ªæ”»å‡»è€…ï¼Œä½ é€šè¿‡å¯†æ–‡è·å–ä¸åˆ°ä»»ä½•æœ‰ä»·å€¼çš„ä¿¡æ¯ï¼Œç ´è§£çš„å”¯ä¸€æ‰‹æ®µå°±æ˜¯é çè’™ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>ğŸ“ åœ¨Dan Boneh and Victor Shoup çš„ ã€ŠA Graduate Course in Applied Cryptographyã€‹ä¹¦ä¸­å®šä¹‰ä¸ºï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-30-sec-bit-zkp-summary/perfect%20security.png"
loading="lazy"
>&lt;/p>
&lt;p>é€šè¿‡å¯†æ–‡è·å–ä¸åˆ°ä¿¡æ¯ï¼Œè¿™å°±æ„å‘³ç€ä½ æ²¡æœ‰è·å¾—ä»»ä½•é¢å¤–çš„è®¡ç®—èƒ½åŠ›ï¼Œèƒ½å¤Ÿå¸®åŠ©è®©ä½ ä»¥æ›´çŸ­çš„æ—¶é—´æ¥è®¡ç®—å‡ºæ˜æ–‡ã€‚&lt;/p>
&lt;blockquote>
&lt;p>è¯­ä¹‰å®‰å…¨ï¼šå‡è®¾ä½ æ˜¯ä¸€ä¸ªæ”»å‡»è€…ï¼Œä½ é€šè¿‡å¯†æ–‡åœ¨å¤šé¡¹å¼æ—¶é—´å†…è®¡ç®—ä¸å‡ºæ¥ä»»ä½•æœ‰ä»·å€¼çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>ğŸ“’ä¹¦ä¸­å®šä¹‰ä¸ºï¼š
&lt;img src="https://wenjin1997.github.io/img/2022-11-30-sec-bit-zkp-summary/semantic%20security.png"
loading="lazy"
>&lt;/p>
&lt;p>ä¸å¯åŒºåˆ†çš„æ¦‚å¿µï¼š
æˆ‘ä»¬åˆå¼•å…¥ä¸€ä¸ªæ¦‚å¿µâ€”â€”ã€Œä¸å¯åŒºåˆ†æ€§ã€ï¼Œæ¥é‡æ–°è¡¨è¿°åŠ å¯†ç®—æ³•çš„å®‰å…¨æ€§ï¼šå‡è®¾ä½ æ˜¯ä¸€ä¸ªæ”»å‡»è€…ï¼Œè€Œæˆ‘æœ‰ä¸€ä¸ªåŠ å¯†ç®—æ³•ï¼š&lt;/p>
&lt;ol>
&lt;li>ä½ éšæœºäº§ç”Ÿä¸¤æ®µç­‰é•¿çš„æ˜æ–‡ï¼Œ&lt;code>m1&lt;/code>=ã€Œç™½æ—¥ä¾å±±å°½ï¼Œé»„æ²³å…¥æµ·æµã€ï¼Œ&lt;code>m2&lt;/code>=ã€Œçƒ«çƒ«çƒ«çƒ«çƒ«ï¼Œçƒ«çƒ«çƒ«çƒ«çƒ«ã€&lt;/li>
&lt;li>ä½ æŠŠè¿™ä¸¤æ®µæ˜æ–‡ï¼Œ&lt;code>m1&lt;/code>Â ä¸Â &lt;code>m2&lt;/code>Â äº¤ç»™æˆ‘&lt;/li>
&lt;li>æˆ‘éšæœºæŒ‘é€‰ä¸€ä¸ªæ˜æ–‡ï¼Œä¸å‘Šè¯‰ä½ æ˜¯å“ªä¸€ä¸ªï¼Œç„¶åè¿›è¡ŒåŠ å¯†ï¼Œäº§ç”Ÿä¸€ä¸ªå¯†æ–‡Â &lt;code>c&lt;/code>&lt;/li>
&lt;li>æˆ‘æŠŠå¯†æ–‡Â &lt;code>c&lt;/code>Â å‡ºç¤ºç»™ä½ çœ‹ï¼Œè®©ä½ çŒœè¿™ä¸ª&lt;code>c&lt;/code>Â ç©¶ç«Ÿæ˜¯ç”±å”è¯—åŠ å¯†äº§ç”Ÿï¼Œè¿˜æ˜¯ä¹±ç åŠ å¯†äº§ç”Ÿ&lt;/li>
&lt;li>å¦‚æœä½ ç”¨ä¸€å°è®¡ç®—æœºæ¥ç ´è§£&lt;code>c&lt;/code>ï¼Œåœ¨å¤šé¡¹å¼æ—¶é—´å†…ç ´è§£ä¸å‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ æ²¡åŠæ³•åŒºåˆ†&lt;code>c&lt;/code>çš„æ¥æºï¼Œé‚£ä¹ˆå°±è¯´æ˜åŠ å¯†ç®—æ³•æ˜¯è¯­ä¹‰å®‰å…¨çš„&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>åŒºåˆ†ä¸¤ä¸ªä¸–ç•Œ&lt;/strong>&lt;/p>
&lt;p>è¯æ˜çš„é›¶çŸ¥è¯†è¿‡ç¨‹ï¼Œç­‰ä»·äºæ„é€ ï¼ˆå¯»æ‰¾ï¼‰ä¸€ä¸ªã€Œæ¨¡æ‹Ÿã€ç®—æ³•ï¼Œè¿™ä¸ªç®—æ³•èƒ½å¤Ÿè®©æ¨¡æ‹Ÿå™¨æ¥æ¨¡æ‹Ÿå‡ºä¸€ä¸ªã€Œæ²¡æœ‰çŸ¥è¯†ã€çš„ç†æƒ³ä¸–ç•Œã€‚å¦‚æœè¿™ä¸ªç®—æ³•å­˜åœ¨ï¼Œè€Œä¸”ä¸¤ä¸ªä¸–ç•Œä¸å¯åŒºåˆ†ï¼Œé‚£ä¹ˆå°±è¯æ˜å®Œæ¯•ã€‚&lt;/p>
&lt;p>æ‰€è°“çš„ä¸å¯åŒºåˆ†æ€§é’ˆå¯¹çš„æ˜¯ç†æƒ³ä¸–ç•Œä¸­çš„ä¸ªä½“è®¤çŸ¥è€Œè¨€ã€‚è€Œã€Œå¯åŒºåˆ†æ€§ã€æ˜¯å¯¹ä½äºä¸–ç•Œå¤–éƒ¨çš„ç¥è€Œè¨€ã€‚&lt;/p>
&lt;p>é¦–å…ˆã€Œé›¶çŸ¥è¯†ã€æ˜¯ä¸ºäº†ä¿æŠ¤ Alice çš„åˆ©ç›Šï¼Œå› ä¸º Alice ä¸æƒ³åœ¨äº¤äº’è¿‡ç¨‹ä¸­é€éœ²æ›´å¤šçš„ä¿¡æ¯ç»™ Bobï¼Œä¸æƒ³è®© Bob çŸ¥é“å¥¹æ‰€æ‹¥æœ‰çš„ç§˜å¯†Â wï¼Œç”šè‡³ä¸æƒ³è®© Bob ä»äº¤äº’çš„è¿‡ç¨‹ä¸­åˆ†æå‡ºå“ªæ€•ä¸€ä¸ç‚¹çš„ä¿¡æ¯ã€‚é‚£ä¹ˆæ€ä¹ˆä¿è¯è¿™ä¸€ç‚¹å‘¢ï¼Ÿã€Œæ¨¡æ‹Ÿå™¨ã€è¿™æ—¶å€™ç™»åœºäº†ï¼Œå®ƒèƒ½æ¨¡æ‹Ÿå‡ºä¸€ä¸ªå’Œç°å®ä¸–ç•Œå¤–è¡¨ä¸€æ¨¡ä¸€æ ·çš„ã€Œç†æƒ³ä¸–ç•Œã€ï¼Œç„¶åã€Œæ¨¡æ‹Ÿå™¨ã€åœ¨è¿™ä¸ªä¸–ç•Œä¸­å¯ä»¥è½»æ¾åœ°éª—è¿‡ä»»ä½•ä¸€ä¸ªå¯¹æ‰‹ï¼Œè®©å¯¹æ–¹æ— æ³•åˆ†è¾¨è‡ªå·±æ˜¯åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œè¿˜æ˜¯ç†æƒ³ä¸–ç•Œä¸­ã€‚å› ä¸ºã€Œæ¨¡æ‹Ÿå™¨ã€æ‰‹é‡Œæ²¡æœ‰é‚£ä¸ªç§˜å¯†Â wï¼Œã€Œç†æƒ³ä¸–ç•Œã€æ˜¯é›¶çŸ¥è¯†çš„ã€‚åˆå› ä¸ºä¸¤ä¸ªä¸–ç•Œçš„ä¸å¯åŒºåˆ†æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼šAlice çš„äº¤äº’åè®®æ˜¯ã€Œé›¶çŸ¥è¯†ã€çš„ã€‚&lt;/p>
&lt;p>&lt;strong>åœ°å›¾ä¸‰æŸ“è‰²é—®é¢˜çš„é›¶çŸ¥è¯†è¯æ˜&lt;/strong>&lt;/p>
&lt;p>æ–‡ç« ä¸­ç”¨å›¾ç‰‡å½¢è±¡çš„è¯´æ˜äº†é›¶çŸ¥è¯†è¯æ˜çš„è¿‡ç¨‹ã€‚ä¸è¿‡è¿™æ˜¯é’ˆå¯¹è¯šå®çš„Bobï¼Œå¦‚æœæ˜¯ä¸è¯šå®çš„Bobå‘¢ï¼Ÿå¦‚æœåœ¨æ¨¡æ‹Ÿå™¨ç¬¬ä¸€æ¬¡å®æ–½æ—¶é—´å€’æµä¹‹åï¼ŒBobåˆé€‰æ‹©äº†ä¸åŒçš„è¾¹ï¼Œé‚£ä¹ˆæ¨¡æ‹Ÿå™¨å¯ä»¥æŠŠé¢œè‰²æ‰“ä¹±ä¹‹åï¼Œå†æ¬¡è¿è¡Œæ—¶é—´å€’æµï¼Œåœ¨å¤šæ¬¡æ—¶é—´å€’æµä¹‹åï¼ŒBob æå¤§çš„æ¦‚ç‡æ€»ä¼šä¸€æ¬¡é€‰æ‹©æ¨¡æ‹Ÿå™¨è¿›è¡ŒæŸ“è‰²çš„é‚£æ¡è¾¹ï¼Œç„¶åè¿™æ—¶å€™æ¨¡æ‹Ÿå™¨æ‰èµ°åˆ°ç¬¬ä¸‰æ­¥ï¼Œæ‰“å¼€çº¸ç‰‡ã€‚&lt;/p>
&lt;p>&lt;strong>é˜¿é‡Œå·´å·´ã€æ´ç©´ä¸èŠéº»å¼€é—¨&lt;/strong>&lt;/p>
&lt;p>æ–‡ç« ä¸­å†æ¬¡é˜è¿°äº†é˜¿é‡Œå·´å·´ä¸å¤§ç›—çš„æ•…äº‹ï¼Œè¿™ä¸ªæ•…äº‹æ¥æºäºè®ºæ–‡&lt;a class="link" href="http://pages.cs.wisc.edu/~mkowalcz/628.pdf" target="_blank" rel="noopener"
>How to explain zero-knowledge protocols to your children&lt;/a>ï¼Œæˆ‘çš„è®ºæ–‡çš„ç¬”è®°è§&lt;a class="link" href="https://wenjin1997.github.io/2022/11/28/How-to-explain-zero-knowledge-protocols-to-your-children/" target="_blank" rel="noopener"
>è¿™é‡Œ&lt;/a>ã€‚The Jealous Reporterç”¨çš„å‰ªè¾‘æ‰‹æ®µå°±æ˜¯æ¨¡æ‹Ÿå™¨ä¸­çš„è¶…èƒ½åŠ›ï¼Œç”±äºä¸¤å®¶ç”µè§†å°æ”¾å‡ºçš„å½±ç‰‡äººä»¬æ— æ³•åŒºåˆ†ï¼Œè€Œå‡çš„é‚£ä¸ªæ ¹æœ¬ä¸çŸ¥é“æ´ç©´çš„ç§˜å¯†ï¼Œè¿™ä¹Ÿå°±è¯æ˜äº†è¿™ä¸ªè¿‡ç¨‹æ˜¯é›¶çŸ¥è¯†çš„ã€‚&lt;/p>
&lt;p>&lt;strong>æ¨¡æ‹Ÿå™¨ä¸å›¾çµæœº&lt;/strong>&lt;/p>
&lt;p>æ¨¡æ‹Ÿå™¨ä¸èƒ½éšä¾¿å¼€æŒ‚ã€‚æ¨¡æ‹Ÿå™¨å…¶å®åªæ˜¯ä¸€ä¸ªå›¾çµæœºï¼Œè€Œå‰é¢æåˆ°çš„æ—¶é—´å€’æµæ˜¯å›¾çµæœºå¯ä»¥å®ç°çš„åŠŸèƒ½ã€‚&lt;/p>
&lt;p>æ–‡ç« ä¸­ä¸‹é¢è¿™æ®µè¯å¾ˆé‡è¦ğŸ‘‡&lt;/p>
&lt;p>è¯æ˜é›¶çŸ¥è¯†çš„è¿‡ç¨‹ï¼Œå°±æ˜¯è¦å¯»æ‰¾ä¸€ä¸ªç®—æ³•ï¼Œæˆ–è€…æ›´é€šä¿—ç‚¹è¯´ï¼Œå†™å‡ºä¸€æ®µä»£ç ï¼Œå®ƒè¿è¡Œåœ¨å¤–éƒ¨è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œä½†æ˜¯å®ç°äº†è™šæ‹Ÿæœºçš„åŠŸèƒ½ã€‚è€Œä¸”åœ¨è™šæ‹Ÿæœºä¸­ï¼Œéœ€è¦æœ‰ä¸€ä¸ªä¸å¸¦æœ‰ã€ŒçŸ¥è¯†ã€ä½œä¸ºè¾“å…¥çš„ Zliceï¼Œå¯ä»¥éª—è¿‡æ”¾å…¥è™šæ‹Ÿæœºè¿è¡Œçš„ Bobã€‚&lt;/p>
&lt;h2 id="è¯»å¿ƒæœ¯ä»é›¶çŸ¥è¯†è¯æ˜ä¸­æå–çŸ¥è¯†">è¯»å¿ƒæœ¯ï¼šä»é›¶çŸ¥è¯†è¯æ˜ä¸­æå–ã€ŒçŸ¥è¯†ã€
&lt;/h2>&lt;p>è¿™ç¯‡æ–‡ç« å®é™…æ˜¯åœ¨è¯´æ˜é›¶çŸ¥è¯†è¯æ˜ä¸­çš„å¯é æ€§ã€‚&lt;/p>
&lt;p>&lt;strong>ã€Œé›¶çŸ¥è¯†ã€vs. ã€Œå¯é æ€§ã€&lt;/strong>
ã€Œé›¶çŸ¥è¯†è¯æ˜ã€å¹¶ä¸æ˜¯é€šè¿‡ç»™å‡ºä¸€ä¸ª&lt;strong>ä¸å…è®¸å‘ç”Ÿçš„äº‹ä»¶åˆ—è¡¨&lt;/strong>æ¥å®šä¹‰ï¼Œè€Œæ˜¯ç›´æ¥ç»™å‡ºäº†ä¸€ä¸ªæœ€æè‡´çš„ã€Œæ¨¡æ‹Ÿæ¡ä»¶ã€ã€‚&lt;/p>
&lt;p>æ‰€è°“ã€Œæ¨¡æ‹Ÿæ¡ä»¶ã€æ˜¯æŒ‡ï¼Œé€šè¿‡ã€Œæ¨¡æ‹Ÿã€æ–¹æ³•æ¥å®ç°ä¸€ä¸ªã€Œç†æƒ³ä¸–ç•Œã€ï¼Œä½¿ä¹‹ä¸ã€Œç°å®ä¸–ç•Œã€ä¸å¯åŒºåˆ†ï¼›è€Œç”±äºåœ¨ç†æƒ³ä¸–ç•Œä¸­ä¸å­˜åœ¨çŸ¥è¯†ï¼Œæ‰€ä»¥å¯ä»¥æ¨å¯¼å‡ºç»“è®ºï¼šç°å®ä¸–ç•Œæ»¡è¶³ã€Œé›¶çŸ¥è¯†ã€ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ç»§ç»­åˆ†æä¸‹ä¸€ä¸ªäº¤äº’ç³»ç»Ÿï¼ˆå®‰å…¨åè®®ï¼‰çš„ä¸‰ä¸ªæ€§è´¨ï¼šã€Œå®Œå¤‡æ€§ã€ã€ã€Œå¯é æ€§ã€ä¸ã€Œé›¶çŸ¥è¯†ã€ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å¯é æ€§ï¼ˆSoundnessï¼‰ï¼šAlice åœ¨æ²¡æœ‰çŸ¥è¯†çš„æƒ…å†µä¸‹ä¸èƒ½é€šè¿‡ Bob çš„éªŒè¯ã€‚&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>å®Œå¤‡æ€§ï¼ˆCompletenessï¼‰ï¼šAlice åœ¨æœ‰çŸ¥è¯†çš„æƒ…å†µä¸‹å¯ä»¥é€šè¿‡ Bob çš„éªŒè¯ã€‚&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>é›¶çŸ¥è¯†ï¼ˆZero-knowledgeï¼‰ï¼šAlice åœ¨äº¤äº’çš„è¿‡ç¨‹ä¸­ä¸ä¼šæ³„éœ²å…³äºçŸ¥è¯†çš„ä»»ä½•ä¿¡æ¯ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ã€Œå¯é æ€§ã€å’Œã€Œå®Œå¤‡æ€§ã€æœ‰ä¸€ç§ã€Œå¯¹ç§°æ€§ã€ã€‚å¯é æ€§ä¿è¯äº†æ¶æ„çš„ Alice ä¸€å®šå¤±è´¥ï¼Œè€Œå®Œå¤‡æ€§ä¿è¯äº†è¯šå®çš„ Alice ä¸€å®šæˆåŠŸã€‚&lt;/p>
&lt;p>&lt;strong>ç®€æ´çš„Schnorråè®®&lt;/strong>&lt;/p>
&lt;p>ğŸ“ è¿™ä¸€å°èŠ‚çš„å†…å®¹è¡¥å……äº†å…³äºç¾¤çš„çŸ¥è¯†ã€‚&lt;/p>
&lt;p>Alice æ‹¥æœ‰ä¸€ä¸ªç§˜å¯†æ•°å­—ï¼Œ&lt;code>a&lt;/code>ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªæ•°å­—æƒ³è±¡æˆã€Œç§é’¥ã€ï¼Œç„¶åæŠŠå®ƒã€Œæ˜ å°„ã€åˆ°æ¤­åœ†æ›²çº¿ç¾¤ä¸Šçš„ä¸€ä¸ªç‚¹Â &lt;code>a*G&lt;/code>ï¼Œç®€å†™ä¸ºÂ &lt;code>aG&lt;/code>ã€‚è¿™ä¸ªç‚¹æˆ‘ä»¬æŠŠå®ƒå½“åšã€Œå…¬é’¥ã€ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>sk = a&lt;/code>&lt;/li>
&lt;li>&lt;code>PK = aG&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>è¯·æ³¨æ„ã€Œæ˜ å°„ã€è¿™ä¸ªè¯ï¼Œæˆ‘ä»¬è¿™é‡Œå…ˆç®€è¦ä»‹ç»ã€ŒåŒæ€ã€è¿™ä¸ªæ¦‚å¿µã€‚æ¤­åœ†æ›²çº¿ç¾¤æœ‰é™åŸŸä¹‹é—´å­˜åœ¨ç€ä¸€ç§åŒæ€æ˜ å°„å…³ç³»ã€‚æœ‰é™åŸŸï¼Œæˆ‘ä»¬ç”¨Â &lt;code>Zq&lt;/code>è¿™ä¸ªç¬¦å·è¡¨ç¤ºï¼Œå…¶ä¸­ç´ æ•°Â &lt;code>q&lt;/code>æ˜¯æŒ‡æœ‰é™åŸŸçš„å¤§å°ï¼Œå®ƒæ˜¯æŒ‡ä»Â &lt;code>0, 1, 2, â€¦, q-1&lt;/code>Â è¿™æ ·ä¸€ä¸ªæ•´æ•°é›†åˆã€‚è€Œåœ¨ä¸€æ¡æ¤­åœ†æ›²çº¿ä¸Šï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªåŸºç‚¹ï¼Œ&lt;code>G&lt;/code>ï¼Œå¯ä»¥äº§ç”Ÿä¸€ä¸ªã€Œå¾ªç¯ç¾¤ã€ï¼Œæ ‡è®°ä¸ºÂ &lt;code>0G, G, 2G, â€¦, (q-1)G&lt;/code>ï¼Œæ­£å¥½æ˜¯æ•°é‡ä¸ºÂ &lt;code>q&lt;/code>ä¸ª æ›²çº¿ç‚¹çš„é›†åˆã€‚ä»»æ„ä¸¤ä¸ªæ›²çº¿ç‚¹æ­£å¥½å¯ä»¥è¿›è¡Œä¸€ç§ã€Œç‰¹æ®Šçš„äºŒå…ƒè¿ç®—ã€ï¼Œ&lt;code>G + G = 2G&lt;/code>ï¼Œ&lt;code>2G + 3G = 5G&lt;/code>ï¼Œçœ‹èµ·æ¥è¿™ä¸ªäºŒå…ƒè¿ç®—å¥½åƒå’Œã€ŒåŠ æ³•ã€ç±»ä¼¼ï¼Œæ»¡è¶³äº¤æ¢å¾‹å’Œç»“åˆå¾‹ã€‚äºæ˜¯æˆ‘ä»¬å°±ç”¨Â &lt;code>+&lt;/code>è¿™ä¸ªç¬¦å·æ¥è¡¨ç¤ºã€‚ä¹‹æ‰€ä»¥æŠŠè¿™ä¸ªç¾¤ç§°ä¸ºå¾ªç¯ç¾¤ï¼Œå› ä¸ºæŠŠç¾¤çš„æœ€åä¸€ä¸ªå…ƒç´ Â &lt;code>(q-1)G&lt;/code>ï¼Œå†åŠ ä¸Šä¸€ä¸ªÂ &lt;code>G&lt;/code>å°±å›å·åˆ°ç¾¤çš„ç¬¬ä¸€ä¸ªå…ƒç´ Â &lt;code>0G&lt;/code>ã€‚&lt;/p>
&lt;p>ç»™ä»»æ„ä¸€ä¸ªæœ‰é™åŸŸä¸Šçš„æ•´æ•°Â &lt;code>r&lt;/code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å¾ªç¯ç¾¤ä¸­æ‰¾åˆ°ä¸€ä¸ªå¯¹åº”çš„ç‚¹Â &lt;code>rG&lt;/code>ï¼Œæˆ–è€…ç”¨ä¸€ä¸ªæ ‡é‡ä¹˜æ³•æ¥è¡¨ç¤ºÂ &lt;code>r*G&lt;/code>ã€‚ä½†æ˜¯åè¿‡æ¥è®¡ç®—æ˜¯å¾ˆã€Œå›°éš¾ã€çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªã€Œå¯†ç å­¦éš¾é¢˜ã€â€”â€” è¢«ç§°ä¸ºç¦»æ•£å¯¹æ•°éš¾é¢˜[2]ã€‚&lt;/p>
&lt;p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä»»æ„ç»™ä¸€ä¸ªæ¤­åœ†æ›²çº¿å¾ªç¯ç¾¤ä¸Šçš„ç‚¹Â &lt;code>R&lt;/code>ï¼Œé‚£ä¹ˆåˆ°åº•æ˜¯æœ‰é™åŸŸä¸­çš„å“ªä¸€ä¸ªæ•´æ•°å¯¹åº”Â &lt;code>R&lt;/code>ï¼Œè¿™ä¸ªè®¡ç®—æ˜¯å¾ˆéš¾çš„ï¼Œå¦‚æœæœ‰é™åŸŸè¶³å¤Ÿå¤§ï¼Œæ¯”å¦‚è¯´ 256bit è¿™ä¹ˆå¤§ï¼Œæˆ‘ä»¬å§‘ä¸”å¯ä»¥è®¤ä¸ºè¿™ä¸ªåå‘è®¡ç®—æ˜¯ä¸å¯èƒ½åšåˆ°çš„ã€‚&lt;/p>
&lt;p>Schnorr åè®®å……åˆ†åˆ©ç”¨äº†æœ‰é™åŸŸå’Œå¾ªç¯ç¾¤ä¹‹é—´å•å‘æ˜ å°„ï¼Œå®ç°äº†æœ€ç®€å•çš„é›¶çŸ¥è¯†è¯æ˜å®‰å…¨åè®®ï¼šAlice å‘ Bob è¯æ˜å¥¹æ‹¥æœ‰Â &lt;code>PK&lt;/code>Â å¯¹åº”çš„ç§é’¥Â &lt;code>sk&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;code>z&lt;/code>Â çš„è®¡ç®—å’ŒéªŒè¯è¿‡ç¨‹å¾ˆæœ‰è¶£ï¼Œæœ‰å‡ ä¸ªå…³é”®æŠ€å·§ï¼š&lt;/p>
&lt;ol>
&lt;li>é¦–å…ˆ Bob å¿…é¡»ç»™å‡ºä¸€ä¸ªã€Œéšæœºã€æŒ‘æˆ˜æ•°ï¼Œç„¶å Bob åœ¨æ¤­åœ†æ›²çº¿ä¸ŠåŒæ€åœ°æ£€æŸ¥Â &lt;code>z&lt;/code>Â ã€‚å¦‚æœæˆ‘ä»¬æŠŠæŒ‘æˆ˜æ•°Â &lt;code>c&lt;/code>Â çœ‹æˆæ˜¯ä¸€ä¸ªæœªçŸ¥æ•°ï¼Œé‚£ä¹ˆÂ &lt;code>r+a*c=z&lt;/code>Â å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹ï¼Œå…¶ä¸­Â &lt;code>r&lt;/code>Â ä¸Â &lt;code>a&lt;/code>Â æ˜¯æ–¹ç¨‹ç³»æ•°ã€‚è¯·æ³¨æ„åœ¨Â &lt;code>c&lt;/code>Â æœªçŸ¥çš„å‰æä¸‹ï¼Œå¦‚æœÂ &lt;code>r + a*x = r' + a'*x&lt;/code>Â è¦æˆç«‹ï¼Œé‚£ä¹ˆæ ¹æ® Schwatz-Zippel å®šç†[3]ï¼Œæå¤§æ¦‚ç‡ä¸ŠÂ &lt;code>r=r'&lt;/code>ï¼Œ&lt;code>a=a'&lt;/code>Â éƒ½æˆç«‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ Alice åœ¨Â &lt;code>c&lt;/code>Â æœªçŸ¥çš„å‰æä¸‹ï¼Œæƒ³æ‰¾åˆ°å¦ä¸€å¯¹ä¸åŒçš„Â &lt;code>r'&lt;/code>,&lt;code>a'&lt;/code>Â æ¥è®¡ç®—Â &lt;code>z&lt;/code>Â éª—è¿‡ Bob æ˜¯å‡ ä¹ä¸å¯èƒ½çš„ã€‚è¿™ä¸ªéšæœºæŒ‘æˆ˜æ•°Â &lt;code>c&lt;/code>Â å®ç°äº†&lt;code>r&lt;/code>Â å’ŒÂ &lt;code>a&lt;/code>Â çš„é™åˆ¶ã€‚è™½ç„¶ Bob éšæœºé€‰äº†ä¸€ä¸ªæ•°ï¼Œä½†æ˜¯ç”±äº Alice äº‹å…ˆä¸çŸ¥é“ï¼Œæ‰€ä»¥ Alice ä¸å¾—ä¸ä½¿ç”¨ç§é’¥Â &lt;code>a&lt;/code>Â æ¥è®¡ç®—Â &lt;code>z&lt;/code>ã€‚è¿™é‡Œçš„å…³é”®ï¼šÂ &lt;code>c&lt;/code>Â å¿…é¡»æ˜¯ä¸ªéšæœºæ•°ã€‚&lt;/li>
&lt;li>Bob éªŒè¯æ˜¯åœ¨æ¤­åœ†æ›²çº¿ç¾¤ä¸Šå®Œæˆã€‚Bob ä¸çŸ¥é“&lt;code>r&lt;/code>ï¼Œä½†æ˜¯ä»–çŸ¥é“Â &lt;code>r&lt;/code>Â æ˜ å°„åˆ°æ›²çº¿ä¸Šçš„ç‚¹&lt;code>R&lt;/code>ï¼›Bob ä¹Ÿä¸çŸ¥é“Â &lt;code>a&lt;/code>ï¼Œä½†æ˜¯ä»–çŸ¥é“Â &lt;code>a&lt;/code>Â æ˜ å°„åˆ°æ›²çº¿ç¾¤ä¸Šçš„ç‚¹Â &lt;code>PK&lt;/code>ï¼Œå³Â &lt;code>a*G&lt;/code>ã€‚é€šè¿‡åŒæ€æ˜ å°„ä¸Schwatz-Zippel å®šç†ï¼ŒBob å¯ä»¥æ ¡éªŒÂ &lt;code>z&lt;/code>Â çš„è®¡ç®—è¿‡ç¨‹æ˜¯å¦æ­£ç¡®ï¼Œä»è€ŒçŸ¥é“ Alice ç¡®å®æ˜¯é€šè¿‡Â &lt;code>r&lt;/code>Â å’ŒÂ &lt;code>a&lt;/code>Â è®¡ç®—å¾—å‡ºçš„Â &lt;code>z&lt;/code>ï¼Œä½†æ˜¯åˆä¸æš´éœ²Â &lt;code>r&lt;/code>Â ä¸Â &lt;code>a&lt;/code>Â çš„å€¼ã€‚&lt;/li>
&lt;li>è¿˜æœ‰ï¼Œåœ¨åè®®ç¬¬ä¸€æ­¥ä¸­äº§ç”Ÿçš„éšæœºæ•°Â &lt;code>r&lt;/code>Â ä¿è¯äº†Â &lt;code>a&lt;/code>Â çš„ä¿å¯†æ€§ã€‚å› ä¸ºä»»ä½•ä¸€ä¸ªç§˜å¯†å½“å’Œä¸€ä¸ªç¬¦åˆã€Œä¸€è‡´æ€§åˆ†å¸ƒã€çš„éšæœºæ•°ç›¸åŠ ä¹‹åçš„å’Œä»ç„¶ç¬¦åˆã€Œä¸€è‡´æ€§åˆ†å¸ƒã€ã€‚&lt;/li>
&lt;/ol>
&lt;p>ğŸ“ &lt;code>c&lt;/code>å¿…é¡»æ˜¯éšæœºæ•°ã€‚&lt;/p>
&lt;p>&lt;strong>å†é‡æ¨¡æ‹Ÿå™¨&lt;/strong>&lt;/p>
&lt;p>å…¶å®ï¼Œã€Œå¯é æ€§ã€å’Œã€Œé›¶çŸ¥è¯†ã€è¿™ä¸¤ä¸ªæ€§è´¨åœ¨å¦ä¸€ä¸ªç»´åº¦ä¸Šä¹Ÿæ˜¯å­˜åœ¨ç€ä¸€ç§å¯¹ç§°æ€§ã€‚**å¯é æ€§ä¿è¯äº†æ¶æ„çš„ Alice ä¸€å®šå¤±è´¥ï¼Œé›¶çŸ¥è¯†ä¿è¯äº†æ¶æ„çš„ Bob ä¸€å®šä¸ä¼šæˆåŠŸã€‚**æœ‰è¶£åœ°æ˜¯ï¼Œè¿™ç§å¯¹ç§°æ€§å°†ä½“ç°åœ¨æ¨¡æ‹Ÿå‡ºæ¥çš„ã€Œç†æƒ³ä¸–ç•Œã€ä¸­ã€‚&lt;/p></description></item><item><title>Cryptographic and Physical Zero-Knowledge Proof Systems for Solutions of Sudoku Puzzles</title><link>https://wenjin1997.github.io/2022/11/29/Cryptographic-and-Physical-Zero-Knowledge-Proof-Systems-for-Solutions-of-Sudoku-Puzzles/</link><pubDate>Tue, 29 Nov 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/11/29/Cryptographic-and-Physical-Zero-Knowledge-Proof-Systems-for-Solutions-of-Sudoku-Puzzles/</guid><description>&lt;img src="https://wenjin1997.github.io/img/2022-11-29-Cryptographic-and-Physical-Zero-Knowledge-Proof-Systems-for-Solutions-of-Sudoku-Puzzles/background.jpg" alt="Featured image of post Cryptographic and Physical Zero-Knowledge Proof Systems for Solutions of Sudoku Puzzles" />&lt;p>è®ºæ–‡è§&lt;a class="link" href="https://link.springer.com/content/pdf/10.1007/s00224-008-9119-9.pdf" target="_blank" rel="noopener"
>Cryptographic and Physical Zero-Knowledge Proof Systems for Solutions of Sudoku Puzzles&lt;/a>ã€‚æœ¬ç¯‡è®ºæ–‡è¯¦ç»†çš„ä»‹ç»äº†å…³äºæ•°ç‹¬é—®é¢˜çš„å¯†ç å­¦å’Œç‰©ç†ä¸Šçš„é›¶çŸ¥è¯†è¯æ˜åè®®ã€‚å¯ä»¥äº†è§£åˆ°é›¶çŸ¥è¯†è¯æ˜åè®®çš„å®Œæ•´è¿‡ç¨‹ï¼Œä¸€èˆ¬æ­¥éª¤æœ‰å“ªäº›ã€‚&lt;/p>
&lt;h2 id="1-introduction">1 Introduction
&lt;/h2>&lt;p>å¦‚ä½•åœ¨ä¸é€éœ²è§£çš„æƒ…å†µä¸‹è®©åˆ«äººç›¸ä¿¡ä½ çŸ¥é“ä¸€ä¸ªæ•°ç‹¬çš„è§£ã€‚å…³æ³¨ä¸¤ä»¶äº‹ï¼Œè¯æ˜è€…å¦‚ä½•è¯´æ˜ï¼š&lt;/p>
&lt;ol>
&lt;li>ç»™å®šä¸€ä¸ªæ•°ç‹¬é—®é¢˜ï¼Œå­˜åœ¨ä¸€ä¸ªè§£&lt;/li>
&lt;li>ä»–çŸ¥é“è¿™ä¸ªè§£ï¼Œä½†æ˜¯ä¸ç”¨ç»™å‡ºå…³äºè§£çš„ä»»ä½•å…¶ä»–ä¿¡æ¯&lt;/li>
&lt;/ol>
&lt;p>æ•°ç‹¬é—®é¢˜åœ¨è®¡ç®—å¤æ‚åº¦ä¸Šå±äºNPé—®é¢˜ï¼Œäº‹å®ä¸Šï¼Œæ˜¯NP-å®Œå…¨é—®é¢˜ã€‚NPé—®é¢˜æ„å‘³ç€å¾ˆå®¹æ˜“éªŒè¯ä¸€ä¸ªè§£æ˜¯å¦æ­£ç¡®ã€‚&lt;/p>
&lt;h2 id="2-definitions">2 Definitions
&lt;/h2>&lt;p>ä¸€èˆ¬åŒ–çš„æ•°ç‹¬é—®é¢˜ï¼Œæ•°ç‹¬é—®é¢˜çš„å¤§å°æ˜¯ $n = k^2$ï¼Œæ€»å…± $n \times n$ä¸ªæ ¼å­ï¼Œæ¯ä¸ªå°å—æ˜¯ $k \times k$å¤§å°çš„ï¼Œé‚£ä¹ˆæ•°çš„èŒƒå›´æ˜¯ ${ 1, &amp;hellip;, n}$ã€‚æ¯”å¦‚å¸¸è§çš„ $k = 3$ï¼Œ$9 \times 9$ å¤§å°çš„æ•°ç‹¬ã€‚ä¸€ä¸ªå…·ä½“æ•°ç‹¬é—®é¢˜ä¾‹å­å’Œè§£éƒ½æ˜¯ $O(n^2 \log n)$ ä½çš„ã€‚&lt;/p>
&lt;h3 id="cryptographic-functionalities">Cryptographic Functionalities
&lt;/h3>&lt;p>åè®®ä¸­æœ‰ä¸¤æ–¹ï¼Œä¸€ä¸ªæ˜¯proverï¼Œä¸€ä¸ªæ˜¯verifierã€‚ä¸€æ—¦proverå’Œverifierå›ºå®šä¸‹æ¥ï¼Œä»–ä»¬äº¤äº’å‘çš„æ¶ˆæ¯å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªåªåŒ…å«proverå’Œverifieréšæœºæ•°çš„å‡½æ•°ã€‚ä¸‹é¢è®¨è®ºè¿™ä¸ªåè®®çš„ä¸€äº›æ€§è´¨ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>completeness.&lt;/p>
&lt;p>ä¸€ä¸ªè¯šå®çš„verifierä¼šaccepectä¸€ä¸ªæ­£ç¡®çš„è¯æ˜ã€‚ä¹Ÿå°±æ˜¯ä¸€ä¸ªproveræœ‰ä¸€ä¸ªåˆæ³•çš„è§£ä¼šéµå¾ªè¿™ä¸ªåè®®ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>soundness error.&lt;/p>
&lt;blockquote>
&lt;p>The &lt;strong>soundness error&lt;/strong> (or soundness) of the protocol is the (upper bound on the) probability that a verifier accepts an incorrect proof, i.e. a proof to a fallacious statement; in our case this corresponds to the event that a prover who does not a solution to a given Sudoku puzzle, claims that it knows to solve it, and the verifier accepts this claim.&lt;/p>
&lt;/blockquote>
&lt;p>å¯¹äºé”™è¯¯çš„è¯æ˜ï¼Œä¼šæœ‰å¤šå°‘çš„æ¦‚ç‡é€šè¿‡verifierçš„éªŒè¯ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>zero-knowledge.&lt;/p>
&lt;blockquote>
&lt;p>The goal in designing the protocols is to prevent the verifier from gaining any new knowledge from a correct (interactive) proof. I.e., the protocol should be zero- knowledge in the following sense: whatever a verifier could learn by interacting with the correct prover, the verifier could learn itself.&lt;/p>
&lt;/blockquote>
&lt;p>ä»€ä¹ˆæ˜¯é›¶çŸ¥è¯†å‘¢ï¼Ÿæ— è®ºverifieré€šè¿‡ä¸proveräº¤äº’å­¦åˆ°äº†ä»€ä¹ˆï¼Œé‚£ä¹ˆverifierä¹Ÿèƒ½é€šè¿‡å’Œè‡ªå·±äº¤äº’å­¦åˆ°è¿™äº›çŸ¥è¯†ï¼Œæ‰æ˜¯çœŸçš„æ²¡æœ‰æ³„éœ²ä»»ä½•åˆ«çš„çŸ¥è¯†ã€‚å®é™…æ“ä½œä¸­æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„æ¨¡æ‹Ÿå™¨ã€‚è¿™ä¸ªæ¨¡æ‹Ÿå™¨ä¼šç”Ÿæˆverifierå’Œproverä¹‹é—´çš„å¯¹è¯ï¼ŒåŒæ—¶åªçŸ¥é“puzzleï¼Œè€Œä¸çŸ¥é“æ•°ç‹¬çš„è§£ã€‚è¦æ±‚æ¨¡æ‹Ÿå™¨ä¸­verifierä¸proverå¯¹è¯ä¹‹é—´çš„åˆ†å¸ƒå’ŒçœŸå®çš„æƒ…å†µä¸‹ä¸¤è€…ä¹‹é—´çš„åˆ†å¸ƒæ˜¯ä¸€æ ·çš„ï¼Œè¿™æ ·å°±æ— æ³•åŒºåˆ†æ¨¡æ‹Ÿå™¨å’ŒçœŸå®çš„æƒ…å†µã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>proofs-of-knowledge.&lt;/p>
&lt;blockquote>
&lt;p>Our protocols should also be &lt;em>&lt;strong>proofs-of-knowledge&lt;/strong>&lt;/em>: if the prover (or anyone imper-
sonating him) can succeed in making the verifier accept, then there is another ma-
chine, called the &lt;em>extractor&lt;/em>, that can communicate with the prover and actually come
up with the solution itself. This must involve running the prover several times using
the same randomness (which is not possible under normal circumstances), so as not
to contradict the zero-knowledge properties.&lt;/p>
&lt;/blockquote>
&lt;p>è¯æ˜proverç¡®å®æœ‰çŸ¥è¯†ï¼Œå­˜åœ¨è¿™æ ·ä¸€ä¸ªæå–å™¨ï¼Œå®ƒèƒ½å¤Ÿé€šè¿‡å’Œproveräº¤äº’å¾—åˆ°çŸ¥è¯†ï¼Œå½“ç„¶ï¼Œå®ƒä¸èƒ½å‘é€é€šå¸¸çš„éšæœºæ•°ï¼Œå®ƒå¯ä»¥å¤šæ¬¡ä½¿ç”¨ç›¸åŒçš„éšæœºæ•°ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>è®ºæ–‡ä¸­è¯æ˜ä¸­ç”¨åˆ°çš„å”¯ä¸€çš„å¯†ç å­¦å·¥å…·æ˜¯ commitment protocolã€‚ä¸€ä¸ªæ‰¿è¯ºåè®®ï¼Œå‘é€æ–¹å‘æ¥æ”¶æ–¹æ‰¿è¯ºä¸€ä¸ªå€¼ï¼Œæ¥æ”¶æ–¹ä¸ä¼šå­¦åˆ°ä»»ä½•å…³äºè¿™ä¸ªå€¼æœ‰ç”¨çš„ä¿¡æ¯ã€‚è¿™æ ·çš„ä¸€ä¸ªåè®®åŒ…å«ä¸¤ä¸ªé˜¶æ®µï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>commit phase&lt;/strong> æ‰¿è¯ºé˜¶æ®µã€‚&lt;/p>
&lt;p>å‘é€æ–¹ç»‘å®šä¸€äº›å€¼ $v$ï¼Œæ¥æ”¶æ–¹ä¸èƒ½å†³å®šä»»ä½•å…³äº $v$ æœ‰ç”¨çš„ä¿¡æ¯ã€‚ç‰¹åˆ«åœ°ï¼Œå¯¹äºä»»æ„çš„$b$å’Œ$bâ€™$ï¼Œæ¥å—æ–¹æ— æ³•åŒºåˆ†$v=b$å’Œ$v=bâ€™$ã€‚è¿™ä¸ªæ€§è´¨ç§°ä¸º &lt;strong>&lt;strong>&lt;strong>&lt;strong>&lt;strong>&lt;strong>&lt;strong>hiding&lt;/strong>&lt;/strong>&lt;/strong>&lt;/strong>&lt;/strong>&lt;/strong>&lt;/strong>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>decommit or reval phase&lt;/p>
&lt;p>æ¥æ”¶æ–¹è·å¾—$v$åï¼Œç¡®ä¿å®ƒæ˜¯åŸæ¥çš„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦commité˜¶æ®µç»“æŸï¼Œæ¥æ”¶æ–¹ä¼šåœ¨revalé˜¶æ®µæ¥æ”¶ä¸€ä¸ªå”¯ä¸€çš„å€¼ã€‚è¿™ä¸ªæ€§è´¨ç§°ä¸º &lt;strong>binding&lt;/strong>ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>bit commitmentå¯ä»¥é«˜æ•ˆæ‰§è¡Œã€‚&lt;/p>
&lt;h3 id="physical-protocols">Physical Protocols
&lt;/h3>&lt;p>åœ¨æ–‡ç« ä¸­ä½¿ç”¨ tamper-evident sealed envelopesï¼Œä¹Ÿå°±æ˜¯é˜²æ‹†å°ä¿¡å°ã€‚åœ¨æ•°ç‹¬çš„ä¾‹å­ä¸­ï¼Œæ¯ä¸ªç›–ä½çš„å¡ç‰‡å½“ä½œæ˜¯è¿™æ ·çš„ tamper-evident sealed envelopesï¼Œå°†å¡ç‰‡ç¿»å¼€å°±ç›¸å½“äºæ‹†å¼€ä¿¡å°ã€‚&lt;/p>
&lt;h2 id="3-cryptographic-protocols">3. Cryptographic Protocols
&lt;/h2>&lt;p>veriferè¦ä¿è¯ä¸¤ä»¶äº‹æƒ…ï¼š&lt;/p>
&lt;ol>
&lt;li>å­˜åœ¨ä¸€ä¸ªè§£&lt;/li>
&lt;li>the prover çŸ¥é“è¿™ä¸ªè§£&lt;/li>
&lt;/ol>
&lt;p>é›¶çŸ¥è¯†åè®®è¯æ˜çš„ç»“æ„ï¼š&lt;/p>
&lt;blockquote>
&lt;ol>
&lt;li>The prover commits to several values. These values are functions of the instance,
the solution and some randomization known only to the prover. è¯æ˜æ–¹æ‰¿è¯ºä¸€äº›å€¼ã€‚&lt;/li>
&lt;li>The verifier requests that the prover open some of the committed valuesâ€”this is
called the &lt;em>challenge&lt;/em>. The verifier chooses the challenge at random from a collec-
tion of possible challenges. éªŒè¯æ–¹å‘èµ·æŒ‘æˆ˜ã€‚&lt;/li>
&lt;li>The prover opens the requested values. è¯æ˜æ–¹æ‰“å¼€è¦æ±‚çš„å€¼ã€‚&lt;/li>
&lt;li>The verifier checks the consistency of the opened values with the given instance,
and accepts or rejects accordingly. éªŒè¯æ–¹éªŒè¯ç»™å®šå®ä¾‹æ‰“å¼€å€¼çš„ä¸€è‡´æ€§ï¼Œç„¶åç›¸åº”åœ°æ¥å—æˆ–è€…æ‹’ç»ã€‚&lt;/li>
&lt;/ol>
&lt;/blockquote>
&lt;p>è¦æ±‚åœ¨æ­¥éª¤3ä¸­æ‰“å¼€çš„å€¼çš„åˆ†å¸ƒæ˜¯ä¸€ä¸ªå…³äºæ•°ç‹¬é—®é¢˜å’Œæ­¥éª¤2ä¸­å‘é€çš„æŒ‘æˆ˜çš„æœ‰æ•ˆå‡½æ•°ã€‚é‚£ä¹ˆç»“åˆæ‰¿è¯ºåè®®çš„ä¸å¯åŒºåˆ†æ€§è´¨ï¼Œè¯´æ˜äº†æœ‰æ•ˆæ¨¡æ‹Ÿå™¨çš„å­˜åœ¨æ€§ã€‚&lt;/p>
&lt;p>æ¨¡æ‹Ÿå™¨çš„æ“ä½œå¦‚ä¸‹ï¼šåœ¨æ­¥éª¤2ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªéªŒè¯æ–¹å¯èƒ½å‘èµ·çš„æŒ‘æˆ˜ï¼Œè®¡ç®—æ­¥éª¤1ä¸­ä¼šæ»¡è¶³æŒ‘æˆ˜çš„å€¼ã€‚æ¨¡æ‹Ÿå™¨æ¨¡æ‹Ÿå°†è¿™äº›å€¼å‘é€ç»™éªŒè¯æ–¹ï¼Œç„¶åè¿è¡ŒéªŒè¯æ–¹çš„ç®—æ³•ï¼Œç”¨åˆšåˆšå¾—åˆ°çš„å€¼å’Œæ•°ç‹¬é—®é¢˜ä½œä¸ºè¾“å…¥ã€‚æ¨¡æ‹Ÿå™¨ä¼šè·å¾—åœ¨æ­¥éª¤2ä¸­å‘é€çš„æŒ‘æˆ˜ã€‚å¦‚æœè¿™ä¸ªæŒ‘æˆ˜æ˜¯å®ƒä¹‹å‰çŒœçš„å€¼ï¼Œæ¨¡æ‹Ÿå™¨å°±ä¼šæ‰“å¼€ä¹‹å‰å‘é€çš„æ‰¿è¯ºï¼Œé‚£ä¹ˆéªŒè¯æ–¹è‡ªç„¶ä¼šæ¥å—ï¼Œæ¨¡æ‹Ÿå™¨å¯ä»¥ç»§ç»­æ‰§è¡Œè¿™ä¸ªåè®®ï¼Œå¦åˆ™çš„è¯ï¼Œæ¨¡æ‹Ÿå™¨ä¼šé‡ç½®å¹¶é‡æ–°å¼€å§‹ã€‚è¿™é‡Œæœ‰ç‚¹ç»•ï¼ŒåŸæ–‡å¦‚ä¸‹ï¼š&lt;/p>
&lt;blockquote>
&lt;p>The simulator operates in the following way: it picks at random a challenge that the verifier might send in Step 2 (i.e. it guesses what the verifierâ€™s challenge will be), and computes commitments for Step 1 that will satisfy this challenge. The simulator simulates sending these commitments to the verifier, then it runs the verifierâ€™s algo- rithm with the puzzle as its input, a fresh set of random bits and these commitments being the first message it receives. It then obtains the challenge the verifier sends in Step 2. If this challenge is indeed the value it guessed, then the simulator can open the commitments it sent and the verifier should accept; the simulator can continue simulating the protocol and output the transcript of the simulated protocol execution. Otherwise, the simulator resets the simulation and starts it all over again.&lt;/p>
&lt;/blockquote>
&lt;p>å¦‚æœå¯èƒ½çš„æŒ‘æˆ˜çš„æ•°é‡æ˜¯å¤šé¡¹å¼çš„ï¼Œé‚£ä¹ˆæ¯æ¬¡æ¨¡æ‹Ÿå™¨çŒœæµ‹éªŒè¯æ–¹çš„æŒ‘æˆ˜ï¼Œå°±æ˜¯ç”¨â€œreasonably highâ€æ¦‚ç‡æ˜¯æ­£ç¡®çš„ã€‚è¿™ä¸ªè¿‡ç¨‹ä¿è¯äº†åè®®æ˜¯é›¶çŸ¥è¯†çš„ï¼Œå› ä¸ºæ¨¡æ‹Ÿå™¨çš„è¾“å‡ºå’ŒéªŒè¯æ–¹ä»è¯æ˜æ–¹äº¤äº’å¾—åˆ°çš„è¾“å‡ºæ˜¯ä¸èƒ½åŒºåˆ†çš„ï¼Œä½†æ˜¯æ¨¡æ‹Ÿå™¨è¿™ä¸€è¿‡ç¨‹çš„è®¡ç®—æ˜¯æ²¡æœ‰å’Œè¯æ˜æ–¹äº¤äº’çš„ï¼Œé‚£è‚¯å®šä¸èƒ½å¾—åˆ°ä»»ä½•å…³äºè§£çš„çŸ¥è¯†ã€‚&lt;/p>
&lt;h3 id="31-a-protocol-based-on-coloring">3.1 A Protocol Based on Coloring
&lt;/h3>&lt;p>å¯¹äº3-Colorability Protocolï¼Œè¯æ˜è€…é‡æ–°æ’åˆ—é¢œè‰²ï¼Œç„¶åæäº¤æ¯ä¸ªé¡¶ç‚¹é‡æ–°æ’åˆ—ä¹‹åçš„é¢œè‰²ã€‚éªŒè¯æ–¹éšæœºé€‰æ‹©ä¸€æ¡è¾¹ï¼Œæ£€æŸ¥è¾¹çš„ä¸¤ç«¯é¢œè‰²æ˜¯å¦æ˜¯ä¸åŒçš„ã€‚&lt;/p>
&lt;p>å¯¹äºæ•°ç‹¬é—®é¢˜ï¼Œè¿™ä¸ªåè®®æ˜¯å¦‚ä¸‹è¿™æ ·çš„ï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-29-Cryptographic-and-Physical-Zero-Knowledge-Proof-Systems-for-Solutions-of-Sudoku-Puzzles/Untitled.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>Proveræ­¥éª¤1æ˜¯éšæœºé€‰æ‹©ä¸€ä¸ªæ’åˆ—$\sigma$ï¼Œä»${1,\dots,n}$æ˜ å°„åˆ°${1,\dots,n}$ï¼Œè¿™æ ·é¿å…æ³„æ¼åŸæ¥çš„è§£ã€‚&lt;/p>
&lt;h3 id="32-an-efficient-cryptographic-protocol-with-constant-soundness-error">3.2 An Efficient Cryptographic Protocol with Constant Soundness Error
&lt;/h3>&lt;p>ä¸‹é¢è¿™ç§åè®®æœ‰å¸¸æ•°çš„soundness errorã€‚è¿™ä¸ªåè®®çš„æƒ³æ³•æ˜¯å°†æ¯ä¸ªå•å…ƒå¤åˆ¶ä¸‰ä»½ï¼Œåˆ›å»ºå…³äºè§£çš„è¡Œã€åˆ—ä»¥åŠå­ç½‘æ ¼çš„è§†è§’ã€‚å¤åˆ¶åçš„æ¯ä¸ªå•å…ƒéšæœºæ’åˆ—ï¼Œproverçš„å·¥ä½œæ˜¯è¯´æ˜ä»¥ä¸‹æ€§è´¨ï¼š&lt;/p>
&lt;ol>
&lt;li>å¯¹åº”è¡Œã€åˆ—ã€å­ç½‘æ ¼å«æœ‰æ‰€æœ‰å¯èƒ½çš„æ•°å­—ï¼Œå¦‚${ 1,2,&amp;hellip;,n }$ã€‚&lt;/li>
&lt;li>ä¸€ä¸ªå•å…ƒçš„ä¸‰ä¸ªç‰ˆæœ¬çš„å€¼éƒ½æ˜¯ç›¸åŒçš„ã€‚&lt;/li>
&lt;li>è¿™äº›å¤åˆ¶åçš„å•å…ƒä¸­åŒ…å«é¢„å…ˆç¡®å®šçš„å€¼ã€‚&lt;/li>
&lt;/ol>
&lt;p>å¦‚æœä¸Šè¿°ä¸‰ä¸ªæ¡ä»¶éƒ½æ»¡è¶³çš„è¯ï¼Œè¯´æ˜å­˜åœ¨è¿™æ ·ä¸€ä¸ªè§£å¹¶ä¸”proveræ˜¯çŸ¥é“å®ƒçš„ã€‚å…·ä½“çš„åè®®å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-29-Cryptographic-and-Physical-Zero-Knowledge-Proof-Systems-for-Solutions-of-Sudoku-Puzzles/Untitled%201.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>ä¸Šé¢è¿‡ç¨‹ä¸æ˜¯å¾ˆå¥½ç†è§£ï¼Œä¾‹å¦‚$n=4$çš„æƒ…å†µï¼Œ$3 \times n^2 = 2 \times 4^2 = 3 \times 16$ï¼Œæ•°ç‹¬è°œé¢˜é‡Œå¡«çš„æ•°å­—èŒƒå›´æ˜¯ ${ 1,2,3,4 }$ã€‚è¿™æ ·æœ‰è§£çš„ä¸‰ä¸ªå‰¯æœ¬ï¼Œåˆ†åˆ«æ˜¯è¡Œã€åˆ—ã€subgridsã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-29-Cryptographic-and-Physical-Zero-Knowledge-Proof-Systems-for-Solutions-of-Sudoku-Puzzles/Untitled%202.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>Proverï¼š&lt;/p>
&lt;ol>
&lt;li>æäº¤$3 \times n^2$ ä¸ªå€¼ $v_1,v_2,â€¦,v_{3 \times 4^2}$ã€‚$v_{i_1}ã€v_{i_2}ã€v_{i_3}$ æ˜¯åŸæ¥æ•°ç‹¬è§£ä¸­çš„å€¼ï¼Œæœ‰ç›¸åŒçš„å€¼ï¼Œ$(i_1,i_2,i_3)$ æ˜¯ä¸€ä¸ªä¸‰å…ƒç»„ï¼Œæ˜¯éšæœºçš„ä¸‹æ ‡ï¼Œä¾‹å¦‚å›¾ä¸­çš„$(3,16,9)$ã€$(80,1,17)$ã€‚&lt;/li>
&lt;li>æäº¤èŒƒå›´${ 1,2, \dots , 3 \times n^2 }$ä¸­ $n^2$ä¸ªä¸‰å…ƒç»„$(i_1,i_2,i_3)$ï¼Œä¾‹å¦‚${ (3,16,9),(80,1,17)\dots,(i_1,i_2,i_3), \dots }$ã€‚&lt;/li>
&lt;li>æäº¤æ­¥éª¤2ä¸­ä¸ªæ¯ä¸ªä¸‰å…ƒç»„çš„åå­—ï¼Œå¦‚$(3,16,9)$çš„åå­—å°±æ˜¯$(rows,columns,subgrids)$ï¼Œ$(80,1,17)$å¯¹åº”çš„æ˜¯$(subgrids,rows,columns)$ã€‚&lt;/li>
&lt;li>æäº¤æ­¥éª¤1ä¸­$3n$ç»„ä½ç½®ï¼Œå¯¹åº”è¡Œã€åˆ—å’Œå­ç½‘æ ¼ï¼Œå¹¶ä¸”åœ¨æ¯ç»„ä¸­ä¸ä¼šå­˜åœ¨ç›¸äº¤çš„ä¸¤ä¸ªå•å…ƒæ ¼ã€‚ä¾‹å¦‚å›¾ä¸­è“è‰²ç®­å¤´éƒ¨åˆ†ã€‚&lt;/li>
&lt;/ol>
&lt;p>Verifierï¼šé€‰æ‹©ä»¥ä¸‹ä¸‰ä¸ªä¸­çš„ä¸€ä¸ªè¿›è¡ŒæŒ‘æˆ˜ï¼š&lt;/p>
&lt;p>(a) æ‰“å¼€æ­¥éª¤1ä¸­$3 \times n^2$ä¸ªå€¼ï¼Œä»¥åŠæ­¥éª¤4ä¸­$3n$ç»„çš„ä½ç½®ã€‚éªŒè¯æ¯ç»„ä¸­æ˜¯å¦å«æœ‰$n$ä¸ªä¸åŒçš„å€¼ï¼Œä»»æ„ä¸¤ç»„ä¹‹é—´ä¸ç›¸äº¤ã€‚&lt;/p>
&lt;p>(b)æ‰“å¼€æ­¥éª¤1ä¸­$3n^2$ä¸ªå€¼ä»¥åŠæ­¥éª¤2ã€‚éªŒè¯æäº¤çš„ä¸‰å…ƒç»„å¯¹åº”ä¸‹æ ‡çš„å€¼éƒ½æ˜¯ç›¸åŒçš„ã€‚&lt;/p>
&lt;p>(c)æ‰“å¼€æ­¥éª¤2ã€3ã€4ä¸­æäº¤çš„å€¼ä»¥åŠæ­¥éª¤1ä¸­å·²ç»å¡«å¥½çš„æ•°ç‹¬ï¼Œå¦‚å›¾ä¸­ç´«è‰²æ•°å­—ã€‚éªŒè¯(i)æ‰“å¼€çš„å€¼å’Œä¹‹å‰è®¾å®šçš„å€¼æ˜¯ä¸€è‡´çš„ï¼Œ(ii)æ­¥éª¤4ä¸­çš„æ¯ä¸ªé›†åˆå’Œä¹‹å‰çš„ä½ç½®æ˜¯ä¸€è‡´çš„ï¼Œ(iii)æ¯ä¸ªä¸‰å…ƒç»„çš„åå­—å¯¹åº”æ˜¯æ­£ç¡®çš„ã€‚&lt;/p>
&lt;h3 id="overhead-of-our-protocols">Overhead of our Protocols
&lt;/h3>&lt;p>ä¸Šé¢ä¸¤ä¸ªåè®®éƒ½å¯ä»¥é€šè¿‡é‡å¤æ‰§è¡Œæ¥é™ä½soundness errorã€‚&lt;/p>
&lt;h2 id="4-physical-protocols">4 Physical Protocols
&lt;/h2>&lt;p>ç‰©ç†ä¸Šçš„åè®®ï¼Œä½¿ç”¨ Tamper Evidenceä½œä¸ºç‰©ç†çš„å¯†ç å­¦åŸºç¡€ï¼Œå°±æ˜¯å¯†å°çš„ä¿¡å°ã€‚&lt;/p>
&lt;p>å¯†ç å­¦åè®®å’Œç‰©ç†çš„åè®®çš„è¿˜æœ‰ä¸€ä¸ªä¸åŒæ˜¯ï¼š&lt;/p>
&lt;blockquote>
&lt;p>The protocol does not prevent cheating by adversaries that accept the risk of being labelled as cheaters (in this respect it is similar to the model of covert adversaries).&lt;/p>
&lt;/blockquote>
&lt;p>ä¸¤ä¸ªå‡½æ•°éœ€è¦ç”¨åˆ°ï¼šshuffle å’Œ triplicateã€‚&lt;/p>
&lt;p>å®ç°å¯†å°æ•ˆæœæœ‰ä¸‰ç§æ–¹å¼ï¼š&lt;/p>
&lt;ol>
&lt;li>å¯†å°çš„ä¿¡å°&lt;/li>
&lt;li>åˆ®åˆ®å¡&lt;/li>
&lt;li>éªŒè¯æ–¹å’Œè¯æ˜æ–¹åœ¨åŒä¸€ä¸ªæˆ¿é—´ï¼Œç”¨æ ‡å‡†çš„ä¸é€æ˜å¡ç‰‡ï¼Œå¯†å°å°±æ˜¯æŠŠæ•°å­—ç›–ç€ï¼Œæ­å¼€æ•°å­—å°±æ˜¯ç¿»è½¬å¡ç‰‡ï¼Œå°†æ•°å­—æœä¸Šã€‚&lt;/li>
&lt;/ol>
&lt;p>åè®®3&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>Protocol 3&lt;/strong> &lt;em>A physical protocol with&lt;/em> 1/9 &lt;em>soundness error&lt;/em>&lt;/p>
&lt;ul>
&lt;li>&lt;em>The prover places three scratch-off cards on each cell&lt;/em>. &lt;em>On filled-in cells&lt;/em>, &lt;em>he places
three cards with the correct value&lt;/em>, &lt;em>which are already open&lt;/em> (&lt;em>scratched&lt;/em>).&lt;/li>
&lt;li>&lt;em>For each row/column/subgrid&lt;/em>, &lt;em>the verifier chooses&lt;/em> (&lt;em>at random&lt;/em>) &lt;em>one of the three
cards of each cell in the corresponding row/column/subgrid&lt;/em>.&lt;/li>
&lt;li>&lt;em>The prover makes packets of the verifierâ€™s requested cards&lt;/em> (&lt;em>i&lt;/em>.&lt;em>e&lt;/em>. &lt;em>for every row/
column/subgrid&lt;/em>, &lt;em>he assembles the requested cards&lt;/em>). &lt;em>He then shuffles each of the&lt;/em> 3n
&lt;em>packets separately&lt;/em> (&lt;em>using the shuffle functionality&lt;/em>), &lt;em>and hands the shuffled packets
to the verifier&lt;/em>.&lt;/li>
&lt;li>&lt;em>The verifier scratches off all the cards in each packet and verifies that each packet
contains all of the numbers&lt;/em>.&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>è¿™ä¸ªåè®®éœ€è¦æ‰§è¡Œçš„æ´—ç‰Œæ¬¡æ•°æ¯”è¾ƒå¤šï¼Œå¯¹äº$9 \times 9$çš„æƒ…å†µï¼Œéœ€è¦è¿›è¡Œ$3 \times n = 3 \times 9 = 27$æ¬¡æ´—ç‰Œï¼Œåœ¨å®é™…æ“ä½œä¸­è¿™ä¸ªæ¬¡æ•°è¿‡å¤šã€‚&lt;/p>
&lt;h3 id="411-reducing-the-number-of-shuffles">4.1.1 Reducing the Number of Shuffles
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-29-Cryptographic-and-Physical-Zero-Knowledge-Proof-Systems-for-Solutions-of-Sudoku-Puzzles/Untitled%203.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>ä¸Šé¢çš„æ„æ€æ˜¯åœ¨éªŒè¯é˜¶æ®µï¼Œproverç»™æ¯ä¸ªè¢‹å­æ ‡è®°ä¸€ä¸ªå€¼ï¼Œä»$0$åˆ°$c-1$ï¼Œå¦‚æœæ ‡è®°çš„æ˜¯$0$è¡¨ç¤ºè¿™ä¸ªå£è¢‹ä¸è¢«é€‰ä¸­ã€‚é‚£ä¹ˆå¯¹äºæ¯ä¸€ä¸ªæ ‡è®°çš„å·$i$ï¼Œå¦‚æœæœ‰$t$ä¸ªè¢‹å­æ˜¯è¿™ä¸ªæ ‡è®°ï¼Œå°±æŠŠè¿™$t$ä¸ªè¢‹å­æ··åˆåœ¨ä¸€èµ·è¿›è¡Œæ´—ç‰Œæ“ä½œï¼Œæœ€åéªŒè¯é‡Œé¢æ¯ä¸ªæ•°å­—æ˜¯å¦å‡ºç°$t$æ¬¡ã€‚è¿™æ ·å°±å¤§å¤§å‡å°‘äº†shuffleså‡½æ•°çš„è°ƒç”¨æ¬¡æ•°ã€‚&lt;/p>
&lt;h2 id="42-a-physical-zero-knowledge-protocol-with-no-soundness-error">4.2 A Physical Zero-Knowledge Protocol with no Soundness Error
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-29-Cryptographic-and-Physical-Zero-Knowledge-Proof-Systems-for-Solutions-of-Sudoku-Puzzles/Untitled%204.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>è¿™ç§åè®®proveræ˜¯æ²¡æœ‰åŠæ³•ä½œå¼Šçš„ã€‚&lt;/p>
&lt;h2 id="43-a-protocol-using-scissors-and-a-sheet-of-paper">4.3 A Protocol Using Scissors and a Sheet of Paper
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-29-Cryptographic-and-Physical-Zero-Knowledge-Proof-Systems-for-Solutions-of-Sudoku-Puzzles/Untitled%205.png"
loading="lazy"
alt="Untitled"
>&lt;/p></description></item><item><title>How to explain zero-knowledge protocols to your children</title><link>https://wenjin1997.github.io/2022/11/28/How-to-explain-zero-knowledge-protocols-to-your-children/</link><pubDate>Mon, 28 Nov 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/11/28/How-to-explain-zero-knowledge-protocols-to-your-children/</guid><description>&lt;img src="https://wenjin1997.github.io/img/2022-11-28-How-to-explain-zero-knowledge-protocols-to-your-children/background.jpg" alt="Featured image of post How to explain zero-knowledge protocols to your children" />&lt;p>åœ¨æ–‡ç«  &lt;strong>&lt;a class="link" href="http://pages.cs.wisc.edu/~mkowalcz/628.pdf" target="_blank" rel="noopener"
>How to explain zero-knowledge protocols to your children&lt;/a>&lt;/strong> ä¸­é€šè¿‡é˜¿é‡Œå·´å·´ä¸ç¥ç§˜çš„æ´ç©´çš„æ•…äº‹ä»‹ç»äº†ä»€ä¹ˆæ˜¯é›¶çŸ¥è¯†è¯æ˜ã€‚ä¸­æ–‡ç¿»è¯‘æ–‡ç« è§&lt;a class="link" href="https://blog.dreamerryao.wiki/archives/%E8%AF%91howtoexplainzero-knowledgeprotocolstoyourchildren" target="_blank" rel="noopener"
>ã€è¯‘ã€‘How to Explain Zero-Knowledge Protocols to Your Children&lt;/a>ã€‚ä¸‹é¢ç®€è¦è®°å½•æ–‡ç« çš„ç¬”è®°ï¼š&lt;/p>
&lt;h2 id="the-strange-cave-of-ali-baba">The Strange Cave of Ali Baba
&lt;/h2>&lt;p>é˜¿é‡Œå·´å·´æ¯å¤©éƒ½å»é›†å¸‚ä¸Šï¼Œæ€»è¢«å°å·å·ä¸œè¥¿ï¼Œæ¯æ¬¡å°å·éƒ½è·‘åˆ°ä¸€ä¸ªæ´ç©´ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªå²”è·¯å£ï¼Œæœ‰ä¸¤æ¡é“è·¯ï¼Œé˜¿é‡Œå·´å·´è¿½ç€å°å·æ¥åˆ°æ´ç©´ï¼Œé˜¿é‡Œå·´å·´æ¯æ¬¡åªèƒ½é€‰æ‹©ä¸€ä¸ªå£è¿›å…¥ï¼Œæ¯æ¬¡å°å·éƒ½èƒ½é€ƒèµ°ã€‚åœ¨ç»å†æ‚²å‚¬çš„40æ¬¡è¢«å·åï¼Œä¸ç§‘å­¦å‘€ï¼Œæ¯æ¬¡å°å·éƒ½èƒ½é€‰æ‹©é˜¿é‡Œå·´å·´ä¸èµ°çš„é‚£æ¡è·¯ï¼Œé‚£å°å·å¾—å¤šå¹¸è¿ï¼Œ$\frac{1}{2^{40}}$çš„æ¦‚ç‡ï¼Œä¸å¤ªå¯èƒ½ï¼ï¼ï¼æ´ç©´ä¸€å®šæœ‰ä»€ä¹ˆä¸å¯å‘Šäººçš„ç§˜å¯†ï¼&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-28-How-to-explain-zero-knowledge-protocols-to-your-children/Untitled.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>ä¸€å¤©é˜¿é‡Œå·´å·´æå‰è—åœ¨æ´ç©´é‡Œï¼Œå‘ç°å°å·è¯´å‡ºäº†â€œèŠéº»å¼€é—¨â€å’’è¯­ï¼Œæ´ç©´è¿æ¥äº†èµ·æ¥ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-28-How-to-explain-zero-knowledge-protocols-to-your-children/Untitled%201.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>éš¾æ€ªè¿™äº›å°å·æ¯æ¬¡èƒ½é¡ºåˆ©é€ƒè„±ã€‚åæ¥é˜¿é‡Œå·´å·´ä¸æ–­å®éªŒå’’è¯­ï¼Œå‘ç°å¯ä»¥ä¿®æ”¹å’’è¯­ï¼Œç°åœ¨åªæœ‰ä»–çŸ¥é“æ–°çš„å’’è¯­äº†ã€‚é˜¿é‡Œå·´å·´æŠŠè¿™ä¸ªç¥å¥‡çš„ç»å†å†™åœ¨æ‰‹ç¨¿ä¸Šæµä¼ äº†ä¸‹æ¥ã€‚&lt;/p>
&lt;h2 id="the-fate-of-the-manuscript">The Fate of the Manuscript
&lt;/h2>&lt;p>åæ¥ï¼Œé˜¿é‡Œå·´å·´çš„åä»£ Mick Ali çŸ¥é“å’’è¯­çš„ç§˜å¯†ï¼Œä½†æ˜¯ä»–ä¸æƒ³å‘Šè¯‰ä¸–äººè¿™ä¸ªç§˜å¯†ï¼Œåªæƒ³è¯´æœåˆ«äººç›¸ä¿¡ä»–çŸ¥é“è¿™ä¸ªç§˜å¯†ã€‚ä¸€å®¶ç”µè§†å°ç‹¬å®¶æŠ¥é“è¿™ä¸ªè¿‡ç¨‹ï¼Œå®éªŒæ˜¯è¿™æ ·è¿›è¡Œçš„ï¼š&lt;/p>
&lt;ol>
&lt;li>æ‘„å½±å›¢é˜Ÿå…ˆæ‹æ‘„ä¸¤ä¸ªæ­»èƒ¡åŒçš„ç»†èŠ‚&lt;/li>
&lt;li>æ¯ä¸ªäººéƒ½ç¦»å¼€æ´ç©´ï¼ŒMick Ali å•ç‹¬ä¸€äººè¿›å…¥æ´ç©´&lt;/li>
&lt;li>è®°è€…è¿›å…¥åˆ°æ´ç©´çš„å²”è·¯å£ï¼ŒæŠ›ä¸€æšé“¶å¸ï¼Œé€‰æ‹©å·¦è¾¹è¿˜æ˜¯å³è¾¹ï¼Œæ¥ç€å¤§å–Šè®©Mikeä»é€‰æ‹©çš„é‚£ä¸€è¾¹å‡ºæ¥&lt;/li>
&lt;li>é‡å¤ä¸Šè¿°è¿‡ç¨‹40æ¬¡&lt;/li>
&lt;/ol>
&lt;p>Mickè¿ç»­æˆåŠŸ40æ¬¡ï¼Œå·²ç»èƒ½è¶³å¤Ÿè¯´æœæˆ‘ä»¬ä»–çŸ¥é“å’’è¯­ã€‚&lt;/p>
&lt;h2 id="the-jealous-reporter">The Jealous Reporter
&lt;/h2>&lt;p>å«‰å¦’çš„è®°è€…æ‰¾æ¥ä¸€ä¸ªæ¼”å‘˜è£…æ‰®æˆMickçš„æ ·å­ï¼Œä½†æ˜¯ä»–ä¸çŸ¥é“å’’è¯­ï¼Œè®°è€…ä¹Ÿæ¨¡æ‹Ÿä¸Šè¿°è¿‡ç¨‹ï¼Œä¸è¿‡æœ€åå‰ªæ‰å¤±è´¥çš„ç‰‡æ®µï¼Œåªå±•ç¤ºè¿ç»­æˆåŠŸ40æ¬¡çš„ç»“æœã€‚&lt;/p>
&lt;p>æ¨¡æ‹Ÿçš„æƒ…å†µå’ŒçœŸå®çš„æƒ…å†µä¸€åŒå‘ä¸–äººè¿›è¡Œå±•ç¤ºï¼Œäººä»¬ä¹Ÿæ— æ³•åŒºåˆ«å­°çœŸå­°å‡ï¼Œè¿™ä¸æ°å¥½è¯´æ˜å’’è¯­çš„ç§˜å¯†æ²¡æœ‰æ³„éœ²å˜›ï¼ä½†æ˜¯äººä»¬éƒ½ç›¸ä¿¡MickçŸ¥é“å’’è¯­çš„ç§˜å¯†ã€‚è¿™ä¸€è¿‡ç¨‹å°±åœ¨è¯æ˜&lt;strong>é›¶çŸ¥è¯†&lt;/strong>ï¼ï¼ï¼&lt;/p>
&lt;h2 id="the-tests-in-parallel">The Tests in Parallel
&lt;/h2>&lt;p>ä¸Šé¢çš„è¯æ˜è¿‡ç¨‹è¦è¿ç»­è¿›è¡Œ40æ¬¡ï¼Œæœ‰æ²¡æœ‰æ–¹æ³•å¹¶è¡Œå‘¢ï¼Ÿå¯ä»¥å»ºé€ è¿™æ ·ä¸€åº§å¤§å¦ï¼Œæ¯ä¸€å±‚æœ‰ä¸€ä¸ªæ´ç©´ï¼Œæ¯ä¸€ä¸ªæ´ç©´éƒ½æœ‰è‡ªå·±çš„å’’è¯­ï¼Œæ¯ä¸ªæ´ç©´æœ‰ä¸€ä¸ªæ¼”å‘˜ï¼Œåœ¨åŒä¸€æ—¶åˆ»ä»–ä»¬è¿›å…¥æ´ç©´ç„¶åéšæœºé€‰æ‹©è¿›å…¥å“ªä¸€è¾¹ï¼Œæœ€åå‡ºæ¥ã€‚ä½†æ˜¯è¿™æ ·çš„è¯ï¼Œéœ€è¦åœ¨ç§˜å¯†çš„æ•°é‡å’Œæ‹æ‘„åœºæ™¯æ•°é‡ä¸Šåšä¸€ä¸ªå¹³è¡¡ã€‚&lt;/p>
&lt;h2 id="the-prior-agreement">The Prior Agreement
&lt;/h2>&lt;p>ä¹‹å‰çš„æ¨¡æ‹Ÿåœºæ™¯éœ€è¦åæœŸå‰ªæ‰é‚£äº›ä¸æˆåŠŸçš„åœºæ™¯ï¼Œæœ‰æ²¡æœ‰è¿ç»­è¿›è¡ŒæŒ‘æˆ˜æˆåŠŸçš„åŠæ³•å‘¢ï¼Ÿé‚£å°±æ˜¯éªŒè¯è€…å’Œè¯æ˜è€…ä¹‹é—´äº‹å…ˆå•†å®šéšæœºé€‰æ‹©èµ°å“ªè¾¹ï¼Œè¿ç»­è¿›è¡Œ40æ¬¡ä¹Ÿèƒ½æŒ‘æˆ˜æˆåŠŸã€‚&lt;/p>
&lt;h2 id="a-single-test-a-single-secret">A Single Test, A Single Secret
&lt;/h2>&lt;p>å¦‚ä½•åªè¿›è¡Œä¸€æ¬¡æµ‹è¯•ï¼Œå°±è®©äººä»¬è¶³å¤Ÿç›¸ä¿¡æ‹¥æœ‰ç§˜å¯†å‘¢ï¼Ÿå»ºé€ ä¸‹é¢è¿™æ ·çš„æ´ç©´ï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-28-How-to-explain-zero-knowledge-protocols-to-your-children/Untitled%202.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>åªéœ€è¦å•ç‹¬ä¸€æ¬¡æµ‹è¯•å°±èƒ½å¤Ÿè®©äººè¾¾åˆ°è¿ç»­40æ¬¡æµ‹è¯•ç›¸åŒæ°´å¹³çš„ä¿¡æœåº¦ï¼Œæ¥ç›¸ä¿¡Mickæ˜¯çŸ¥é“è¿™ä¸ªå’’è¯­çš„ç§˜å¯†çš„ã€‚&lt;/p></description></item><item><title>The Incredible Machine</title><link>https://wenjin1997.github.io/2022/11/28/The-Incredible-Machine/</link><pubDate>Mon, 28 Nov 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/11/28/The-Incredible-Machine/</guid><description>&lt;img src="https://wenjin1997.github.io/img/2022-11-28-The-Incredible-Machine/nicolas-houdayer-3h_uBlWlobU-unsplash.jpg" alt="Featured image of post The Incredible Machine" />&lt;p>æœ¬ç¯‡æ˜¯åšå®¢ã€Š&lt;a class="link" href="https://medium.com/qed-it/the-incredible-machine-4d1270d7363a" target="_blank" rel="noopener"
>The Incredible Machine&lt;/a>ã€‹çš„ç¬”è®°ï¼Œæ–‡ç« é€šè¿‡ä¸€ä¸ªæ•°ç‹¬çš„æ•…äº‹æ¥è§£é‡Šä»€ä¹ˆæ˜¯é›¶çŸ¥è¯†è¯æ˜ã€‚&lt;/p>
&lt;p>å…ˆæ€»ç»“ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼š&lt;/p>
&lt;ol>
&lt;li>äº¤äº’å¼è¯æ˜ã€‚AliceçŸ¥é“æ•°ç‹¬çš„è§£ï¼Œå…ˆå°†ç­”æ¡ˆå†™åœ¨çº¸ä¸Šï¼Œç„¶åç›–ä½ï¼ŒBobå‘èµ·ä¸€ä¸ªéšæœºæŒ‘æˆ˜ï¼Œå¯ä»¥é€‰æ‹©è¡Œã€åˆ—æˆ–è€…ä¸€ä¸ª3 $\times$ 3çš„å—ã€‚å¦‚æœé€‰æ‹©è¡Œï¼Œé‚£ä¹ˆæ”¶é›†æ¯è¡Œçš„çº¸ç‰‡åˆ°ä¸€ä¸ªè¢‹å­é‡Œï¼Œæ··åˆåï¼Œæ¯ä¸ªè¢‹å­æ‰“å¼€éƒ½æ˜¯1ï½9çš„æ•°å­—ã€‚é‡å¤æ­¤è¿‡ç¨‹è®©æˆ‘ä»¬ç†ç”±ç›¸ä¿¡AliceçŸ¥é“æ•°ç‹¬çš„è§£ï¼Œå¹¶ä¸”è¿™ä¸€è¿‡ç¨‹æ²¡æœ‰æ³„æ¼è§£ã€‚&lt;/li>
&lt;li>æ¨¡æ‹Ÿã€‚ä¸Šè¿°è¿‡ç¨‹åœ¨Aliceå’ŒBobäº‹å…ˆå•†å®šéšæœºæŒ‘æˆ˜é€‰æ‹©çš„é¡ºåºåï¼Œå¯ä»¥åœ¨ä¸çŸ¥é“æ•°ç‹¬è§£çš„æƒ…å†µä¸‹é€šè¿‡æŒ‘æˆ˜ã€‚è¿™ä¹Ÿæ­£å¥½è¯æ˜äº†è¿™ä¸€è¿‡ç¨‹æ˜¯é›¶çŸ¥è¯†çš„ã€‚&lt;/li>
&lt;li>éäº¤äº’å¼è¯æ˜ã€‚ç”±ä¸€ä¸ªæœºå™¨æ¥æ¨¡æ‹Ÿè¿™ä¸€è¿‡ç¨‹ï¼Œæœºå™¨å†…éƒ¨äº‹å…ˆç„Šä¸€ä¸ªéšæœºæŒ‘æˆ˜çš„é¡ºåºï¼Œè¿™ä¸ªé¡ºåºå¯ä»¥ç”±ä¸€ä¸ªä»ªå¼æ¥å®Œæˆï¼Œä¿è¯æ²¡æœ‰äººçŸ¥é“è¿™ä¸ªé¡ºåºã€‚è¿™ä¸ªæœºå™¨ä¹Ÿæ˜¯å­˜åœ¨ç¼ºç‚¹çš„ï¼Œå¯ä»¥é€šè¿‡å®éªŒå¾—åˆ°è¿™ä¸ªéšæœºé¡ºåºã€‚&lt;/li>
&lt;/ol>
&lt;p>æ­£æ–‡å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>How Alice, Bob, and Charlie used Zero-Knowledge and Blockchains to launch The Global Sudoku Revolution.&lt;/p>
&lt;p>This post is inspired by two great papers that make zero-knowledge proofs accessible to a wide audience:&lt;/p>
&lt;p>[1] How to Explain Zero Knowledge Protocols to Your Children (QuisquaterÂ &lt;em>et. al.&lt;/em>)&lt;/p>
&lt;p>[2] Cryptographic and Physical Zero-Knowledge Proof Systems for Solutions of Sudoku Puzzles (GradwohlÂ &lt;em>et. al.&lt;/em>).&lt;/p>
&lt;p>Alice, Bob, and Charlie loved to solve Sudoku problems.The three friends liked challenging each other with puzzles all the time (in fact, sometimes they solved Sudoku problems that wereÂ &lt;a class="link" href="http://www.sudoku-download.net/files/Sudoku_64x64.pdf" target="_blank" rel="noopener"
>REALLY large&lt;/a>Â â€” not just 9x9 taken fromÂ &lt;a class="link" href="http://www.sudoku-download.net/" target="_blank" rel="noopener"
>here&lt;/a>). Alice was the cleverest of the three. She would draw a Sudoku board on paper, and fill in some of theÂ &lt;strong>constraints&lt;/strong>. Then, sheâ€™d let Bob and Charlie try to solve the puzzle.&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/max/585/1*KwMJAvmMQ7Zdfllic4RioA.png"
loading="lazy"
alt="https://miro.medium.com/max/585/1*KwMJAvmMQ7Zdfllic4RioA.png"
>&lt;/p>
&lt;h1 id="the-proof">&lt;strong>The Proof&lt;/strong>
&lt;/h1>&lt;p>One day, Bob, who was working on an especially difficult Sudoku that Alice had devisedï¼ˆè®¾è®¡çš„ï¼‰ sighed with despairï¼ˆç»æœ›çš„ï¼‰. â€œI swear, this puzzle has no solution! Alice just gave me one of the unsolvable ones to mess with me!â€&lt;/p>
&lt;p>He quickly came to Alice to complain.&lt;/p>
&lt;p>â€œIâ€™ll prove to you that this puzzle has a solution, and that I know it!â€ declared Alice. â€œGood!â€ Said Bob, who was secretly hoping to learn the answer and later tauntï¼ˆå˜²è®½ï¼‰ Charlie with it.&lt;/p>
&lt;p>â€œIn fact, Iâ€™ll prove it to you with â€˜zero-knowledgeâ€™, that is, without ever revealing the solution itselfâ€. â€œIâ€™d like to see you tryâ€, said Bob, who was still thinking of all the fun heâ€™d have teasing ï¼ˆæˆå¼„ï¼‰Charlie.&lt;/p>
&lt;h1 id="the-commitment">&lt;strong>The Commitment&lt;/strong>
&lt;/h1>&lt;p>Alice retrieved 81 blank index cards. She quickly wrote a single digit (from 1 to 9) on each card and carefully placed the cards on the table, in a 9-by-9 matrix, organized just like a Sudoku puzzle. All of the cards were placed face down, with the exception of the few that had the constraints that Bob had already seen written on them.&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/max/531/1*FcUS_t2zp0qQ4Zm_wmfLTw.png"
loading="lazy"
alt="https://miro.medium.com/max/531/1*FcUS_t2zp0qQ4Zm_wmfLTw.png"
>&lt;/p>
&lt;p>éšæœºé€‰æ‹©è¡Œã€åˆ—æˆ–è€…ä¸€ä¸ªå—æ¥è¿›è¡ŒéªŒè¯ã€‚&lt;/p>
&lt;h1 id="the-random-challenge">&lt;strong>The Random Challenge&lt;/strong>
&lt;/h1>&lt;p>Bob was excited. The solution was close. Heâ€™d been working on the problem for ages!&lt;/p>
&lt;p>â€œBob, you arenâ€™t allowed to peak at the cards!â€ Alice exclaimed to Bobâ€™s disappointment. â€œNot yet anyway. But I will let you test the solution. You can choose whether you want to check the rows, the columns, or the blocks. Pick one at random.â€&lt;/p>
&lt;p>Bob decided to pick the rows. Alice proceeded to place the cards from each row inside an opaque bag â€” one bag per row. She gave each bag a thorough shake, making sure the index cards inside were mixed well. She handed the bags to Bob, who gave her a quizzical look.&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/max/700/1*p0wq334jocZQJzi1Vl8BYg.png"
loading="lazy"
alt="https://miro.medium.com/max/700/1*p0wq334jocZQJzi1Vl8BYg.png"
>&lt;/p>
&lt;h1 id="verification">&lt;strong>Verification&lt;/strong>
&lt;/h1>&lt;p>â€œWell, open them!â€ she said. â€œThey should each have exactly 9 cards with all the numbers 1 through 9â€. Bob opened each bag and verified that this was indeed the case.&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/max/363/1*jjLrBnvToa0i0Bg6EdJIGw.png"
loading="lazy"
alt="https://miro.medium.com/max/363/1*jjLrBnvToa0i0Bg6EdJIGw.png"
>&lt;/p>
&lt;p>â€œThis doesnâ€™t prove a thing!â€ I can also do that! Iâ€™d just have to place the numbers 1 through 9 in each row in any order iâ€™d like!â€ said Bob quickly.&lt;/p>
&lt;p>Alice explained that she couldnâ€™t have known in advance that Bob would pick the rows. Sheâ€™s not a mind reader! In fact, only a correct solution would have the numbers 1â€“9 in each row, column, and box and so if her solution was not correct, Bob would have at least a 1 in 3 chance of catching her.&lt;/p>
&lt;h1 id="rinse-and-repeat">&lt;strong>Rinse and Repeat&lt;/strong>
&lt;/h1>&lt;p>Bob thought that a 1 in 3 chance of catching Alice wasnâ€™t good enough. He still had a gnawing suspicion that the puzzle was unsolvable. He demanded that Alice repeat the procedure with him â€” each time placing the same cards for the same Sudoku problem face down on the floor, but letting him pick a different test at random. After a long series of tests, Bob was forced to admit that Alice was either an extremely lucky person, or, that she simply has a solution to the Sudoku problem (or perhaps she could read his thoughts after all). He was also quite disappointed that he had gained no knowledge (zero-knowledge) about the solution. All he knew after all these tests was that it was highly likely that every row, column and block did indeed contain the numbers 1â€“9 exactly once, which could only be so if Alice knew the solution.&lt;/p>
&lt;p>The three friends had made it a habit to prove to one another that their Sudoku challenges were solvable. After all, no one wants to spend his time on an unsolvable problem. Each test was long and quite exhausting, but Sudoku is after all very serious business.&lt;/p>
&lt;p>å¦‚æœåªè¿›è¡Œä¸€æ¬¡éªŒè¯ï¼Œé‚£ä¹ˆAliceå¯èƒ½ä¼šæœ‰1/3æ¦‚ç‡ä½œå¼Šï¼Œå› æ­¤éœ€è¦é‡å¤è¿›è¡Œéšæœºè¯•éªŒï¼Œæé«˜å¯ä¿¡åº¦ã€‚&lt;/p>
&lt;h1 id="blockchains-and-the-global-sudoku-revolution">&lt;strong>Blockchains and The Global Sudoku Revolution&lt;/strong>
&lt;/h1>&lt;p>One day, Alice had a great idea. Knowing that her love for Sudoku is shared by millions online, she decided to open her very own YouTube channel, where she can post her own Sudoku challenges online. She called it â€œThe Sudoku Blockchainâ€ (she didnâ€™t know what blockchains were exactly, but it was such a cool buzzwordï¼ˆæ—¶é«¦æœ¯è¯­ï¼Œæµè¡Œè¡Œè¯ï¼‰). She dreamed of many channel subscribers that would send her Bitcoins and decided to include features that the competing Sudoku channels did not have: She asked Bob to verify the existence of a solution to each of the puzzles using a zero-knowledge proof. Sheâ€™d film the whole thing and put it on the Sudoku Blockchain, so that everyone would know that (with high probability) each of the puzzles is indeed solvable.&lt;/p>
&lt;h1 id="the-simulation">&lt;strong>The Simulation&lt;/strong>
&lt;/h1>&lt;p>One day, Alice came over to Bobâ€™s house to record the proof for a Sudoku challenge, but found that she left the solution to the puzzle at home. Since she was in a hurry to publish the new challenge online, she begged Bob to film it with her anyway. She convinced Bob to pretend to run the proof with her. Together they agreed on a sequence of tests (rows / columns / and blocks) that Bob would â€œrandomlyâ€ pick. Since Alice too knew the sequence of tests, she could easily pass them without having the solution to the puzzle.&lt;/p>
&lt;p>Charlie, who was travelling abroad and saw the video was later surprised when Alice and Bob told him how they filmed it. â€œIâ€™ll never trust you two again!â€ he exclaimed. â€œNo one should trust any of your online video proofs!â€.&lt;/p>
&lt;p>æ¨¡æ‹Ÿï¼Œåœ¨æ¨¡æ‹Ÿæƒ…å†µä¸‹æœ‰ä¸€ç§è¶…èƒ½åŠ›ï¼Œäº‹å…ˆçº¦å®šâ€œéšæœºâ€é€‰æ‹©çš„é¡ºåºï¼Œä¸çŸ¥é“çœŸæ­£çš„è§£ä¹Ÿèƒ½é€šè¿‡æµ‹è¯•ï¼Œè¿™ä¸æ­£æ°å¥½è¯´æ˜æ²¡æœ‰æ³„æ¼çŸ¥è¯†å˜›ï¼&lt;/p>
&lt;h1 id="the-incredible-machine-and-non-interactive-proofs">&lt;strong>The Incredible Machine and Non-Interactive Proofs&lt;/strong>
&lt;/h1>&lt;p>Charlie was frustrated. He did not want to easily give up his Sudoku solving habit, but knowing that Alice and Bob were not trustworthy, he wanted a way to check proofs remotely. After a few sleepless nights, he declared to Alice and Bob that he had a new idea. He locked himself in his room for hours and labored frantically through the night. In the morning, Charlie presented Alice and Bob with his incredible new invention: â€œThe Zero-Knowledge Sudoku Non-Interactive Proof Machineâ€ (or zk-SNIPM as he like to refer to it).&lt;/p>
&lt;p>The Machine was basically an automated version of Aliceâ€™s test. Alice would need to place her cards on the conveyor belt, and feed Sudoku solutions to the machine. The machine would then collect the cards from rows, columns, or boxes and place them automatically into bags that would come out on the other side (after being thoroughly mixed). Then, Alice could open the bags while the camera was still rolling and reveal their contents.&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/max/511/1*wSsIDzJgzJHMi5CCdXFaDg.png"
loading="lazy"
alt="https://miro.medium.com/max/511/1*wSsIDzJgzJHMi5CCdXFaDg.png"
>&lt;/p>
&lt;p>The machine had a control panel with a long series of dials that set the test for each set of 81 cards that Alice would feed in. Charlie had set up his own secret series of tests and then welded the control panelâ€™s cover shut (Alice was worried that he also booby-trapped it with explosives, or filled it up with scorpions, vials of acid, or some other similarly nasty thing. Charlie was a bit extreme when it came to securing his devices).&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/max/564/1*jbhDHFgSlG-JRVWDOeefpQ.png"
loading="lazy"
alt="https://miro.medium.com/max/564/1*jbhDHFgSlG-JRVWDOeefpQ.png"
>&lt;/p>
&lt;p>Charlie could now trust his machine to provide a series of tests that was unknown to Alice so that he could watch youtube videos of proofs and be relatively sure that Alice had not cheated together with Bob.&lt;/p>
&lt;h1 id="the-ceremony">&lt;strong>The Ceremony&lt;/strong>
&lt;/h1>&lt;p>Alice and Bob were jealous of Charlieâ€™s zk-SNIPM machine and wanted to use it to verify all puzzles (including those that Charlie invented). The only problem was that Charlie was the one who had set up the secret series of tests, and they could not let him use it for proofs (he could easily cheat since he knows the sequence of tests). Instead, Alice suggested that they conduct a multi-party set up of the machine together. A sort of â€œtrusted setup ceremonyâ€. She asked Charlie to open the control panel (and remove all of his nasty traps). Each of the dials on the control panel had 3 states, and you would need to rotate it to select the test.&lt;/p>
&lt;p>She suggested that they place the machine in a dark room, and remove all the labels from the knobs. Each one of them would then go into the room with the machine in the dark (Bob also suggested that theyâ€™d be blindfolded just for good measure, and that they each wear a tinfoil hat to prevent mind reading side-channel attacks by Alice) and would turn the knobs on the machine to a random position (either turn them one-third of a turn clockwise, two-thirds of a turn clockwise, or leave them as they are). This way, the final setting of each knob would not be known to any single one of them (in fact, even if two participants colluded, they would not know the final state of the knob without the third personâ€™s assistance). After the set-up ceremony was over, theyâ€™d weld the cover of the machine shut.&lt;/p>
&lt;h1 id="cracking-the-machine">&lt;strong>Cracking the Machine&lt;/strong>
&lt;/h1>&lt;p>One afternoon, when Bob and Charlie were off travelling, Alice was left alone with the machine. She started wondering if it was as secure as advertised. Thinking about it for a while she decided to feed it slightly modified Sudoku puzzle solutions in order to discover which tests the machine was using. She used a Sudoku puzzle that she could solve, and fed in many boards to see that the solution is indeed accepted by the machine. She then repeated the procedure, but changed the first board fed to the machine to simply include the numbers 1â€“9 in each row (without forming a legal solution in columns or boxes). The test still passed, and she then realized she can use this idea to learn the sequence of tests that were pre-set within the machine.&lt;/p>
&lt;p>è¿™é‡ŒAliceå…ˆç”¨ä¸€ä¸ªæ•°ç‹¬çš„çœŸè§£å–‚ç»™æœºå™¨ï¼Œçœ‹çœ‹æœºå™¨çš„è¾“å‡ºç»“æœã€‚æ¥ç€é‡å¤è¿™ä¸€è¿‡ç¨‹ï¼Œä½†æ˜¯ä¿®æ”¹è§£ï¼Œä¿è¯æ¯è¡Œæ˜¯æ•°å­—1ï½9ï¼Œå–‚ç»™æœºå™¨ï¼ŒæŸ¥çœ‹æœºå™¨çš„è¾“å‡ºç»“æœï¼Œè¿™æ ·å¯ä»¥æ¨æµ‹å‡ºä¹‹å‰é€šè¿‡ä»ªå¼å¾—åˆ°çš„éšæœºé¡ºåºã€‚&lt;/p>
&lt;p>Alice felt very frustrated. Can you help Alice build a better zk-SNIPM? Can you think of a series of tests that would be harder to crack, or is the approach doomed to fail? Write us and tell us your ideas!&lt;/p>
&lt;h1 id="a-note-about-the-real-world">&lt;strong>A Note About the Real World&lt;/strong>
&lt;/h1>&lt;p>In fact, the zk-SNIPM is a tongue-in-cheek construction of aÂ &lt;em>non-interactive zero-knowledge prover&lt;/em>, somewhere between zk-SNARKs and tamper-proof hardware. zk-SNIPM relies on a â€œphysicalâ€ type of zero-knowledge proof. Such physical proofs could in fact be made much more powerful, for example, by using a photocopy machine to copy the cards and check the rows, columns and boxes simultaneously on the same solution. Still, we have elected to utilize a physical proving system that has some analogies to computational proofs found in cryptographic zero-knowledge constructions.&lt;/p>
&lt;p>Aliceâ€™s initial proving method is analogous to anÂ &lt;em>interactive&lt;/em>Â zero-knowledge proof protocol, where the verifier sends a randomÂ &lt;em>challenge&lt;/em>Â to the prover, after she commits to the solution. A prover and verifier that are colluding and share this random challenge in advance can simulate a proof, without really knowing the solutions. AÂ &lt;em>non-interactive&lt;/em>Â version that must work without this challenge step, is constructed by hiding the challenge itself in some cryptographic â€œmachineryâ€ in advance. This prevents the prover from having access to the challenge. Indeed, one good way to generate such a trusted challenge is through a â€œceremonyâ€ enacted through multiparty computation that combines the randomness from several participants into a single random challenge, encoded in the proving system.&lt;/p>
&lt;p>å¼€å§‹çš„è¯æ˜æ–¹æ³•ç±»ä¼¼äº¤äº’å¼é›¶çŸ¥è¯†è¯æ˜åè®®ï¼ŒéªŒè¯è€…ç»™è¯æ˜æ–¹ä¸€ä¸ªéšæœºæŒ‘æˆ˜ï¼Œç„¶åè¿›è¡ŒéªŒè¯ã€‚è¯æ˜æ–¹å’ŒéªŒè¯æ–¹å¯ä»¥äº‹å…ˆä½œå¼Šå•†é‡éšæœºæŒ‘æˆ˜çš„é¡ºåºï¼Œè¿™æ ·ä»–ä»¬åœ¨ä¸çŸ¥é“è§£çš„æƒ…å†µä¸‹å¯ä»¥æ¨¡æ‹Ÿä¸€ä¸ªè¯æ˜ã€‚åæ¥çš„æœºå™¨éªŒè¯è¿‡ç¨‹æ˜¯éäº¤äº’å¼è¯æ˜ï¼Œå®ç°æ„é€ ä¸€ä¸ªéšæœºé¡ºåºï¼Œå¯ä»¥é€šè¿‡ä»ªå¼çš„æ–¹å¼ï¼Œç„¶åå†è¿›è¡Œè¯æ˜ã€‚&lt;/p>
&lt;p>The Sudoku example in this post is taken in slightly modified form fromÂ &lt;strong>Cryptographic and Physical Zero-Knowledge Proof Systems for Solutions of Sudoku Puzzles (Gradwohl et. al.).&lt;/strong>&lt;/p>
&lt;p>Many thanks to Daniel Benarroch for his help with this post.&lt;/p>
&lt;p>This post was originally published onÂ &lt;a class="link" href="http://qed-it.com/2017/12/the-incredible-machine/" target="_blank" rel="noopener"
>qed-it.com&lt;/a>.&lt;/p></description></item><item><title>Dan Boneh Cryptography I Week1</title><link>https://wenjin1997.github.io/2022/11/21/Dan-Boneh-Cryptography-Week1/</link><pubDate>Mon, 21 Nov 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/11/21/Dan-Boneh-Cryptography-Week1/</guid><description>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/background.jpg" alt="Featured image of post Dan Boneh Cryptography I Week1" />&lt;p>å¼€å§‹å­¦ä¹ å¯†ç å­¦ï¼Œè¿™æ˜¯ä¸€å¥—ä¸é”™çš„è¯¾ç¨‹ã€‚å®˜æ–¹è¯¾ç¨‹é“¾æ¥&lt;a class="link" href="https://crypto.stanford.edu/~dabo/courses/OnlineCrypto/" target="_blank" rel="noopener"
>Online Cryptography Course&lt;/a>ã€‚æ•™æ&lt;a class="link" href="http://toc.cryptobook.us/" target="_blank" rel="noopener"
>A Graduate Course in Applied Cryptography&lt;/a>ï¼ŒCourseraä¸Šçš„é“¾æ¥ä¸º&lt;a class="link" href="https://www.coursera.org/learn/crypto" target="_blank" rel="noopener"
>å¯†ç å­¦ I&lt;/a>ã€‚&lt;/p>
&lt;p>ä¸‹é¢è®°å½•ç¬¬ä¸€å‘¨çš„å­¦ä¹ ç¬”è®°ã€‚&lt;/p>
&lt;h2 id="course-overview">&lt;strong>Course Overview&lt;/strong>
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%201.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>å¯†ç å­¦æ— å¤„ä¸åœ¨ï¼ŒDVDä½¿ç”¨çš„æ˜¯CSSåŠ å¯†ï¼ŒBlu-rayä½¿ç”¨çš„æ˜¯AACSåŠ å¯†ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%202.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>å¸¸ç”¨çš„HTTPSåº•å±‚ç”¨çš„æ˜¯SSL/TLSã€‚å®‰å…¨çš„äº¤æµä¸­é—´æ˜¯æ²¡æœ‰å·å¬å’Œç¯¡æ”¹çš„ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%203.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%204.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%205.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>å¯¹ç§°åŠ å¯†ç³»ç»Ÿä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªkeyã€‚åŠ å¯†ç®—æ³•æ˜¯å…¬å¼€çš„ï¼Œæ°¸è¿œä¸è¦ä½¿ç”¨ä¸€ä¸ªä¸“æœ‰çš„åŠ å¯†ç®—æ³•ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%206.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%207.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>å¯†ç å­¦ä¸æ˜¯æ‰€æœ‰å®‰å…¨é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚è½¯ä»¶æ¼æ´æˆ–è€…å·¥ç¨‹ä¸Šçš„æ”»å‡»ã€‚&lt;/p>
&lt;h2 id="what-is-cryptography">&lt;strong>What is cryptography?&lt;/strong>
&lt;/h2>&lt;h3 id="crypto-core">Crypto core
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%208.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>å¯†ç å­¦çš„æ ¸å¿ƒå»ºç«‹å¯†é’¥ï¼Œä¿è¯äº¤æµçš„å¯é å’Œå®Œæ•´æ€§ã€‚&lt;/p>
&lt;h3 id="but-crypto-can-do-much-more">But crypto can do much more
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%209.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>å¯†ç å­¦å¯ä»¥åº”ç”¨åœ¨åŒ¿åäº¤æµä¸­ï¼Œä¸Šå›¾ä¸­çš„åŒ¿åæ˜¯ç›¸äº’çš„ï¼ŒAliceä¸çŸ¥é“å¯¹æ–¹æ˜¯è°ï¼ŒBobä¹Ÿä¸çŸ¥é“å¯¹æ–¹æ˜¯è°ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2010.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>å¯†ç å­¦åº”ç”¨åœ¨åŒ¿åç”µå­è´§å¸ï¼Œç±»ä¼¼äºæˆ‘ä»¬å»å•†åº—æ¶ˆè´¹ï¼Œä¸æƒ³è®©å•†åº—çŸ¥é“æˆ‘ä»¬çš„èº«ä»½ï¼ŒåŒæ—¶åœ¨ç½‘ç»œä¸­ï¼Œè¦ä¿è¯ç”µå­è´§å¸ä¸èƒ½é‡å¤æ¶ˆè´¹ã€‚&lt;/p>
&lt;h3 id="protocols">&lt;strong>Protocols&lt;/strong>
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2011.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2012.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>åœ¨é€‰ä¸¾æˆ–è€…ç§æœ‰æ‹å–çš„ä¾‹å­ä¸­ï¼Œæœ‰å—ä¿¡çš„ç¬¬ä¸‰æ–¹æ¥è¿›è¡Œå…¬å¸ƒç»“æœã€‚è¿™é‡Œæœ‰ä¸€ä¸ªé‡è¦çš„ç†è®ºï¼Œä»»ä½•å¯ä»¥ä½¿ç”¨å—ä¿¡ç¬¬ä¸‰æ–¹å®Œæˆçš„äº‹ä¹Ÿå¯ä»¥ä¸ç”¨ç¬¬ä¸‰æ–¹å°±èƒ½å®Œæˆã€‚&lt;/p>
&lt;h3 id="crypto-magic">&lt;strong>Crypto magic&lt;/strong>
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2013.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;h3 id="a-rigorous-science">&lt;strong>A rigorous science&lt;/strong>
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2014.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>å¯†ç å­¦æ˜¯ä¸€é—¨ä¸¥è°¨çš„å­¦ç§‘ï¼Œè¦éµå¾ªä»¥ä¸Šä¸‰ä¸ªæ­¥éª¤ã€‚&lt;/p>
&lt;h2 id="history">&lt;strong>History&lt;/strong>
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2015.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2016.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2017.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2018.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2019.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>æ›¿æ¢å¼åŠ å¯†çš„å¯†é’¥ç©ºé—´å¾ˆå¤§ï¼Œæ˜¯26ä¸ªå­—æ¯çš„å…¨æ’åˆ—ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2020.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2021.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>ç ´è§£æ›¿æ¢å¼åŠ å¯†çš„æ–¹æ³•æ˜¯åˆ©ç”¨äº†è‹±è¯­å­—æ¯å‡ºç°çš„é¢‘ç‡ï¼Œå­—æ¯eå‡ºç°çš„é¢‘ç‡æœ€é«˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¯¹æˆªè·åˆ°çš„å¯†æ–‡ç»Ÿè®¡å‡ºç°çš„é¢‘ç‡ï¼Œå‡ºç°é¢‘ç‡æœ€é«˜çš„å­—æ¯å°±å¯¹åº”äºå­—æ¯eã€‚æ¥ç€å†åˆ©ç”¨äºŒåˆå­—æ¯å‡ºç°çš„é¢‘ç‡ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2022.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2023.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>å½“æˆ‘ä»¬çŸ¥é“keyä¸­åŠ å¯†å­—æ¯çš„é•¿åº¦æ—¶ï¼Œå°±å¾ˆå¥½ç ´è§£ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2024.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2025.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2026.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;h2 id="discrete-probability">&lt;strong>Discrete Probability&lt;/strong>
&lt;/h2>&lt;p>è¿™éƒ¨åˆ†è¯¦ç»†ä»‹ç»è§&lt;a class="link" href="https://en.wikibooks.org/wiki/High_School_Mathematics_Extensions/Discrete_Probability" target="_blank" rel="noopener"
>https://en.wikibooks.org/wiki/High_School_Mathematics_Extensions/Discrete_Probability&lt;/a>ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2027.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;h3 id="events">Events
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2028.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;h3 id="the-union-bound">The union bound
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2029.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;h3 id="random-variables">Random Variables
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2030.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;h3 id="the-uniform-random-variable">The uniform random variable
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2031.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2032.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;h3 id="randomized-algorithms">Randomized algorithms
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2033.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2034.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;h3 id="independence">Independence
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2035.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;h3 id="xor">XOR
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2036.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2037.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>å¼‚æˆ–ä¸­é‡è¦çš„ä¸€ä¸ªå®šç†æ˜¯ï¼ŒYæ˜¯ä¸€ä¸ªéšæœºå˜é‡ï¼ŒXæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å‡åŒ€åˆ†å¸ƒå˜é‡ï¼ŒYä¸Xå¼‚æˆ–ä¹‹åæ˜¯ä¸€ä¸ªå‡åŒ€åˆ†å¸ƒå˜é‡ã€‚&lt;/p>
&lt;h3 id="the-birthday-paradox">&lt;strong>The birthday paradox&lt;/strong>
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2038.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>å½“$n=1.2 \times \sqrt{|U|}$æ—¶ï¼Œ$U$ ä¸­å­˜åœ¨ä¸¤ä¸ªå˜é‡ç›¸ç­‰çš„æ¦‚ç‡å¤§äºç­‰äº$1/2$ã€‚å¸¸è¯†è®¤ä¸ºå¯èƒ½æ˜¯$|U|/2$ï¼Œå› æ­¤ä¹Ÿå«åšæ‚–è®ºã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2039.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;h2 id="the-one-time-pad">The One Time Pad
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2040.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2041.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>keyå’Œè¦åŠ å¯†çš„æ¶ˆæ¯çš„é•¿åº¦ä¸€æ ·é•¿ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2042.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2043.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>keyä¹Ÿå¯ä»¥ç®—å‡ºæ¥ï¼Œæ˜¯må’Œcçš„å¼‚æˆ–ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2044.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2045.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>ä»€ä¹ˆæ˜¯å®‰å…¨çš„åŠ å¯†å‘¢ï¼Ÿé¦™å†œçš„å®šä¹‰æ˜¯ï¼Œä¸èƒ½ä»å¯†æ–‡ä¸­å¾—åˆ°ä»»ä½•å…³äºåŸæ–‡çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2046.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>ç”¨æ¦‚ç‡æ¥å®šä¹‰ perfect secrecyï¼Œä¹Ÿå°±æ˜¯ä»å¯†æ–‡ä¸­æ— æ³•åŒºåˆ†ä»»æ„ä¸¤ä¸ªåŸæ–‡ï¼Œå¾—åˆ°ä¸¤ä¸ªä¸åŒmessageçš„æ¦‚ç‡æ˜¯ç›¸åŒçš„ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2047.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2048.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>OTPæ˜¯æœ‰perfectå®‰å…¨æ€§çš„ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2049.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2050.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>OTPæ˜¯æ²¡æœ‰æƒŸå¯†æ–‡æ”»å‡»ï¼Œä½†æ˜¯æœ‰å…¶ä»–æ”»å‡»ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2051.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;h2 id="pseudorandom-generators">&lt;strong>Pseudorandom Generators&lt;/strong>
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2052.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2053.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>ç”¨ä¼ªéšæœºkeyä»£æ›¿éšæœºkeyã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2054.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2055.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2056.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2057.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2058.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2059.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2060.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>æ°¸è¿œä¸è¦åœ¨åŠ å¯†ä¸­ä½¿ç”¨glibcä¸­çš„&lt;code>random()&lt;/code>å‡½æ•°ã€‚&lt;/p>
&lt;h2 id="negligible-vs-non-negligible">&lt;strong>Negligible vs. non-negligible&lt;/strong>
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2061.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>å¯å¿½ç•¥çš„ï¼šæ„æ€æ˜¯æ¯”å¤šé¡¹å¼çš„é€†ä¸‹é™åœ°è¿˜è¦å¿«ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2062.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2063.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2064.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;h2 id="attacks-on-otp-and-stream-ciphers">&lt;strong>Attacks on OTP and stream ciphers&lt;/strong>
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2065.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2066.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>ä¸èƒ½ä¸¤æ¬¡ä½¿ç”¨ç›¸åŒçš„PRG(k)ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2067.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯ä¸æœåŠ¡ç«¯åˆ°å®¢æˆ·ç«¯åº”è¯¥ä½¿ç”¨ä¸åŒçš„keyã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2068.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2069.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2070.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2071.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2072.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2073.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2074.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>ä¸­é—´å¯ä»¥åŠ å…¥pï¼Œç„¶åè¿›è¡Œç¯¡æ”¹ã€‚&lt;/p>
&lt;h2 id="real-world-stream-ciphers">&lt;strong>Real-world Stream Ciphers&lt;/strong>
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2075.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2076.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2077.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2078.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2079.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2080.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2081.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2082.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2083.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;h2 id="prg-security-defs">&lt;strong>PRG Security Defs&lt;/strong>
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2084.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2085.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2086.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2087.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2088.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2089.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2090.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>ä¸€ä¸ªå®‰å…¨çš„PRGæ˜¯ä¸å¯é¢„æµ‹çš„ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2091.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2092.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>åè¿‡æ¥ä¹Ÿæˆç«‹ï¼Œä¸€ä¸ªä¸å¯é¢„æµ‹çš„PRGæ˜¯å®‰å…¨çš„ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2093.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>ç”¨åˆ°äº†å‰é¢å®šç†(Yaoâ€™82)çš„é€†å¦å‘½é¢˜ã€‚ä¸å®‰å…¨çš„PRGæ˜¯å¯é¢„æµ‹çš„ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2094.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>æ›´ä¸€èˆ¬çš„å®šä¹‰ï¼Œcomputationally indistinguishableã€‚&lt;/p>
&lt;h2 id="semantic-security">Semantic security
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2095.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2096.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2097.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>å‰ä¸¤ä¸ªå®šä¹‰éƒ½å¤ªå¼ºäº†ï¼Œéœ€è¦ä¸€ä¸ªå¼±ä¸€äº›çš„å®šä¹‰ï¼Œæ‰¾åˆ°å­˜åœ¨çš„ $m_0$ ä¸ $m_1$ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2098.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%2099.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>è¿™é‡Œç»™å‡ºäº†semantically secure çš„å®šä¹‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%20100.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%20101.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>OTPæ˜¯ semantically secure çš„ã€‚&lt;/p>
&lt;h2 id="stream-ciphers-are-semantically-secure">&lt;strong>Stream ciphers are semantically secure&lt;/strong>
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%20102.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%20103.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%20104.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%20105.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%20106.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%20107.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-21-Dan-Boneh-Cryptography-Week1/Untitled%20108.png"
loading="lazy"
alt="Untitled"
>&lt;/p></description></item><item><title>å¦‚ä½•ç”¨Hugo + Github Actionéƒ¨ç½²ä¸ªäººåšå®¢</title><link>https://wenjin1997.github.io/2022/11/19/hugo-post/</link><pubDate>Sat, 19 Nov 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/11/19/hugo-post/</guid><description>&lt;img src="https://wenjin1997.github.io/img/2022-11-19-hugo-post/background.jpg" alt="Featured image of post å¦‚ä½•ç”¨Hugo + Github Actionéƒ¨ç½²ä¸ªäººåšå®¢" />&lt;p>æœ€è¿‘åˆæŠŠè‡ªå·±çš„åšå®¢æŠ˜è…¾äº†ä¸€éï¼Œä¹‹å‰ç”¨çš„æ˜¯vuepressæ­å»ºçš„ï¼Œå¥ˆä½•å®åœ¨çœ‹ä¸æƒ¯å­—ä½“å¤ªå°ï¼Œé…ç½®å­—ä½“å¤§å°åŠå¤©ä¸æˆåŠŸï¼Œç´¢æ€§æƒ³ç€é‡æ–°æ­å»ºä¸€ä¸‹ã€‚ç½‘ä¸Šæœç´¢åˆ°çš„ä¸»è¦æœ‰hexoå’Œhugoï¼Œä¹‹å‰å°è¯•è¿‡hexoï¼Œæ²¡æœ‰å¾ˆæ»¡æ„ï¼Œè¿™æ¬¡å°±è¯•ç€ç”¨hugoæ­å»ºã€‚&lt;/p>
&lt;h2 id="å®‰è£…hugo">å®‰è£…Hugo
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">brew install hugo
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¥ç€è¿è¡Œï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">hugo version
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ˜¾ç¤ºæ­£å¸¸åˆ™è¯´æ˜å®‰è£…æˆåŠŸã€‚&lt;/p>
&lt;h2 id="åˆ›å»ºhugoç½‘ç«™">åˆ›å»ºHugoç½‘ç«™
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">hugo new site hugo-blog
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">jinjin@Mac-mini &lt;span class="nb">test&lt;/span> % hugo new site hugo-blog
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Congratulations! Your new Hugo site is created in /Users/jinjin/code/test/hugo-blog.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Just a few more steps and you&lt;span class="err">&amp;#39;&lt;/span>re ready to go:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1. Download a theme into the same-named folder.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Choose a theme from https://themes.gohugo.io/ or
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> create your own with the &lt;span class="s2">&amp;#34;hugo new theme &amp;lt;THEMENAME&amp;gt;&amp;#34;&lt;/span> command.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2. Perhaps you want to add some content. You can add single files
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> with &lt;span class="s2">&amp;#34;hugo new &amp;lt;SECTIONNAME&amp;gt;/&amp;lt;FILENAME&amp;gt;.&amp;lt;FORMAT&amp;gt;&amp;#34;&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3. Start the built-in live server via &lt;span class="s2">&amp;#34;hugo server&amp;#34;&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Visit https://gohugo.io/ &lt;span class="k">for&lt;/span> quickstart guide and full documentation.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="é€‰æ‹©ä¸»é¢˜">é€‰æ‹©ä¸»é¢˜
&lt;/h2>&lt;p>åœ¨å®˜æ–¹ç½‘ç«™&lt;a class="link" href="https://themes.gohugo.io/" target="_blank" rel="noopener"
>ä¸»é¢˜æ¿å—&lt;/a>é€‰æ‹©ä¸€ä¸ªå–œæ¬¢çš„ä¸»é¢˜ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯&lt;a class="link" href="https://themes.gohugo.io/themes/hugo-theme-cleanwhite/" target="_blank" rel="noopener"
>Clean White&lt;/a>ï¼Œæ¥ç€å¯ä»¥æŒ‰ç…§ä¸»é¢˜ç»™çš„æ•™ç¨‹è¿›è¡Œå®‰è£…ã€‚ä¸ºäº†åç»­æ–¹ä¾¿githubç®¡ç†éƒ¨ç½²ä»¥åŠä¿®æ”¹ä¸»é¢˜ï¼Œå°†åŸä¸»é¢˜ä»“åº“&lt;code>fork&lt;/code>åˆ°è‡ªå·±çš„è´¦æˆ·ï¼Œç”¨&lt;code>git submodule&lt;/code>æ–¹å¼è¿›è¡Œä»“åº“é“¾æ¥ã€‚&lt;/p>
&lt;p>é¦–å…ˆæ‰¾åˆ°ä¸»é¢˜çš„githubä»“åº“ï¼Œç„¶å&lt;code>fork&lt;/code>ä¸‹æ¥ï¼Œæ¥ç€åœ¨æœ¬åœ°ä½¿ç”¨&lt;code>git submodule&lt;/code>å‘½ä»¤ï¼Œè¿™é‡Œä»“åº“åœ°å€å·²ç»å˜æˆè‡ªå·±è´¦æˆ·ä¸‹ä¸»é¢˜ä»“åº“çš„åœ°å€äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">git submodule add https://github.com/wenjin1997/hugo-theme-cleanwhite.git themes/hugo-theme-cleanwhite
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¿è¡Œ&lt;code>git submodule&lt;/code>ä¸&lt;code>git clone&lt;/code>é‡åˆ°äº†ä¸€äº›é—®é¢˜ã€‚&lt;/p>
&lt;h3 id="è§£å†³-failed-to-connect-to-githubcom-port-443">è§£å†³ Failed to connect to github.com port 443
&lt;/h3>&lt;p>å‚è€ƒ&lt;a class="link" href="https://www.notion.so/github-18e3596e3b5f4c75b78c1c90ccc9594c#3bef0cc6434a4f6ea074149ebaa5aeca" target="_blank" rel="noopener"
>&lt;strong>Failed to connect to github.com port 443: Operation timed out&lt;/strong>&lt;/a>è§£å†³è¯¥é—®é¢˜ï¼Œè®¿é—®&lt;a class="link" href="https://ping.chinaz.com/github.com" target="_blank" rel="noopener"
>https://ping.chinaz.com/github.com&lt;/a>ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„ipåœ°å€ï¼Œä¾‹å¦‚ä¸º140.82.121.4ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> ~
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo vim /etc/hosts
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨hostæ–‡ä»¶ä¸­è¿›è¡Œä¿®æ”¹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Host Database
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># localhost is used to configure the loopback interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># when the system is booting. Do not change this entry.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1 localhost
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">255.255.255.255 broadcasthost
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">::1 localhost
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">140.82.121.4 github.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è§£å†³http2-stream-1-was-not-closed-cleanly-before-end-of-the-underlying-stream">è§£å†³HTTP/2 stream 1 was not closed cleanly before end of the underlying stream
&lt;/h3>&lt;p>ä¹‹åä½¿ç”¨&lt;code>git clone&lt;/code>åˆå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">jinjin@Mac-mini themes % git clone https://github.com/zhaohuabing/hugo-theme-cleanwhite.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Cloning into &lt;span class="s1">&amp;#39;hugo-theme-cleanwhite&amp;#39;&lt;/span>...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fatal: unable to access &lt;span class="s1">&amp;#39;https://github.com/zhaohuabing/hugo-theme-cleanwhite.git/&amp;#39;&lt;/span>: HTTP/2 stream &lt;span class="m">1&lt;/span> was not closed cleanly before end of the underlying stream
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å‚è€ƒ&lt;a class="link" href="https://blog.csdn.net/zz00008888/article/details/123529805" target="_blank" rel="noopener"
>è§£å†³ HTTP/2 stream 1 was not closed cleanly before end of the underlying stream&lt;/a>ï¼Œéœ€è¦å¯¹gitè¿›è¡Œå…¨å±€é…ç½®ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">git config --global http.version HTTP/1.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="åˆå§‹åŒ–ä¸»é¢˜é…ç½®åŠå‘å¸ƒ">åˆå§‹åŒ–ä¸»é¢˜é…ç½®åŠå‘å¸ƒ
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> themes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp -r hugo-theme-cleanwhite/exampleSite/** ../
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¥ç€è¿è¡Œ&lt;code>hugo server&lt;/code>åœ¨æœ¬åœ°&lt;a class="link" href="http://localhost:1313/" target="_blank" rel="noopener"
>http://localhost:1313/&lt;/a>å°±èƒ½çœ‹åˆ°åšå®¢çš„æ ·å­äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> ..
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hugo server
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">jinjin@Mac-mini hugo-blog % hugo server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Start building sites â€¦
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hugo v0.101.0+extended darwin/arm64 &lt;span class="nv">BuildDate&lt;/span>&lt;span class="o">=&lt;/span>unknown
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">|&lt;/span> EN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-------------------+-----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Pages &lt;span class="p">|&lt;/span> &lt;span class="m">71&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Paginator pages &lt;span class="p">|&lt;/span> &lt;span class="m">8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Non-page files &lt;span class="p">|&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Static files &lt;span class="p">|&lt;/span> &lt;span class="m">70&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Processed images &lt;span class="p">|&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Aliases &lt;span class="p">|&lt;/span> &lt;span class="m">17&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Sitemaps &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Cleaned &lt;span class="p">|&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Built in &lt;span class="m">82&lt;/span> ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Watching &lt;span class="k">for&lt;/span> changes in /Users/jinjin/code/hugo-blog/&lt;span class="o">{&lt;/span>archetypes,content,data,layouts,static,themes&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Watching &lt;span class="k">for&lt;/span> config changes in /Users/jinjin/code/hugo-blog/config.toml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Environment: &lt;span class="s2">&amp;#34;development&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Serving pages from memory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Running in Fast Render Mode. For full rebuilds on change: hugo server --disableFastRender
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Web Server is available at http://localhost:1313/ &lt;span class="o">(&lt;/span>&lt;span class="nb">bind&lt;/span> address 127.0.0.1&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Ctrl+C to stop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">^C%
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ä¿®æ”¹é…ç½®">ä¿®æ”¹é…ç½®
&lt;/h3>&lt;p>å¯ä»¥è¾¹ä¿®æ”¹åšå®¢è¾¹åœ¨æœ¬åœ°é¢„è§ˆæ•ˆæœï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ä¿®æ”¹ï¼Œå°±æ˜¯åœ¨æ ¹ç›®å½•ä¸‹çš„&lt;code>congig.toml&lt;/code>æ–‡ä»¶ä¸­å°†&lt;code>baseurl&lt;/code>ä¿®æ”¹ä¸ºè‡ªå·±çš„åšå®¢åœ°å€ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">baseurl&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;https://wenjin1997.github.io&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="github-pageså‘å¸ƒåšå®¢">GitHub Pageså‘å¸ƒåšå®¢
&lt;/h2>&lt;p>é¦–å…ˆè¦åœ¨githubä¸Šåˆ›å»ºè‡ªå·±&lt;code>&amp;lt;è´¦æˆ·å&amp;gt;.github.io&lt;/code>çš„ä»“åº“ã€‚&lt;/p>
&lt;h3 id="æ‰‹åŠ¨å‘å¸ƒ">æ‰‹åŠ¨å‘å¸ƒ
&lt;/h3>&lt;p>Hugoç”Ÿæˆçš„é™æ€é¡µé¢ä¼šæ”¾åœ¨publicæ–‡ä»¶å¤¹ä¸‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">hugo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> public
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¥ç€å‘è¿œç¨‹æ¨é€æˆ‘ä»¬çš„gitä»“åº“ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">git init
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git remote add origin git@github.com:wenjin1997/wenjin1997.github.io
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git add .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git commit -m &lt;span class="s2">&amp;#34;add test&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git push origin master
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚æœåœ¨æ·»åŠ è¿œç¨‹ä»“åº“æ—¶å‡ºç°é”™è¯¯ï¼Œå‚è€ƒ&lt;a class="link" href="https://blog.csdn.net/top_code/article/details/50381432" target="_blank" rel="noopener"
>Git æç¤ºfatal: remote origin already exists é”™è¯¯è§£å†³åŠæ³•&lt;/a>è§£å†³æ–¹æ³•ï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤åˆ é™¤è¿œç¨‹gitä»“åº“ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">git remote rm origin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¥ç€å†ç”¨&lt;code>git remote add origin git@github.com:wenjin1997/wenjin1997.github.io&lt;/code>é‡æ–°æ·»åŠ è¿œç¨‹ä»“åº“ã€‚&lt;/p>
&lt;p>è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">jinjin@Mac-mini hugo-blog % &lt;span class="nb">cd&lt;/span> public
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jinjin@Mac-mini public % git init
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hint: Using &lt;span class="s1">&amp;#39;master&amp;#39;&lt;/span> as the name &lt;span class="k">for&lt;/span> the initial branch. This default branch name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hint: is subject to change. To configure the initial branch name to use in all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hint: of your new repositories, which will suppress this warning, call:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hint:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hint: git config --global init.defaultBranch &amp;lt;name&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hint:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hint: Names commonly chosen instead of &lt;span class="s1">&amp;#39;master&amp;#39;&lt;/span> are &lt;span class="s1">&amp;#39;main&amp;#39;&lt;/span>, &lt;span class="s1">&amp;#39;trunk&amp;#39;&lt;/span> and
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hint: &lt;span class="s1">&amp;#39;development&amp;#39;&lt;/span>. The just-created branch can be renamed via this command:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hint:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hint: git branch -m &amp;lt;name&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Initialized empty Git repository in /Users/jinjin/code/hugo-blog/public/.git/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jinjin@Mac-mini public % git remote add origin git@github.com:wenjin1997/wenjin1997.github.io
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jinjin@Mac-mini public % git add .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jinjin@Mac-mini public % git commit -m &lt;span class="s2">&amp;#34;add test&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>master &lt;span class="o">(&lt;/span>root-commit&lt;span class="o">)&lt;/span> af5a609&lt;span class="o">]&lt;/span> add &lt;span class="nb">test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">165&lt;/span> files changed, &lt;span class="m">60905&lt;/span> insertions&lt;span class="o">(&lt;/span>+&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> create mode &lt;span class="m">100644&lt;/span> 2017/11/03/hello-world/index.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> create mode &lt;span class="m">100644&lt;/span> 2017/11/04/istio-install_and_example/index.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> create mode &lt;span class="m">100644&lt;/span> 2017/11/07/istio-traffic-shifting/index.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...ï¼ˆçœç•¥ï¼‰
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jinjin@Mac-mini public % git push origin master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enumerating objects: 285, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Counting objects: 100% &lt;span class="o">(&lt;/span>285/285&lt;span class="o">)&lt;/span>, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Delta compression using up to &lt;span class="m">8&lt;/span> threads
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Compressing objects: 100% &lt;span class="o">(&lt;/span>213/213&lt;span class="o">)&lt;/span>, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Writing objects: 100% &lt;span class="o">(&lt;/span>285/285&lt;span class="o">)&lt;/span>, 3.32 MiB &lt;span class="p">|&lt;/span> 341.00 KiB/s, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total &lt;span class="m">285&lt;/span> &lt;span class="o">(&lt;/span>delta 82&lt;span class="o">)&lt;/span>, reused &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>delta 0&lt;span class="o">)&lt;/span>, pack-reused &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remote: Resolving deltas: 100% &lt;span class="o">(&lt;/span>82/82&lt;span class="o">)&lt;/span>, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To github.com:wenjin1997/wenjin1997.github.io
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * &lt;span class="o">[&lt;/span>new branch&lt;span class="o">]&lt;/span> master -&amp;gt; master
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è®¿é—®è‡ªå·±çš„åšå®¢åœ°å€&lt;a class="link" href="https://wenjin1997.github.io" target="_blank" rel="noopener"
>wenjin1997.github.io&lt;/a>ï¼Œå¯ä»¥çœ‹åˆ°å¤§åŠŸå‘Šæˆå•¦ï¼&lt;/p>
&lt;h3 id="è‡ªåŠ¨å‘å¸ƒ">è‡ªåŠ¨å‘å¸ƒ
&lt;/h3>&lt;p>ä½¿ç”¨Github Action é…ç½®è‡ªåŠ¨å‘å¸ƒåšå®¢ï¼Œå…ˆè¦åˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œä¾‹å¦‚hugo-blogï¼Œè¿™é‡Œæ”¾ç½®åšå®¢çš„æºç ï¼ŒåŒ…æ‹¬è‡ªå·±çš„åšå®¢æ–‡ç« ã€å›¾ç‰‡ç­‰ã€‚åœ¨ä»“åº“åˆ›å»º&lt;code>.github/workflows/deploy.yml&lt;/code>æ–‡ä»¶ï¼Œé…ç½®å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">deploy&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">push&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">workflow_dispatch&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">schedule&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># Runs everyday at 8:00 AM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">cron&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;0 0 * * *&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">jobs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">build&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">runs-on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ubuntu-latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">steps&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Checkout&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">actions/checkout@v2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">submodules&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-depth&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Setup Hugo&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">peaceiris/actions-hugo@v2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hugo-version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;latest&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Build Web&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">run&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">hugo&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deploy Web&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">peaceiris/actions-gh-pages@v3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">PERSONAL_TOKEN&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.PERSONAL_TOKEN }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">EXTERNAL_REPOSITORY&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">wenjin1997/wenjin1997.github.io&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">PUBLISH_BRANCH&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">master&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">PUBLISH_DIR&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">./public&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">commit_message&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ github.event.head_commit.message }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ³¨æ„è¦ä¿®æ”¹&lt;code> EXTERNAL_REPOSITORY: wenjin1997/wenjin1997.github.io&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;code>Checkout&lt;/code>æ­¥éª¤ä¸­çš„&lt;code>with&lt;/code>ä¸­é…ç½®çš„&lt;code>submoudles&lt;/code>å€¼ä¸º&lt;code>true&lt;/code>å¯ä»¥åŒæ­¥åšå®¢æºä»“åº“çš„å­æ¨¡å—ã€‚&lt;/p>
&lt;p>åœ¨GitHubè´¦æˆ·ä¸‹&lt;code>Setting - Developer settings - Personal access tokens - Tkens(classic)&lt;/code>åˆ›å»ºä¸€ä¸ªTokenã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-19-hugo-post/github-token.png"
loading="lazy"
alt="github-token"
>&lt;/p>
&lt;p>æƒé™å¼€å¯&lt;code>repo&lt;/code>å’Œ&lt;code>workflow&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-19-hugo-post/repo-workflow.png"
loading="lazy"
alt="repo-workflow"
>&lt;/p>
&lt;p>é…ç½®åå¤åˆ¶ç”Ÿæˆçš„Tokenï¼ˆåªä¼šå‡ºç°ä¸€æ¬¡ï¼‰ï¼Œåœ¨åˆšåˆšåˆ›å»ºçš„æºä»“åº“&lt;code>hugo-blog&lt;/code>çš„&lt;code>Settings - Security - Secretes - Actions&lt;/code>ä¸­æ·»åŠ &lt;code>PERSON_TOKEN&lt;/code>ä¸ºåˆšåˆšçš„Tokenã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-19-hugo-post/PERSONAL_TOKEN.png"
loading="lazy"
alt="PERSONAL_TOKEN"
>&lt;/p>
&lt;p>å®Œæˆä¸Šè¿°é…ç½®åï¼Œæœ¬åœ°ä¿®æ”¹åšå®¢æ–‡ç« ï¼Œå‘ä»“åº“&lt;code>hugo-blog&lt;/code>è¿›è¡Œæ¨é€ï¼Œå¯ä»¥è§¦å‘GitHub Actionï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆåšå®¢é¡µé¢å¹¶æ¨é€åˆ°GitHub Pagesä»“åº“ï¼ŒGitHub Pagesä»“åº“æ›´æ–°åï¼Œåˆä¼šè‡ªåŠ¨è§¦å‘å®˜æ–¹é¡µé¢éƒ¨ç½²CIï¼Œå®ç°åšå®¢å‘å¸ƒã€‚&lt;/p>
&lt;h2 id="åšå®¢æ”¯æŒæ•°å­¦å…¬å¼">åšå®¢æ”¯æŒæ•°å­¦å…¬å¼
&lt;/h2>&lt;p>å‚è€ƒ&lt;a class="link" href="https://shaohanyun.top/posts/env/hugo_mathjax/" target="_blank" rel="noopener"
>Hugoåšå®¢æ·»åŠ LaTeXè¯­æ³•æ”¯æŒ&lt;/a>ï¼Œåœ¨ä¸»é¢˜æ–‡ä»¶&lt;code>themes/hugo-theme-clean-white/layouts/partials&lt;/code>ä¸‹åˆ›å»º&lt;code>mathjax.html&lt;/code>ï¼Œå†…å®¹ä¸ºï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;text/javascript&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">async&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">MathJax&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Hub&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Config&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">tex2jax&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">inlineMath&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">[[&lt;/span>&lt;span class="s1">&amp;#39;$&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;$&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;\\(&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;\\)&amp;#39;&lt;/span>&lt;span class="p">]],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">displayMath&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">[[&lt;/span>&lt;span class="s1">&amp;#39;$$&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;$$&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;\[\[&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;\]\]&amp;#39;&lt;/span>&lt;span class="p">]],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">processEscapes&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">processEnvironments&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">skipTags&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;script&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;noscript&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;style&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;textarea&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;pre&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">TeX&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">equationNumbers&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">autoNumber&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;AMS&amp;#34;&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">extensions&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;AMSmath.js&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;AMSsymbols.js&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">MathJax&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Hub&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Queue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Fix &amp;lt;code&amp;gt; tags after MathJax finishes running. This is a
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// hack to overcome a shortcoming of Markdown. Discussion at
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// https://github.com/mojombo/jekyll/issues/199
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">var&lt;/span> &lt;span class="nx">all&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">MathJax&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Hub&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getAllJax&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="nx">all&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">length&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">all&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="nx">SourceElement&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">parentNode&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">className&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="s1">&amp;#39; has-jax&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">style&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">code&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nc">has-jax&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">font&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">inherit&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">font-size&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="kt">%&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">background&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">inherit&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">border&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">inherit&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">color&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">#515151&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">style&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨&lt;code>themes/hugo-theme-clean-white/layouts/partials/head.html&lt;/code>æ–‡ä»¶æœ«å°¾æ·»åŠ ä¸‹é¢ä¸€è¡Œä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">{{ partial &amp;#34;mathjax.html&amp;#34; . }}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™æ ·åœ¨æ¯ä¸ªé¡µé¢éƒ½ä¼šè‡ªåŠ¨æ’å…¥ä»£ç ï¼Œæ”¯æŒæ•°å­¦å…¬å¼äº†ã€‚&lt;/p>
&lt;p>Tipsï¼šä¸Šé¢ä½¿ç”¨çš„æ˜¯MathJaxï¼Œå¯¹äºLaTeXå…¬å¼ä¸­çš„æ¢è¡Œç¬¦ï¼Œè¦ä½¿ç”¨&lt;code>\\\&lt;/code>ä¸‰ä¸ªæ–œæ ä»£æ›¿&lt;code>\\&lt;/code>ï¼Œä¾‹å¦‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-latex" data-lang="latex">&lt;span class="line">&lt;span class="cl">&lt;span class="k">\begin&lt;/span>&lt;span class="nb">{&lt;/span>aligned&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\begin&lt;/span>&lt;span class="nb">{&lt;/span>cases&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\frac&lt;/span>&lt;span class="nb">{&lt;/span>du&lt;span class="nb">}{&lt;/span>dt&lt;span class="nb">}&lt;/span>=-&lt;span class="k">\frac&lt;/span>&lt;span class="nb">{&lt;/span>u&lt;span class="nb">}{&lt;/span>t&lt;span class="nb">}&lt;/span>,1&lt;span class="k">\leq&lt;/span> t&lt;span class="k">\leq&lt;/span> 2, &lt;span class="k">\\\&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> u(1)=1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\end&lt;/span>&lt;span class="nb">{&lt;/span>cases&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">\end&lt;/span>&lt;span class="nb">{&lt;/span>aligned&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™æ ·æ‰èƒ½æ­£å¸¸æ˜¾ç¤ºä¸¤è¡Œå…¬å¼ï¼š&lt;/p>
$$
\begin{aligned}
\begin{cases}
\frac{du}{dt}=-\frac{u}{t},1\leq t\leq 2, \\\
u(1)=1
\end{cases}
\end{aligned}
$$&lt;h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™
&lt;/h2>&lt;ol>
&lt;li>&lt;a class="link" href="https://themes.gohugo.io/" target="_blank" rel="noopener"
>Hugo å®˜ç½‘&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.pseudoyu.com/zh/2022/05/29/deploy_your_blog_using_hugo_and_github_action/" target="_blank" rel="noopener"
>Hugo + GitHub Actionï¼Œæ­å»ºä½ çš„åšå®¢è‡ªåŠ¨å‘å¸ƒç³»ç»Ÿ&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://toutiao.io/posts/npcjzh/preview" target="_blank" rel="noopener"
>å¦‚ä½•åˆ©ç”¨ GitHub Pages å’Œ Hugo è½»æ¾æ­å»ºä¸ªäººåšå®¢ï¼Ÿ&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://waynerv.com/posts/setup-blog-with-hugo-and-github-pages/" target="_blank" rel="noopener"
>ä½¿ç”¨ Hugo å’Œ GitHub Pages æ­å»ºé™æ€åšå®¢&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://themes.gohugo.io/themes/hugo-theme-cleanwhite/" target="_blank" rel="noopener"
>Hugo Themes: Clean White&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/zhaohuabing/hugo-theme-cleanwhite" target="_blank" rel="noopener"
>zhaohuabing/hugo-theme-cleanwhite&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.notion.so/github-18e3596e3b5f4c75b78c1c90ccc9594c#3bef0cc6434a4f6ea074149ebaa5aeca" target="_blank" rel="noopener"
>Failed to connect to github.com port 443: Operation timed out&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://blog.csdn.net/zz00008888/article/details/123529805" target="_blank" rel="noopener"
>è§£å†³ HTTP/2 stream 1 was not closed cleanly before end of the underlying stream&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://blog.csdn.net/top_code/article/details/50381432" target="_blank" rel="noopener"
>Git æç¤ºfatal: remote origin already exists é”™è¯¯è§£å†³åŠæ³•&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://shaohanyun.top/posts/env/hugo_mathjax/" target="_blank" rel="noopener"
>Hugoåšå®¢æ·»åŠ LaTeXè¯­æ³•æ”¯æŒ&lt;/a>&lt;/li>
&lt;/ol></description></item><item><title>Zero Knowledge Proofs: An illustratedÂ primer</title><link>https://wenjin1997.github.io/2022/11/16/Zero-Knowledge-Proofs-An-illustrated-primer/</link><pubDate>Wed, 16 Nov 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/11/16/Zero-Knowledge-Proofs-An-illustrated-primer/</guid><description>&lt;img src="https://wenjin1997.github.io/img/2022-11-16-Zero-Knowledge-Proofs-An-illustrated-primer/background.jpg" alt="Featured image of post Zero Knowledge Proofs: An illustratedÂ primer" />&lt;p>åŸæ–‡é“¾æ¥ï¼š&lt;a class="link" href="https://blog.cryptographyengineering.com/2014/11/27/zero-knowledge-proofs-illustrated-primer/" target="_blank" rel="noopener"
>Zero Knowledge Proofs: An illustrated primer&lt;/a>ã€‚æœ¬ç¯‡æ–‡ç« é€šè¿‡å›¾ä¸‰è‰²é—®é¢˜æ¥ä»‹ç»ä»€ä¹ˆæ˜¯é›¶çŸ¥è¯†è¯æ˜ã€‚&lt;/p>
&lt;p>One of the best things about modern cryptography ï¼ˆå¯†ç å­¦ï¼‰ is the beautiful terminology ï¼ˆæœ¯è¯­ï¼‰. You could start any number of punk bandsï¼ˆæœ‹å…‹ä¹é˜Ÿï¼‰ (orÂ &lt;a class="link" href="http://www.explainxkcd.com/wiki/index.php/1025:_Tumblr" target="_blank" rel="noopener"
>Tumblrs&lt;/a>) named after cryptography terms like â€˜hard-core predicateâ€™, â€˜trapdoor functionâ€™,Â &lt;em>â€˜&lt;/em>Â or â€˜impossible differential cryptanalysis ï¼ˆå¯†ç åˆ†æï¼‰â€™. And of course, I havenâ€™t even mentioned the one term that surpasses all of these. That term is â€˜&lt;em>zero knowledge&lt;/em>â€˜.&lt;/p>
&lt;p>&lt;img src="https://matthewdgreen.files.wordpress.com/2014/11/54b69-zk.jpg"
loading="lazy"
alt="https://matthewdgreen.files.wordpress.com/2014/11/54b69-zk.jpg"
>&lt;/p>
&lt;p>In fact, the term â€˜zero knowledgeâ€™ is so appealingï¼ˆæœ‰å¸å¼•åŠ›çš„ï¼‰ that it leads to problems. People misuse it, assuming that zero knowledge must be synonymousï¼ˆåŒä¹‰è¯ï¼‰ with â€˜&lt;em>really, reallyÂ secure&lt;/em>â€˜. Hence it gets tackedï¼ˆé™„åŠ ï¼Œå¢è¡¥ï¼‰ onto all kinds of stuff â€” likeÂ &lt;a class="link" href="https://spideroak.com/faq/questions/23/is_spideroak_really_zero_knowledge_could_you_read_a_users_data_if_forced_at_gunpoint/" target="_blank" rel="noopener"
>encryptionï¼ˆåŠ å¯†ï¼‰ systems&lt;/a>Â and anonymityï¼ˆåŒ¿åï¼‰ networks â€” that really have nothing to do with true zero knowledge protocols.&lt;/p>
&lt;p>æ¾„æ¸…é›¶çŸ¥è¯†çš„è¯¯åŒºï¼ŒåƒåŠ å¯†ç³»ç»Ÿå’ŒåŒ¿åç½‘ç»œï¼ŒçœŸçš„å’Œé›¶çŸ¥è¯†åè®®æ²¡æœ‰å…³ç³»ã€‚&lt;/p>
&lt;p>This all serves to underscore a point:Â &lt;a class="link" href="http://en.wikipedia.org/wiki/Zero-knowledge_proof" target="_blank" rel="noopener"
>zero-knowledge proofs&lt;/a>Â are one of the most powerful tools cryptographers have ever devisedï¼ˆè®¾è®¡çš„ï¼‰. But unfortunately theyâ€™re also relatively poorly understood. In this series of posts Iâ€™m going try to give a (mostly)Â &lt;em>non&lt;/em>â€“&lt;em>mathematical&lt;/em>Â description of what ZK proofs are, and what makes them so special. In this post and the next Iâ€™ll talk about some of the ZK protocols we actually use.&lt;/p>
&lt;h3 id="origins-of-zero-knowledge">Origins of Zero Knowledge
&lt;/h3>&lt;p>The notion of â€˜zero knowledgeâ€™ was first proposedÂ &lt;a class="link" href="http://groups.csail.mit.edu/cis/pubs/shafi/1985-stoc.pdf" target="_blank" rel="noopener"
>in the 1980&lt;/a>sÂ by MIT researchers Shafi Goldwasser, Silvio Micali and Charles Rackoff. These researchers were working on problems related toÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/Interactive_proof_system" target="_blank" rel="noopener"
>interactive proof systems&lt;/a>, theoretical systems where a first party (called a â€˜Proverâ€™) exchanges messages with a second party (â€˜Verifierâ€™) to convince the Verifier that some mathematical statement is true.*&lt;/p>
&lt;p>é›¶çŸ¥è¯†çš„æ¦‚å¿µå‡ºç°åœ¨1980s Shafi Goldwasserï¼ŒSilvio Micali å’Œ Charles Rackoffå‘è¡¨çš„è¿™ç¯‡æ–‡ç« ä¸­ã€‚ç ”ç©¶è€…å…³æ³¨åœ¨äº¤äº’å¼è¯æ˜ç³»ç»Ÿï¼Œä¸€æ–¹æ˜¯â€œProverâ€ï¼Œå¦ä¸€æ–¹æ˜¯â€œVerifierâ€ï¼ŒProverä¸Verifieräº¤æ¢ä¿¡æ¯ï¼Œæ¥è¯´æœVerifieråœ¨æ•°å­¦ä¸Šï¼ˆå¯ä»¥æ˜¯æ¦‚ç‡æ„ä¹‰ä¸‹ï¼‰ç›¸ä¿¡ä¸€äº›é™ˆè¿°æ˜¯çœŸçš„ã€‚&lt;/p>
&lt;p>Prior to GoldwasserÂ &lt;em>et al.&lt;/em>, most work in this area focused theÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/Soundness" target="_blank" rel="noopener"
>soundness&lt;/a>Â of the proof system. That is, it considered the case where a maliciousï¼ˆæ¶æ„çš„ï¼‰ Prover attempts to â€˜trickâ€™ a Verifier into believing a false statement. What Goldwasser, Micali and Rackoff did was to turn this problem on its head. Instead of worrying only about the Prover, they asked: what happens if you donâ€™t trust theÂ &lt;em>Verifier?&lt;/em>&lt;/p>
&lt;p>ä¹‹å‰çš„å·¥ä½œä¸»è¦è€ƒè™‘è¯æ˜ç³»ç»Ÿçš„å¯é æ€§ï¼Œè€ƒè™‘çš„æ˜¯æ¶æ„çš„è¯æ˜æ–¹ï¼Œè€Œ Goldwasser, Micali å’Œ Rackoff å¼€å§‹è€ƒè™‘å¦‚æœä¸ç›¸ä¿¡éªŒè¯è€…ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæˆ‘ä»¬ä¸èƒ½å‚»ä¹ä¹çš„å°±æŠŠä¸€äº›ç§˜å¯†æ³„æ¼ç»™proverã€‚&lt;/p>
&lt;p>The specific concern they raised wasÂ &lt;em>information leakage.&lt;/em>Â Concretely, they asked, how much extra informationÂ is the Verifier going to learn during the course of this proof, beyond the mere fact that the statement is true?&lt;/p>
&lt;p>ä»–ä»¬è€ƒè™‘çš„æ˜¯éªŒè¯è€…å¯èƒ½ä¼šæ³„æ¼ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯åœ¨é™¤äº†çŸ¥é“é™ˆè¿°æ˜¯çœŸçš„è¿™ä¸ªä¿¡æ¯å¤–ï¼ŒéªŒè¯è€…é€šè¿‡è¿™ä¸ªè¯æ˜è¿‡ç¨‹è¿˜çŸ¥é“ä»€ä¹ˆé¢å¤–çš„ä¿¡æ¯ï¼Ÿ&lt;/p>
&lt;p>Itâ€™s important to note that this is not simply of theoretical interest. There are real, practical applications where this kind of thing matters.&lt;/p>
&lt;p>Hereâ€™s one: imagine that a real-world client wishes to log into a web server using a password. The standard â€˜real worldâ€™ approach to this problem involves storing aÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/Cryptographic_hash_function#Password_verification" target="_blank" rel="noopener"
>hashed version of the password&lt;/a>Â on the server. The login can thus be viewed as a sort of â€˜proofâ€™ that a given password hash is the output of a hash function on some password â€” and more to the point, that the client actuallyÂ &lt;em>knows&lt;/em>Â the password.&lt;/p>
&lt;p>Most real systems implement this â€˜proofâ€™ in the absolute worst possible way. The client simply transmits the original password to the server, which re-computes the password hash and compares it to the stored value. The problem here is obvious: at the conclusion of the protocol,Â &lt;em>the server has learned my cleartext password.&lt;/em>Â Modern password hygieneï¼ˆå«ç”Ÿï¼‰ therefore involves a good deal of praying that servers arenâ€™t compromisedï¼ˆæŸå®³ï¼‰.&lt;/p>
&lt;p>è¿™é‡Œä¸¾äº†ç°å®ä¸­çš„ä¸€ä¸ªä¾‹å­ï¼Œå°±æ˜¯å¯†ç ç™»å½•ã€‚å¤§å¤šæ•°å®é™…çš„ç³»ç»Ÿä¸­å®¢æˆ·ç«¯ç®€å•çš„å°†åŸå§‹å¯†ç å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å†è®¡ç®—ä¸€éå¯†ç çš„å“ˆå¸Œå€¼ï¼Œç„¶åå’Œå­˜å‚¨çš„å€¼è¿›è¡Œæ¯”è¾ƒã€‚è¿™é‡Œä¼šå‡ºç°å®‰å…¨é—®é¢˜ï¼Œå¯†ç ä¸æ³„æ¼åªèƒ½ç¥ˆç¥·äºæœåŠ¡ç«¯ä¸ä¼šå‡ºç°é—®é¢˜ã€‚&lt;/p>
&lt;p>What Goldwasser, Micali and Rackoff proposedÂ was a new hope for conducting such proofs. If fully realized, zero knowledge proofs would allow us to prove statements like the one above, while provably revealingÂ &lt;em>no information&lt;/em>Â beyond the single bit of information corresponding to â€˜this statement is trueâ€™.&lt;/p>
&lt;p>é›¶çŸ¥è¯†å°±æ˜¯é™¤äº†â€™this statement is trueâ€™å¤–ä¸ä¼šæ³„æ¼ä»»ä½•å…¶ä»–çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;h3 id="a-real-world-example">A â€˜real worldâ€™ example
&lt;/h3>&lt;p>So far this discussion has been pretty abstract. To make things a bit more concrete, letâ€™s go ahead and give a â€˜realâ€™ example of a (slightly insaneï¼ˆç–¯ç‹‚çš„ï¼›éå¸¸æ„šè ¢çš„ï¼‰) zero knowledge protocol.&lt;/p>
&lt;p>For the purposes of this example, Iâ€™d like you to imagine that Iâ€™m a telecomï¼ˆç”µä¿¡ï¼‰ magnateï¼ˆå·¨å¤´ï¼‰ in the process of deployingï¼ˆéƒ¨ç½²ï¼‰ a new cellularï¼ˆèœ‚çªï¼‰ communications network. My network structure is represented by the graph below. Each vertexï¼ˆé¡¶ç‚¹ï¼‰ in this graph represents a cellular radio tower, and the connecting lines (edges) indicate locations where two cellsÂ &lt;em>overlapï¼ˆé‡å ï¼‰&lt;/em>, meaning that their transmissions are likely to interfere with each other.&lt;/p>
&lt;p>&lt;img src="https://matthewdgreen.files.wordpress.com/2014/11/d5db3-uncoloredgraph.png?w=200&amp;amp;h=122"
loading="lazy"
alt="https://matthewdgreen.files.wordpress.com/2014/11/d5db3-uncoloredgraph.png?w=200&amp;h=122"
>&lt;/p>
&lt;p>éƒ¨ç½²èœ‚çªç½‘çš„ä¾‹å­ï¼Œæ¯ä¸ªé¡¶ç‚¹ä»£è¡¨ä¸€ä¸ªèœ‚çªå¡”ï¼Œæ¯ä¸ªè¾¹ä»£è¡¨ç€ä¸¤ä¸ªæœ‰é‡å ï¼Œæ„å‘³ç€ä»–ä»¬ä¹‹é—´çš„ä¼ è¾“ä¼šç›¸äº’å½±å“ã€‚&lt;/p>
&lt;p>This overlap is problematic, since it means that signals from adjacent towers are likely to scrambleï¼ˆäº‰å¤ºï¼‰ reception. Fortunately my network design allows me to configure each tower to one of three different frequency bands to avoid such interference.&lt;/p>
&lt;p>Thus the challenge in deploying my network is to assign frequency bands to the towers such that no two overlapping cells share the same frequencies. If we use colors to represent the frequency bands, we can quickly work out one solution to the problem:&lt;/p>
&lt;p>&lt;img src="https://matthewdgreen.files.wordpress.com/2014/11/af15c-coloredgraph.png?w=200&amp;amp;h=122"
loading="lazy"
alt="https://matthewdgreen.files.wordpress.com/2014/11/af15c-coloredgraph.png?w=200&amp;h=122"
>&lt;/p>
&lt;p>ä¸¤ä¸ªç›¸é‚»å¡”ä¹‹é—´ç”¨ä¸åŒçš„é¢‘ç‡ï¼Œä¹Ÿå°±è½¬æ¢ä¸ºå›¾ä¸‰è‰²é—®é¢˜ã€‚åœ¨è®¡ç®—å¤æ‚åº¦åˆ†ç±»ä¸Šï¼Œå®ƒå±äºNP-completeé—®é¢˜ã€‚&lt;/p>
&lt;p>Of course, many of you will notice that what Iâ€™m describing here is simply an instance of the famous theory problem called theÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/Graph_coloring" target="_blank" rel="noopener"
>graph three-coloring&lt;/a>Â problem. You might also know that what makes this problem interesting is that, for some graphs, it can be quite hard to find a solution, or even to determineÂ &lt;em>if&lt;/em>Â a solution exists.Â **In fact, graph three-coloring â€” specifically, the decision problem of whether a given graph supports a solution with three colors â€” is known to be in the complexity classÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/NP-complete" target="_blank" rel="noopener"
>NP-complete&lt;/a>.&lt;/p>
&lt;p>It goes without saying that the toy example above is easy to solve by hand. But what if it wasnâ€™t? For example, imagine that my cellular network was very large and complex, so much so that the computing power at my disposalï¼ˆå¤„ç†ï¼‰ was not sufficient to find a solution. In this instance, it would be desirable toÂ &lt;em>outsource&lt;/em>Â the problem to someone else who has plenty of computing power. For example, I might hire my friends at Google to solve it for me on spec.&lt;/p>
&lt;p>But this leads to a problem.&lt;/p>
&lt;p>Suppose that Google devotes a large percentage of their computing infrastructure to searching for a valid coloring for my graph. Iâ€™m certainly not going to pay them until I know that they really have such a coloring. At the same time, Google isnâ€™t going to give me a copy of their solution until Iâ€™ve paid up. Weâ€™ll wind up at an impasseï¼ˆåƒµå±€ï¼‰.&lt;/p>
&lt;p>In real life thereâ€™s probably a common-sense answer to this dilemma, one that involves lawyers and escrowï¼ˆç¬¬ä¸‰æ–¹æ‰˜ç®¡ï¼‰ accounts. But this is not a blog about real life, itâ€™s a blog about cryptography. And if youâ€™ve ever read aÂ crypto paper, youâ€™ll understand that the right way to solve this problem isÂ &lt;em>to dream up an absolutely crazy technical solution&lt;/em>.&lt;/p>
&lt;h3 id="a-crazy-technical-solution-with-hats">A crazy technical solution (with hats!)
&lt;/h3>&lt;p>The engineers at Google consult with Silvio Micali at MIT, who in consultation with his colleaguesÂ &lt;a class="link" href="http://people.csail.mit.edu/silvio/Selected%20Scientific%20Papers/Zero%20Knowledge/Proofs_That_Yield_Nothing_But_Their_Validity_or_All_Languages_in_NP_Have_Zero-Knowledge_Proof_Systems.pdf" target="_blank" rel="noopener"
>Oded Goldreich and Avi Wigderson&lt;/a>,Â comes up withÂ the following clever protocol â€” one so elegant that it doesnâ€™t even require any computers. All it requires is a large warehouse, lots of crayonsï¼ˆèœ¡ç¬”ï¼‰, and plenty of paper. Oh yes, and a whole bunch of hats.**&lt;/p>
&lt;p>Hereâ€™s how it works.&lt;/p>
&lt;p>First I will enter the warehouse, cover the floor with paper, and draw a blank representation of my cell network graph. Then Iâ€™ll exit the warehouse. Google can now enter enter, shuffle a collection of three crayons toÂ &lt;em>pick a random assignment of the three agreed-upon crayon colors&lt;/em>Â (red/blue/purple, as in the example above), and color in the graph in with their solution. Note that it doesnâ€™t matter which specific crayons they use, only that the coloring is valid.&lt;/p>
&lt;p>Before leaving the warehouse, Google covers up each of the vertices with a hat. When I come back in, this is what Iâ€™ll see:&lt;/p>
&lt;p>&lt;img src="https://matthewdgreen.files.wordpress.com/2014/11/538c4-hats.png?w=200&amp;amp;h=122"
loading="lazy"
alt="https://matthewdgreen.files.wordpress.com/2014/11/538c4-hats.png?w=200&amp;h=122"
>&lt;/p>
&lt;p>Obviously this approach protects Googleâ€™s secret coloring perfectly. But it doesnâ€™t help me at all. For all I know, Google might have filled in the graph with a random, invalid solution. They might not even have colored the graph at all.&lt;/p>
&lt;p>To address my valid concerns, Google now gives me an opportunity to â€˜challengeâ€™ their solution to the graph coloring*.*Â Iâ€™m allowed to pick â€” at random â€” a single â€˜edgeâ€™ of this graph (that is, one line between two adjacent hats). Google will then remove the two corresponding hats, revealing a small portion of their solution:&lt;/p>
&lt;p>&lt;img src="https://matthewdgreen.files.wordpress.com/2014/11/12725-hatsminusone.png?w=200&amp;amp;h=122"
loading="lazy"
alt="https://matthewdgreen.files.wordpress.com/2014/11/12725-hatsminusone.png?w=200&amp;h=122"
>&lt;/p>
&lt;p>Notice that there are two outcomes to my experiment:&lt;/p>
&lt;ol>
&lt;li>If the two revealed vertices are the same color (or arenâ€™t colored in at all!) then I definitely know that Google is lying to me. Clearly Iâ€™m not going to pay Google a cent.&lt;/li>
&lt;li>If the two revealed vertices are different colors, then GoogleÂ &lt;em>might&lt;/em>Â &lt;em>not&lt;/em>Â be lying to me.&lt;/li>
&lt;/ol>
&lt;p>Hopefully the first proposition is obvious. The second one requires a bit more consideration. The problem is thatÂ &lt;em>even after our experiment&lt;/em>, Google could still be lying to me â€” after all, I only looked under two of the hats. If there areÂ &lt;em>E&lt;/em>Â different edges in the graph, then Google could fill in an invalidÂ solution and still get away with it most of the time. Specifically, after one test they could succeed in cheating me with probability up to (&lt;em>E&lt;/em>-1)/&lt;em>E&lt;/em>Â (which forÂ a 1,000 edge graph works out to 99.9% of the time).&lt;/p>
&lt;p>Fortunately Google has an answer to this. Weâ€™ll just run the protocolÂ &lt;em>again!&lt;/em>&lt;/p>
&lt;p>We put down fresh paper with a new, blank copy of the graph.Â &lt;em>Google now picks a new (random) shuffle of the three crayons&lt;/em>. Next they fill in the graph with a valid solution, but using the new random ordering of the three colors.&lt;/p>
&lt;p>The hats go back on. I come back in and repeat the challenge process, picking a new random edge. Once again the logic above applies. Only this time if all goes well, I should now be slightly more confident that Google is telling me the truth. Thatâ€™s because in order to cheat me, Google would have had to get lucky twice in a row. That can happen â€” but it happens with relatively lower probability. The chance that Google fools me twice in a row is now (&lt;em>E&lt;/em>-1)/*E **Â (&lt;em>E&lt;/em>-1)/&lt;em>E&lt;/em>Â (or about 99.8% probability for our 1,000 edge example above).&lt;/p>
&lt;p>Fortunately we donâ€™t have to stop at two challenges. In fact, we can keep trying this over and over again until Iâ€™m confident that Google is probably telling me the truth.&lt;/p>
&lt;p>But donâ€™t take my word for it. Thanks to some neat Javascript, you canÂ &lt;a class="link" href="http://web.mit.edu/~ezyang/Public/graph/svg.html" target="_blank" rel="noopener"
>go try it yourself&lt;/a>.&lt;/p>
&lt;p>Note that Iâ€™ll never be perfectly certain that Google is being honest â€” thereâ€™s always going to be a tiny probability that theyâ€™re cheating me. But after a large number of iterations (&lt;em>E^2,&lt;/em>Â as it happens) I can eventually raise my confidence to the point where Google can only cheat me withÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/Negligible_function" target="_blank" rel="noopener"
>negligible&lt;/a>Â probability â€” low enough thatÂ &lt;em>for all practical purposes&lt;/em>Â itâ€™s not worth worrying about. And then Iâ€™ll be able to safely hand Google my money.&lt;/p>
&lt;p>What you need to believe is that Google is alsoÂ protected. Even if I try to learn something about their solution by keeping notes between protocol runs, it shouldnâ€™t matter. Iâ€™m foiled by Googleâ€™s decision toÂ &lt;em>randomize&lt;/em>Â their color choices between each iteration. The limited information I obtain does me no good, and thereâ€™s no way for me toÂ &lt;em>link&lt;/em>Â the data I learn between interactions.&lt;/p>
&lt;p>æ€»ç»“ä¸€ä¸‹ä¸Šé¢çš„è¿‡ç¨‹ï¼Œé¦–å…ˆæˆ‘è¿›å…¥æˆ¿é—´ï¼Œç”»å‡ºå›¾ï¼Œæ¥ç€Googleè¿›å…¥æˆ¿é—´ï¼Œéšæœºé€‰æ‹©ä¸‰ç§é¢œè‰²ï¼Œæ¶‚ä¸Šè§£æ³•ï¼Œç›–ä¸Šå¸½å­ï¼Œæœ€åæˆ‘å†è¿›å…¥æˆ¿é—´ï¼Œå–ä¸‹ä»»æ„ä¸€ä¸ªè¾¹çš„ä¸¤ä¸ªå¸½å­ï¼Œçœ‹æ˜¯å¦æ˜¯ç›¸åŒé¢œè‰²ã€‚é‡å¤ä¸Šè¿°è¿‡ç¨‹è¶³å¤Ÿå¤šæ¬¡ï¼Œ$E^2$æ¬¡ï¼Œæœ‰ç†ç”±ç›¸ä¿¡Googleæœ‰è§£ï¼Œè€Œæˆ‘æ— æ³•é€šè¿‡è¿™ä¸ªäº¤äº’è¿‡ç¨‹è·å¾—è§£çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;h3 id="what-makes-it-zero-knowledge">What makes it â€˜zero knowledgeâ€™?
&lt;/h3>&lt;p>Iâ€™ve claimed to you that this protocol leaks no information about Googleâ€™s solution. But donâ€™t let me get away with this! The first rule of modern cryptography isÂ &lt;em>never to trust people&lt;/em>Â who claim such things without proof.&lt;/p>
&lt;p>Goldwasser, Micali and Rackoff proposed three following properties that every zero-knowledge protocol must satisfy. Stated informally, they are:&lt;/p>
&lt;ol>
&lt;li>&lt;em>Completeness.&lt;/em>Â If Google is telling the truth, then they will eventually convince me (at least with high probability).&lt;/li>
&lt;li>&lt;em>Soundness.&lt;/em>Â Google canÂ &lt;em>only&lt;/em>Â convince meÂ &lt;em>if&lt;/em>Â theyâ€™re actually telling the truth.&lt;/li>
&lt;li>&lt;em>Zero-knowledgeness.&lt;/em>Â (Yes itâ€™s really called this.)Â **IÂ donâ€™t learnÂ anythingÂ elseÂ **about Googleâ€™s solution.&lt;/li>
&lt;/ol>
&lt;p>é›¶çŸ¥è¯†åè®®éœ€è¦æ»¡è¶³ï¼š&lt;/p>
&lt;ol>
&lt;li>å®Œå¤‡æ€§ã€‚å¦‚æœGoogleè¯´çš„æ˜¯äº‹å®ï¼Œé‚£ä¹ˆä»–ä»¬æœ€ç»ˆä¼šè¯´æœæˆ‘ã€‚&lt;/li>
&lt;li>å¯é æ€§ã€‚åªæœ‰å½“GoogleçœŸçš„è¯´çš„æ˜¯äº‹å®æ—¶æ‰èƒ½è¯´æœæˆ‘ã€‚&lt;/li>
&lt;li>é›¶çŸ¥è¯†ã€‚æˆ‘ä¸èƒ½è·å¾—å…³äºGoogle è§£æ³•çš„ä»»ä½•çŸ¥è¯†ã€‚&lt;/li>
&lt;/ol>
&lt;p>Weâ€™ve already discussed the argument for completeness. The protocol will eventually convince me (with a negligible error probability), provided we run it enough times. Soundness is also pretty easy to show here. If Google ever tries to cheat me, I will detect their treachery with overwhelming probability.&lt;/p>
&lt;p>å®Œå¤‡æ€§è¯æ˜ï¼šä¸Šè¿°è¿‡ç¨‹å·²ç»è¯æ˜äº†ï¼Œåªè¦äº¤äº’è¿‡ç¨‹é‡å¤çš„æ¬¡æ•°è¶³å¤Ÿå¤šï¼Œæœ€ç»ˆéƒ½ä¼šä»¥ä¸€ä¸ªå¯ä»¥å¿½ç•¥çš„é”™è¯¯æ¦‚ç‡æ¥ä½¿æˆ‘ä¿¡æœã€‚&lt;/p>
&lt;p>å¯é æ€§è¯æ˜ï¼šå¦‚æœGoogleæ¬ºéª—æˆ‘ï¼Œæˆ‘ä¼šæœ‰å‹å€’æ€§çš„æ¦‚ç‡å‘ç°è¿™ä¸€ç‚¹ã€‚&lt;/p>
&lt;p>å‚è€ƒBIUè¯¾ç¨‹ï¼Œå®Œå¤‡æ€§å’Œå¯é æ€§çš„ä¸¥æ ¼å®šä¹‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-16-Zero-Knowledge-Proofs-An-illustrated-primer/Untitled.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>The hard part here is the â€˜zero knowledgenessâ€™ property. To do this, we need to conduct a very strange thought experiment.&lt;/p>
&lt;h3 id="a-thought-experiment-with-time-machines">A thought experiment (with time machines)
&lt;/h3>&lt;p>First, letâ€™s start with a crazy hypotheticalï¼ˆå‡è®¾ï¼‰. Imagine that Googleâ€™s engineers arenâ€™t quite as capable as people make them out to be. They work on this problem for weeks and weeks,Â &lt;em>but they never manage to come up with a solution&lt;/em>. With twelve hours to go until showtime, the Googlers get desperate. They decide toÂ &lt;em>trick&lt;/em>Â me intoÂ thinkingÂ they have a coloring for the graph, even though they donâ€™t.&lt;/p>
&lt;p>Their idea is to sneak into the GoogleX workshop and borrow Googleâ€™s prototypeÂ &lt;a class="link" href="http://mashable.com/2014/04/23/google-street-view-time-machine/" target="_blank" rel="noopener"
>time machine&lt;/a>. Initially the plan is to travel backwards a few years and use the extra working time to take another crack at solving the problem. Unfortunately it turns out that, like most Google prototypes, the time machine has some limitations. Most critically: itâ€™s only capable of going backwards in timeÂ &lt;em>four and a half minutes.&lt;/em>&lt;/p>
&lt;p>So using the time machine to manufacture more working time is out. But still, it turns out that even this very limited technology can still be used to trick me.&lt;/p>
&lt;p>&lt;img src="https://i0.wp.com/farm5.static.flickr.com/4030/4383097320_118c18153e_m.jpg"
loading="lazy"
alt="I donâ€™t really know whatâ€™s going on herebut it seemed apropos."
>&lt;/p>
&lt;p>I donâ€™t really know whatâ€™s going on herebut it seemed apropos.&lt;/p>
&lt;p>The plan is diabolicallyï¼ˆéå¸¸ï¼‰ simple. Since GoogleÂ &lt;em>doesnâ€™t actually know&lt;/em>Â a valid coloring for the graph, theyâ€™ll simply color the paper with a bunch of random colors, then put the hats on. If by sheer luck, I challenge them on a pair of vertices that happen to be different colors, everyone will heave a sigh of relief and weâ€™ll continue with the protocol. So far so good.&lt;/p>
&lt;p>Inevitablyï¼ˆä¸å¯é¿å…åœ°ï¼‰, though, Iâ€™m going to pull off a pair of hats and discover two vertices of theÂ &lt;em>same&lt;/em>Â color. In the normal protocol, Google would now be totally bustedï¼ˆå´©æºƒï¼‰. And this is where the time machine comes in. Whenever Google finds themselves in this awkward situation, they simply fix it. That is, a designated Googler pulls a switch, â€˜rewindsâ€™ time about four minutes, and the Google team recolors the graph with a completely new random solution. Now they let time roll forward and try again.&lt;/p>
&lt;p>In effect, the time machine allows Google to â€˜repairâ€™ any accidents that happen during their bogusï¼ˆè™šå‡çš„ï¼‰ protocol execution, which makes the experience look totally legitimate to me. Since bad challenge results will occur only 1/3 of the time, the expected runtime of the protocol (from Googleâ€™s perspective) is only moderately greater than the time it takes to run the honest protocol. From my perspective I donâ€™t even know that the extra time machine trips are happening.&lt;/p>
&lt;p>This last point is the most important. In fact, from my perspective, being unaware that the time machine is in the picture, the resulting interactionÂ &lt;em>is exactly the same as the real thing.&lt;/em>Â Itâ€™s statistically identical.Â And yet itâ€™s worth pointing out again that in the time machine version,Â &lt;em>Google has absolutely no information about how to color the graph.&lt;/em>&lt;/p>
&lt;p>æ€»ç»“ä¸€ä¸‹ï¼ŒGoogleä¸çŸ¥é“å›¾æ¶‚è‰²çš„è§£æ³•ï¼Œä½†æ˜¯ä»–ä»¬æœ‰ç¥å™¨æ—¶é—´æœºå™¨ï¼Œå¯ä»¥å€’é€€å››åˆ†åŠçš„æ—¶é—´ã€‚
å¦‚æœåœ¨äº¤äº’è¿‡ç¨‹ä¸­å¤±è´¥ï¼Œä»–ä»¬å°±ä½¿ç”¨æ—¶é—´æœºå™¨å€’é€€ï¼Œé‡æ–°æ¶‚è‰²ã€‚
ä»æˆ‘çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘æ²¡æœ‰æ„è¯†åˆ°ä»–ä»¬æœ‰æ—¶é—´æœºå™¨ï¼Œå› æ­¤äº§ç”Ÿçš„äº’åŠ¨å’ŒçœŸå®çš„ä¸œè¥¿å®Œå…¨ä¸€æ ·ï¼Œåœ¨ç»Ÿè®¡ä¸Šæ˜¯ç›¸åŒçš„ã€‚ä½†æ˜¯åœ¨æ—¶é—´æœºå™¨ç‰ˆæœ¬ï¼ŒGoogleå®Œå…¨æ²¡æœ‰æ¶‚è‰²çš„è§£æ³•ã€‚&lt;/p>
&lt;p>BIUè¯¾ç¨‹ä¸­å¯¹HVZKçš„å®šä¹‰ï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-11-16-Zero-Knowledge-Proofs-An-illustrated-primer/Untitled%201.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;h3 id="what-the-hell-is-the-point-of-this">What the hell is the point of this?
&lt;/h3>&lt;p>What weâ€™ve just shown is an example of aÂ &lt;em>simulation&lt;/em>. Note that in a world where time runs only forward and nobody can trick me with a time machine, the hat-based protocol is correct andÂ &lt;em>sound&lt;/em>, meaning that afterÂ &lt;em>E^2&lt;/em>Â rounds I should be convinced (with all but negligible probability) that the graph really is colorable and that Google is putting valid inputs into the protocol.&lt;/p>
&lt;p>What weâ€™ve just shown is that if time doesnâ€™t run only forward â€” specifically, if Google can â€˜rewindâ€™ my view of time â€” then they can fake a valid protocol runÂ &lt;em>even if they have no information at all about the actual graph coloring.&lt;/em>&lt;/p>
&lt;p>From my perspective, whatâ€™s the difference between the two protocol transcripts? When we consider the statistical distribution of the two, thereâ€™s no difference at all*.*Â Both convey exactly the same amount of useful information.&lt;/p>
&lt;p>Believe it or not, this proves something very important.&lt;/p>
&lt;p>Specifically, assume that I (the Verifier) have some strategy that â€˜extractsâ€™ useful information about Googleâ€™s coloring after observing an execution of the honest protocol. Then my strategy should work equally well in the case where Iâ€™m being fooled with a time machine. The protocol runs are, from my perspective, statistically identical. I physically cannot tell the difference.&lt;/p>
&lt;p>Thus if the amount of information I can extract is identical in the â€˜real experimentâ€™ and the â€˜time machine experimentâ€™, yet the amount of information Google puts into the â€˜time machineâ€™ experiment is exactly zero â€” then this implies that even in the real world the protocol must not leak any useful information.&lt;/p>
&lt;p>Thus it remains only to show that computer scientists have time machines. We do! (Itâ€™s a well-kept secret.)&lt;/p>
&lt;p>æ€»ç»“ï¼šä»æˆ‘çš„è§†è§’æ¥çœ‹ï¼Œä¸¤ä¸ªåè®®æ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼Œå› ä¸ºå®ƒä»¬åœ¨ç»Ÿè®¡ä¸Šçš„åˆ†å¸ƒæ˜¯ç›¸åŒçš„ï¼Œå®ƒä»¬éƒ½ä¼ è¾¾äº†å®Œå…¨ç›¸åŒæ•°é‡çš„æœ‰ç”¨ä¿¡æ¯ã€‚
å…·ä½“æ¥è¯´ï¼Œå¦‚æœæˆ‘èƒ½åœ¨çœŸå®ä¸–ç•Œä¸­æå–ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆæˆ‘åœ¨æ—¶é—´æœºå™¨ç‰ˆæœ¬ä¸­ä¹Ÿèƒ½æå–æœ‰ç”¨çš„ä¿¡æ¯ï¼Œä½†æ˜¯ç”±äºæ—¶é—´æœºå™¨å®éªŒä¸­çš„ä¿¡æ¯é‡ä¸º0ï¼Œå› æ­¤ä¹Ÿå°±æ„å‘³ç€å³ä½¿æ˜¯åœ¨ç°å®ä¸–ç•Œï¼Œåè®®ä¹Ÿä¸ä¼šæ³„æ¼ä»»ä½•æœ‰ç”¨çš„ä¿¡æ¯ã€‚
å› æ­¤ï¼Œæˆ‘ä»¬çŸ¥é“è®¡ç®—æœºç§‘å­¦å®¶æ‹¥æœ‰æ—¶é—´æœºå™¨ã€‚&lt;/p>
&lt;h3 id="getting-rid-of-the-hats-and-time-machines">Getting rid of the hats (and time machines)
&lt;/h3>&lt;p>Of course we donâ€™t actually want to run a protocol with hats. And even Google (probably?) doesnâ€™t have a literal time machine.&lt;/p>
&lt;p>To tie things together, we first need to bring our protocol into the digital world. This requires that we construct the digital equivalent of a â€˜hatâ€™: something that both hides a digital value, while simultaneously â€˜bindingâ€™ (or â€˜committingâ€™) the maker to it, so she canâ€™t change her mind after the fact. è¿™é‡Œè¯´çš„å°±æ˜¯&lt;strong>binding&lt;/strong>æ€§è´¨ï¼Œæ­éœ²ä¹‹åå€¼å°±å›ºå®šä¸‹æ¥äº†ã€‚&lt;/p>
&lt;p>Fortunately we have a perfect tool for this application. Itâ€™s called &lt;strong>a digitalÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/Commitment_scheme" target="_blank" rel="noopener"
>commitment scheme&lt;/a>&lt;/strong>.Â A commitment scheme allows one party to â€˜commitâ€™ to a given message while keeping it secret, and then later â€˜openâ€™ the resulting commitment to reveal whatâ€™s inside. They can be built out of various ingredientsï¼ˆç»„æˆéƒ¨åˆ†ï¼‰, including (strong) cryptographic hash functions.******&lt;/p>
&lt;p>è¿™é‡Œç»™å‡ºäº†ä¸€ä¸ªæ•°å­— commitment schemeã€‚&lt;/p>
&lt;p>Given a commitment scheme, we now have all the ingredients we need to run the zero knowledge protocol electronically. The Prover first encodes its vertex colorings as a set of digital messages (for example, the numbers 0, 1, 2), then generates digital commitments to each one. These commitments get sent over to the Verifier. When the Verifier challenges on an edge, the Prover simply reveals the opening values for the commitments corresponding to the two vertices.&lt;/p>
&lt;p>å…¶å®å°±æ˜¯ç”¨æ•°å­—çš„commitmentæ¥ä»£æ›¿ä¹‹å‰ç‰©ç†ä¸Šçš„å¸½å­ã€‚&lt;/p>
&lt;p>So weâ€™ve managed to eliminate the hats. But how do we prove that this protocol is zero knowledge?&lt;/p>
&lt;p>Fortunately now that weâ€™re in the digital world, we no longer need a real time machine to prove things about this protocol. A key trick is to specify in our setting that the protocol is not going to be run between twoÂ &lt;em>people&lt;/em>, but rather between two differentÂ &lt;em>computer programs&lt;/em>Â (or, to be more formal, probabilisticÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/Probabilistic_Turing_machine" target="_blank" rel="noopener"
>Turing machines&lt;/a>.)&lt;/p>
&lt;p>What we can now prove is the following theorem: if you could ever come up with a computer program (for the Verifier) that extracts useful information after participating in a run of the protocol, then it would be possible to use a â€˜time machineâ€™ on that program in order to make it extract the same amount of useful information from a â€˜fakeâ€™ run of the protocol where the Prover doesnâ€™t put in any information to begin with.&lt;/p>
&lt;p>And since weâ€™re now talking aboutÂ &lt;em>computer programs&lt;/em>, it should be obvious that rewinding time isnâ€™t such an extraordinary feat at all. In fact, we rewind computer programs all the time. For example, consider usingÂ virtual machine software with a snapshot capability.&lt;/p>
&lt;p>&lt;img src="https://i0.wp.com/download.parallels.com/desktop/v4/docs/en/Parallels_Desktop_Users_Guide/snapshotmanager.gif"
loading="lazy"
alt="Example of rewinding through VM snapshots. An initial VM is played forward, rewound to aninitial snapshot, then execution is forked to a new path."
>&lt;/p>
&lt;p>Example of rewinding through VM snapshots. An initial VM is played forward, rewound to aninitial snapshot, then execution is forked to a new path.&lt;/p>
&lt;p>Even if you donâ€™t have fancy virtual machine software, any computer program can be â€˜rewoundâ€™ to an earlier state, simply by starting the program over again from the beginning and feeding it exactly the same inputs. Provided that the inputs â€” including all random numbers â€” are fixed, the program will always follow the same execution path. Thus you can rewind a program just by running it from the start and â€˜forkingâ€™ its execution when it reaches some desired point.&lt;/p>
&lt;p>Ultimately what we get is the following theorem. If there exists any Verifier computer program that successfully extracts information by interactively running this protocol with some Prover, then we can simply use the rewinding trick on that program to commit to a random solution, then â€˜trickâ€™ the Verifier by rewinding its execution whenever we canâ€™t answer its challenge correctly. The same logic holds as we gave above: if such a Verifier succeeds in extracting information after running the real protocol, then it should be able to extract theÂ &lt;em>same amount of information&lt;/em>Â from the simulated, rewinding-based protocol. But since thereâ€™s no information going into the simulated protocol, thereâ€™s no information to extract. Thus the information the Verifier can extract must always be zero.&lt;/p>
&lt;h3 id="ok-so-what-does-this-all-mean">Ok, so what does this all mean?
&lt;/h3>&lt;p>So letâ€™s recap. We know that the protocol is complete and sound, based on our analysis above. The soundness argument holds in any situation where we know that nobody is fiddlingï¼ˆæ— è¶³è½»é‡åœ°ï¼‰ with time â€” that is, the Verifier is running normally and nobody is rewinding its execution.&lt;/p>
&lt;p>At the same time, the protocol is also zero knowledge. To prove this, we showed that any Verifier program that succeeds in extracting information must also be able to extract information from a protocol run where rewinding is used andÂ &lt;em>no information is available in the first place.&lt;/em>Â Which leads to an obvious contradictionï¼ˆçŸ›ç›¾ï¼‰, and tells us that the protocol canâ€™t leak information in either situation.&lt;/p>
&lt;p>åŒæ—¶åè®®ä¹Ÿæ˜¯é›¶çŸ¥è¯†çš„ã€‚ä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å·²ç»å±•ç¤ºäº†ä»»ä½•èƒ½å¤ŸæˆåŠŸæå–ä¿¡æ¯çš„éªŒè¯ç¨‹åºä¹Ÿå¿…é¡»åœ¨ä½¿ç”¨äº†rewindingè¶…èƒ½åŠ›çš„åè®®ä¸­æˆåŠŸæå–ä¿¡æ¯ï¼Œä½†æ˜¯è¿™ä¸ªåè®®æ˜¯ä¸èƒ½è·å–åˆ°ä»»ä½•çŸ¥è¯†çš„ã€‚è¿™ä¹Ÿå°±å‘Šè¯‰äº†æˆ‘ä»¬åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹éƒ½æ²¡æœ‰æ³„æ¼çŸ¥è¯†ã€‚&lt;/p>
&lt;p>Thereâ€™s an important benefit to all this. Since itâ€™s trivial for anyone to â€˜fakeâ€™ a protocol transcript, even after Google proves to me that they have a solution, I canâ€™t re-play a recording of the protocol transcript to prove anything to anyone else (say, a judge). Thatâ€™s because the judge would have no guarantee that the video was recorded honestly, and that I didnâ€™t simplyÂ &lt;em>edit&lt;/em>Â in the same way Google might have done using the time machine. This means that protocol transcripts themselves contain no information. The protocol is only meaningful if I myself participated, and I can be sure that it happened in real time.&lt;/p>
&lt;p>æ¨¡æ‹Ÿçš„å’ŒçœŸå®çš„æ˜¯æ— æ³•åœ¨çœŸå®ä¸–ç•Œä¸­è¿›è¡ŒåŒºåˆ†çš„ï¼Œæ‰€ä»¥åªæœ‰å½“æˆ‘å‚ä¸è¿›å»çš„æ—¶å€™ï¼Œåè®®æ‰æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå¹¶ä¸”æˆ‘èƒ½ç¡®ä¿å®åœ¨çœŸå®æ—¶é—´ä¸­å‘ç”Ÿçš„ã€‚&lt;/p>
&lt;h3 id="proofs-for-all-of-np">&lt;strong>Proofs for all of NP!&lt;/strong>
&lt;/h3>&lt;p>If youâ€™ve made it this far, Iâ€™m pretty sure youâ€™re ready for the big news. Which is that 3-coloring cellphone networks isnâ€™t all that interesting of a problem â€” at least, not in and of itself.&lt;/p>
&lt;p>The really interesting thing about the 3-coloring problem is that itâ€™s in the classÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/NP-complete" target="_blank" rel="noopener"
>NP-complete&lt;/a>. To put this informally, the wonderful thing about such problems is thatÂ &lt;em>any other problem in the classÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/NP_%28complexity%29" target="_blank" rel="noopener"
>NP&lt;/a>&lt;/em>Â can be translated into an instance of that problem.In a single stroke, this result â€”Â &lt;a class="link" href="http://people.csail.mit.edu/silvio/Selected%20Scientific%20Papers/Zero%20Knowledge/Proofs_That_Yield_Nothing_But_Their_Validity_or_All_Languages_in_NP_Have_Zero-Knowledge_Proof_Systems.pdf" target="_blank" rel="noopener"
>due toÂ Goldreich&lt;/a>, Micali and WigdersonÂ â€” proves that â€˜efficientâ€™ ZK proofs exists for a vast class of useful statements, many of which areÂ &lt;em>way more&lt;/em>Â interesting than assigning frequencies to cellular networks. You simply find a statement (in NP) that you wish to prove, such as our hash function example from above, then translate it into an instance of the 3-coloring problem. At that point you simply run the digital version of the hat protocol.&lt;/p>
&lt;p>ä¸‰æ¶‚è‰²é—®é¢˜æ˜¯NPCé—®é¢˜ï¼Œé‚£ä¹ˆå¯¹äºä¸€ä¸ªæƒ³è¦è¯æ˜çš„NPé—®é¢˜ï¼Œéƒ½å¯ä»¥å½’çº¦åˆ°è¿™ä¸ªNPCé—®é¢˜ï¼Œç„¶åè½¬åŒ–æˆä¸‰æ¶‚è‰²é—®é¢˜ï¼Œç”¨ä¸Šé¢çš„æ•°å­—åè®®è¿›è¡Œè¿è¡Œå°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;h3 id="in-summary-and-next-time">&lt;strong>In summary, and next time&lt;/strong>
&lt;/h3>&lt;p>Of course, actually running this protocol for interesting statements would be an insanelyï¼ˆç–¯ç‹‚åœ°ï¼‰ silly thing for anyone to do, since the cost of doing so would include the total size of the original statement and witness, plus the reduction cost to convert it into a graph, plus theÂ &lt;em>$E^2$&lt;/em>Â protocol rounds youâ€™d have to conduct in order to convince someone that the proof is valid. Theoretically this is â€˜efficientâ€™, since the total cost of the proof would be polynomial in the input size, but in practice it would be anything but.&lt;/p>
&lt;p>ç†è®ºä¸Šä¸Šé¢çš„ä¸‰è‰²é—®é¢˜çš„é›¶çŸ¥è¯†è¯æ˜åè®®æ˜¯â€œefficentâ€ï¼Œä½†æ˜¯ä¸å®ç”¨ã€‚&lt;/p>
&lt;p>So what weâ€™ve shown so far is that such proofs areÂ &lt;em>possible&lt;/em>. It remains for us to actually find proofs that are practical enough for real-world use.&lt;/p>
&lt;p>In theÂ &lt;a class="link" href="https://blog.cryptographyengineering.com/2017/01/21/zero-knowledge-proofs-an-illustrated-primer-part-2/" target="_blank" rel="noopener"
>next post&lt;/a>Â Iâ€™ll talk about some of those â€” specifically, theÂ &lt;em>efficient&lt;/em>Â proofs that we use for various useful statements. Iâ€™ll give some examples (from real applications) where these things have been used. Also at reader request: Iâ€™ll also talk about why I dislikeÂ &lt;a class="link" href="http://en.wikipedia.org/wiki/Secure_Remote_Password_protocol" target="_blank" rel="noopener"
>SRP&lt;/a>Â so much.&lt;/p>
&lt;p>&lt;a class="link" href="https://blog.cryptographyengineering.com/2017/01/21/zero-knowledge-proofs-an-illustrated-primer-part-2/" target="_blank" rel="noopener"
>SeeÂ here&lt;/a>Â for Part 2.&lt;/p>
&lt;p>&lt;em>Notes:&lt;/em>&lt;/p>
&lt;ul>
&lt;li>Formally, the goal of an interactive proof is to convince the Verifier that a particular string belongs to some language. Typically the Prover is very powerful (unbounded), but the Verifier is limited in computation.&lt;/li>
&lt;li>&lt;code>*&lt;/code> This example is based on the original solution of Goldwasser, Micali and Rackoff, and the teaching example using hats is based on an explanation by Silvio Micali. I take credit only for the silly mistakes.&lt;/li>
&lt;li>***** A simple example of a commitment can be built using a hash function. To commit to the value â€œxâ€ simply generate some (suitably long) string of random numbers, which weâ€™ll call â€˜saltâ€™, and output the commitmentÂ &lt;em>C = Hash(salt || x)&lt;/em>. To open the commitment, you simply reveal â€˜xâ€™ and â€˜saltâ€™. Anyone can check that the original commitment is valid by recomputing the hash. This is secure under some (moderately strong) assumptions about the function itself.&lt;/li>
&lt;/ul></description></item><item><title>Rustå¼‚æ­¥Webæ¡†æ¶</title><link>https://wenjin1997.github.io/2022/08/23/rust-web/</link><pubDate>Tue, 23 Aug 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/08/23/rust-web/</guid><description>&lt;h2 id="å¼‚æ­¥webæ¡†æ¶ç”Ÿæ€">å¼‚æ­¥Webæ¡†æ¶ç”Ÿæ€
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/SergioBenitez/Rocket" target="_blank" rel="noopener"
>Rocket&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/http-rs/tide" target="_blank" rel="noopener"
>tide&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/seanmonstar/warp" target="_blank" rel="noopener"
>warp&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/carllerche/tower-web" target="_blank" rel="noopener"
>tower-web&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/thruster-rs/Thruster" target="_blank" rel="noopener"
>Thruster&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/gotham-rs/gotham" target="_blank" rel="noopener"
>gotham&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/actix/actix-web" target="_blank" rel="noopener"
>actix-web&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/ntex-rs/ntex" target="_blank" rel="noopener"
>ntex&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/tokio-rs/axum" target="_blank" rel="noopener"
>axum&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="rocketæ¡†æ¶">Rocketæ¡†æ¶
&lt;/h2>&lt;p>å®˜æ–¹æ•™ç¨‹ï¼š&lt;a class="link" href="https://rocket.rs/v0.5-rc/guide/" target="_blank" rel="noopener"
>The Rocket Programming Guide&lt;/a>&lt;/p>
&lt;p>Rocketè®¾è®¡æ ¸å¿ƒå“²å­¦ï¼š&lt;/p>
&lt;ul>
&lt;li>Security, correctness, and developer experience are paramount.&lt;/li>
&lt;li>All request handling information should be typed and self-contained.&lt;/li>
&lt;li>Decisions should not be forced.&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Lifecycle&lt;/strong>&lt;/p>
&lt;p>Rocket&amp;rsquo;s main task is to listen for incoming web requests, dispatch the request to the application code, and return a response to the client. We call the process that goes from request to response the &amp;ldquo;lifecycle&amp;rdquo;. We summarize the lifecycle as the following sequence of steps:&lt;/p>
&lt;ol>
&lt;li>Routing è·¯ç”±&lt;/li>
&lt;li>Validation éªŒè¯&lt;/li>
&lt;li>Processing å¤„ç†&lt;/li>
&lt;li>Response å›å¤&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[get(&lt;/span>&lt;span class="s">&amp;#34;/world&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// &amp;lt;- route attribute
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">world&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span> &lt;span class="kt">str&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// &amp;lt;- request handler
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;hello, world!&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Lanuching&lt;/strong>&lt;/p>
&lt;p>Rocket begins serving requests after being launched, which starts a multi-threaded asynchronous server and dispatches requests to matching routes as they arrive.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[macro_use]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">extern&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rocket&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[get(&lt;/span>&lt;span class="s">&amp;#34;/world&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">world&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span> &lt;span class="kt">str&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Hello, world!&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[launch]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">rocket&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">_&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">rocket&lt;/span>::&lt;span class="n">build&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">mount&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/hello&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">routes!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">world&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Dynamic Paths&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[get(&lt;/span>&lt;span class="s">&amp;#34;/hello/&amp;lt;name&amp;gt;&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">hello&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">String&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Hello, &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">!&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Forwarding&lt;/strong>&lt;/p>
&lt;p>Routes are attempted in increasing rank order. Rocket chooses a default ranking from -12 to -1, detailed in the next section, but a route&amp;rsquo;s rank can also be manually set with the rank attribute. To illustrate, consider the following routes:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[get(&lt;/span>&lt;span class="s">&amp;#34;/user/&amp;lt;id&amp;gt;&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">user&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>: &lt;span class="kt">usize&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cm">/* ... */&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[get(&lt;/span>&lt;span class="s">&amp;#34;/user/&amp;lt;id&amp;gt;&amp;#34;&lt;/span>&lt;span class="cp">, rank = 2)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">user_int&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>: &lt;span class="kt">isize&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cm">/* ... */&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[get(&lt;/span>&lt;span class="s">&amp;#34;/user/&amp;lt;id&amp;gt;&amp;#34;&lt;/span>&lt;span class="cp">, rank = 3)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">user_str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cm">/* ... */&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[launch]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">rocket&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">_&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">rocket&lt;/span>::&lt;span class="n">build&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">mount&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">routes!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">user_int&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">user_str&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="actix-web">actix-web
&lt;/h2>&lt;p>å®˜æ–¹æ–‡æ¡£ï¼š&lt;a class="link" href="https://docs.rs/actix-web/4.1.0/actix_web/" target="_blank" rel="noopener"
>actix_web&lt;/a>&lt;/p>
&lt;p>å¯ä»¥é€šè¿‡å®æ¥åˆ›å»ºæå–å™¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">actix_web&lt;/span>::&lt;span class="p">{&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">web&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">App&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HttpServer&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Responder&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[get(&lt;/span>&lt;span class="s">&amp;#34;/hello/{name}&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">async&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">greet&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>: &lt;span class="nc">web&lt;/span>::&lt;span class="n">Path&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Responder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Hello &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">!&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[actix_web::main]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// or #[tokio::main]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">async&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">std&lt;/span>::&lt;span class="n">io&lt;/span>::&lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">HttpServer&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">App&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">greet&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">bind&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="s">&amp;#34;127.0.0.1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">8080&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">await&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å…¶ä»–&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/LemmyNet/lemmy" target="_blank" rel="noopener"
>Lemmyè®ºå›&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/actix/actix-extras" target="_blank" rel="noopener"
>actix-extras&lt;/a>ï¼šactixä¸­é—´ä»¶&lt;/li>
&lt;/ul>
&lt;p>actix-webåº•å±‚åŸºäº&lt;a class="link" href="https://github.com/actix/actix-net" target="_blank" rel="noopener"
>actix-net&lt;/a>ä¸­é—´åº“ï¼Œå°è£…äº†å’Œç½‘ç»œç›¸å…³çš„ä¸œè¥¿ã€‚&lt;/p>
&lt;p>åœ¨actix-net/actix-rt/src/arbiter.rsä¸‹æ¯ä¸ªarbiterå¯¹åº”ä¸€ä¸ªçº¿ç¨‹ã€‚&lt;/p>
&lt;h2 id="gotham">gotham
&lt;/h2>&lt;p>æ¯”è¾ƒæ—©çš„æ¡†æ¶ï¼ŒåŸºäºtokioå®ç°ã€‚&lt;/p>
&lt;h2 id="thruster">Thruster
&lt;/h2>&lt;p>æ„å»ºäºhyperä¹‹ä¸Šï¼Œè¿™ä¸ªä¸­é—´ä»¶åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­è®¾ç½®ä¸Šä¸‹æ–‡ã€‚&lt;/p>
&lt;h2 id="tower">tower
&lt;/h2>&lt;p>æ–‡æ¡£ï¼š &lt;a class="link" href="https://docs.rs/tower/0.4.13/tower/" target="_blank" rel="noopener"
>tower&lt;/a>&lt;/p>
&lt;p>Tower is a library of modular and reusable components for building robust networking clients and servers.&lt;/p>
&lt;h2 id="hyper">hyper
&lt;/h2>&lt;p>å®˜æ–¹æ–‡æ¡£ï¼š&lt;a class="link" href="https://docs.rs/hyper/0.14.20/hyper/" target="_blank" rel="noopener"
>hyper&lt;/a>&lt;/p>
&lt;p>å…³äºè·¯ç”±ç”¨åˆ°&lt;a class="link" href="https://github.com/http-rs/route-recognizer" target="_blank" rel="noopener"
>route-recognizer&lt;/a>ï¼Œå®ƒçš„åº•å±‚æ˜¯&lt;a class="link" href="https://zh.m.wikipedia.org/zh-hans/%E9%9D%9E%E7%A1%AE%E5%AE%9A%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E8%87%AA%E5%8A%A8%E6%9C%BA" target="_blank" rel="noopener"
>éç¡®å®šæœ‰é™çŠ¶æ€è‡ªåŠ¨æœº&lt;/a>ã€‚&lt;/p>
&lt;h2 id="warp">warp
&lt;/h2>&lt;p>githubä»“åº“åœ°å€ï¼š&lt;a class="link" href="https://github.com/seanmonstar/warp" target="_blank" rel="noopener"
>warp&lt;/a>ã€‚&lt;/p>
&lt;p>filterçš„å·¥ä½œæœºåˆ¶ï¼ŒåŸºäºhyperã€‚&lt;a class="link" href="https://github.com/steadylearner/Rust-Warp-Example" target="_blank" rel="noopener"
>Rust-Warp-Example&lt;/a>æ˜¯ä¸€ä¸ªåº”ç”¨å®ä¾‹ã€‚&lt;/p>
&lt;h2 id="ä¸€äº›åº•å±‚çš„åº“">ä¸€äº›åº•å±‚çš„åº“
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://docs.rs/http/0.2.8/http/" target="_blank" rel="noopener"
>http&lt;/a>ï¼šè§£æå¤„ç†HTTPåè®®ï¼Œå¯¹httpè¯·æ±‚å’Œå“åº”åšäº†ä¸€ä¸ªç±»å‹æŠ½è±¡ã€‚&lt;/li>
&lt;li>&lt;a class="link" href="https://docs.rs/http-body/0.4.5/http_body/" target="_blank" rel="noopener"
>http-body&lt;/a>ï¼šåšå¼‚æ­¥httpè¯·æ±‚å’Œå“åº”ã€‚&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/http-rs/http-types" target="_blank" rel="noopener"
>http-types&lt;/a>ï¼šåŸºäºasync-stdã€‚&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/tower-rs/tower-http" target="_blank" rel="noopener"
>tower-http&lt;/a>ï¼šåŸºäºtowerã€httpã€http-bodyã€çš„ä¸­é—´ä»¶ã€‚&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/hyperium/hyper" target="_blank" rel="noopener"
>hyper&lt;/a>ï¼šHTTPçš„å®ç°ï¼Œæ²¡æœ‰æ•´åˆtower-httpã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="rustå¼‚æ­¥webæ¡†æ¶">Rustå¼‚æ­¥Webæ¡†æ¶
&lt;/h2>&lt;p>ç»“æ„ï¼š&lt;/p>
&lt;ul>
&lt;li>æ¡†æ¶æ¥å£è®¾è®¡&lt;/li>
&lt;li>è·¯ç”±ç»“æ„å®ç°&lt;/li>
&lt;li>å®ç°Handler&lt;/li>
&lt;li>æ·»åŠ tracingæ‰“å°æ—¥å¿—&lt;/li>
&lt;li>å®ç°æå–å™¨&lt;/li>
&lt;li>å®ç°ä¸­é—´ä»¶&lt;/li>
&lt;li>é”™è¯¯å¤„ç†&lt;/li>
&lt;/ul>
&lt;h2 id="è¡¥å……å­¦ä¹ ">è¡¥å……å­¦ä¹ 
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://www.runoob.com/regexp/regexp-tutorial.html" target="_blank" rel="noopener"
>æ­£åˆ™è¡¨è¾¾å¼&lt;/a>&lt;/li>
&lt;li>Cow&lt;/li>
&lt;li>and_thenã€and&lt;/li>
&lt;li>dyn&lt;/li>
&lt;li>pinã€unpin&lt;/li>
&lt;li>Oneshot&lt;/li>
&lt;li>pin_project!&lt;/li>
&lt;li>ç½‘ç»œä¸­çš„è¯·æ±‚æ–¹æ³•æœ‰å“ªäº›ï¼ŸåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/li>
&lt;li>&lt;a class="link" href="https://doc.rust-lang.org/core/any/index.html" target="_blank" rel="noopener"
>Any&lt;/a>&lt;/li>
&lt;li>ç»ˆç«¯å‘½ä»¤ curlï¼Œå‚è€ƒ&lt;a class="link" href="https://www.cnblogs.com/duhuo/p/5695256.html" target="_blank" rel="noopener"
>Linux curlå‘½ä»¤è¯¦è§£&lt;/a>&lt;/li>
&lt;li>DSLæ˜¯ä»€ä¹ˆï¼Ÿå‚è€ƒ&lt;a class="link" href="https://draveness.me/dsl/" target="_blank" rel="noopener"
>è°ˆè°ˆ DSL ä»¥åŠ DSL çš„åº”ç”¨ï¼ˆä»¥ CocoaPods ä¸ºä¾‹ï¼‰&lt;/a>&lt;/li>
&lt;li>uri&lt;/li>
&lt;li>async_trait&lt;/li>
&lt;li>mapã€map_err&lt;/li>
&lt;li>&lt;code>curl http://... -I -HEAD&lt;/code>&lt;/li>
&lt;li>tower&lt;/li>
&lt;li>é˜…è¯»axumæºç &lt;/li>
&lt;li>kv-serve å’Œ web å¦‚ä½•è¿æ¥åœ¨ä¸€èµ·ï¼Ÿ&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-08-23-rust-web/rust-web-%e8%af%be%e7%a8%8b%e5%9b%9e%e9%a1%be.png"
loading="lazy"
alt="è¯¾ç¨‹å›é¡¾"
>&lt;/p>
&lt;h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™
&lt;/h2>&lt;p>&lt;a class="link" href="https://time.geekbang.org/course/intro/348" target="_blank" rel="noopener"
>å¼ æ±‰ä¸œçš„Rustå®æˆ˜è¯¾&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/ZhangHanDong/inviting-rust" target="_blank" rel="noopener"
>å¼ æ±‰ä¸œçš„Rustå®æˆ˜è¯¾è§†é¢‘è¯¾ç¨‹ä»£ç ç¤ºä¾‹&lt;/a>&lt;/p></description></item><item><title>Macç”¨sshè¿œç¨‹è¿æ¥æœåŠ¡å™¨</title><link>https://wenjin1997.github.io/2022/08/01/Linux-ssh/</link><pubDate>Mon, 01 Aug 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/08/01/Linux-ssh/</guid><description>&lt;p>åœ¨macæœ¬åœ°æ‰“å¼€ç»ˆç«¯ï¼Œåˆ›å»ºå¯†é’¥å¯¹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ssh-keygen -t rsa -C &lt;span class="s1">&amp;#39;your email@domain.com&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>-t æŒ‡å®šå¯†é’¥ç±»å‹ï¼Œé»˜è®¤å³ rsa ï¼Œå¯ä»¥çœç•¥
-C è®¾ç½®æ³¨é‡Šæ–‡å­—ï¼Œæ¯”å¦‚ä½ çš„é‚®ç®±ï¼Œå¯ä»¥çœç•¥&lt;/p>
&lt;p>æ¥ç€å°±æŒ‰å›è½¦ï¼Œå¦‚æœå‘ç°ä¹‹å‰çš„ id_rsa æ–‡ä»¶éœ€è¦è¦†ç›–ï¼Œåˆ™å¯ä»¥å¦å¤–åˆ›å»ºæ–‡ä»¶å­˜å‚¨å¯†é’¥ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">Enter file in which to save the key &lt;span class="o">(&lt;/span>/Users/zheng/.ssh/id_rsa&lt;span class="o">)&lt;/span>: linux_id_rsa
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¥ç€åœ¨ç”¨æˆ·æ–‡ä»¶å¤¹ä¸‹èƒ½æ‰¾åˆ° linux_id_rsa å’Œ linux_id_rsa.pub è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå°†å®ƒä»¬å¤åˆ¶åˆ° /.ssh ç›®å½•ä¸‹ã€‚&lt;/p>
&lt;p>ä¸‹é¢å°†ç”Ÿæˆçš„å…¬é’¥å¤åˆ¶åˆ°æœåŠ¡å™¨ï¼Œå°±æ˜¯å°†macæœ¬åœ°çš„ linux_id_rsa.pub ä¸­çš„å†…å®¹å¤åˆ¶åˆ°æœåŠ¡å™¨ä¸Š ~/.ssh/authorized_keys æ–‡ä»¶ä¸­ã€‚æˆ‘è¿™é‡Œæ²¡æœ‰ç”¨å‘½ä»¤ï¼Œç›´æ¥ç”¨é¢æ¿å¤åˆ¶è¿‡å»ï¼Œä¹Ÿå¯ä»¥ç”¨ scp å‘½ä»¤ã€‚&lt;/p>
&lt;p>æ¥ç€é…ç½®æœ¬åœ°&lt;code>~/.ssh/config&lt;/code> æ–‡ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ˜¯ linux_id_rsa æ–‡ä»¶ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">Host &lt;span class="nb">alias&lt;/span> &lt;span class="c1">#è‡ªå®šä¹‰åˆ«å&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">HostName hostname &lt;span class="c1">#æ›¿æ¢ä¸ºä½ çš„sshæœåŠ¡å™¨ipæˆ–domain&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Port port &lt;span class="c1">#sshæœåŠ¡å™¨ç«¯å£ï¼Œé»˜è®¤ä¸º22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">User user &lt;span class="c1">#sshæœåŠ¡å™¨ç”¨æˆ·å&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IdentityFile ~/.ssh/linux_id_rsa &lt;span class="c1">#ç¬¬ä¸€ä¸ªæ­¥éª¤ç”Ÿæˆçš„å…¬é’¥æ–‡ä»¶å¯¹åº”çš„ç§é’¥æ–‡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æœ¬æ¥ç™»å½•å‘½ä»¤æ˜¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ssh -p &amp;lt;ç«¯å£å·&amp;gt; &amp;lt;ç”¨æˆ·å&amp;gt;@&amp;lt;ipåœ°å€&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç°åœ¨ç›´æ¥ç”¨åˆ«åå°±å¯ä»¥ç™»å½•äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ssh &lt;span class="nb">alias&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="jianshu.com/p/7990ca55da69" >Macä½¿ç”¨sshå¯†é’¥ç™»å½•Linux&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.runoob.com/w3cnote/set-ssh-login-key.html" target="_blank" rel="noopener"
>è®¾ç½® SSH é€šè¿‡å¯†é’¥ç™»å½•&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://blog.csdn.net/zheng911209/article/details/49909113" target="_blank" rel="noopener"
>githubç”Ÿæˆå¤šä¸ªssh keyï¼Œå¦‚ä½•è§£å†³&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Rustå¼€å‘è€…å¤§ä¼š</title><link>https://wenjin1997.github.io/2022/07/31/RustChinaConf/</link><pubDate>Thu, 07 Jul 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/07/31/RustChinaConf/</guid><description>&lt;h2 id="rustdocä½ å¯ä»¥ç”¨å®ƒåšä»€ä¹ˆä»¥åŠå®ƒçš„æœªæ¥">Rustdocï¼šä½ å¯ä»¥ç”¨å®ƒåšä»€ä¹ˆï¼Œä»¥åŠå®ƒçš„æœªæ¥
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731091034869.png"
loading="lazy"
alt="image-20220731091034869"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731091100532.png"
loading="lazy"
alt="image-20220731091100532"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731091430701.png"
loading="lazy"
alt="image-20220731091430701"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731091521094.png"
loading="lazy"
alt="image-20220731091521094"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731091806721.png"
loading="lazy"
alt="image-20220731091806721"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731092315229.png"
loading="lazy"
alt="image-20220731092315229"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731092426371.png"
loading="lazy"
alt="image-20220731092426371"
>&lt;/p>
&lt;h2 id="rust-è®¡ç®—åŠ é€ŸæŠ€æœ¯è§£è¯»åŠé«˜æ€§èƒ½ä»£ç é‡æ„å®è·µ">Rust è®¡ç®—åŠ é€ŸæŠ€æœ¯è§£è¯»åŠé«˜æ€§èƒ½ä»£ç é‡æ„å®è·µ
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731092727921.png"
loading="lazy"
alt="image-20220731092727921"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731092828681.png"
loading="lazy"
alt="image-20220731092828681"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731092919521.png"
loading="lazy"
alt="image-20220731092919521"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731093235281.png"
loading="lazy"
alt="image-20220731093235281"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731093347151.png"
loading="lazy"
alt="image-20220731093347151"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731093727975.png"
loading="lazy"
alt="image-20220731093727975"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731093919749.png"
loading="lazy"
alt="image-20220731093919749"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731094105340.png"
loading="lazy"
alt="image-20220731094105340"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731094239849.png"
loading="lazy"
alt="image-20220731094239849"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731094313221.png"
loading="lazy"
alt="image-20220731094313221"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731094448917.png"
loading="lazy"
alt="image-20220731094448917"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731094545016.png"
loading="lazy"
alt="image-20220731094545016"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731094703530.png"
loading="lazy"
alt="image-20220731094703530"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731094746130.png"
loading="lazy"
alt="image-20220731094746130"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731094931102.png"
loading="lazy"
alt="image-20220731094931102"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731095105687.png"
loading="lazy"
alt="image-20220731095105687"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731095140335.png"
loading="lazy"
alt="image-20220731095140335"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731095222117.png"
loading="lazy"
alt="image-20220731095222117"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731095251258.png"
loading="lazy"
alt="image-20220731095251258"
>&lt;/p>
&lt;h2 id="ä»é›¶å¼€å§‹å®ç°rust-fuzzerä»é›¶å¼€å§‹å®ç°rust-fuzzer">ä»é›¶å¼€å§‹å®ç°Rust Fuzzerä»é›¶å¼€å§‹å®ç°Rust Fuzzer
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731100802290.png"
loading="lazy"
alt="image-20220731100802290"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731100858793.png"
loading="lazy"
alt="image-20220731100858793"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731101052964.png"
loading="lazy"
alt="image-20220731101052964"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731101108684.png"
loading="lazy"
alt="image-20220731101108684"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731101152673.png"
loading="lazy"
alt="image-20220731101152673"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731101301531.png"
loading="lazy"
alt="image-20220731101301531"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731101348078.png"
loading="lazy"
alt="image-20220731101348078"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731101412070.png"
loading="lazy"
alt="image-20220731101412070"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731101503214.png"
loading="lazy"
alt="image-20220731101503214"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731101611315.png"
loading="lazy"
alt="image-20220731101611315"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731101617693.png"
loading="lazy"
alt="image-20220731101617693"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731101701919.png"
loading="lazy"
alt="image-20220731101701919"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731101832442.png"
loading="lazy"
alt="image-20220731101832442"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731101947189.png"
loading="lazy"
alt="image-20220731101947189"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731102015235.png"
loading="lazy"
alt="image-20220731102015235"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731102154008.png"
loading="lazy"
alt="image-20220731102154008"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731102242684.png"
loading="lazy"
alt="image-20220731102242684"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731102412549.png"
loading="lazy"
alt="image-20220731102412549"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731102520682.png"
loading="lazy"
alt="image-20220731102520682"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731102534607.png"
loading="lazy"
alt="image-20220731102534607"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731102659728.png"
loading="lazy"
alt="image-20220731102659728"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731102742775.png"
loading="lazy"
alt="image-20220731102742775"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731102830755.png"
loading="lazy"
alt="image-20220731102830755"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731102935124.png"
loading="lazy"
alt="image-20220731102935124"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731103055445.png"
loading="lazy"
alt="image-20220731103055445"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731103229032.png"
loading="lazy"
alt="image-20220731103229032"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731103346454.png"
loading="lazy"
alt="image-20220731103346454"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731103442336.png"
loading="lazy"
alt="image-20220731103442336"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731103531626.png"
loading="lazy"
alt="image-20220731103531626"
>&lt;/p>
&lt;h2 id="å¤æ‚-rust-å¼€æºé¡¹ç›®çš„ç»´æŠ¤">å¤æ‚ Rust å¼€æºé¡¹ç›®çš„ç»´æŠ¤
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731104633768.png"
loading="lazy"
alt="image-20220731104633768"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731104634881.png"
loading="lazy"
alt="image-20220731104634881"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731104726335.png"
loading="lazy"
alt="image-20220731104726335"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731104815249.png"
loading="lazy"
alt="image-20220731104815249"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731105001044.png"
loading="lazy"
alt="image-20220731105001044"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731105111235.png"
loading="lazy"
alt="image-20220731105111235"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731105300603.png"
loading="lazy"
alt="image-20220731105300603"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731105310077.png"
loading="lazy"
alt="image-20220731105310077"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731105448472.png"
loading="lazy"
alt="image-20220731105448472"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731105651909.png"
loading="lazy"
alt="image-20220731105651909"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731105700999.png"
loading="lazy"
alt="image-20220731105700999"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731105926107.png"
loading="lazy"
alt="image-20220731105926107"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731110059295.png"
loading="lazy"
alt="image-20220731110059295"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731110335455.png"
loading="lazy"
alt="image-20220731110335455"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731110351448.png"
loading="lazy"
alt="image-20220731110351448"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731110647351.png"
loading="lazy"
alt="image-20220731110647351"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731111109249.png"
loading="lazy"
alt="image-20220731111109249"
>&lt;/p>
&lt;h2 id="åŸºäºllvm-rustä»£ç æ··æ·†è®¾è®¡ä¸å®ç°">åŸºäºLLVM Rustä»£ç æ··æ·†è®¾è®¡ä¸å®ç°
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731133449859.png"
loading="lazy"
alt="image-20220731133449859"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731133506773.png"
loading="lazy"
alt="image-20220731133506773"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731133511610.png"
loading="lazy"
alt="image-20220731133511610"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731133624267.png"
loading="lazy"
alt="image-20220731133624267"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731133631447.png"
loading="lazy"
alt="image-20220731133631447"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731133815789.png"
loading="lazy"
alt="image-20220731133815789"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731133926858.png"
loading="lazy"
alt="image-20220731133926858"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731134118235.png"
loading="lazy"
alt="image-20220731134118235"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731134229393.png"
loading="lazy"
alt="image-20220731134229393"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731134331178.png"
loading="lazy"
alt="image-20220731134331178"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731134507784.png"
loading="lazy"
alt="image-20220731134507784"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731134636190.png"
loading="lazy"
alt="image-20220731134636190"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731134802636.png"
loading="lazy"
alt="image-20220731134802636"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731134859722.png"
loading="lazy"
alt="image-20220731134859722"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731134950706.png"
loading="lazy"
alt="image-20220731134950706"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731135028573.png"
loading="lazy"
alt="image-20220731135028573"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731135035939.png"
loading="lazy"
alt="image-20220731135035939"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731135055839.png"
loading="lazy"
alt="image-20220731135055839"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731135204104.png"
loading="lazy"
alt="image-20220731135204104"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731135310076.png"
loading="lazy"
alt="image-20220731135310076"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731135429533.png"
loading="lazy"
alt="image-20220731135429533"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731135625688.png"
loading="lazy"
alt="image-20220731135625688"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731135754991.png"
loading="lazy"
alt="image-20220731135754991"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731135935667.png"
loading="lazy"
alt="image-20220731135935667"
>&lt;/p>
&lt;h2 id="rust-apiå¯é æ€§åˆ†æä¸éªŒè¯">Rust APIå¯é æ€§åˆ†æä¸éªŒè¯
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731141110280.png"
loading="lazy"
alt="image-20220731141110280"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731141115692.png"
loading="lazy"
alt="image-20220731141115692"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731141146654.png"
loading="lazy"
alt="image-20220731141146654"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731141311818.png"
loading="lazy"
alt="image-20220731141311818"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731141629634.png"
loading="lazy"
alt="image-20220731141629634"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731141805536.png"
loading="lazy"
alt="image-20220731141805536"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731142027074.png"
loading="lazy"
alt="image-20220731142027074"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731142431576.png"
loading="lazy"
alt="image-20220731142431576"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731142717062.png"
loading="lazy"
alt="image-20220731142717062"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731142833826.png"
loading="lazy"
alt="image-20220731142833826"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731143319843.png"
loading="lazy"
alt="image-20220731143319843"
>&lt;/p>
&lt;h2 id="ä½ ä¸ºä»€ä¹ˆéœ€è¦rust-ç¼–ç è§„èŒƒ">ä½ ä¸ºä»€ä¹ˆéœ€è¦ã€ŒRust ç¼–ç è§„èŒƒã€
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731144558561.png"
loading="lazy"
alt="image-20220731144558561"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731144606305.png"
loading="lazy"
alt="image-20220731144606305"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731144647528.png"
loading="lazy"
alt="image-20220731144647528"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731144708296.png"
loading="lazy"
alt="image-20220731144708296"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731144742623.png"
loading="lazy"
alt="image-20220731144742623"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731144749990.png"
loading="lazy"
alt="image-20220731144749990"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731144842637.png"
loading="lazy"
alt="image-20220731144842637"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731144919996.png"
loading="lazy"
alt="image-20220731144919996"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731145011907.png"
loading="lazy"
alt="image-20220731145011907"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731145044742.png"
loading="lazy"
alt="image-20220731145044742"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731145120801.png"
loading="lazy"
alt="image-20220731145120801"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731145128175.png"
loading="lazy"
alt="image-20220731145128175"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731145148510.png"
loading="lazy"
alt="image-20220731145148510"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731145233867.png"
loading="lazy"
alt="image-20220731145233867"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731145257898.png"
loading="lazy"
alt="image-20220731145257898"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731145324467.png"
loading="lazy"
alt="image-20220731145324467"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-31-RustChinaConf/image-20220731145552860.png"
loading="lazy"
alt="image-20220731145552860"
>&lt;/p></description></item><item><title>Rustå¼‚æ­¥ç¼–ç¨‹</title><link>https://wenjin1997.github.io/2022/07/07/Rust-async/</link><pubDate>Thu, 07 Jul 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/07/07/Rust-async/</guid><description>&lt;p>æœ¬ç« è‡³ä¸‹è€Œä¸Šçš„æ–¹å¼æ¥å¸¦é¢†å¤§å®¶ç†è§£å¼‚æ­¥ç¼–ç¨‹:&lt;/p>
&lt;ol>
&lt;li>å¼‚æ­¥ I/O æ¨¡å‹&lt;/li>
&lt;li>å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼š
&lt;ul>
&lt;li>äº‹ä»¶é©±åŠ¨æ¨¡å‹&lt;/li>
&lt;li>Futures&lt;/li>
&lt;li>ç”Ÿæˆå™¨ ä¸ Pin&lt;/li>
&lt;li>async/await&lt;/li>
&lt;li>å¼‚æ­¥è¿è¡Œæ—¶ä»‹ç»ï¼šasync-stdã€tokioã€bastionã€smol&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="å¼‚æ­¥ioæ¨¡å‹">å¼‚æ­¥IOæ¨¡å‹
&lt;/h2>&lt;h3 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ
&lt;/h3>&lt;ul>
&lt;li>åŒæ­¥å’Œå¼‚æ­¥ï¼Œå…³æ³¨çš„æ˜¯æ¶ˆæ¯é€šä¿¡æœºåˆ¶ã€‚ï¼ˆè°ƒç”¨è€…è§†è§’ï¼‰ç»“åˆçƒ§å¼€æ°´çš„ä¾‹å­ã€‚
&lt;ul>
&lt;li>åŒæ­¥ï¼Œå‘å‡ºä¸€ä¸ªè°ƒç”¨ï¼Œåœ¨æ²¡æœ‰å¾—åˆ°ç»“æœä¹‹å‰ä¸è¿”å›ã€‚æ°´æ²¡çƒ§å¥½ä¸ç¦»å¼€ã€‚&lt;/li>
&lt;li>å¼‚æ­¥ï¼Œå‘å‡ºä¸€ä¸ªè°ƒç”¨ï¼Œåœ¨æ²¡æœ‰å¾—åˆ°ç»“æœä¹‹å‰è¿”å›ã€‚æ°´æ²¡çƒ§å¥½æ—¶ï¼Œå¯ä»¥å…ˆå»å¹²åˆ«çš„ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>é˜»å¡å’Œéé˜»å¡ï¼Œå…³æ³¨çš„æ˜¯ç¨‹åºç­‰å¾…è°ƒç”¨ç»“æœçš„çŠ¶æ€ã€‚ï¼ˆè¢«è°ƒç”¨è€…è§†è§’ï¼‰
&lt;ul>
&lt;li>é˜»å¡ï¼Œåœ¨è°ƒç”¨ç»“æœè¿”å›ä¹‹å‰ï¼Œçº¿ç¨‹è¢«æŒ‚èµ·ã€‚&lt;/li>
&lt;li>éé˜»å¡ï¼Œåœ¨è°ƒç”¨ç»“æœè¿”å›ä¹‹å‰ï¼Œçº¿ç¨‹ä¸ä¼šè¢«æŒ‚èµ·ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>é˜»å¡ï¼Œä¸ç³»ç»Ÿè°ƒç”¨æœ‰å…³ã€‚&lt;/p>
&lt;h3 id="ioæ¨¡å‹">I/Oæ¨¡å‹
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl"> +-+ é˜» å¡ I/O (BIO)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-+ é é˜» å¡ I/O (NIO)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +----+ åŒ æ­¥ I/O +--+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +-+ I/O å¤š è·¯ å¤ ç”¨
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +-+ ä¿¡ å· é©± åŠ¨ I/O
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I/O æ¨¡ å‹ +---+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +-+ Linux (AIO)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | (io_uring)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +----+ å¼‚ æ­¥ I/O +--+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-+ windows (IOCP)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="åŒæ­¥é˜»å¡io">åŒæ­¥é˜»å¡I/O
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">Application kernel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+---------+ +-----------+ +---+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | syscall | no | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| Read | +--------&amp;gt; | datagram | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| recvfrom| | ready | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | + | +-+ wait for
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | | | +-+ data
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | v | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | datagram | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | ready | +---+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | copy | +---+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | datagram | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|process | | + | +-+ copy data
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|datagram | return | | | +-+ from kernel to user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | &amp;lt;--------+ | v | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | copy | +---+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | complete |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+---------+ +-----------+
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¾“å…¥æ“ä½œä¸¤ä¸ªé˜¶æ®µï¼š&lt;/p>
&lt;ol>
&lt;li>è¿›ç¨‹ç­‰å¾…å†…æ ¸æŠŠæ•°æ®å‡†å¤‡å¥½ï¼›è¿™ä¸ªé˜¶æ®µå¯ä»¥é˜»å¡ä¹Ÿå¯éé˜»å¡ï¼Œè®¾ç½®socketå±æ€§ã€‚
&lt;ul>
&lt;li>é˜»å¡ï¼š recvfrom é˜»å¡çº¿ç¨‹ç›´åˆ°è¿”å›æ•°æ®å°±ç»ªçš„ç»“æœã€‚&lt;/li>
&lt;li>éé˜»å¡ï¼šç«‹å³è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œè½®è¯¢ç›´åˆ°æ•°æ®å°±ç»ªã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ä»å†…æ ¸ç¼“å†²åŒºå‘è¿›ç¨‹ç¼“å†²åŒºå¤åˆ¶æ•°æ®ã€‚ï¼ˆä¸€ç›´é˜»å¡ï¼‰&lt;/li>
&lt;/ol>
&lt;p>å¼‚æ­¥I/Oï¼Œrecvfromæ€»æ˜¯ç«‹å³è¿”å›ï¼Œä¸¤ä¸ªé˜¶æ®µéƒ½ç”±å†…æ ¸å®Œæˆã€‚&lt;/p>
&lt;h3 id="ioå¤šè·¯å¤ç”¨">I/Oå¤šè·¯å¤ç”¨
&lt;/h3>&lt;p>IOå¤šè·¯å¤ç”¨æ˜¯ä¸€ç§åŒæ­¥IOæ¨¡å‹ï¼Œå®ç°ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç›‘è§†å¤šä¸ªæ–‡ä»¶å¥æŸ„ã€‚&lt;/p>
&lt;p>æ”¯æŒI/Oå¤šè·¯å¤ç”¨çš„ç³»ç»Ÿè°ƒç”¨æœ‰ select/pselect/poll/epollï¼Œæœ¬è´¨éƒ½æ˜¯ åŒæ­¥ I/Oï¼Œå› ä¸ºæ•°æ®æ‹·è´éƒ½æ˜¯é˜»å¡çš„ã€‚ é€šè¿‡ select/epoll æ¥åˆ¤æ–­æ•°æ®æŠ¥æ˜¯å¦å‡†å¤‡å¥½ï¼Œå³åˆ¤æ–­å¯è¯»å¯å†™çŠ¶æ€ã€‚&lt;/p>
&lt;h3 id="è¡¥å……èµ„æ–™">è¡¥å……èµ„æ–™
&lt;/h3>&lt;p>I/Oæ¨¡å‹å’ŒI/Oè°ƒç”¨æ˜¯ä¸æ˜¯åˆ†ä¸æ¸…æ¥šï¼Œå‚è€ƒ&lt;a class="link" href="https://cloud.tencent.com/developer/article/1684951" target="_blank" rel="noopener"
>ç†è§£ä¸€ä¸‹5ç§IOæ¨¡å‹ã€é˜»å¡IOå’Œéé˜»å¡IOã€åŒæ­¥IOå’Œå¼‚æ­¥IO&lt;/a>ã€‚&lt;/p>
&lt;p>å…ˆç†è§£ä»€ä¹ˆæ˜¯IOï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/image-20220815091311443.png"
loading="lazy"
alt="image-20220815091311443"
>&lt;/p>
&lt;p>è¦è¾“å…¥è¾“å‡ºæ•°æ®åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šç”¨æˆ·è¿›ç¨‹ç©ºé—´&amp;lt;&amp;ndash;&amp;gt;å†…æ ¸ç©ºé—´ã€å†…æ ¸ç©ºé—´&amp;lt;&amp;ndash;&amp;gt;è®¾å¤‡ç©ºé—´ï¼ˆç£ç›˜ã€ç½‘ç»œç­‰ï¼‰ã€‚&lt;/p>
&lt;ol>
&lt;li>
&lt;p>é˜»å¡IOæ¨¡å‹&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/image-20220815091553220.png"
loading="lazy"
alt="image-20220815091553220"
>&lt;/p>
&lt;p>è¿›ç¨‹å‘èµ·IOç³»ç»Ÿè°ƒç”¨åï¼Œè¿›ç¨‹è¢«é˜»å¡ï¼Œè½¬åˆ°å†…æ ¸ç©ºé—´å¤„ç†ï¼Œæ•´ä¸ªIOå¤„ç†å®Œæ¯•åè¿”å›è¿›ç¨‹ã€‚æ“ä½œæˆåŠŸåˆ™è¿›ç¨‹è·å–åˆ°æ•°æ®ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>éé˜»å¡IOæ¨¡å‹&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/image-20220815091819969.png"
loading="lazy"
alt="image-20220815091819969"
>&lt;/p>
&lt;p>è¿›ç¨‹å‘èµ·IOç³»ç»Ÿè°ƒç”¨åï¼Œå¦‚æœå†…æ ¸ç¼“å†²åŒºæ²¡æœ‰æ•°æ®ï¼Œéœ€è¦åˆ°IOè®¾å¤‡ä¸­è¯»å–ï¼Œè¿›ç¨‹è¿”å›ä¸€ä¸ªé”™è¯¯è€Œä¸ä¼šè¢«é˜»å¡ï¼›è¿›ç¨‹å‘èµ·IOç³»ç»Ÿè°ƒç”¨åï¼Œå¦‚æœå†…æ ¸ç¼“å†²åŒºæœ‰æ•°æ®ï¼Œå†…æ ¸å°±ä¼šæŠŠæ•°æ®è¿”å›è¿›ç¨‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>IOå¤ç”¨æ¨¡å‹&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/image-20220815092054045.png"
loading="lazy"
alt="image-20220815092054045"
>&lt;/p>
&lt;p>å¤šä¸ªè¿›ç¨‹çš„IOå¯ä»¥æ³¨å†Œåˆ°ä¸€ä¸ªå¤ç”¨å™¨ï¼ˆselectï¼‰ä¸Šï¼Œç„¶åç”¨ä¸€ä¸ªè¿›ç¨‹è°ƒç”¨è¯¥selectï¼Œselectä¼šç›‘å¬æ‰€æœ‰æ³¨å†Œè¿›æ¥çš„IOï¼›&lt;/p>
&lt;p>å¦‚æœselectæ²¡æœ‰ç›‘å¬çš„IOåœ¨å†…æ ¸ç¼“å†²åŒºéƒ½æ²¡æœ‰å¯è¯»æ•°æ®ï¼Œselectè°ƒç”¨è¿›ç¨‹ä¼šè¢«é˜»å¡ï¼›è€Œå½“ä»»ä¸€IOåœ¨å†…æ ¸ç¼“å†²åŒºä¸­æœ‰å¯ç”¨æ•°æ®æ—¶ï¼Œselectè°ƒç”¨å°±ä¼šè¿”å›ï¼›&lt;/p>
&lt;p>è€Œåselectè°ƒç”¨è¿›ç¨‹å¯ä»¥è‡ªå·±æˆ–é€šçŸ¥å¦å¤–çš„è¿›ç¨‹ï¼ˆæ³¨å†Œè¿›ç¨‹ï¼‰æ¥å†æ¬¡å‘èµ·è¯»å–IOï¼Œè¯»å–å†…æ ¸ä¸­å‡†å¤‡å¥½çš„æ•°æ®ã€‚&lt;/p>
&lt;p>selectã€pollã€epoll&lt;/p>
&lt;ul>
&lt;li>Linuxä¸­IOå¤ç”¨çš„å®ç°æ–¹å¼ä¸»è¦æœ‰selectã€pollå’Œepollã€‚&lt;/li>
&lt;li>Select: æ³¨å†ŒIOã€é˜»å¡æ‰«æï¼Œç›‘å¬çš„IOæœ€å¤§è¿æ¥æ•°ä¸èƒ½å¤šäºFD_SIZEã€‚&lt;/li>
&lt;li>Poll: åŸç†å’ŒSelectç›¸ä¼¼ï¼Œæ²¡æœ‰æ•°é‡é™åˆ¶ï¼Œä½†IOæ•°é‡å¤§æ‰«æçº¿æ€§æ€§èƒ½ä¸‹é™ã€‚&lt;/li>
&lt;li>Epollï¼šäº‹ä»¶é©±åŠ¨ä¸é˜»å¡ï¼Œmmapå®ç°å†…æ ¸ä¸ç”¨æˆ·ç©ºé—´çš„æ¶ˆæ¯ä¼ é€’ï¼Œæ•°é‡å¾ˆå¤§ï¼ŒLinux2.6åå†…æ ¸æ”¯æŒã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ä¿¡å·é©±åŠ¨IOæ¨¡å‹&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/image-20220815093027374.png"
loading="lazy"
alt="image-20220815093027374"
>&lt;/p>
&lt;p>å½“è¿›ç¨‹å‘èµ·ä¸€ä¸ªIOæ“ä½œï¼Œä¼šå‘å†…æ ¸æ³¨å†Œä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œç„¶åè¿›ç¨‹è¿”å›ä¸é˜»å¡ï¼›å½“å†…æ ¸æ•°æ®å°±ç»ªæ—¶ä¼šå‘ç”Ÿä¸€ä¸ªä¿¡å·ç»™è¿›ç¨‹ï¼Œè¿›ç¨‹ä¾¿åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­è°ƒç”¨IOè¯»å–æ•°æ®ã€‚&lt;/p>
&lt;p>ç‰¹ç‚¹ï¼šå›è°ƒæœºåˆ¶ï¼Œå®ç°ã€å¼€å‘åº”ç”¨éš¾åº¦å¤§ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¼‚æ­¥IOæ¨¡å‹&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/image-20220815093324750.png"
loading="lazy"
alt="image-20220815093324750"
>&lt;/p>
&lt;p>å½“è¿›ç¨‹å‘èµ·ä¸€ä¸ªIOæ“ä½œï¼Œè¿›ç¨‹è¿”å›ï¼ˆä¸é˜»å¡ï¼‰ï¼Œä½†ä¹Ÿä¸èƒ½è¿”å›ç»“æœï¼›å†…æ ¸æŠŠæ•´ä¸ªIOå¤„ç†å®Œåï¼Œä¼šé€šçŸ¥è¿›ç¨‹ç»“æœã€‚å¦‚æœIOæ“ä½œæˆåŠŸåˆ™è¿›ç¨‹ç›´æ¥è·å–åˆ°æ•°æ®ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>ä¸€å›¾æ€»ç»“ï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/rust_async_I:O_model.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h2 id="epoll">epoll
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl"> +--------------------------------+ +-------------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | epoll_ctl | | epoll_wait |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | | +----+ |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +---+ | | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | | | | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +-+---+--+ | | +--+-+ |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | | | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +--++ +-++ | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">epoll_create +----&amp;gt; | | | | | | | +--+-+ |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +-+-+ +--+ +----&amp;gt;+ | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | |event| | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +----+--+ | | +--+-+ |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | | | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | ++ | | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +--+ +-+-+ | | +--+-+ |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | | | | | | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +--+ +---+ | | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | | +----+ |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | çº¢ é»‘ æ ‘ | | é“¾ è¡¨ |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +--------------------------------+ +-------------------------+
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>epoll_create(int size) : å†…æ ¸äº§ç”Ÿä¸€ä¸ªepollå®ä¾‹æ•°æ®ç»“æ„ï¼Œå¹¶è¿”å›ä¸€ä¸ªepfd&lt;/li>
&lt;li>epoll_ctl(int epfd, int op, int fd, struct epoll_event *event)ï¼šå°†è¢«ç›‘å¬çš„æè¿°ç¬¦æ·»åŠ åˆ°çº¢é»‘æ ‘æˆ–ä»çº¢é»‘æ ‘ä¸­åˆ é™¤æˆ–è€…å¯¹ç›‘å¬äº‹ä»¶è¿›è¡Œä¿®æ”¹ã€‚&lt;/li>
&lt;li>epoll_wait(int epfd, struct epoll_event *events, int maxevents, int timeout): é˜»å¡ç­‰å¾…æ³¨å†Œçš„äº‹ä»¶å‘ç”Ÿï¼Œè¿”å›äº‹ä»¶çš„æ•°ç›®ï¼Œå¹¶å°†è§¦å‘çš„äº‹ä»¶å†™å…¥eventsæ•°ç»„ä¸­&lt;/li>
&lt;/ul>
&lt;p>epoll ä¸¤ç§è§¦å‘æœºåˆ¶ï¼š&lt;/p>
&lt;ul>
&lt;li>æ°´å¹³è§¦å‘æœºåˆ¶ï¼ˆLT)ã€‚ç¼“å†²åŒºåªè¦æœ‰æ•°æ®å°±è§¦å‘è¯»å†™ã€‚epoll é»˜è®¤å·¥ä½œæ–¹å¼ã€‚select/pollåªæ”¯æŒè¯¥æ–¹å¼ã€‚&lt;/li>
&lt;li>è¾¹ç¼˜è§¦å‘æœºåˆ¶ï¼ˆET)ã€‚ç¼“å†²åŒºç©ºæˆ–æ»¡çš„çŠ¶æ€æ‰è§¦å‘è¯»å†™ã€‚nginx ä½¿ç”¨è¯¥æ–¹å¼ï¼Œé¿å…é¢‘ç¹è¯»å†™ã€‚&lt;/li>
&lt;/ul>
&lt;p>æƒŠç¾¤é—®é¢˜ï¼š&lt;/p>
&lt;p>å½“å¤šä¸ªè¿›ç¨‹/çº¿ç¨‹è°ƒç”¨epoll_waitæ—¶ä¼šé˜»å¡ç­‰å¾…ï¼Œå½“å†…æ ¸è§¦å‘å¯è¯»å†™äº‹ä»¶ï¼Œæ‰€æœ‰è¿›ç¨‹/çº¿ç¨‹éƒ½ä¼šè¿›è¡Œå“åº”ï¼Œä½†æ˜¯å®é™…ä¸Šåªæœ‰ä¸€ä¸ªè¿›ç¨‹/çº¿ç¨‹çœŸå®å¤„ç†è¿™äº›äº‹ä»¶ã€‚ Liux 4.5 é€šè¿‡å¼•å…¥ EPOLLEXCLUSIVE æ ‡è¯†æ¥ä¿è¯ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿæ—¶å€™åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šè¢«å”¤é†’ï¼Œä»¥é¿å…å¤šä¾¦å¬ä¸‹çš„æƒŠç¾¤é—®é¢˜ã€‚&lt;/p>
&lt;h3 id="è¡¥å……èµ„æ–™-1">è¡¥å……èµ„æ–™
&lt;/h3>&lt;p>&lt;a class="link" href="https://www.cnblogs.com/lojunren/p/3856290.html" target="_blank" rel="noopener"
>Linuxä¸‹çš„I/Oå¤ç”¨ä¸epollè¯¦è§£&lt;/a>&lt;/p>
&lt;p>selectã€pollã€epoll&lt;/p>
&lt;ul>
&lt;li>Linuxä¸­IOå¤ç”¨çš„å®ç°æ–¹å¼ä¸»è¦æœ‰selectã€pollå’Œepollï¼š&lt;/li>
&lt;li>Selectï¼šæ³¨å†ŒIOã€é˜»å¡æ‰«æï¼Œç›‘å¬çš„IOæœ€å¤§è¿æ¥æ•°ä¸èƒ½å¤šäºFD_SIZEï¼›&lt;/li>
&lt;li>Pollï¼šåŸç†å’ŒSelectç›¸ä¼¼ï¼Œæ²¡æœ‰æ•°é‡é™åˆ¶ï¼Œä½†IOæ•°é‡å¤§æ‰«æçº¿æ€§æ€§èƒ½ä¸‹é™ï¼›&lt;/li>
&lt;li>Epoll ï¼šäº‹ä»¶é©±åŠ¨ä¸é˜»å¡ï¼Œmmapå®ç°å†…æ ¸ä¸ç”¨æˆ·ç©ºé—´çš„æ¶ˆæ¯ä¼ é€’ï¼Œæ•°é‡å¾ˆå¤§ï¼ŒLinux2.6åå†…æ ¸æ”¯æŒã€‚&lt;/li>
&lt;/ul>
&lt;p>selectçš„ç¼ºé™·ï¼š&lt;/p>
&lt;ul>
&lt;li>selecté¢„ä¼°é”™è¯¯äº†ä¸€ä»¶äº‹ï¼Œå½“æ•°åä¸‡å¹¶å‘è¿æ¥å­˜åœ¨æ—¶ï¼Œå¯èƒ½æ¯ä¸€æ¯«ç§’åªæœ‰æ•°ç™¾ä¸ªæ´»è·ƒçš„è¿æ¥ï¼ŒåŒæ—¶å…¶ä½™æ•°åä¸‡è¿æ¥åœ¨è¿™ä¸€æ¯«ç§’æ˜¯éæ´»è·ƒçš„ã€‚&lt;/li>
&lt;li>åœ¨Linuxå†…æ ¸ä¸­ï¼Œselectæ‰€ç”¨åˆ°çš„FD_SETæ˜¯æœ‰é™çš„ï¼Œå³å†…æ ¸ä¸­æœ‰ä¸ªå‚æ•°__FD_SETSIZEå®šä¹‰äº†æ¯ä¸ªFD_SETçš„å¥æŸ„ä¸ªæ•°ã€‚&lt;/li>
&lt;li>å†…æ ¸ä¸­å®ç° selectæ˜¯ç”¨&lt;strong>è½®è¯¢&lt;/strong>æ–¹æ³•ï¼Œå³æ¯æ¬¡æ£€æµ‹éƒ½ä¼šéå†æ‰€æœ‰FD_SETä¸­çš„å¥æŸ„ï¼Œæ˜¾ç„¶ï¼Œselectå‡½æ•°æ‰§è¡Œæ—¶é—´ä¸FD_SETä¸­çš„å¥æŸ„ä¸ªæ•°æœ‰ä¸€ä¸ªæ¯”ä¾‹å…³ç³»ï¼Œå³ selectè¦æ£€æµ‹çš„å¥æŸ„æ•°è¶Šå¤šå°±ä¼šè¶Šè´¹æ—¶ã€‚&lt;/li>
&lt;/ul>
&lt;p>ç›¸æ¯”äºselectæœºåˆ¶ï¼Œpollåªæ˜¯å–æ¶ˆäº†æœ€å¤§ç›‘æ§æ–‡ä»¶æè¿°ç¬¦æ•°é™åˆ¶ï¼Œå¹¶æ²¡æœ‰ä»æ ¹æœ¬ä¸Šè§£å†³selectå­˜åœ¨çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>epollç²¾å·§çš„ä½¿ç”¨äº†3ä¸ªæ–¹æ³•æ¥å®ç°selectæ–¹æ³•è¦åšçš„äº‹ï¼š&lt;/p>
&lt;ol>
&lt;li>æ–°å»ºepollæè¿°ç¬¦==epoll_create()&lt;/li>
&lt;li>epoll_ctl(epollæè¿°ç¬¦ï¼Œæ·»åŠ æˆ–è€…åˆ é™¤æ‰€æœ‰å¾…ç›‘æ§çš„è¿æ¥)&lt;/li>
&lt;li>è¿”å›çš„æ´»è·ƒè¿æ¥ ==epoll_waitï¼ˆ epollæè¿°ç¬¦ ï¼‰&lt;/li>
&lt;/ol>
&lt;p>ä¸selectç›¸æ¯”ï¼Œepollåˆ†æ¸…äº†é¢‘ç¹è°ƒç”¨å’Œä¸é¢‘ç¹è°ƒç”¨çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œepoll_ctlæ˜¯ä¸å¤ªé¢‘ç¹è°ƒç”¨çš„ï¼Œè€Œepoll_waitæ˜¯éå¸¸é¢‘ç¹è°ƒç”¨çš„ã€‚è¿™æ—¶ï¼Œepoll_waitå´å‡ ä¹æ²¡æœ‰å…¥å‚ï¼Œè¿™æ¯”selectçš„æ•ˆç‡é«˜å‡ºä¸€å¤§æˆªï¼Œè€Œä¸”ï¼Œå®ƒä¹Ÿä¸ä¼šéšç€å¹¶å‘è¿æ¥çš„å¢åŠ ä½¿å¾—å…¥å‚è¶Šå‘å¤šèµ·æ¥ï¼Œå¯¼è‡´å†…æ ¸æ‰§è¡Œæ•ˆç‡ä¸‹é™ã€‚&lt;/p>
&lt;p>è¦æ·±åˆ»ç†è§£epollï¼Œé¦–å…ˆå¾—äº†è§£epollçš„ä¸‰å¤§å…³é”®è¦ç´ ï¼š&lt;strong>mmapã€çº¢é»‘æ ‘ã€é“¾è¡¨&lt;/strong>ã€‚&lt;/p>
&lt;p>epollæ˜¯é€šè¿‡å†…æ ¸ä¸ç”¨æˆ·ç©ºé—´mmapåŒä¸€å—å†…å­˜å®ç°çš„ã€‚mmapå°†ç”¨æˆ·ç©ºé—´çš„ä¸€å—åœ°å€å’Œå†…æ ¸ç©ºé—´çš„ä¸€å—åœ°å€åŒæ—¶æ˜ å°„åˆ°ç›¸åŒçš„ä¸€å—ç‰©ç†å†…å­˜åœ°å€ï¼ˆä¸ç®¡æ˜¯ç”¨æˆ·ç©ºé—´è¿˜æ˜¯å†…æ ¸ç©ºé—´éƒ½æ˜¯è™šæ‹Ÿåœ°å€ï¼Œæœ€ç»ˆè¦é€šè¿‡åœ°å€æ˜ å°„æ˜ å°„åˆ°ç‰©ç†åœ°å€ï¼‰ï¼Œä½¿å¾—è¿™å—ç‰©ç†å†…å­˜å¯¹å†…æ ¸å’Œå¯¹ç”¨æˆ·å‡å¯è§ï¼Œå‡å°‘ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„æ•°æ®äº¤æ¢ã€‚å†…æ ¸å¯ä»¥ç›´æ¥çœ‹åˆ°epollç›‘å¬çš„å¥æŸ„ï¼Œæ•ˆç‡é«˜ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://zh.m.wikipedia.org/zh/%E7%BA%A2%E9%BB%91%E6%A0%91" target="_blank" rel="noopener"
>çº¢é»‘æ ‘&lt;/a>å°†å­˜å‚¨epollæ‰€ç›‘å¬çš„å¥—æ¥å­—ã€‚ä¸Šé¢mmapå‡ºæ¥çš„å†…å­˜å¦‚ä½•ä¿å­˜epollæ‰€ç›‘å¬çš„å¥—æ¥å­—ï¼Œå¿…ç„¶ä¹Ÿå¾—æœ‰ä¸€å¥—æ•°æ®ç»“æ„ï¼Œepollåœ¨å®ç°ä¸Šé‡‡ç”¨çº¢é»‘æ ‘å»å­˜å‚¨æ‰€æœ‰å¥—æ¥å­—ï¼Œå½“æ·»åŠ æˆ–è€…åˆ é™¤ä¸€ä¸ªå¥—æ¥å­—æ—¶ï¼ˆepoll_ctlï¼‰ï¼Œéƒ½åœ¨çº¢é»‘æ ‘ä¸Šå»å¤„ç†ï¼Œçº¢é»‘æ ‘æœ¬èº«æ’å…¥å’Œåˆ é™¤æ€§èƒ½æ¯”è¾ƒå¥½ï¼Œæ—¶é—´å¤æ‚åº¦O(logN)ã€‚&lt;/p>
&lt;p>é€šè¿‡epoll_ctlå‡½æ•°æ·»åŠ è¿›æ¥çš„äº‹ä»¶éƒ½ä¼šè¢«æ”¾åœ¨çº¢é»‘æ ‘çš„æŸä¸ªèŠ‚ç‚¹å†…ï¼Œæ‰€ä»¥ï¼Œé‡å¤æ·»åŠ æ˜¯æ²¡æœ‰ç”¨çš„ã€‚å½“æŠŠäº‹ä»¶æ·»åŠ è¿›æ¥çš„æ—¶å€™æ—¶å€™ä¼šå®Œæˆå…³é”®çš„ä¸€æ­¥ï¼Œé‚£å°±æ˜¯è¯¥äº‹ä»¶éƒ½ä¼šä¸ç›¸åº”çš„è®¾å¤‡ï¼ˆç½‘å¡ï¼‰é©±åŠ¨ç¨‹åºå»ºç«‹å›è°ƒå…³ç³»ï¼Œå½“ç›¸åº”çš„äº‹ä»¶å‘ç”Ÿåï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°åœ¨å†…æ ¸ä¸­è¢«ç§°ä¸ºï¼šep_poll_callback,&lt;strong>è¿™ä¸ªå›è°ƒå‡½æ•°å…¶å®å°±æ‰€æŠŠè¿™ä¸ªäº‹ä»¶æ·»åŠ åˆ°rdllistè¿™ä¸ªåŒå‘é“¾è¡¨ä¸­&lt;/strong>ã€‚ä¸€æ—¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œepollå°±ä¼šå°†è¯¥äº‹ä»¶æ·»åŠ åˆ°åŒå‘é“¾è¡¨ä¸­ã€‚é‚£ä¹ˆå½“æˆ‘ä»¬è°ƒç”¨epoll_waitæ—¶ï¼Œepoll_waitåªéœ€è¦æ£€æŸ¥rdliståŒå‘é“¾è¡¨ä¸­æ˜¯å¦æœ‰å­˜åœ¨æ³¨å†Œçš„äº‹ä»¶ï¼Œæ•ˆç‡éå¸¸å¯è§‚ã€‚è¿™é‡Œä¹Ÿéœ€è¦å°†å‘ç”Ÿäº†çš„äº‹ä»¶å¤åˆ¶åˆ°ç”¨æˆ·æ€å†…å­˜ä¸­å³å¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/rust_async_epoll.jpeg"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>epoll_waitçš„å·¥ä½œæµç¨‹ï¼š&lt;/p>
&lt;ol>
&lt;li>epoll_waitè°ƒç”¨ep_pollï¼Œå½“rdlistä¸ºç©ºï¼ˆæ— å°±ç»ªfdï¼‰æ—¶æŒ‚èµ·å½“å‰è¿›ç¨‹ï¼Œç›´åˆ°rdlistä¸ç©ºæ—¶è¿›ç¨‹æ‰è¢«å”¤é†’ã€‚&lt;/li>
&lt;li>æ–‡ä»¶fdçŠ¶æ€æ”¹å˜ï¼ˆbufferç”±ä¸å¯è¯»å˜ä¸ºå¯è¯»æˆ–ç”±ä¸å¯å†™å˜ä¸ºå¯å†™ï¼‰ï¼Œå¯¼è‡´ç›¸åº”fdä¸Šçš„å›è°ƒå‡½æ•°ep_poll_callback()è¢«è°ƒç”¨ã€‚&lt;/li>
&lt;li>ep_poll_callbackå°†ç›¸åº”fdå¯¹åº”epitemåŠ å…¥rdlistï¼Œå¯¼è‡´rdlistä¸ç©ºï¼Œè¿›ç¨‹è¢«å”¤é†’ï¼Œepoll_waitå¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚&lt;/li>
&lt;li>ep_events_transferå‡½æ•°å°†rdlistä¸­çš„epitemæ‹·è´åˆ°txlistä¸­ï¼Œå¹¶å°†rdlistæ¸…ç©ºã€‚&lt;/li>
&lt;li>ep_send_eventså‡½æ•°ï¼ˆå¾ˆå…³é”®ï¼‰ï¼Œå®ƒæ‰«ætxlistä¸­çš„æ¯ä¸ªepitemï¼Œè°ƒç”¨å…¶å…³è”fdå¯¹ç”¨çš„pollæ–¹æ³•ã€‚æ­¤æ—¶å¯¹pollçš„è°ƒç”¨ä»…ä»…æ˜¯å–å¾—fdä¸Šè¾ƒæ–°çš„eventsï¼ˆé˜²æ­¢ä¹‹å‰eventsè¢«æ›´æ–°ï¼‰ï¼Œä¹‹åå°†å–å¾—çš„eventså’Œç›¸åº”çš„fdå‘é€åˆ°ç”¨æˆ·ç©ºé—´ï¼ˆå°è£…åœ¨struct epoll_eventï¼Œä»epoll_waitè¿”å›ï¼‰ã€‚&lt;/li>
&lt;/ol>
&lt;p>selectã€pollå’Œepollä¸‰ç§I/Oå¤ç”¨æ¨¡å¼çš„æ¯”è¾ƒï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>ç³»ç»Ÿè°ƒç”¨&lt;/th>
&lt;th>select&lt;/th>
&lt;th>poll&lt;/th>
&lt;th>epoll&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>äº‹ä»¶é›†åˆ&lt;/td>
&lt;td>ç”¨æˆ·é€šè¿‡3ä¸ªå‚æ•°åˆ†åˆ«ä¼ å…¥æ„Ÿå…´è¶£çš„å¯è¯»ï¼Œå¯å†™åŠå¼‚å¸¸ç­‰äº‹ä»¶å†…æ ¸é€šè¿‡å¯¹è¿™äº›å‚æ•°çš„åœ¨çº¿ä¿®æ”¹æ¥åé¦ˆå…¶ä¸­çš„å°±ç»ªäº‹ä»¶è¿™ä½¿å¾—ç”¨æˆ·æ¯æ¬¡è°ƒç”¨selectéƒ½è¦é‡ç½®è¿™3ä¸ªå‚æ•°&lt;/td>
&lt;td>ç»Ÿä¸€å¤„ç†æ‰€æœ‰äº‹ä»¶ç±»å‹ï¼Œå› æ­¤åªéœ€è¦ä¸€ä¸ªäº‹ä»¶é›†å‚æ•°ã€‚ç”¨æˆ·é€šè¿‡pollfd.eventsä¼ å…¥æ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Œå†…æ ¸é€šè¿‡ä¿®æ”¹pollfd.reventsåé¦ˆå…¶ä¸­å°±ç»ªçš„äº‹ä»¶&lt;/td>
&lt;td>å†…æ ¸é€šè¿‡ä¸€ä¸ªäº‹ä»¶è¡¨ç›´æ¥ç®¡ç†ç”¨æˆ·æ„Ÿå…´è¶£çš„æ‰€æœ‰äº‹ä»¶ã€‚å› æ­¤æ¯æ¬¡è°ƒç”¨epoll_waitæ—¶ï¼Œæ— éœ€åå¤ä¼ å…¥ç”¨æˆ·æ„Ÿå…´è¶£çš„äº‹ä»¶ã€‚epoll_waitç³»ç»Ÿè°ƒç”¨çš„å‚æ•°eventsä»…ç”¨æ¥åé¦ˆå°±ç»ªçš„äº‹ä»¶&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>åº”ç”¨ç¨‹åºç´¢å¼•å°±ç»ªæ–‡ä»¶æè¿°ç¬¦çš„æ—¶é—´å¤æ‚åº¦&lt;/td>
&lt;td>O(n)&lt;/td>
&lt;td>O(n)&lt;/td>
&lt;td>O(1)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æœ€å¤§æ”¯æŒæ–‡ä»¶æè¿°ç¬¦æ•°&lt;/td>
&lt;td>ä¸€èˆ¬æœ‰æœ€å¤§å€¼é™åˆ¶&lt;/td>
&lt;td>65535&lt;/td>
&lt;td>65535&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>å·¥ä½œæ¨¡å¼&lt;/td>
&lt;td>LT&lt;/td>
&lt;td>LT&lt;/td>
&lt;td>æ”¯æŒETé«˜æ•ˆæ¨¡å¼&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>å†…æ ¸å®ç°å’Œå·¥ä½œæ•ˆç‡&lt;/td>
&lt;td>é‡‡ç”¨è½®è¯¢æ–¹å¼æ£€æµ‹å°±ç»ªäº‹ä»¶ï¼Œæ—¶é—´å¤æ‚åº¦ï¼šO(n)&lt;/td>
&lt;td>é‡‡ç”¨è½®è¯¢æ–¹å¼æ£€æµ‹å°±ç»ªäº‹ä»¶ï¼Œæ—¶é—´å¤æ‚åº¦ï¼šO(n)&lt;/td>
&lt;td>é‡‡ç”¨å›è°ƒæ–¹å¼æ£€æµ‹å°±ç»ªäº‹ä»¶ï¼Œæ—¶é—´å¤æ‚åº¦ï¼šO(1)&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="io_uring-å¼‚æ­¥-io-æ¨¡å‹">io_uring å¼‚æ­¥ I/O æ¨¡å‹
&lt;/h2>&lt;p>Linux AIO å®ç°çš„å¹¶ä¸ç†æƒ³ï¼Œæ‰€ä»¥å¼•å…¥äº†æ–°çš„å¼‚æ­¥I/Oæ¥å£ io_uringã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">+----+ Head +---------+ +----------+ Head
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| +---------+ +----------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| +---------+ +----------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| +---------+ +----------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| Tail +---------+ +----------+ Tail &amp;lt;--+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| +--------------------------------------------+ |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | Kernel | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | +-------+ +-------+ | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | | | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+---------------&amp;gt; | SQ | | CQ | +--------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +-------+ +-------+ |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +--------------------------------------------+
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>io_uringæ¥å£é€šè¿‡ä¸¤ä¸ªä¸»è¦æ•°æ®ç»“æ„å·¥ä½œï¼š&lt;/p>
&lt;ul>
&lt;li>æäº¤é˜Ÿåˆ—æ¡ç›®ï¼ˆsqeï¼‰&lt;/li>
&lt;li>å®Œæˆé˜Ÿåˆ—æ¡ç›®ï¼ˆcqeï¼‰&lt;/li>
&lt;/ul>
&lt;p>è¿™äº›ç»“æ„çš„å®ä¾‹ä½äºå†…æ ¸å’Œåº”ç”¨ç¨‹åºä¹‹é—´çš„&lt;strong>å…±äº«å†…å­˜&lt;/strong>å•ç”Ÿäº§è€…å•æ¶ˆè´¹è€…ç¯å½¢ç¼“å†²åŒºä¸­ã€‚&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://thenewstack.io/how-io_uring-and-ebpf-will-revolutionize-programming-in-linux/" target="_blank" rel="noopener"
>How io_uring and eBPF Will Revolutionize Programming in Linux&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://cor3ntin.github.io/posts/iouring/#io_uring" target="_blank" rel="noopener"
>A Universal I/O Abstraction for C++&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/image-20220815104458456.png"
loading="lazy"
alt="image-20220815104458456"
>&lt;/p>
&lt;h2 id="äº‹ä»¶é©±åŠ¨ç¼–ç¨‹æ¨¡å‹">äº‹ä»¶é©±åŠ¨ç¼–ç¨‹æ¨¡å‹
&lt;/h2>&lt;p>å› ä¸ºå¤„ç† I/O å¤ç”¨çš„ç¼–ç¨‹æ¨¡å‹ç›¸å½“å¤æ‚ï¼Œä¸ºäº†ç®€åŒ–ç¼–ç¨‹ï¼Œå¼•å…¥äº†ä¸‹é¢ä¸¤ç§æ¨¡å‹ã€‚&lt;/p>
&lt;ul>
&lt;li>Reactorï¼ˆååº”å™¨ï¼‰ æ¨¡å¼ï¼Œå¯¹åº”åŒæ­¥I/Oï¼Œè¢«åŠ¨çš„äº‹ä»¶åˆ†ç¦»å’Œåˆ†å‘æ¨¡å‹ã€‚æœåŠ¡ç­‰å¾…è¯·æ±‚äº‹ä»¶çš„åˆ°æ¥ï¼Œå†é€šè¿‡ä¸å—é—´æ–­çš„åŒæ­¥å¤„ç†äº‹ä»¶ï¼Œä»è€Œåšå‡ºååº”ã€‚&lt;/li>
&lt;li>Preactorï¼ˆä¸»åŠ¨å™¨ï¼‰ æ¨¡å¼ï¼Œå¯¹åº”å¼‚æ­¥I/Oï¼Œä¸»åŠ¨çš„äº‹ä»¶åˆ†ç¦»å’Œåˆ†å‘æ¨¡å‹ã€‚è¿™ç§è®¾è®¡å…è®¸å¤šä¸ªä»»åŠ¡å¹¶å‘çš„æ‰§è¡Œï¼Œä»è€Œæé«˜ååé‡ï¼›å¹¶å¯æ‰§è¡Œè€—æ—¶é•¿çš„ä»»åŠ¡ï¼ˆå„ä¸ªä»»åŠ¡é—´äº’ä¸å½±å“ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;p>Reactor Model:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl"> +----------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">req Dispatch | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+------+ +--------&amp;gt; | req handler |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | +----------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | +----+ |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+------+ | event +------------+ |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +--------&amp;gt; | Service | |Dispatch +----------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | Handler +------------&amp;gt; | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">req +---------&amp;gt; | | | | req handler |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+------+ | +------------+ | +----------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | event |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| +----+ |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+------+ | Dispatch +----------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---------&amp;gt;+ |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | req handler |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +----------------+
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸‰ç§å®ç°æ–¹å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>å•çº¿ç¨‹æ¨¡å¼ã€‚ accept()ã€read()ã€write()ä»¥åŠconnect()æ“ä½œ éƒ½åœ¨åŒä¸€çº¿ç¨‹ã€‚&lt;/li>
&lt;li>å·¥ä½œè€…çº¿ç¨‹æ± æ¨¡å¼ã€‚é I/O æ“ä½œäº¤ç»™çº¿ç¨‹æ± å¤„ç†&lt;/li>
&lt;li>å¤šçº¿ç¨‹æ¨¡å¼ã€‚ä¸»Reactor (master) ï¼Œè´Ÿè´£ç½‘ç»œç›‘å¬ ï¼Œ å­Reactor(worker) è¯»å†™ç½‘ç»œæ•°æ®ã€‚&lt;/li>
&lt;/ul>
&lt;p>è¯»å†™æ“ä½œæµç¨‹ï¼š&lt;/p>
&lt;ol>
&lt;li>åº”ç”¨æ³¨å†Œè¯»å†™å°±ç»ªäº‹ä»¶å’Œç›¸å…³è”çš„äº‹ä»¶å¤„ç†å™¨&lt;/li>
&lt;li>äº‹ä»¶åˆ†ç¦»å™¨ç­‰å¾…äº‹ä»¶å‘ç”Ÿ&lt;/li>
&lt;li>å½“å‘ç”Ÿè¯»å†™å°±ç»ªäº‹ä»¶ï¼Œäº‹ä»¶åˆ†ç¦»å™¨è°ƒç”¨å·²æ³¨å†Œçš„äº‹ä»¶å¤„ç†å™¨&lt;/li>
&lt;li>äº‹ä»¶å¤„ç†å™¨æ‰§è¡Œè¯»å†™æ“ä½œ&lt;/li>
&lt;/ol>
&lt;p>å‚ä¸è€…ï¼š&lt;/p>
&lt;ol>
&lt;li>æè¿°ç¬¦ï¼ˆhandleï¼‰ï¼šæ“ä½œç³»ç»Ÿæä¾›çš„èµ„æºï¼Œè¯†åˆ« socketç­‰ã€‚&lt;/li>
&lt;li>åŒæ­¥äº‹ä»¶å¤šè·¯åˆ†ç¦»å™¨ã€‚å¼€å¯äº‹ä»¶å¾ªç¯ï¼Œç­‰å¾…äº‹ä»¶çš„å‘ç”Ÿã€‚å°è£…äº† å¤šè·¯å¤ç”¨å‡½æ•° select/poll/epollç­‰ã€‚&lt;/li>
&lt;li>äº‹ä»¶å¤„ç†å™¨ã€‚æä¾›å›è°ƒå‡½æ•°ï¼Œç”¨äºæè¿°ä¸åº”ç”¨ç¨‹åºç›¸å…³çš„æŸä¸ªäº‹ä»¶çš„æ“ä½œã€‚&lt;/li>
&lt;li>å…·ä½“çš„äº‹ä»¶å¤„ç†å™¨ã€‚äº‹ä»¶å¤„ç†å™¨æ¥å£çš„å…·ä½“å®ç°ã€‚ä½¿ç”¨æè¿°ç¬¦æ¥è¯†åˆ«äº‹ä»¶å’Œç¨‹åºæä¾›çš„æœåŠ¡ã€‚&lt;/li>
&lt;li>Reactor ç®¡ç†å™¨ã€‚äº‹ä»¶å¤„ç†å™¨çš„è°ƒåº¦æ ¸å¿ƒã€‚åˆ†ç¦»æ¯ä¸ªäº‹ä»¶ï¼Œè°ƒåº¦äº‹ä»¶ç®¡ç†å™¨ï¼Œè°ƒç”¨å…·ä½“çš„å‡½æ•°å¤„ç†æŸä¸ªäº‹ä»¶ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="è¡¥å……èµ„æ–™-2">è¡¥å……èµ„æ–™
&lt;/h3>&lt;p>&lt;a class="link" href="https://segmentfault.com/a/1190000022048085" target="_blank" rel="noopener"
>äº‹ä»¶é©±åŠ¨åŠå…¶è®¾è®¡æ¨¡å¼&lt;/a>&lt;/p>
&lt;p>ä»äº‹ä»¶è§’åº¦è¯´ï¼Œäº‹ä»¶é©±åŠ¨ç¨‹åºçš„åŸºæœ¬ç»“æ„æ˜¯ç”±ä¸€ä¸ªäº‹ä»¶æ”¶é›†å™¨ã€ä¸€ä¸ªäº‹ä»¶å‘é€å™¨å’Œä¸€ä¸ªäº‹ä»¶å¤„ç†å™¨ç»„æˆã€‚&lt;/p>
&lt;p>&lt;strong>äº‹ä»¶å¾ªç¯å™¨çš„å®ç°&lt;/strong>&lt;/p>
&lt;p>äº‹ä»¶å¾ªç¯å™¨ä¸æ–­æ¥å—æ¥è‡ªå®¢æˆ·ç«¯ï¼ˆClientï¼‰çš„è¯·æ±‚ï¼Œäº‹ä»¶å¾ªç¯å™¨æŠŠè¯·æ±‚è½¬äº¤ç»™æ³¨å†Œäº†æŸç±»äº‹ä»¶çš„å·¥ä½œçº¿ç¨‹ï¼ˆWorkerï¼‰å¤„ç†ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/image-20220815105703262.png"
loading="lazy"
alt="image-20220815105703262"
>&lt;/p>
&lt;p>æ ¹æ®å®ç°çš„æ–¹å¼ä¸åŒï¼Œåœ¨ç½‘ç»œç¼–ç¨‹ä¸­åŸºäºäº‹ä»¶é©±åŠ¨ä¸»è¦æœ‰ä¸¤ç§è®¾è®¡æ¨¡å¼ï¼šReactorå’ŒProactorã€‚&lt;/p>
&lt;p>&lt;strong>Reactoræ¨¡å¼æ¡†æ¶&lt;/strong>&lt;/p>
&lt;p>ä½¿ç”¨Reactoræ¨¡å‹ï¼Œå¿…å¤‡çš„å‡ ä¸ªç»„ä»¶ï¼šäº‹ä»¶æºã€Reactoræ¡†æ¶ã€äº‹ä»¶å¤šè·¯å¤ç”¨æœºåˆ¶å’Œäº‹ä»¶å¤„ç†ç¨‹åºï¼Œå…ˆæ¥çœ‹çœ‹Reactoræ¨¡å‹çš„æ•´ä½“æ¡†æ¶ï¼Œæ¥ä¸‹æ¥å†å¯¹æ¯ä¸ªç»„ä»¶åšé€ä¸€è¯´æ˜ã€‚&lt;/p>
&lt;p>1ï¼‰äº‹ä»¶æºï¼šLinuxä¸Šæ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼ŒWindowsä¸Šå°±æ˜¯Socketæˆ–è€…Handleäº†ï¼Œè¿™é‡Œç»Ÿä¸€ç§°ä¸ºâ€œå¥æŸ„é›†â€ï¼›ç¨‹åºåœ¨æŒ‡å®šçš„å¥æŸ„ä¸Šæ³¨å†Œå…³å¿ƒçš„äº‹ä»¶ï¼Œæ¯”å¦‚I/Oäº‹ä»¶ã€‚&lt;/p>
&lt;p>2ï¼‰äº‹ä»¶å¤šè·¯å¤ç”¨æœºåˆ¶ï¼šç”±æ“ä½œç³»ç»Ÿæä¾›çš„I/Oå¤šè·¯å¤ç”¨æœºåˆ¶ï¼Œæ¯”å¦‚selectå’Œepollã€‚ç¨‹åºé¦–å…ˆå°†å…¶å…³å¿ƒçš„å¥æŸ„ï¼ˆäº‹ä»¶æºï¼‰åŠå…¶äº‹ä»¶æ³¨å†Œåˆ°å¤šè·¯å¤ç”¨æœºåˆ¶ä¸Šã€‚å½“æœ‰äº‹ä»¶åˆ°è¾¾æ—¶ï¼Œäº‹ä»¶å¤šè·¯å¤ç”¨æœºåˆ¶ä¼šå‘å‡ºé€šçŸ¥â€œåœ¨å·²ç»æ³¨å†Œçš„å¥æŸ„é›†ä¸­ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªå¥æŸ„çš„äº‹ä»¶å·²ç»å°±ç»ªâ€ã€‚ç¨‹åºæ”¶åˆ°é€šçŸ¥åï¼Œå°±å¯ä»¥åœ¨éé˜»å¡çš„æƒ…å†µä¸‹å¯¹äº‹ä»¶è¿›è¡Œå¤„ç†äº†ã€‚&lt;/p>
&lt;p>3ï¼‰ Reactorã€‚æ˜¯äº‹ä»¶ç®¡ç†çš„æ¥å£ï¼Œå†…éƒ¨ä½¿ç”¨äº‹ä»¶å¤šè·¯å¤ç”¨æœºåˆ¶æ³¨å†Œã€æ³¨é”€äº‹ä»¶ï¼›å¹¶è¿è¡Œäº‹ä»¶å¾ªç¯ï¼Œå½“æœ‰äº‹ä»¶è¿›å…¥â€œå°±ç»ªâ€çŠ¶æ€æ—¶ï¼Œè°ƒç”¨æ³¨å†Œäº‹ä»¶çš„å›è°ƒå‡½æ•°å¤„ç†äº‹ä»¶ã€‚&lt;/p>
&lt;p>4ï¼‰äº‹ä»¶å¤„ç†ç¨‹åºã€‚äº‹ä»¶å¤„ç†ç¨‹åºæä¾›äº†ä¸€ç»„æ¥å£ï¼Œæ¯ä¸ªæ¥å£å¯¹åº”äº†ä¸€ç§ç±»å‹çš„äº‹ä»¶ï¼Œä¾›Reactoråœ¨ç›¸åº”çš„äº‹ä»¶å‘ç”Ÿæ—¶è°ƒç”¨ï¼Œæ‰§è¡Œç›¸åº”çš„äº‹ä»¶å¤„ç†ã€‚é€šå¸¸å®ƒä¼šç»‘å®šä¸€ä¸ªæœ‰æ•ˆçš„å¥æŸ„ã€‚&lt;/p>
&lt;p>ä½¿ç”¨Reactoræ¨¡å¼åï¼Œäº‹ä»¶æ§åˆ¶æµæ˜¯ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿå¯ä»¥å‚è§ä¸‹é¢çš„åºåˆ—å›¾ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/rust_async_reactor.webp"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>æˆ‘ä»¬åˆ†åˆ«ä»¥è¯»æ“ä½œå’Œå†™æ“ä½œä¸ºä¾‹æ¥çœ‹çœ‹Reactorä¸­çš„å…·ä½“æ­¥éª¤ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>åº”ç”¨ç¨‹åºæ³¨å†Œè¯»å°±ç»ªäº‹ä»¶å’Œç›¸å…³è”çš„äº‹ä»¶å¤„ç†å™¨ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>äº‹ä»¶åˆ†ç¦»å™¨ç­‰å¾…äº‹ä»¶çš„å‘ç”Ÿï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å½“å‘ç”Ÿè¯»å°±ç»ªäº‹ä»¶çš„æ—¶å€™ï¼Œäº‹ä»¶åˆ†ç¦»å™¨è°ƒç”¨ç¬¬ä¸€æ­¥æ³¨å†Œçš„äº‹ä»¶å¤„ç†å™¨ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>äº‹ä»¶å¤„ç†å™¨é¦–å…ˆæ‰§è¡Œå®é™…çš„è¯»å–æ“ä½œï¼Œç„¶åæ ¹æ®è¯»å–åˆ°çš„å†…å®¹è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>å†™å…¥æ“ä½œç±»ä¼¼äºè¯»å–æ“ä½œï¼Œåªä¸è¿‡ç¬¬ä¸€æ­¥æ³¨å†Œçš„æ˜¯å†™å°±ç»ªäº‹ä»¶ã€‚&lt;/p>
&lt;p>&lt;strong>Proactor&lt;/strong>&lt;/p>
&lt;p>æˆ‘ä»¬æ¥çœ‹çœ‹Proactoræ¨¡å¼ä¸­è¯»å–æ“ä½œå’Œå†™å…¥æ“ä½œçš„è¿‡ç¨‹ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>åº”ç”¨ç¨‹åºåˆå§‹åŒ–ä¸€ä¸ªå¼‚æ­¥è¯»å–æ“ä½œï¼Œç„¶åæ³¨å†Œç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ï¼Œæ­¤æ—¶äº‹ä»¶å¤„ç†å™¨ä¸å…³æ³¨è¯»å–å°±ç»ªäº‹ä»¶ï¼Œè€Œæ˜¯å…³æ³¨è¯»å–å®Œæˆäº‹ä»¶ï¼Œè¿™æ˜¯åŒºåˆ«äºReactorçš„å…³é”®ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>äº‹ä»¶åˆ†ç¦»å™¨ç­‰å¾…è¯»å–æ“ä½œå®Œæˆäº‹ä»¶ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨äº‹ä»¶åˆ†ç¦»å™¨ç­‰å¾…è¯»å–æ“ä½œå®Œæˆçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿè°ƒç”¨å†…æ ¸çº¿ç¨‹å®Œæˆè¯»å–æ“ä½œï¼ˆå¼‚æ­¥I/Oéƒ½æ˜¯æ“ä½œç³»ç»Ÿè´Ÿè´£å°†æ•°æ®è¯»å†™åˆ°åº”ç”¨ä¼ é€’è¿›æ¥çš„ç¼“å†²åŒºä¾›åº”ç”¨ç¨‹åºæ“ä½œï¼‰ï¼Œå¹¶å°†è¯»å–çš„å†…å®¹æ”¾å…¥ç”¨æˆ·ä¼ é€’è¿‡æ¥çš„ç¼“å­˜åŒºä¸­ã€‚è¿™ä¹Ÿæ˜¯åŒºåˆ«äºReactorçš„ä¸€ç‚¹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>äº‹ä»¶åˆ†ç¦»å™¨æ•è·åˆ°è¯»å–å®Œæˆäº‹ä»¶åï¼Œæ¿€æ´»åº”ç”¨ç¨‹åºæ³¨å†Œçš„äº‹ä»¶å¤„ç†å™¨ï¼Œäº‹ä»¶å¤„ç†å™¨ç›´æ¥ä»ç¼“å­˜åŒºè¯»å–æ•°æ®ï¼Œè€Œä¸éœ€è¦è¿›è¡Œå®é™…çš„è¯»å–æ“ä½œã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>Proactorä¸­å†™å…¥æ“ä½œå’Œè¯»å–æ“ä½œï¼Œåªä¸è¿‡æ„Ÿå…´è¶£çš„äº‹ä»¶æ˜¯å†™å…¥å®Œæˆäº‹ä»¶ã€‚&lt;/p>
&lt;p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼ŒReactorå’ŒProactoræ¨¡å¼çš„ä¸»è¦åŒºåˆ«å°±æ˜¯çœŸæ­£çš„è¯»å–å’Œå†™å…¥æ“ä½œæ˜¯ç”±è°æ¥å®Œæˆçš„ï¼ŒReactorä¸­éœ€è¦åº”ç”¨ç¨‹åºè‡ªå·±è¯»å–æˆ–è€…å†™å…¥æ•°æ®ï¼Œè€ŒProactoræ¨¡å¼ä¸­ï¼Œåº”ç”¨ç¨‹åºä¸éœ€è¦è¿›è¡Œå®é™…çš„è¯»å†™è¿‡ç¨‹ï¼Œå®ƒåªéœ€è¦ä»ç¼“å­˜åŒºè¯»å–æˆ–è€…å†™å…¥å³å¯ï¼Œæ“ä½œç³»ç»Ÿä¼šè¯»å–ç¼“å­˜åŒºæˆ–è€…å†™å…¥ç¼“å­˜åŒºåˆ°çœŸæ­£çš„I/Oè®¾å¤‡ã€‚&lt;/p>
&lt;h2 id="epollä»£ç å®è·µ">epollä»£ç å®è·µ
&lt;/h2>&lt;p>å‚è§&lt;a class="link" href="https://github.com/zupzup/rust-epoll-example/blob/main/src/main.rs" target="_blank" rel="noopener"
>rust-epoll-example&lt;/a>ã€‚&lt;/p>
&lt;h2 id="reactorä»£ç å®è·µ">Reactorä»£ç å®è·µ
&lt;/h2>&lt;p>å‚è§&lt;a class="link" href="https://github.com/zupzup/rust-reactor-executor-example" target="_blank" rel="noopener"
>rust-reactore-executor-example&lt;/a>ã€‚&lt;/p>
&lt;h2 id="minimioä»£ç å®è·µ">MiniMioä»£ç å®è·µ
&lt;/h2>&lt;p>epollåªæ”¯æŒåœ¨Linuxç³»ç»Ÿä¸‹ä½¿ç”¨ï¼Œè€Œ&lt;a class="link" href="https://github.com/cfsamson/examples-minimio" target="_blank" rel="noopener"
>minimio&lt;/a>å®ç°äº†è·¨å¹³å°ã€‚&lt;/p>
&lt;p>ä¼šå°†å„ä¸ªå¹³å°çš„å‘½ä»¤æ‹¿å‡ºæ¥ã€‚æ¯”å¦‚Selectoråšäº†æŠ½è±¡ï¼Œæ¯ä¸ªå¹³å°å®é™…ä¸Šä¸åŒã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[cfg(target_os = &lt;/span>&lt;span class="s">&amp;#34;windows&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">mod&lt;/span> &lt;span class="nn">windows&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[cfg(target_os = &lt;/span>&lt;span class="s">&amp;#34;windows&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">windows&lt;/span>::&lt;span class="p">{&lt;/span>&lt;span class="n">Event&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Registrator&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Selector&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TcpStream&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[cfg(target_os = &lt;/span>&lt;span class="s">&amp;#34;macos&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">mod&lt;/span> &lt;span class="nn">macos&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[cfg(target_os = &lt;/span>&lt;span class="s">&amp;#34;macos&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">macos&lt;/span>::&lt;span class="p">{&lt;/span>&lt;span class="n">Event&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Registrator&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Selector&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TcpStream&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[cfg(target_os = &lt;/span>&lt;span class="s">&amp;#34;linux&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">mod&lt;/span> &lt;span class="nn">linux&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[cfg(target_os = &lt;/span>&lt;span class="s">&amp;#34;linux&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">linux&lt;/span>::&lt;span class="p">{&lt;/span>&lt;span class="n">Event&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Registrator&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Selector&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TcpStream&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨lib.rsä¸­æŠ½è±¡å‡ºè·¨å¹³å°çš„ç»“æ„Pollã€‚ä»£è¡¨äº‹ä»¶é˜Ÿåˆ—ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[derive(Debug)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Poll&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">registry&lt;/span>: &lt;span class="nc">Registry&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">is_poll_dead&lt;/span>: &lt;span class="nc">Arc&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">AtomicBool&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Pollæœ‰ä¸€ä¸ªè½®è¯¢æ–¹æ³•pollã€‚åœ¨å®é™…è°ƒç”¨æ—¶å·²ç»å®ç°äº†è·¨å¹³å°ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">poll&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">events&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Events&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">timeout_ms&lt;/span>: &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">i32&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">io&lt;/span>::&lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">usize&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="mioä»£ç å®è·µ">Mioä»£ç å®è·µ
&lt;/h2>&lt;p>ç”Ÿäº§ç¯å¢ƒä¸­çš„å¤šè·¯å¤ç”¨è·¨å¹³å°ä»£ç &lt;a class="link" href="https://github.com/tokio-rs/mio" target="_blank" rel="noopener"
>mio&lt;/a>ã€‚&lt;/p>
&lt;p>å…¶ä¸­æŠ½è±¡å‡ºäº†&lt;a class="link" href="https://docs.rs/mio/0.8.4/mio/struct.Poll.html" target="_blank" rel="noopener"
>Poll&lt;/a>ç»“æ„ä½“ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Poll&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">registry&lt;/span>: &lt;span class="nc">Registry&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™é‡Œç”¨åˆ°äº†è®¾è®¡æ¨¡å¼â€”â€”å¤–è§‚æ¨¡å¼ï¼Œå¤–è§‚æ¨¡å¼ç›¸å…³çŸ¥è¯†è§&lt;a class="link" href="https://www.runoob.com/design-pattern/facade-pattern.html" target="_blank" rel="noopener"
>è¿™é‡Œ&lt;/a>ã€‚&lt;/p>
&lt;p>å¤–è§‚æ¨¡å¼ï¼ˆFacade Patternï¼‰éšè—ç³»ç»Ÿçš„å¤æ‚æ€§ï¼Œå¹¶å‘å®¢æˆ·ç«¯æä¾›äº†ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥è®¿é—®ç³»ç»Ÿçš„æ¥å£ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºç»“æ„å‹æ¨¡å¼ï¼Œå®ƒå‘ç°æœ‰çš„ç³»ç»Ÿæ·»åŠ ä¸€ä¸ªæ¥å£ï¼Œæ¥éšè—ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚&lt;/p>
&lt;p>è¿™ç§æ¨¡å¼æ¶‰åŠåˆ°ä¸€ä¸ªå•ä¸€çš„ç±»ï¼Œè¯¥ç±»æä¾›äº†å®¢æˆ·ç«¯è¯·æ±‚çš„ç®€åŒ–æ–¹æ³•å’Œå¯¹ç°æœ‰ç³»ç»Ÿç±»æ–¹æ³•çš„å§”æ‰˜è°ƒç”¨ã€‚&lt;/p>
&lt;h2 id="å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹æ¦‚è¦">å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹æ¦‚è¦
&lt;/h2>&lt;p>è®©æˆ‘ä»¬å…ˆä»å»ºç«‹å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹çš„æ•´ä½“æ¦‚å¿µæ¡†æ¶å¼€å§‹ï¼Œå…ˆä¸æ·±å…¥ç»†èŠ‚ã€‚&lt;/p>
&lt;p>&lt;strong>Rust æä¾›çš„å¼‚æ­¥å¹¶å‘ç›¸æ¯”äºå…¶ä»–è¯­è¨€æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>Rust è¯­è¨€åªæ˜¯æä¾›ä¸€ä¸ªé›¶æˆæœ¬çš„å¼‚æ­¥ç¼–ç¨‹æŠ½è±¡ï¼Œè€Œä¸å†…ç½®è¿è¡Œæ—¶ã€‚&lt;/li>
&lt;li>åŸºäº Generator å®ç°çš„ Futureï¼Œåœ¨ Future åŸºç¡€ä¸Š æä¾› async/await è¯­æ³•ç³–ã€‚æœ¬è´¨æ˜¯ä¸€ä¸ªçŠ¶æ€æœºã€‚&lt;/li>
&lt;/ol>
&lt;p>æŸ¥çœ‹ README å’Œå…¶ä»–ç¼–ç¨‹è¯­è¨€æ¯”è¾ƒçš„å›¾ç¤ºã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/node_async.png"
loading="lazy"
alt="node"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/go_async.png"
loading="lazy"
alt="go"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/rust_async_01.png"
loading="lazy"
alt="rust"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/async_01.png"
loading="lazy"
alt="rustasync"
>&lt;/p>
&lt;p>&lt;strong>ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ï¼Ÿ&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>å¯¹æè‡´æ€§èƒ½çš„è¿½æ±‚ã€‚&lt;/li>
&lt;li>å¯¹ç¼–ç¨‹ä½“éªŒçš„è¿½æ±‚ã€‚&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹å‘å±•é˜¶æ®µï¼š&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>Callback&lt;/li>
&lt;li>Promise/Future&lt;/li>
&lt;li>async/await&lt;/li>
&lt;/ol>
&lt;p>å¯åœ¨é¡¹ç›® README æŸ¥çœ‹å›è°ƒåœ°ç‹±ç¤ºä¾‹å›¾ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/callback-hell.gif"
loading="lazy"
alt="callback_hell"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| +-------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | Bv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+------+ +-----+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | do1 |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | +-----+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | do2 |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | +-+---+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| A | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+------+ |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | &amp;lt;----------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+------+
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ—©æœŸ Rust å¼‚æ­¥å†™æ³•ç¤ºæ„ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">future&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id_rpc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">my_server&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">and_then&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">get_row&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}).&lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">json&lt;/span>::&lt;span class="n">encode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}).&lt;/span>&lt;span class="n">and_then&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">encoded&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">write_string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">my_socket&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">encoded&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™æ ·å†™ä¼šå­˜åœ¨å¤§é‡å†…åµŒ Futureï¼Œå¼€å‘ä½“éªŒä¸å¥½ã€‚&lt;/p>
&lt;p>å¼•å…¥ async/await ä¹‹åï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id_rpc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">my_server&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="k">await&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">get_row&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="k">await&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">encoded&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">json&lt;/span>::&lt;span class="n">encode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">write_string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">my_socket&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">encoded&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="k">await&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ‹¥æœ‰äº†å’ŒåŒæ­¥ä»£ç ä¸€è‡´çš„ä½“éªŒã€‚&lt;/p>
&lt;p>&lt;strong>å¼‚æ­¥ä»»åŠ¡å¯çœ‹ä½œæ˜¯ä¸€ç§ç»¿è‰²çº¿ç¨‹&lt;/strong>&lt;/p>
&lt;p>æŸ¥çœ‹ README ç›¸å…³å›¾ç¤º&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/process_thread_coroutine.png"
loading="lazy"
alt="process"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/swap_problem.jpg"
loading="lazy"
alt="process"
>&lt;/p>
&lt;p>å¯ä»¥è¯´ï¼Œå¼‚æ­¥ä»»åŠ¡çš„è¡Œä¸ºæ˜¯æ¨¡ä»¿ çº¿ç¨‹ æ¥æŠ½è±¡ã€‚&lt;/p>
&lt;ol>
&lt;li>çº¿ç¨‹åœ¨è¿›ç¨‹å†…ï¼Œå¼‚æ­¥ä»»åŠ¡åœ¨çº¿ç¨‹å†…ã€‚&lt;/li>
&lt;li>çº¿ç¨‹å¯è¢«è°ƒåº¦åˆ‡æ¢ï¼ˆLinuxé»˜è®¤æŠ¢å å¼ï¼‰ï¼Œå¼‚æ­¥ä»»åŠ¡ä¹Ÿå¯ä»¥è¢«è°ƒåº¦ï¼ˆåä½œå¼è€ŒéæŠ¢å å¼ï¼‰ã€‚åŒºåˆ«åœ¨äºï¼Œå¼‚æ­¥ä»»åŠ¡åªåœ¨ç”¨æˆ·æ€ï¼Œæ²¡æœ‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ã€‚&lt;/li>
&lt;li>çº¿ç¨‹æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¼‚æ­¥ä»»åŠ¡ä¹Ÿæœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚&lt;/li>
&lt;li>çº¿ç¨‹é—´å¯ä»¥é€šä¿¡ï¼Œå¼‚æ­¥ä»»åŠ¡ä¹‹é—´ä¹Ÿå¯ä»¥é€šä¿¡ã€‚&lt;/li>
&lt;li>çº¿ç¨‹é—´æœ‰ç«äº‰ï¼Œå¼‚æ­¥ä»»åŠ¡ä¹‹é—´ä¹Ÿæœ‰ç«äº‰ã€‚&lt;/li>
&lt;/ol>
&lt;p>æ•´ä¸ªå¼‚æ­¥ç¼–ç¨‹æ¦‚å¿µï¼ŒåŒ…æ‹¬å¼‚æ­¥è¯­æ³•ã€å¼‚æ­¥è¿è¡Œæ—¶éƒ½æ˜¯å›´ç»•å¦‚ä½•å»ºç«‹è¿™ç§ã€Œç»¿è‰²çº¿ç¨‹ã€æŠ½è±¡è€Œæˆçš„ã€‚&lt;/p>
&lt;p>ä»€ä¹ˆæ˜¯&lt;a class="link" href="https://zh.m.wikipedia.org/zh-hans/%E7%BB%BF%E8%89%B2%E7%BA%BF%E7%A8%8B" target="_blank" rel="noopener"
>ç»¿è‰²çº¿ç¨‹&lt;/a>ï¼Ÿ&lt;/p>
&lt;blockquote>
&lt;p>åœ¨è®¡ç®—æœºç¨‹åºè®¾è®¡ä¸­ï¼Œ&lt;strong>ç»¿è‰²çº¿ç¨‹&lt;/strong>æ˜¯ä¸€ç§ç”±&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e8%bf%90%e8%a1%8c%e6%97%b6%e7%b3%bb%e7%bb%9f" target="_blank" rel="noopener"
>è¿è¡Œç¯å¢ƒ&lt;/a>æˆ–&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e8%99%9b%e6%93%ac%e6%a9%9f%e5%99%a8" target="_blank" rel="noopener"
>è™šæ‹Ÿæœº&lt;/a>è°ƒåº¦ï¼Œè€Œä¸æ˜¯ç”±æœ¬åœ°åº•å±‚æ“ä½œç³»ç»Ÿè°ƒåº¦çš„çº¿ç¨‹ã€‚ç»¿è‰²çº¿ç¨‹å¹¶ä¸ä¾èµ–åº•å±‚çš„ç³»ç»ŸåŠŸèƒ½ï¼Œæ¨¡æ‹Ÿå®ç°äº†å¤šçº¿ç¨‹çš„è¿è¡Œï¼Œè¿™ç§çº¿ç¨‹çš„ç®¡ç†è°ƒé…å‘ç”Ÿåœ¨ç”¨æˆ·ç©ºé—´è€Œä¸æ˜¯å†…æ ¸ç©ºé—´ï¼Œæ‰€ä»¥å®ƒä»¬å¯ä»¥åœ¨æ²¡æœ‰åŸç”Ÿçº¿ç¨‹æ”¯æŒçš„ç¯å¢ƒä¸­å·¥ä½œã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="futureå’Œfutures-rsä»‹ç»">Futureå’ŒFutures-rsä»‹ç»
&lt;/h2>&lt;p>&lt;a class="link" href="https://doc.rust-lang.org/std/future/index.html" target="_blank" rel="noopener"
>Future&lt;/a>ï¼šæä¾›äº†å¼‚æ­¥è®¡ç®—ã€‚&lt;/p>
&lt;p>Future traitï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Future&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Output&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">poll&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>: &lt;span class="nc">Pin&lt;/span>&lt;span class="o">&amp;lt;&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cx&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Context&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">&amp;#39;_&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Poll&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Output&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å…¶ä¸­pollæ–¹æ³•å¾ˆé‡è¦ï¼Œå°è¯•å»å°†futureå¾—åˆ°ä¸€ä¸ªæœ€ç»ˆçš„å€¼ã€‚å¦‚æœæœ€ç»ˆçš„å€¼æ²¡æœ‰å‡†å¤‡å¥½ï¼Œä¹Ÿä¸ä¼šè¿›è¡Œé˜»å¡ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://doc.rust-lang.org/std/task/index.html" target="_blank" rel="noopener"
>task&lt;/a>ï¼šå¯ä»¥ç†è§£ä¸ºåˆ›å»ºç»¿è‰²çº¿ç¨‹ã€‚&lt;/p>
&lt;p>å…¶ä¸­é‡è¦çš„æ˜¯Enum &lt;a class="link" href="https://doc.rust-lang.org/std/index.html" target="_blank" rel="noopener"
>std&lt;/a>::&lt;a class="link" href="https://doc.rust-lang.org/std/task/index.html" target="_blank" rel="noopener"
>task&lt;/a>::&lt;a class="link" href="https://doc.rust-lang.org/std/task/enum.Poll.html#" target="_blank" rel="noopener"
>Poll&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">enum&lt;/span> &lt;span class="nc">Poll&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Ready&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Pending&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;a class="link" href="https://github.com/rust-lang/futures-rs" target="_blank" rel="noopener"
>futures-rs&lt;/a>ï¼šå¯¹futureåšäº†æ‰©å±•ã€‚&lt;/p>
&lt;h2 id="ç¼–å†™å¼‚æ­¥echoæœåŠ¡">ç¼–å†™å¼‚æ­¥echoæœåŠ¡
&lt;/h2>&lt;p>ä»€ä¹ˆæ˜¯&lt;a class="link" href="https://zh.m.wikipedia.org/zh-hans/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6" target="_blank" rel="noopener"
>æ–‡ä»¶æè¿°ç¬¦&lt;/a>ï¼Ÿ&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>æ–‡ä»¶æè¿°ç¬¦&lt;/strong>ï¼ˆFile descriptorï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­çš„ä¸€ä¸ªæœ¯è¯­ï¼Œæ˜¯ä¸€ä¸ªç”¨äºè¡¨è¿°æŒ‡å‘&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e6%96%87%e4%bb%b6" target="_blank" rel="noopener"
>æ–‡ä»¶&lt;/a>çš„å¼•ç”¨çš„æŠ½è±¡åŒ–æ¦‚å¿µã€‚&lt;/p>
&lt;p>æ–‡ä»¶æè¿°ç¬¦åœ¨å½¢å¼ä¸Šæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚å®é™…ä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ªç´¢å¼•å€¼ï¼ŒæŒ‡å‘&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e5%86%85%e6%a0%b8" target="_blank" rel="noopener"
>å†…æ ¸&lt;/a>ä¸ºæ¯ä¸€ä¸ª&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e8%bf%9b%e7%a8%8b" target="_blank" rel="noopener"
>è¿›ç¨‹&lt;/a>æ‰€ç»´æŠ¤çš„è¯¥è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„è®°å½•è¡¨ã€‚å½“ç¨‹åºæ‰“å¼€ä¸€ä¸ªç°æœ‰æ–‡ä»¶æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚åœ¨&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e7%a8%8b%e5%ba%8f%e8%ae%be%e8%ae%a1" target="_blank" rel="noopener"
>ç¨‹åºè®¾è®¡&lt;/a>ä¸­ï¼Œä¸€äº›æ¶‰åŠåº•å±‚çš„ç¨‹åºç¼–å†™å¾€å¾€ä¼šå›´ç»•ç€æ–‡ä»¶æè¿°ç¬¦å±•å¼€ã€‚ä½†æ˜¯æ–‡ä»¶æè¿°ç¬¦è¿™ä¸€æ¦‚å¿µå¾€å¾€åªé€‚ç”¨äº&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/UNIX" target="_blank" rel="noopener"
>UNIX&lt;/a>ã€&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/Linux" target="_blank" rel="noopener"
>Linux&lt;/a>è¿™æ ·çš„æ“ä½œç³»ç»Ÿã€‚&lt;/p>
&lt;/blockquote>
&lt;p>ä»£ç è§&lt;a class="link" href="https://github.com/ZhangHanDong/inviting-rust/tree/master/async-echo-server" target="_blank" rel="noopener"
>async-echo-server&lt;/a>ã€‚&lt;/p>
&lt;p>æµç¨‹å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/image-20220816104218814.png"
loading="lazy"
alt="image-20220816104218814"
>&lt;/p>
&lt;p>å…ˆçœ‹çœ‹æ–‡ä»¶çš„ç»“æ„ï¼š&lt;/p>
&lt;ul>
&lt;li>main&lt;/li>
&lt;li>epoll&lt;/li>
&lt;li>tcp_listener&lt;/li>
&lt;li>executor&lt;/li>
&lt;li>reactor&lt;/li>
&lt;li>util&lt;/li>
&lt;/ul>
&lt;p>tcp_listener:&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/image-20220816104414073.png"
loading="lazy"
alt="image-20220816104414073"
>&lt;/p>
&lt;p>è¿™é‡Œä¸»è¦æ˜¯å‡ ä¸ªå¼‚æ­¥è®¡ç®—çš„å®ç°ï¼Œä¹Ÿå°±æ˜¯AccpectFutureã€ReadFutureã€WriteFutureã€‚&lt;/p>
&lt;p>epollï¼šLinuxä¸‹epollçš„å°è£…ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/image-20220816104808295.png"
loading="lazy"
alt="image-20220816104808295"
>&lt;/p>
&lt;p>ä¸»è¦å°±æ˜¯è°ƒç”¨ç³»ç»Ÿè°ƒç”¨ï¼Œé‡è¦çš„æ˜¯epollçš„ä¸‰ä¸ªæ–¹æ³•epoll_createã€epoll_ctlã€epoll_waitã€‚&lt;/p>
&lt;p>executorï¼šæ‰§è¡Œå™¨ï¼Œæ€æ ·è°ƒåº¦è¿™äº›ç»¿è‰²çº¿ç¨‹ï¼Œå¦‚ä½•æ‰§è¡Œä»»åŠ¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/image-20220816105016908.png"
loading="lazy"
alt="image-20220816105016908"
>&lt;/p>
&lt;p>reactorï¼šæ·»åŠ äº‹ä»¶ï¼Œæ£€æµ‹åˆ°äº‹ä»¶åå”¤é†’äº‹ä»¶ï¼Œè®©æ‰§è¡Œå™¨å»æ‰§è¡Œã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-07-Rust-async/image-20220816105146577.png"
loading="lazy"
alt="image-20220816105146577"
>&lt;/p>
&lt;h2 id="æ·±å…¥ç†è§£å¼‚æ­¥taskæ¨¡å‹">æ·±å…¥ç†è§£å¼‚æ­¥Taskæ¨¡å‹
&lt;/h2>&lt;p>å›é¡¾ Rust å¼‚æ­¥ task æ¨¡å‹&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl"> +------------------------------------------------------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +--------------------------------------------------------+ |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | +-------------------------------------------------+ | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | |-------------+ +----------+ +--------------+ | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | || futureobj | | futureobj| | futureobj | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | +-------------+ +----------+ +--------------+ | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | | å ç¨‹ task | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | +-------------------------------------------------+ | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | çº¿ ç¨‹ | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +--------------------------------------------------------+ |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +--------------------------------------------------------+ |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | +--------------------------------------------------+ | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | | +------------+ +-------------------------------+ | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | | | futureobj | | futureobj || futureobj || | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | | +------------+ +-------------------------------+ | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | | å ç¨‹ task | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | +--------------------------------------------------+ | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | çº¿ ç¨‹ | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +--------------------------------------------------------+ |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | è¿› ç¨‹ |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +------------------------------------------------------------------+
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä»€ä¹ˆæ˜¯&lt;a class="link" href="https://zh.m.wikipedia.org/zh-hans/%E5%8D%8F%E7%A8%8B" target="_blank" rel="noopener"
>åç¨‹&lt;/a>ï¼Ÿ&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>åç¨‹&lt;/strong>ï¼ˆè‹±è¯­ï¼šcoroutineï¼‰æ˜¯è®¡ç®—æœºç¨‹åºçš„ä¸€ç±»ç»„ä»¶ï¼Œæ¨å¹¿äº†&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e5%8d%8f%e4%bd%9c%e5%bc%8f%e5%a4%9a%e4%bb%bb%e5%8a%a1" target="_blank" rel="noopener"
>åä½œå¼å¤šä»»åŠ¡&lt;/a>çš„&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e5%ad%90%e4%be%8b%e7%a8%8b" target="_blank" rel="noopener"
>å­ä¾‹ç¨‹&lt;/a>ï¼Œå…è®¸æ‰§è¡Œè¢«æŒ‚èµ·ä¸è¢«æ¢å¤ã€‚ç›¸å¯¹å­ä¾‹ç¨‹è€Œè¨€ï¼Œåç¨‹æ›´ä¸ºä¸€èˆ¬å’Œçµæ´»ï¼Œä½†åœ¨å®è·µä¸­ä½¿ç”¨æ²¡æœ‰å­ä¾‹ç¨‹é‚£æ ·å¹¿æ³›ã€‚åç¨‹æ›´é€‚åˆäºç”¨æ¥å®ç°å½¼æ­¤ç†Ÿæ‚‰çš„ç¨‹åºç»„ä»¶ï¼Œå¦‚&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e5%8d%8f%e4%bd%9c%e5%bc%8f%e5%a4%9a%e4%bb%bb%e5%8a%a1" target="_blank" rel="noopener"
>åä½œå¼å¤šä»»åŠ¡&lt;/a>ã€&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86" target="_blank" rel="noopener"
>å¼‚å¸¸å¤„ç†&lt;/a>ã€&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e4%ba%8b%e4%bb%b6%e5%be%aa%e7%8e%af" target="_blank" rel="noopener"
>äº‹ä»¶å¾ªç¯&lt;/a>ã€&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e8%bf%ad%e4%bb%a3%e5%99%a8" target="_blank" rel="noopener"
>è¿­ä»£å™¨&lt;/a>ã€&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e6%83%b0%e6%80%a7%e6%b1%82%e5%80%bc" target="_blank" rel="noopener"
>æ— é™åˆ—è¡¨&lt;/a>å’Œ&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e7%ae%a1%e9%81%93_%28%e8%bd%af%e4%bb%b6%29" target="_blank" rel="noopener"
>ç®¡é“&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>åŒçº¿ç¨‹çš„æ¯”è¾ƒ&lt;/p>
&lt;blockquote>
&lt;p>åç¨‹éå¸¸ç±»ä¼¼äº&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e7%ba%bf%e7%a8%8b" target="_blank" rel="noopener"
>çº¿ç¨‹&lt;/a>ã€‚ä½†æ˜¯åç¨‹æ˜¯&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e5%8d%8f%e4%bd%9c%e5%bc%8f%e5%a4%9a%e4%bb%bb%e5%8a%a1" target="_blank" rel="noopener"
>åä½œå¼&lt;/a>å¤šä»»åŠ¡çš„ï¼Œè€Œçº¿ç¨‹å…¸å‹æ˜¯&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e6%8a%a2%e5%8d%a0%e5%bc%8f%e5%a4%9a%e4%bb%bb%e5%8a%a1" target="_blank" rel="noopener"
>æŠ¢å å¼&lt;/a>&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e5%a4%9a%e4%bb%bb%e5%8a%a1" target="_blank" rel="noopener"
>å¤šä»»åŠ¡&lt;/a>çš„ã€‚è¿™æ„å‘³ç€åç¨‹æä¾›&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e5%b9%b6%e5%8f%91%e6%80%a7" target="_blank" rel="noopener"
>å¹¶å‘æ€§&lt;/a>è€Œé&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e5%b9%b6%e8%a1%8c%e8%ae%a1%e7%ae%97" target="_blank" rel="noopener"
>å¹¶è¡Œæ€§&lt;/a>ã€‚åç¨‹è¶…è¿‡çº¿ç¨‹çš„å¥½å¤„æ˜¯å®ƒä»¬å¯ä»¥ç”¨äº&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e5%ae%9e%e6%97%b6%e8%ae%a1%e7%ae%97" target="_blank" rel="noopener"
>ç¡¬æ€§å®æ—¶&lt;/a>çš„è¯­å¢ƒï¼ˆåœ¨åç¨‹ä¹‹é—´çš„&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e4%b8%8a%e4%b8%8b%e6%96%87%e5%88%87%e6%8d%a2" target="_blank" rel="noopener"
>åˆ‡æ¢&lt;/a>ä¸éœ€è¦æ¶‰åŠä»»ä½•&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e7%b3%bb%e7%bb%9f%e8%b0%83%e7%94%a8" target="_blank" rel="noopener"
>ç³»ç»Ÿè°ƒç”¨&lt;/a>æˆ–ä»»ä½•&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e9%98%bb%e5%a1%9e_%28%e8%ae%a1%e7%ae%97%29" target="_blank" rel="noopener"
>é˜»å¡&lt;/a>è°ƒç”¨ï¼‰ï¼Œè¿™é‡Œä¸éœ€è¦ç”¨æ¥å®ˆå«&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e5%85%b3%e9%94%ae%e5%8c%ba%e6%ae%b5" target="_blank" rel="noopener"
>å…³é”®åŒºæ®µ&lt;/a>çš„åŒæ­¥æ€§åŸè¯­ï¼ˆprimitiveï¼‰æ¯”å¦‚&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e4%ba%92%e6%96%a5%e9%94%81" target="_blank" rel="noopener"
>äº’æ–¥é”&lt;/a>ã€ä¿¡å·é‡ç­‰ï¼Œå¹¶ä¸”ä¸éœ€è¦æ¥è‡ªæ“ä½œç³»ç»Ÿçš„æ”¯æŒã€‚æœ‰å¯èƒ½ä»¥ä¸€ç§å¯¹è°ƒç”¨ä»£ç é€æ˜çš„æ–¹å¼ï¼Œä½¿ç”¨æŠ¢å å¼è°ƒåº¦çš„çº¿ç¨‹å®ç°åç¨‹ï¼Œä½†æ˜¯ä¼šå¤±å»æŸäº›åˆ©ç›Šï¼ˆç‰¹åˆ«æ˜¯å¯¹ç¡¬æ€§å®æ—¶æ“ä½œçš„é€‚åˆæ€§å’Œç›¸å¯¹å»‰ä»·çš„ç›¸äº’ä¹‹é—´åˆ‡æ¢ï¼‰ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e7%ba%bf%e7%a8%8b" target="_blank" rel="noopener"
>çº¿ç¨‹&lt;/a>æ˜¯&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e5%8d%8f%e4%bd%9c%e5%bc%8f%e5%a4%9a%e4%bb%bb%e5%8a%a1" target="_blank" rel="noopener"
>åä½œå¼&lt;/a>å¤šä»»åŠ¡çš„è½»é‡çº§çº¿ç¨‹ï¼Œæœ¬è´¨ä¸Šæè¿°äº†åŒåç¨‹ä¸€æ ·çš„æ¦‚å¿µã€‚å…¶åŒºåˆ«ï¼Œå¦‚æœä¸€å®šè¦è¯´æœ‰çš„è¯ï¼Œæ˜¯åç¨‹æ˜¯è¯­è¨€å±‚çº§çš„æ„é€ ï¼Œå¯çœ‹ä½œä¸€ç§å½¢å¼çš„&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%e6%8e%a7%e5%88%b6%e6%b5%81" target="_blank" rel="noopener"
>æ§åˆ¶æµ&lt;/a>ï¼Œè€Œçº¿ç¨‹æ˜¯ç³»ç»Ÿå±‚çº§çš„æ„é€ ï¼Œå¯çœ‹ä½œæ°å·§æ²¡æœ‰å¹¶è¡Œè¿è¡Œçš„çº¿ç¨‹ã€‚è¿™ä¸¤ä¸ªæ¦‚å¿µè°æœ‰ä¼˜å…ˆæƒæ˜¯äº‰è®®æ€§çš„ï¼šçº¿ç¨‹å¯çœ‹ä½œä¸ºåç¨‹çš„ä¸€ç§å®ç°[&lt;a class="link" href="https://zh.m.wikipedia.org/zh-hans/%e5%8d%8f%e7%a8%8b#cite_note-flounder-6" target="_blank" rel="noopener"
>6]&lt;/a>ï¼Œä¹Ÿå¯çœ‹ä½œå®ç°åç¨‹çš„åŸºåº•[&lt;a class="link" href="https://zh.m.wikipedia.org/zh-hans/%e5%8d%8f%e7%a8%8b#cite_note-msdn-wrap-7" target="_blank" rel="noopener"
>7]&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;ol>
&lt;li>ç†è§£ leaf-futures vs Non-leaf-futures (async/await)
&lt;ul>
&lt;li>å¶å­futuresï¼šåƒä»£ç ç¤ºä¾‹ä¸­çš„AccpectFutureã€ReadFutureã€WriteFutureï¼Œè¦å’ŒReactoræ‰“äº¤é“ï¼Œæ¯”è¾ƒåº•å±‚ã€‚&lt;/li>
&lt;li>éå¶å­futuresï¼šç”¨asyncæˆ–è€…awaitå®ç°ï¼Œä¸šåŠ¡å±‚é¢çš„ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ç†è§£ Wakerï¼š&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>å½“äº‹ä»¶æºæ³¨å†Œè¯¥Futureå°†åœ¨æŸä¸ªäº‹ä»¶ä¸Šç­‰å¾…æ—¶ï¼Œå®ƒå¿…é¡»å­˜å‚¨å”¤é†’ç¨‹åºï¼Œä»¥ä¾¿ä»¥åå¯ä»¥è°ƒç”¨å”¤é†’æ¥å¼€å§‹å”¤é†’é˜¶æ®µã€‚ ä¸ºäº†å¼•å…¥å¹¶å‘æ€§ï¼Œèƒ½å¤ŸåŒæ—¶ç­‰å¾…å¤šä¸ªäº‹ä»¶éå¸¸é‡è¦ï¼Œå› æ­¤å”¤é†’å™¨ä¸å¯èƒ½ç”±å•ä¸ªäº‹ä»¶æºå”¯ä¸€æ‹¥æœ‰ã€‚ ç»“æœï¼ŒWakerç±»å‹éœ€è¦æ˜¯å®ç° Clone çš„ã€‚&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>
&lt;p>Struct &lt;a class="link" href="https://doc.rust-lang.org/std/index.html" target="_blank" rel="noopener"
>std&lt;/a>::&lt;a class="link" href="https://doc.rust-lang.org/std/task/index.html" target="_blank" rel="noopener"
>task&lt;/a>::&lt;a class="link" href="https://doc.rust-lang.org/std/task/struct.Waker.html#" target="_blank" rel="noopener"
>Waker&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[repr(transparent)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;futures_api&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.36.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Waker&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">waker&lt;/span>: &lt;span class="nc">RawWaker&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Waker å¯ä»¥å”¤é†’ä¸€ä¸ªä»»åŠ¡ï¼Œé€šè¿‡é€šçŸ¥æ‰§è¡Œå™¨ã€‚&lt;/p>
&lt;p>Wakerå®ç°äº†ä¸€äº›traitã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;futures_api&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.36.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Unpin&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Waker&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;futures_api&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.36.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">unsafe&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Send&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Waker&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;futures_api&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.36.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">unsafe&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Sync&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Waker&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[derive(PartialEq, Debug)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;futures_api&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.36.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">RawWaker&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// A data pointer, which can be used to store arbitrary data as required
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// by the executor. This could be e.g. a type-erased pointer to an `Arc`
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// that is associated with the task.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// The value of this field gets passed to all functions that are part of
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// the vtable as the first parameter.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">data&lt;/span>: &lt;span class="o">*&lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Virtual function pointer table that customizes the behavior of this waker.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">vtable&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span> &lt;span class="nc">RawWakerVTable&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™é‡ŒRawwakeræœ‰ä¸¤ä¸ªå†…å®¹ï¼Œä¸€ä¸ªdataå¯ä»¥ä¿å­˜ä¸Šä¸‹æ–‡ï¼Œä¸€ä¸ªvtableæ˜¯è™šè¡¨ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;ol start="3">
&lt;li>ç†è§£å¹¶å‘ï¼ˆwaker å¹¶å‘ å’Œ poll å¹¶å‘ï¼‰&lt;/li>
&lt;/ol>
&lt;p>æ·±å…¥ Futures-rs:&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://doc.rust-lang.org/std/future/index.html" target="_blank" rel="noopener"
>Future&lt;/a> and &lt;a class="link" href="https://doc.rust-lang.org/std/task/index.html" target="_blank" rel="noopener"
>task&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/rust-lang/futures-rs" target="_blank" rel="noopener"
>futures-rs&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/smol-rs/futures-lite" target="_blank" rel="noopener"
>futures-lite&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="async-awaitè¯­æ³•èƒŒå">async-awaitè¯­æ³•èƒŒå
&lt;/h2>&lt;h3 id="å†å²">å†å²
&lt;/h3>&lt;p>å¤„ç†å¼‚æ­¥äº‹ä»¶çš„ä¸‰ç§æ–¹å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>Callback&lt;/li>
&lt;li>Promise/Future&lt;/li>
&lt;li>async/await&lt;/li>
&lt;/ul>
&lt;p>async/await æ˜¯ç›®å‰ä½“éªŒæœ€å¥½çš„æ–¹å¼ï¼ŒRust è¦æ”¯æŒå®ƒå¹¶ä¸å®¹æ˜“ã€‚&lt;/p>
&lt;h3 id="asyncawait-è¯­æ³•ä»‹ç»">async/await è¯­æ³•ä»‹ç»
&lt;/h3>&lt;p>å‚è€ƒï¼š&lt;a class="link" href="https://rust-lang.github.io/async-book/01_getting_started/01_chapter.html" target="_blank" rel="noopener"
>Asynchronous Programming in Rust&lt;/a>&lt;/p>
&lt;p>&lt;code>async&lt;/code> ä¸¤ç§ç”¨æ³•ï¼š&lt;code>async fn &lt;/code> å‡½æ•° å’Œ &lt;code>async {}&lt;/code> å—ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// async å‡½æ•°ï¼ŒçœŸæ­£ä¼šè¿”å› `Future&amp;lt;Output = u8&amp;gt;`ï¼Œè€Œä¸æ˜¯è¡¨é¢çœ‹ä¸Šå»çš„ `u8`
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">async&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">foo&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">u8&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// async å—ç”¨æ³•ï¼Œè¿”å› `impl Future&amp;lt;Output = u8&amp;gt;`
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">bar&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Future&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Output&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// è¿™é‡Œ `async` å—è¿”å› `impl Future&amp;lt;Output = u8&amp;gt;`
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">async&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="kt">u8&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">foo&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="k">await&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>await&lt;/code> å°†æš‚åœå½“å‰å‡½æ•°çš„æ‰§è¡Œï¼Œç›´åˆ°æ‰§è¡Œè€…å°† Future ç»“æŸä¸ºæ­¢ã€‚è¿™ä¸ºå…¶ä»– Future ä»»åŠ¡æä¾›äº†è®¡ç®—çš„æœºä¼šã€‚&lt;/p>
&lt;h2 id="ç”Ÿæˆå™¨">ç”Ÿæˆå™¨
&lt;/h2>&lt;p>Future åº•å±‚å®ç°ä¾èµ–äº ç”Ÿæˆå™¨ã€‚ &lt;code>async/await&lt;/code> å¯¹åº”åº•å±‚ç”Ÿæˆå™¨ &lt;code>resume/yield&lt;/code> ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#![feature(generators, generator_trait)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">ops&lt;/span>::&lt;span class="n">Generator&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">pin&lt;/span>::&lt;span class="n">Pin&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gen&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kr">yield&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kr">yield&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kr">yield&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// for _ in 0..4 {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// // ä¸ºäº†ç»™åµŒå…¥å¼æ”¯æŒå¼‚æ­¥ï¼Œå¤šä¼ å…¥äº†ä¸€ä¸ªç©ºçš„unitç»™resumeæ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// let c = Pin::new(&amp;amp;mut gen).resume(());
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// println!(&amp;#34;{:?}&amp;#34;, c);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Pin&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gen&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">resume&lt;/span>&lt;span class="p">(());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Pin&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gen&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">resume&lt;/span>&lt;span class="p">(());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Pin&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gen&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">resume&lt;/span>&lt;span class="p">(());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Pin&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gen&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">resume&lt;/span>&lt;span class="p">(());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç”Ÿæˆç­‰ä»·ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#![allow(unused)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#![feature(generators, generator_trait)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">ops&lt;/span>::&lt;span class="p">{&lt;/span>&lt;span class="n">Generator&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">GeneratorState&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">pin&lt;/span>::&lt;span class="n">Pin&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">enum&lt;/span> &lt;span class="nc">__Gen&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// (0) åˆå§‹çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Start&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// (1) resumeæ–¹æ³•æ‰§è¡Œä»¥å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">State1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">State1&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// (2) resumeæ–¹æ³•æ‰§è¡Œä»¥å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">State2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">State2&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// (3) resumeæ–¹æ³•æ‰§è¡Œä»¥å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">State3&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">State3&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// (4) resumeæ–¹æ³•æ‰§è¡Œä»¥åï¼Œæ­£å¥½å®Œæˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Done&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">State1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="kt">u64&lt;/span> &lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">State2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="kt">u64&lt;/span> &lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">State3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="kt">u64&lt;/span> &lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Generator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">__Gen&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Yield&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">u64&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">u64&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">resume&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>: &lt;span class="nc">Pin&lt;/span>&lt;span class="o">&amp;lt;&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>: &lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">GeneratorState&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u64&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">u64&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mut_ref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">get_mut&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">mem&lt;/span>::&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mut_ref&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">__Gen&lt;/span>::&lt;span class="n">Done&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">__Gen&lt;/span>::&lt;span class="n">Start&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">mut_ref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">__Gen&lt;/span>::&lt;span class="n">State1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">State1&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="mi">1&lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">GeneratorState&lt;/span>::&lt;span class="n">Yielded&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">__Gen&lt;/span>::&lt;span class="n">State1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">State1&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="mi">1&lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">mut_ref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">__Gen&lt;/span>::&lt;span class="n">State2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">State2&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="mi">2&lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">GeneratorState&lt;/span>::&lt;span class="n">Yielded&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">__Gen&lt;/span>::&lt;span class="n">State2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">State2&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="mi">2&lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">mut_ref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">__Gen&lt;/span>::&lt;span class="n">State3&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">State3&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="mi">3&lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">GeneratorState&lt;/span>::&lt;span class="n">Yielded&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">__Gen&lt;/span>::&lt;span class="n">State3&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">State3&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="mi">3&lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">mut_ref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">__Gen&lt;/span>::&lt;span class="n">Done&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">GeneratorState&lt;/span>::&lt;span class="n">Complete&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">panic!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;generator resumed after completion&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">(){&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gen&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">__Gen&lt;/span>::&lt;span class="n">Start&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">unsafe&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Pin&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gen&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">resume&lt;/span>&lt;span class="p">(())});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç”Ÿæˆå™¨åŸºæœ¬ç”¨æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#![allow(unused)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#![feature(generators, generator_trait)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">pin&lt;/span>::&lt;span class="n">Pin&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">ops&lt;/span>::&lt;span class="n">Generator&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">up_to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">limit&lt;/span>: &lt;span class="kt">u64&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Generator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Yield&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">u64&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">u64&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">move&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="n">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kr">yield&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">limit&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">(){&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">up_to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">unsafe&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">..=&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Pin&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">resume&lt;/span>&lt;span class="p">(());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç”Ÿæˆå™¨å˜èº«ä¸ºè¿­ä»£å™¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#![allow(unused)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#![feature(generators, generator_trait)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">pin&lt;/span>::&lt;span class="n">Pin&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">ops&lt;/span>::&lt;span class="p">{&lt;/span>&lt;span class="n">Generator&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">GeneratorState&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">up_to&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Generator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Yield&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">u64&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">move&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">loop&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kr">yield&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">(){&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gen&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">up_to&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">unsafe&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Pin&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gen&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">resume&lt;/span>&lt;span class="p">(())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">GeneratorState&lt;/span>::&lt;span class="n">Yielded&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Completed&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç”Ÿæˆå™¨å˜èº«ä¸º Future:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#![allow(unused)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#![feature(generators, generator_trait)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">ops&lt;/span>::&lt;span class="p">{&lt;/span>&lt;span class="n">Generator&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">GeneratorState&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">pin&lt;/span>::&lt;span class="n">Pin&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">up_to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">limit&lt;/span>: &lt;span class="kt">u64&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Generator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Yield&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u64&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">move&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="n">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kr">yield&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">limit&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">(){&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gen&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">up_to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">limit&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">unsafe&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">..=&lt;/span>&lt;span class="n">limit&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Pin&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gen&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">resume&lt;/span>&lt;span class="p">(())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">GeneratorState&lt;/span>::&lt;span class="n">Yielded&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;resume &lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s"> : Pending&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">GeneratorState&lt;/span>::&lt;span class="n">Complete&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;resume &lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s"> : Ready&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨æ ‡å‡†åº“Futureå†…éƒ¨ï¼Œå¯ä»¥ä»Generatorè½¬æ¢ä¸ºFutureã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[lang = &lt;/span>&lt;span class="s">&amp;#34;from_generator&amp;#34;&lt;/span>&lt;span class="cp">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[doc(hidden)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[unstable(feature = &lt;/span>&lt;span class="s">&amp;#34;gen_future&amp;#34;&lt;/span>&lt;span class="cp">, issue = &lt;/span>&lt;span class="s">&amp;#34;50547&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[rustc_const_unstable(feature = &lt;/span>&lt;span class="s">&amp;#34;gen_future&amp;#34;&lt;/span>&lt;span class="cp">, issue = &lt;/span>&lt;span class="s">&amp;#34;50547&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[inline]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">from_generator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gen&lt;/span>: &lt;span class="nc">T&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Future&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Output&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>::&lt;span class="n">Return&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nc">Generator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">ResumeTy&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Yield&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[rustc_diagnostic_item = &lt;/span>&lt;span class="s">&amp;#34;gen_future&amp;#34;&lt;/span>&lt;span class="cp">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">GenFuture&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nc">Generator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">ResumeTy&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Yield&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// We rely on the fact that async/await futures are immovable in order to create
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// self-referential borrows in the underlying generator.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nc">Generator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">ResumeTy&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Yield&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="nb">Unpin&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">GenFuture&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nc">Generator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">ResumeTy&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Yield&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Future&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">GenFuture&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Output&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>::&lt;span class="n">Return&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">poll&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>: &lt;span class="nc">Pin&lt;/span>&lt;span class="o">&amp;lt;&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cx&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Context&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">&amp;#39;_&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Poll&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Output&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// SAFETY: Safe because we&amp;#39;re !Unpin + !Drop, and this is just a field projection.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gen&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">unsafe&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Pin&lt;/span>::&lt;span class="n">map_unchecked_mut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Resume the generator, turning the `&amp;amp;mut Context` into a `NonNull` raw pointer. The
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// `.await` lowering will safely cast that back to a `&amp;amp;mut Context`.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gen&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">resume&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ResumeTy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">NonNull&lt;/span>::&lt;span class="n">from&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cx&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">cast&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Context&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">()))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">GeneratorState&lt;/span>::&lt;span class="n">Yielded&lt;/span>&lt;span class="p">(())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Poll&lt;/span>::&lt;span class="n">Pending&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">GeneratorState&lt;/span>::&lt;span class="n">Complete&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Poll&lt;/span>::&lt;span class="n">Ready&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">GenFuture&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gen&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="no-stdå¼‚æ­¥ç”Ÿæ€ä»‹ç»">no-stdå¼‚æ­¥ç”Ÿæ€ä»‹ç»
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/irrustible/futures-micro" target="_blank" rel="noopener"
>futures-micro&lt;/a> å¯¹futuresçš„æœ€å°çš„å®ç°&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/embassy-rs/embassy" target="_blank" rel="noopener"
>embassy&lt;/a> åµŒå…¥å¼ç”Ÿæ€&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/richardanaya/executor" target="_blank" rel="noopener"
>executor for no-std&lt;/a> no-stdçš„æ‰§è¡Œå™¨ï¼Œå¯ä»¥ç”¨åœ¨åµŒå…¥å¼åŠWebAssemblyä¸Š&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸€ä¸ªå¼‚æ­¥ç¼“å­˜ä»£ç å®ç°">ä¸€ä¸ªå¼‚æ­¥ç¼“å­˜ä»£ç å®ç°
&lt;/h2>&lt;p>ä»£ç è§&lt;a class="link" href="https://github.com/ChaosStudyGroup/retainer" target="_blank" rel="noopener"
>retainer&lt;/a>ã€‚&lt;/p>
&lt;p>ä¸‹é¢åˆ†æä¸‹ä»£ç ç»“æ„ï¼Œé¦–å…ˆæ˜¯ entry.rsã€‚&lt;/p>
&lt;p>ç¼“å­˜çš„entryç»“æ„ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[derive(Debug)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">CacheEntry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>: &lt;span class="nc">V&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">expiration&lt;/span>: &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">CacheExpiration&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æœ‰ç›¸åº”çš„å€¼valueä»¥åŠè¿‡æœŸæ—¶é—´expirationï¼Œè¿™é‡Œè¿‡æœŸæ—¶é—´æ˜¯ä¸€ä¸ªOptionï¼Œå› ä¸ºæœ‰çš„å¯ä»¥æ²¡æœ‰è¿‡æœŸæ—¶é—´ã€‚&lt;/p>
&lt;p>CacheExpirationï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[derive(Debug)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">CacheExpiration&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">instant&lt;/span>: &lt;span class="nc">Instant&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä»£è¡¨ç¼“å­˜ä¸­çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™é‡Œå¯¹Instantæœ‰ä¸€ä¸ªåŒ…è£…ï¼Œæ–¹ä¾¿å®ç°ä¸€äº›æ–¹æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[derive(Debug)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">CacheEntryReadGuard&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">entry&lt;/span>: &lt;span class="o">*&lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CacheEntry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">marker&lt;/span>: &lt;span class="nc">PhantomData&lt;/span>&lt;span class="o">&amp;lt;&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CacheEntry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯¹åº•å±‚ç¼“å­˜ç»“æ„çš„å¼•ç”¨çš„ä¸€ä¸ªè¯»ä¿æŠ¤ã€‚å½“ä½¿ç”¨é”çš„æ—¶å€™ï¼Œè¿™ä¸ªç»“æ„å¯ä»¥è¿”å›ä¸€ä¸ªæŒ‡å‘å†…éƒ¨ç¼“å­˜ entries çš„å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚åŒæ—¶CacheEntryReadGuardå®ç°äº†Sendå’ŒSyncã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Stores a raw pointer to `T`, so if `T` is `Sync`, the lock guard over `T` is `Send`.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">unsafe&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Send&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CacheEntryReadGuard&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">&amp;#39;_&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">V&lt;/span>: &lt;span class="nb">Sized&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Sync&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">unsafe&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Sync&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CacheEntryReadGuard&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">&amp;#39;_&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">V&lt;/span>: &lt;span class="nb">Sized&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Send&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Sync&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>cache.rs&lt;/p>
&lt;p>ç¼“å­˜ç»“æ„ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Cache&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">store&lt;/span>: &lt;span class="nc">RwLock&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">BTreeMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CacheEntry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">label&lt;/span>: &lt;span class="nb">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç›‘æ§æ˜¯å¦æœ‰è¿‡æœŸç¼“å­˜ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">async&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">monitor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sample&lt;/span>: &lt;span class="kt">usize&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">threshold&lt;/span>: &lt;span class="kt">f64&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">frequency&lt;/span>: &lt;span class="nc">Duration&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">interval&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Interval&lt;/span>::&lt;span class="n">platform_new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">frequency&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">loop&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">interval&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">as_mut&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="k">await&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">purge&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sample&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">threshold&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="k">await&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ° purge å‡½æ•°æœ€ç»ˆå®ç°å¼‚æ­¥æ¸…ç†ã€‚&lt;/p>
&lt;p>è¿™é‡Œè¯´ä¸‹Redisçš„ç¼“å­˜è¿‡æœŸå¤„ç†æ–¹å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>æƒ°æ€§åˆ é™¤ã€‚å½“æŸ¥æ‰¾ä¸€ä¸ªkeyï¼Œè¿‡æœŸæ—¶åˆ é™¤ã€‚&lt;/li>
&lt;li>å®šæœŸåˆ é™¤ã€‚æ¯éš”ä¸€æ®µæ—¶é—´ï¼Œéšæœºå–ä¸€å®šæ•°é‡çš„keyï¼Œçœ‹çœ‹ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœåˆ°è¾¾ä¸€å®šçš„é˜ˆå€¼æ¯”å¦‚20%å·²ç»è¿‡æœŸäº†ï¼Œåˆ™è¿›è¡Œåˆ é™¤ï¼Œå¦‚æœæ²¡æœ‰åˆ°è¾¾è¯¥é˜ˆå€¼ï¼Œåˆ™ä¸åˆ é™¤ã€‚&lt;/li>
&lt;/ul>
&lt;p>å…³äºRedisç¼“å­˜ï¼Œå‚è§&lt;a class="link" href="https://segmentfault.com/a/1190000039020626" target="_blank" rel="noopener"
>Redisç¼“å­˜æ€»ç»“ï¼šæ·˜æ±°æœºåˆ¶ã€ç¼“å­˜é›ªå´©ã€æ•°æ®ä¸ä¸€è‡´&amp;hellip;.&lt;/a>ã€‚&lt;/p>
&lt;h2 id="å¼‚æ­¥è¿è¡Œæ—¶ç”Ÿæ€">å¼‚æ­¥è¿è¡Œæ—¶ç”Ÿæ€
&lt;/h2>&lt;ul>
&lt;li>tokio å’Œrustå¼‚æ­¥æ ‡å‡†æœ‰äº›å·®å¼‚ï¼Œæˆç†Ÿ&lt;/li>
&lt;li>async-std è®©å¼€å‘è€…é¡ºåˆ©ç¼–å†™å¼‚æ­¥ï¼Œå¯¹æ ‡å‡†åº“çš„å¼‚æ­¥&lt;/li>
&lt;li>smol è½»é‡çº§ï¼Œæ¯”è¾ƒé€šç”¨&lt;/li>
&lt;li>glommio ç”Ÿäº§çº§åº”ç”¨&lt;/li>
&lt;li>bastion é«˜å¯ç”¨åˆ†å¸ƒå¼å®¹é”™æ¡†æ¶&lt;/li>
&lt;/ul>
&lt;h2 id="smolè¿è¡Œæ—¶">smolè¿è¡Œæ—¶
&lt;/h2>&lt;p>å…ˆçœ‹çœ‹smolä¸­çš„Cargo.tomlã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">dependencies&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">async-channel&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;1.4.2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">async-executor&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;1.3.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">async-fs&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;1.3.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">async-io&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;1.1.2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">async-lock&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;2.3.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">async-net&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;1.4.3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">async-process&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;1.0.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">blocking&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;1.0.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">futures-lite&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;1.11.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">once_cell&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;1.4.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>smolå¯¹è¿™äº›ç»„ä»¶åšäº†ä¸€ä¸ªæ•´åˆï¼Œè¿™äº›ç»„ä»¶ä¹Ÿå¯ä»¥å•ç‹¬ä½¿ç”¨ã€‚&lt;/p>
&lt;h3 id="smolæ–‡æ¡£httpsdocsrssmollatestsmol">&lt;a class="link" href="https://docs.rs/smol/latest/smol/" target="_blank" rel="noopener"
>smolæ–‡æ¡£&lt;/a>
&lt;/h3>&lt;p>&lt;a class="link" href="https://docs.rs/smol/latest/smol/#modules" target="_blank" rel="noopener"
>Modules&lt;/a>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Name&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;a class="link" href="https://docs.rs/smol/latest/smol/channel/index.html" target="_blank" rel="noopener"
>channel&lt;/a>&lt;/td>
&lt;td>An async multi-producer multi-consumer channel.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="https://docs.rs/smol/latest/smol/fs/index.html" target="_blank" rel="noopener"
>fs&lt;/a>&lt;/td>
&lt;td>Async filesystem primitives.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="https://docs.rs/smol/latest/smol/future/index.html" target="_blank" rel="noopener"
>future&lt;/a>&lt;/td>
&lt;td>Combinators for the &lt;a class="link" href="https://docs.rs/smol/latest/smol/prelude/trait.Future.html" target="_blank" rel="noopener"
>&lt;code>Future&lt;/code>&lt;/a> trait.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="https://docs.rs/smol/latest/smol/io/index.html" target="_blank" rel="noopener"
>io&lt;/a>&lt;/td>
&lt;td>Tools and combinators for I/O.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="https://docs.rs/smol/latest/smol/lock/index.html" target="_blank" rel="noopener"
>lock&lt;/a>&lt;/td>
&lt;td>Async synchronization primitives.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="https://docs.rs/smol/latest/smol/net/index.html" target="_blank" rel="noopener"
>net&lt;/a>&lt;/td>
&lt;td>Async networking primitives for TCP/UDP/Unix communication.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="https://docs.rs/smol/latest/smol/prelude/index.html" target="_blank" rel="noopener"
>prelude&lt;/a>&lt;/td>
&lt;td>Traits &lt;a class="link" href="https://docs.rs/smol/latest/smol/prelude/trait.Future.html" target="_blank" rel="noopener"
>&lt;code>Future&lt;/code>&lt;/a>, &lt;a class="link" href="https://docs.rs/smol/latest/smol/stream/trait.Stream.html" target="_blank" rel="noopener"
>&lt;code>Stream&lt;/code>&lt;/a>, &lt;a class="link" href="https://docs.rs/smol/latest/smol/prelude/trait.AsyncRead.html" target="_blank" rel="noopener"
>&lt;code>AsyncRead&lt;/code>&lt;/a>, &lt;a class="link" href="https://docs.rs/smol/latest/smol/prelude/trait.AsyncWrite.html" target="_blank" rel="noopener"
>&lt;code>AsyncWrite&lt;/code>&lt;/a>, &lt;a class="link" href="https://docs.rs/smol/latest/smol/prelude/trait.AsyncBufRead.html" target="_blank" rel="noopener"
>&lt;code>AsyncBufRead&lt;/code>&lt;/a>, &lt;a class="link" href="https://docs.rs/smol/latest/smol/prelude/trait.AsyncSeek.html" target="_blank" rel="noopener"
>&lt;code>AsyncSeek&lt;/code>&lt;/a>, and their extensions.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="https://docs.rs/smol/latest/smol/process/index.html" target="_blank" rel="noopener"
>process&lt;/a>&lt;/td>
&lt;td>Async interface for working with processes.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="https://docs.rs/smol/latest/smol/stream/index.html" target="_blank" rel="noopener"
>stream&lt;/a>&lt;/td>
&lt;td>Combinators for the &lt;a class="link" href="https://docs.rs/smol/latest/smol/stream/trait.Stream.html" target="_blank" rel="noopener"
>&lt;code>Stream&lt;/code>&lt;/a> trait.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;a class="link" href="https://docs.rs/smol/latest/smol/#structs" target="_blank" rel="noopener"
>Structs&lt;/a>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: left">Name&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: left">&lt;a class="link" href="https://docs.rs/smol/latest/smol/struct.Async.html" target="_blank" rel="noopener"
>Async&lt;/a>&lt;/td>
&lt;td>Async adapter for I/O types. å¼‚æ­¥é€‚é…å™¨ï¼Œå¯ä»¥å°†é˜»å¡IOå˜ä¸ºéé˜»å¡IOã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">&lt;a class="link" href="https://docs.rs/smol/latest/smol/struct.Executor.html" target="_blank" rel="noopener"
>Executor&lt;/a>&lt;/td>
&lt;td>An async executor. å¼‚æ­¥æ‰§è¡Œå™¨ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">&lt;a class="link" href="https://docs.rs/smol/latest/smol/struct.LocalExecutor.html" target="_blank" rel="noopener"
>LocalExecutor&lt;/a>&lt;/td>
&lt;td>A thread-local executor. å•çº¿ç¨‹æ‰§è¡Œå™¨ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">&lt;a class="link" href="https://docs.rs/smol/latest/smol/struct.Task.html" target="_blank" rel="noopener"
>Task&lt;/a>&lt;/td>
&lt;td>A spawned task. ä»»åŠ¡ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">&lt;a class="link" href="https://docs.rs/smol/latest/smol/struct.Timer.html" target="_blank" rel="noopener"
>Timer&lt;/a>&lt;/td>
&lt;td>A future that expires at a point in time.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">&lt;a class="link" href="https://docs.rs/smol/latest/smol/struct.Unblock.html" target="_blank" rel="noopener"
>Unblock&lt;/a>&lt;/td>
&lt;td>Runs blocking I/O on a thread pool.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="smolæºç ">smolæºç 
&lt;/h3>&lt;p>src/spawn.rs&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">once_cell&lt;/span>::&lt;span class="n">sync&lt;/span>::&lt;span class="n">Lazy&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="sd">/// å°†å¼‚æ­¥ä»»åŠ¡åŠ å…¥åˆ° task ä¸­ï¼Œäº¤ç»™ Global æ‰§è¡Œå™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">spawn&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nb">Send&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">future&lt;/span>: &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Future&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Output&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Send&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Task&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">GLOBAL&lt;/span>: &lt;span class="nc">Lazy&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Executor&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">&amp;#39;_&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Lazy&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">num_threads&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Parse SMOL_THREADS or default to 1.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">env&lt;/span>::&lt;span class="n">var&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;SMOL_THREADS&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ok&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">and_then&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">parse&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">ok&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">unwrap_or&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">..=&lt;/span>&lt;span class="n">num_threads&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">thread&lt;/span>::&lt;span class="n">Builder&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;smol-&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">spawn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">loop&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// catch_unwind æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¯ä»¥æ•è·æ ˆå±•å¼€ï¼Œè¿è¡Œpanicçº¿ç¨‹å­˜æ´»å¹¶ç»§ç»­è¿è¡Œã€‚ä½¿ç”¨æ ‡å‡†åº“ä¸­çš„std::panic::catch_unwind()å‡½æ•°ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">catch_unwind&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">block_on&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="no">GLOBAL&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">future&lt;/span>::&lt;span class="n">pending&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()))).&lt;/span>&lt;span class="n">ok&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">expect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;cannot spawn executor thread&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Executor&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="no">GLOBAL&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">spawn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">future&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="èŠå¤©æ¡†ä¾‹å­">èŠå¤©æ¡†ä¾‹å­
&lt;/h3>&lt;h4 id="chat-server">chat-server
&lt;/h4>&lt;p>èŠå¤©æ¡†æœåŠ¡å™¨çš„äº‹ä»¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// An event on the chat server.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">enum&lt;/span> &lt;span class="nc">Event&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// A client has joined.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">SocketAddr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Arc&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Async&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">TcpStream&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// A client has left.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Leave&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">SocketAddr&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// A client sent a message.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Message&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">SocketAddr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å‘å®¢æˆ·ç«¯åˆ†å‘äº‹ä»¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// Dispatches events to clients.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">async&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">dispatch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">receiver&lt;/span>: &lt;span class="nc">Receiver&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Event&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">io&lt;/span>::&lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Currently active clients.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">SocketAddr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Arc&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Async&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">TcpStream&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&amp;gt;&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Receive incoming events.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">event&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">receiver&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">recv&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="k">await&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Process the event and format a message to send to clients.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">output&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">event&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Event&lt;/span>::&lt;span class="n">Join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">addr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">addr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s"> has joined&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">addr&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Event&lt;/span>::&lt;span class="n">Leave&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">addr&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">addr&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s"> has left&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">addr&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Event&lt;/span>::&lt;span class="n">Message&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">addr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">msg&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s"> says: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">addr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">msg&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Display the event in the server process.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">print!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">output&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Send the event to all active clients.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">values_mut&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Ignore errors because the client might disconnect at any point.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">write_all&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">output&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">as_bytes&lt;/span>&lt;span class="p">()).&lt;/span>&lt;span class="k">await&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ok&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(())&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æœåŠ¡ç«¯ main å‡½æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">io&lt;/span>::&lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">smol&lt;/span>::&lt;span class="n">block_on&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">async&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Create a listener for incoming client connections.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">listener&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Async&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">TcpListener&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>::&lt;span class="n">bind&lt;/span>&lt;span class="p">(([&lt;/span>&lt;span class="mi">127&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">6000&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Intro messages.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Listening on &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">listener&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">get_ref&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">local_addr&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Start a chat client now!&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Spawn a background task that dispatches events to clients.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// é€šè¿‡ channel å®ç°æ¶ˆæ¯ä¼ é€’
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sender&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">receiver&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bounded&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// detach å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// åˆ†ç¦»ä»»åŠ¡ï¼Œè®©å®ƒåœ¨åå°è¿è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">smol&lt;/span>::&lt;span class="n">spawn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dispatch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">receiver&lt;/span>&lt;span class="p">)).&lt;/span>&lt;span class="n">detach&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">loop&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Accept the next connection.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">addr&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">listener&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">accept&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="k">await&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Arc&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sender&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sender&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">clone&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Spawn a background task reading messages from the client.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">smol&lt;/span>::&lt;span class="n">spawn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">async&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">move&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Client starts with a `Join` event.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sender&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">send&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Event&lt;/span>::&lt;span class="n">Join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">addr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">clone&lt;/span>&lt;span class="p">())).&lt;/span>&lt;span class="k">await&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ok&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Read messages from the client and ignore I/O errors when the client quits.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">read_messages&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sender&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">clone&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="k">await&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ok&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Client ends with a `Leave` event.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sender&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">send&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Event&lt;/span>::&lt;span class="n">Leave&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">addr&lt;/span>&lt;span class="p">)).&lt;/span>&lt;span class="k">await&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ok&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">detach&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="chat-client">chat-client
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">io&lt;/span>::&lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">smol&lt;/span>::&lt;span class="n">block_on&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">async&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Connect to the server and create async stdin and stdout.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Async&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">TcpStream&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>::&lt;span class="n">connect&lt;/span>&lt;span class="p">(([&lt;/span>&lt;span class="mi">127&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">6000&lt;/span>&lt;span class="p">)).&lt;/span>&lt;span class="k">await&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stdin&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Unblock&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">io&lt;/span>::&lt;span class="n">stdin&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stdout&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Unblock&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">io&lt;/span>::&lt;span class="n">stdout&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Intro messages.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Connected to &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">get_ref&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">peer_addr&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;My nickname: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">get_ref&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">local_addr&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Type a message and hit enter!&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">reader&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">writer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Wait until the standard input is closed or the connection is closed.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">future&lt;/span>::&lt;span class="n">race&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">async&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">io&lt;/span>::&lt;span class="n">copy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">stdin&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">writer&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="k">await&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Quit!&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">},&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">async&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">io&lt;/span>::&lt;span class="n">copy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">reader&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stdout&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="k">await&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Server disconnected!&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">},&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">await&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(())&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="futures_lite">futures_lite
&lt;/h3>&lt;p>æ–‡æ¡£ï¼š&lt;a class="link" href="https://docs.rs/futures-lite/latest/futures_lite/" target="_blank" rel="noopener"
>futures_lite&lt;/a>ï¼Œfuturesåº“çš„è½»é‡ç‰ˆã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://docs.rs/futures-lite/latest/futures_lite/#modules" target="_blank" rel="noopener"
>Modules&lt;/a>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Name&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;a class="link" href="https://docs.rs/futures-lite/latest/futures_lite/future/index.html" target="_blank" rel="noopener"
>future&lt;/a>&lt;/td>
&lt;td>Combinators for the &lt;a class="link" href="https://doc.rust-lang.org/nightly/core/future/future/trait.Future.html" target="_blank" rel="noopener"
>&lt;code>Future&lt;/code>&lt;/a> trait.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="https://docs.rs/futures-lite/latest/futures_lite/io/index.html" target="_blank" rel="noopener"
>io&lt;/a>&lt;/td>
&lt;td>Tools and combinators for I/O.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="https://docs.rs/futures-lite/latest/futures_lite/prelude/index.html" target="_blank" rel="noopener"
>prelude&lt;/a>&lt;/td>
&lt;td>Traits &lt;a class="link" href="https://doc.rust-lang.org/nightly/core/future/future/trait.Future.html" target="_blank" rel="noopener"
>&lt;code>Future&lt;/code>&lt;/a>, &lt;a class="link" href="https://docs.rs/futures-core/0.3.15/futures_core/stream/trait.Stream.html" target="_blank" rel="noopener"
>&lt;code>Stream&lt;/code>&lt;/a>, &lt;a class="link" href="https://docs.rs/futures-io/0.3.15/futures_io/if_std/trait.AsyncRead.html" target="_blank" rel="noopener"
>&lt;code>AsyncRead&lt;/code>&lt;/a>, &lt;a class="link" href="https://docs.rs/futures-io/0.3.15/futures_io/if_std/trait.AsyncWrite.html" target="_blank" rel="noopener"
>&lt;code>AsyncWrite&lt;/code>&lt;/a>, &lt;a class="link" href="https://docs.rs/futures-io/0.3.15/futures_io/if_std/trait.AsyncBufRead.html" target="_blank" rel="noopener"
>&lt;code>AsyncBufRead&lt;/code>&lt;/a>, &lt;a class="link" href="https://docs.rs/futures-io/0.3.15/futures_io/if_std/trait.AsyncSeek.html" target="_blank" rel="noopener"
>&lt;code>AsyncSeek&lt;/code>&lt;/a>, and their extensions.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="https://docs.rs/futures-lite/latest/futures_lite/stream/index.html" target="_blank" rel="noopener"
>stream&lt;/a>&lt;/td>
&lt;td>Combinators for the &lt;a class="link" href="https://docs.rs/futures-core/0.3.15/futures_core/stream/trait.Stream.html" target="_blank" rel="noopener"
>&lt;code>Stream&lt;/code>&lt;/a> trait.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>ä¸»è¦å°±æ˜¯ä¸Šè¿°å››ä¸ªæ¨¡å—ã€‚&lt;/p>
&lt;h3 id="async_io">async_io
&lt;/h3>&lt;p>æ–‡æ¡£ï¼š&lt;a class="link" href="https://docs.rs/async-io/latest/async_io/" target="_blank" rel="noopener"
>async_io&lt;/a>&lt;/p>
&lt;p>åœ¨async_io/lib.rsä¸­å®šä¹‰äº†ä¸¤ä¸ªç»“æ„ä½“ï¼Œä¸€ä¸ªæ˜¯Timerï¼Œå¦ä¸€ä¸ªæ˜¯Asyncã€‚&lt;/p>
&lt;ul>
&lt;li>Timer: åœ¨æŸä¸ªæ—¶é—´ç‚¹åˆ°æœŸçš„ Futureã€‚&lt;/li>
&lt;li>Async: åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­åœ¨æ ‡å‡†ç½‘ç»œç±»å‹ï¼ˆè¿˜æœ‰è®¸å¤šå…¶ä»–ç±»å‹çš„ï¼‰ä¸­ä½¿ç”¨çš„ä¸€ä¸ªé€‚é…å™¨ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[derive(Debug)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Timer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// This timer&amp;#39;s ID and last waker that polled it.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// When this field is set to `None`, this timer is not registered in the reactor.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id_and_waker&lt;/span>: &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">usize&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Waker&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// The next instant at which this timer fires.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">when&lt;/span>: &lt;span class="nc">Instant&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// The period.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">period&lt;/span>: &lt;span class="nc">Duration&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[derive(Debug)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Async&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// A source registered in the reactor.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">source&lt;/span>: &lt;span class="nc">Arc&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Source&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// The inner I/O handle.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">io&lt;/span>: &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™é‡Œç”¨åˆ°äº†&lt;a class="link" href="https://docs.rs/polling/latest/polling/" target="_blank" rel="noopener"
>polling&lt;/a> crateã€‚è¿™ä¸ªåº“å®ç°äº†è·¨å¹³å°çš„pollï¼Œæä¾›äº†å¾ˆå¤šæ¥å£ã€‚&lt;/p>
&lt;blockquote>
&lt;p>Portable interface to epoll, kqueue, event ports, and wepoll.
Supported platforms:&lt;/p>
&lt;ul>
&lt;li>epoll : Linux, Android&lt;/li>
&lt;li>kqueue : macOS, iOS, FreeBSD, NetBSD, OpenBSD, DragonFly BSD&lt;/li>
&lt;li>event ports : illumos, Solaris&lt;/li>
&lt;li>poll : VxWorks, Fuchsia, other Unix systems&lt;/li>
&lt;li>wepoll : Windows&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>ä¸‹é¢çœ‹çœ‹ async_io/reactor.rs&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Reactor&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Portable bindings to epoll/kqueue/event ports/wepoll.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// This is where I/O is polled, producing I/O events.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">poller&lt;/span>: &lt;span class="nc">Poller&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Ticker bumped before polling.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// This is useful for checking what is the current &amp;#34;round&amp;#34; of `ReactorLock::react()` when
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// synchronizing things in `Source::readable()` and `Source::writable()`. Both of those
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// methods must make sure they don&amp;#39;t receive stale I/O events - they only accept events from a
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// fresh &amp;#34;round&amp;#34; of `ReactorLock::react()`.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ticker&lt;/span>: &lt;span class="nc">AtomicUsize&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Registered sources.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sources&lt;/span>: &lt;span class="nc">Mutex&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Slab&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Arc&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Source&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Temporary storage for I/O events when polling the reactor.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Holding a lock on this event list implies the exclusive right to poll I/O.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">events&lt;/span>: &lt;span class="nc">Mutex&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Event&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// An ordered map of registered timers.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Timers are in the order in which they fire. The `usize` in this type is a timer ID used to
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// distinguish timers that fire at the same time. The `Waker` represents the task awaiting the
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// timer.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">timers&lt;/span>: &lt;span class="nc">Mutex&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">BTreeMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Instant&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">usize&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Waker&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// A queue of timer operations (insert and remove).
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// When inserting or removing a timer, we don&amp;#39;t process it immediately - we just push it into
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// this queue. Timers actually get processed when the queue fills up or the reactor is polled.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">timer_ops&lt;/span>: &lt;span class="nc">ConcurrentQueue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">TimerOp&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿˜æœ‰ async_io/driver.rsï¼Œå…¶ä¸­æœ‰main_loopå‡½æ•°ï¼Œå¯¹async_ioçº¿ç¨‹è¿›è¡Œä¸»è¦çš„å¾ªç¯ï¼Œå¦å¤–è¿˜æœ‰block_onå‡½æ•°ï¼Œåœ¨æœ‰å¼‚æ­¥ä»»åŠ¡æ—¶é˜»å¡å½“å‰çš„çº¿ç¨‹ï¼Œåœ¨ç©ºé—²çš„æ—¶å€™å¤„ç†IOäº‹ä»¶ã€‚&lt;/p>
&lt;h3 id="async_task">async_task
&lt;/h3>&lt;p>æ–‡æ¡£ï¼š &lt;a class="link" href="https://docs.rs/async-task/latest/async_task/" target="_blank" rel="noopener"
>async_task&lt;/a>&lt;/p>
&lt;p>Task abstraction for building executors.&lt;/p>
&lt;p>To spawn a future onto an executor, we first need to allocate it on the heap and keep some state attached to it. The state indicates whether the future is ready for polling, waiting to be woken up, or completed. Such a stateful future is called a task.&lt;/p>
&lt;p>All executors have a queue that holds scheduled tasks:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sender&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">receiver&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">flume&lt;/span>::&lt;span class="n">unbounded&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™é‡Œç”¨åˆ°äº†ç¬¬ä¸‰æ–¹åº“&lt;a class="link" href="https://docs.rs/flume/0.10.14/flume/" target="_blank" rel="noopener"
>flume&lt;/a>ã€‚å®ƒæ¯” crossbeam-channel æ›´åŠ è½»é‡ï¼Œå®ç°äº†mpmcã€‚&lt;/p>
&lt;p>æ¥ç€æ¥çœ‹ async_task çš„å‡½æ•°ï¼š&lt;/p>
&lt;ul>
&lt;li>spawn åˆ›å»ºä¸€ä¸ªæ–°ä»»åŠ¡ã€‚&lt;/li>
&lt;li>spawn_local åˆ›å»ºä¸€ä¸ªæ–°çš„æœ¬åœ°ä»»åŠ¡ã€‚&lt;/li>
&lt;li>spawn_uncheckedâš  Creates a new task without Send, Sync, and &amp;lsquo;static bounds.&lt;/li>
&lt;/ul>
&lt;p>async_task çš„ç»“æ„ï¼š&lt;/p>
&lt;ul>
&lt;li>FallibleTask: A spawned task with a fallible response.&lt;/li>
&lt;li>Runnable: A handle to a runnable task.&lt;/li>
&lt;li>Task: A spawned task.&lt;/li>
&lt;/ul>
&lt;p>åœ¨ async_task/raw.rs ä¸­å®šä¹‰äº†åº•å±‚çš„TaskVTableã€TaskLayoutã€RawTaskã€‚&lt;/p>
&lt;p>åœ¨ async_task/header.rs ä¸­å®šä¹‰äº†ç»“æ„ä½“Headerã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Header&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Current state of the task.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Contains flags representing the current state and the reference count.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">state&lt;/span>: &lt;span class="nc">AtomicUsize&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// The task that is blocked on the `Task` handle.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// This waker needs to be woken up once the task completes or is closed.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">awaiter&lt;/span>: &lt;span class="nc">UnsafeCell&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Waker&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// The virtual table.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// In addition to the actual waker virtual table, it also contains pointers to several other
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// methods necessary for bookkeeping the heap-allocated task.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">vtable&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span> &lt;span class="nc">TaskVTable&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç›¸å½“äºåšä¸€äº›ä»»åŠ¡çš„å¤„ç†ï¼Œæä¾›äº†notifyã€takeã€registerä¸‰ä¸ªå‡½æ•°ã€‚&lt;/p>
&lt;p>è¿™é‡Œé¢ä»»åŠ¡çš„çŠ¶æ€stateæ˜¯åœ¨state.rsä¸­å®šä¹‰çš„ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// Set if the task is scheduled for running.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">SCHEDULED&lt;/span>: &lt;span class="kt">usize&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="sd">/// Set if the task is running.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">RUNNING&lt;/span>: &lt;span class="kt">usize&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="sd">/// Set if the task has been completed.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">COMPLETED&lt;/span>: &lt;span class="kt">usize&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="sd">/// Set if the task is closed.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">CLOSED&lt;/span>: &lt;span class="kt">usize&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="sd">/// Set if the `Task` still exists.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">TASK&lt;/span>: &lt;span class="kt">usize&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="sd">/// Set if the `Task` is awaiting the output.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">AWAITER&lt;/span>: &lt;span class="kt">usize&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="sd">/// Set if an awaiter is being registered.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">REGISTERING&lt;/span>: &lt;span class="kt">usize&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="sd">/// Set if the awaiter is being notified.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">NOTIFYING&lt;/span>: &lt;span class="kt">usize&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="sd">/// A single reference.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">REFERENCE&lt;/span>: &lt;span class="kt">usize&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="async_executor">async_executor
&lt;/h3>&lt;p>å¼‚æ­¥æ‰§è¡Œå™¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">async_executor&lt;/span>::&lt;span class="n">Executor&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">futures_lite&lt;/span>::&lt;span class="n">future&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// Create a new executor.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ex&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Executor&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// Spawn a task.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">task&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ex&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">spawn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">async&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Hello world&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// Run the executor until the task completes.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">future&lt;/span>::&lt;span class="n">block_on&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ex&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="blocking">blocking
&lt;/h3>&lt;p>æ–‡æ¡£ï¼š&lt;a class="link" href="https://docs.rs/blocking/latest/blocking/" target="_blank" rel="noopener"
>blocking&lt;/a>&lt;/p>
&lt;p>åœ¨å¼‚æ­¥ç¨‹åºé‡Œæä¾›äº†ä¸€ä¸ªçº¿ç¨‹æ± ç”¨äºéš”ç¦»é˜»å¡çš„IOã€‚&lt;/p>
&lt;p>unblock å‡½æ•°ï¼šå¯¹é˜»å¡çš„ä»£ç è¿›è¡Œå¼‚æ­¥åŒ–ã€‚&lt;/p>
&lt;p>Unblock ç±»å‹ï¼šå¯¹é˜»å¡çš„IOè¿›è¡Œå¼‚æ­¥åŒ–ã€‚é€šè¿‡ç»´æŠ¤ä¸€ä¸ªç¯å½¢é˜Ÿåˆ—æ¥è¿›è¡Œå¤„ç†ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://docs.rs/async-fs/latest/async_fs/" target="_blank" rel="noopener"
>async-fs&lt;/a> å…¶ä¸­ç”¨åˆ°äº† blocking è¿™ä¸ªåº“ã€‚&lt;/p>
&lt;h2 id="async-std">async-std
&lt;/h2>&lt;p>æ–‡æ¡£ï¼š&lt;a class="link" href="https://docs.rs/async-std/1.12.0/async_std/" target="_blank" rel="noopener"
>async_std&lt;/a>ï¼Œrustæ ‡å‡†åº“çš„å¼‚æ­¥ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>taskçš„ä½¿ç”¨ä»¥åŠæŠ½è±¡å‡ºæ¥çš„APIæ¥å£ç±»ä¼¼çº¿ç¨‹ï¼Œæ˜“äºä¸Šæ‰‹ã€‚&lt;/p>
&lt;p>async_std å’Œ smol è¿è¡Œæ—¶ä¸€äº›æ¶æ„ä»¥åŠç»„ä»¶éƒ½æ˜¯å…¬ç”¨çš„ï¼Œå¹¶ä¸”å®ƒæä¾›äº†ä¸€ä¸ªç±»ä¼¼äºçº¿ç¨‹çš„ä¸€ä¸ªå¼‚æ­¥ task çš„æŠ½è±¡ï¼Œå¹¶ä¸”å®ƒè¿˜å…¼å®¹ tokioã€‚&lt;/p>
&lt;h2 id="tokio">tokio
&lt;/h2>&lt;p>githubä»“åº“åœ°å€ï¼š&lt;a class="link" href="https://github.com/tokio-rs/tokio" target="_blank" rel="noopener"
>tokio&lt;/a>&lt;/p>
&lt;p>å®˜æ–¹ç½‘ç«™ï¼š&lt;a class="link" href="https://tokio.rs/" target="_blank" rel="noopener"
>tokio.rs&lt;/a>&lt;/p>
&lt;p>æ–‡æ¡£ï¼š&lt;a class="link" href="https://docs.rs/tokio/latest/tokio/" target="_blank" rel="noopener"
>tokio&lt;/a>&lt;/p>
&lt;p>å®˜æ–¹æ–‡æ¡£ä»‹ç»ï¼š&lt;/p>
&lt;p>A runtime for writing reliable network applications without compromising speed.&lt;/p>
&lt;p>Tokio is an event-driven, non-blocking I/O platform for writing asynchronous applications with the Rust programming language. At a high level, it provides a few major components:&lt;/p>
&lt;ul>
&lt;li>Tools for working with asynchronous tasks, including synchronization primitives and channels and timeouts, sleeps, and intervals.&lt;/li>
&lt;li>APIs for performing asynchronous I/O, including TCP and UDP sockets, filesystem operations, and process and signal management.&lt;/li>
&lt;li>A runtime for executing asynchronous code, including a task scheduler, an I/O driver backed by the operating systemâ€™s event queue (epoll, kqueue, IOCP, etcâ€¦), and a high performance timer.&lt;/li>
&lt;/ul>
&lt;p>Remark: loom æ¨¡å—ç”¨æ¥æ£€æµ‹å¼‚æ­¥å¹¶å‘ï¼Œä¹Ÿå¯ä»¥æ£€æµ‹åŒæ­¥å¹¶å‘ã€‚&lt;/p>
&lt;h3 id="mini-redis">mini-redis
&lt;/h3>&lt;ul>
&lt;li>githubä»“åº“åœ°å€ï¼š&lt;a class="link" href="https://github.com/tokio-rs/mini-redis" target="_blank" rel="noopener"
>mini-redis&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;a class="link" href="https://www.runoob.com/redis/redis-tutorial.html" target="_blank" rel="noopener"
>Redisæ•™ç¨‹&lt;/a>&lt;/p>
&lt;p>&lt;code>#[tokio::main]&lt;/code>å®ï¼Œå®šä¹‰åœ¨tokio-macros/lib.rsä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[tokio::main]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">async&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Hello world&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å®å±•å¼€ä¹‹åä¸ºï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tokio&lt;/span>::&lt;span class="n">runtime&lt;/span>::&lt;span class="n">Builder&lt;/span>::&lt;span class="n">new_multi_thread&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">enable_all&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">build&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">unwrap&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">block_on&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">async&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Hello world&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[proc_macro_attribute]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[cfg(not(test))]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// Work around for rust-lang/rust#62127
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">args&lt;/span>: &lt;span class="nc">TokenStream&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">item&lt;/span>: &lt;span class="nc">TokenStream&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">TokenStream&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">entry&lt;/span>::&lt;span class="n">main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨entry.rsä¸­ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[cfg(not(test))]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// Work around for rust-lang/rust#62127
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">args&lt;/span>: &lt;span class="nc">TokenStream&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">item&lt;/span>: &lt;span class="nc">TokenStream&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rt_multi_thread&lt;/span>: &lt;span class="kt">bool&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">TokenStream&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// If any of the steps for this macro fail, we still want to expand to an item that is as close
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// to the expected output as possible. This helps out IDEs such that completions and other
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// related features keep working.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">input&lt;/span>: &lt;span class="nc">syn&lt;/span>::&lt;span class="n">ItemFn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">syn&lt;/span>::&lt;span class="n">parse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">clone&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">it&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">it&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Err&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">token_stream_with_error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">sig&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ident&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;main&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">sig&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">inputs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">is_empty&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">msg&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;the main function cannot accept arguments&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Err&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">syn&lt;/span>::&lt;span class="n">Error&lt;/span>::&lt;span class="n">new_spanned&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">sig&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ident&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">msg&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">AttributeArgs&lt;/span>::&lt;span class="n">parse_terminated&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">parse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">and_then&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">build_config&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">clone&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rt_multi_thread&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parse_knobs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Err&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">token_stream_with_error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">parse_knobs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">DEFAULT_ERROR_CONFIG&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿˜æœ‰ä¸€ä¸ªselectå®ï¼Œå®˜æ–¹æ•™ç¨‹å‚è§&lt;a class="link" href="https://tokio.rs/tokio/tutorial/select" target="_blank" rel="noopener"
>Select&lt;/a>ã€‚ä¾‹å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tokio&lt;/span>::&lt;span class="n">sync&lt;/span>::&lt;span class="n">oneshot&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[tokio::main]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">async&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tx1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rx1&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">oneshot&lt;/span>::&lt;span class="n">channel&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tx2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rx2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">oneshot&lt;/span>::&lt;span class="n">channel&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tokio&lt;/span>::&lt;span class="n">spawn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">async&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tx1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">send&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;one&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tokio&lt;/span>::&lt;span class="n">spawn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">async&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tx2&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">send&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;two&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tokio&lt;/span>::&lt;span class="fm">select!&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">val&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rx1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;rx1 completed first with &lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">val&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">val&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rx2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;rx2 completed first with &lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">val&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>tokioçš„è¿è¡Œæ—¶æ˜¯é€šè¿‡Builderæ¥åˆ›å»ºçš„ã€‚tokioä¸­åˆ†ä¸¤ç§çº¿ç¨‹ï¼Œcoreçº¿ç¨‹ä¸“é—¨å¤„ç†å¼‚æ­¥ï¼Œblockingçº¿ç¨‹å¤„ç†åŒæ­¥ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Builder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Runtime type
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">kind&lt;/span>: &lt;span class="nc">Kind&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Whether or not to enable the I/O driver
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">enable_io&lt;/span>: &lt;span class="kt">bool&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Whether or not to enable the time driver
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">enable_time&lt;/span>: &lt;span class="kt">bool&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Whether or not the clock should start paused.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">start_paused&lt;/span>: &lt;span class="kt">bool&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// The number of worker threads, used by Runtime.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Only used when not using the current-thread executor.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">worker_threads&lt;/span>: &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">usize&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// core çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Cap on thread usage.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">max_blocking_threads&lt;/span>: &lt;span class="kt">usize&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// blockingçº¿ç¨‹æœ€å¤§æ•°é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Name fn used for threads spawned by the runtime.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">super&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">thread_name&lt;/span>: &lt;span class="nc">ThreadNameFn&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Stack size used for threads spawned by the runtime.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">super&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">thread_stack_size&lt;/span>: &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">usize&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Callback to run after each thread starts.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">super&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">after_start&lt;/span>: &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Callback&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// To run before each worker thread stops
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">super&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">before_stop&lt;/span>: &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Callback&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// To run before each worker thread is parked.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">super&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">before_park&lt;/span>: &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Callback&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// To run after each thread is unparked.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">super&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">after_unpark&lt;/span>: &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Callback&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Customizable keep alive timeout for BlockingPool
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">super&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">keep_alive&lt;/span>: &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Duration&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// How many ticks before pulling a task from the global/remote queue?
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">super&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">global_queue_interval&lt;/span>: &lt;span class="kt">u32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// How many ticks before yielding to the driver for timer and I/O events?
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">super&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">event_interval&lt;/span>: &lt;span class="kt">u32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[cfg(tokio_unstable)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">super&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">unhandled_panic&lt;/span>: &lt;span class="nc">UnhandledPanic&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>tokio/parkï¼š&lt;/p>
&lt;p>æœ‰äº‹ä»¶å”¤é†’çº¿ç¨‹è®©å®ƒå»spawn taskï¼Œå¦‚æœæ²¡æœ‰çš„è¯å°±ç­‰å¾… parkã€‚&lt;/p>
&lt;p>tokioä¸­çš„ä»»åŠ¡é˜Ÿåˆ—tokio/src/runtime/thread_pool/worker.rsã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// A scheduler worker
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">super&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Worker&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Reference to shared state
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">shared&lt;/span>: &lt;span class="nc">Arc&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Shared&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Index holding this worker&amp;#39;s remote state
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">index&lt;/span>: &lt;span class="kt">usize&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Used to hand-off a worker&amp;#39;s core to another thread.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">core&lt;/span>: &lt;span class="nc">AtomicCell&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Core&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="sd">/// Core data
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Core&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Used to schedule bookkeeping tasks every so often.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tick&lt;/span>: &lt;span class="kt">u32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// When a task is scheduled from a worker, it is stored in this slot. The
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// worker will check this slot for a task **before** checking the run
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// queue. This effectively results in the **last** scheduled task to be run
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// next (LIFO). This is an optimization for message passing patterns and
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// helps to reduce latency.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lifo_slot&lt;/span>: &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Notified&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// åè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼Œåšäº†ä¼˜åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// The worker-local run queue.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">run_queue&lt;/span>: &lt;span class="nc">queue&lt;/span>::&lt;span class="n">Local&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Arc&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Shared&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// æœ¬åœ°é˜Ÿåˆ—
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// True if the worker is currently searching for more work. Searching
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// involves attempting to steal from other workers.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">is_searching&lt;/span>: &lt;span class="kt">bool&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// True if the scheduler is being shutdown
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">is_shutdown&lt;/span>: &lt;span class="kt">bool&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Parker
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Stored in an `Option` as the parker is added / removed to make the
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// borrow checker happy.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">park&lt;/span>: &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Parker&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Batching metrics so they can be submitted to RuntimeMetrics.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">metrics&lt;/span>: &lt;span class="nc">MetricsBatch&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Fast random number generator.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rand&lt;/span>: &lt;span class="nc">FastRand&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// How many ticks before pulling a task from the global/remote queue?
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">global_queue_interval&lt;/span>: &lt;span class="kt">u32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// How many ticks before yielding to the driver for timer and I/O events?
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">event_interval&lt;/span>: &lt;span class="kt">u32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æä¾›äº†ä¸€ä¸ªæ–¹æ³•block_in_placeï¼Œå¯ä»¥å°†å½“å‰çº¿ç¨‹å˜ä¸ºé˜»å¡çº¿ç¨‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">block_in_place&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">R&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">f&lt;/span>: &lt;span class="nc">F&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">R&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">FnOnce&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">R&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æµå¤„ç†">æµå¤„ç†
&lt;/h3>&lt;p>æ–‡æ¡£å‚è€ƒï¼š&lt;a class="link" href="https://docs.rs/tokio-util/0.7.3/tokio_util/codec/index.html" target="_blank" rel="noopener"
>tokio_util::codec&lt;/a>ã€‚&lt;/p>
&lt;p>Adaptors from AsyncRead/AsyncWrite to Stream/Sink&lt;/p>
&lt;p>Raw I/O objects work with byte sequences, but higher-level code usually wants to batch these into meaningful chunks, called â€œframesâ€.&lt;/p>
&lt;p>This module contains adapters to go from streams of bytes, AsyncRead and AsyncWrite, to framed streams implementing Sink and Stream. Framed streams are also known as transports.&lt;/p>
&lt;p>tokio-streamæŠ½è±¡äº†ä¸€ç§å¸§ç»“æœï¼Œä¹Ÿæä¾›ç›¸åº”çš„é€‚é…å™¨è¿›è¡Œå¼‚æ­¥è¯»å†™ã€‚å¦‚æœæƒ³æ›´å¥½çš„è¿›è¡Œå¼‚æ­¥è¯»å†™ï¼Œå¯ä»¥ä½¿ç”¨æŠ½è±¡çš„codecï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ›´åº•å±‚çš„Sink/Streamè¿›è¡Œå¤„ç†ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/hyperium/tonic" target="_blank" rel="noopener"
>tonic&lt;/a>ï¼šå®ç°gRPCå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Œè‡ªå·±å®ç°Streamï¼Œä»è€Œæ¥è¿›è¡Œå¼‚æ­¥è¯»å†™ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/seanmonstar/warp" target="_blank" rel="noopener"
>wrap&lt;/a>ï¼šå®ç°æ–‡ä»¶ä¸Šä¼ ï¼Œä¹Ÿæ˜¯é€šè¿‡è‡ªå·±å®ç°Streamã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/redis-rs/redis-rs" target="_blank" rel="noopener"
>redis-rs&lt;/a>ï¼šredis libraryã€‚è¿™é‡Œç”¨åˆ°äº†è§£æå™¨ç»„åˆå­&lt;a class="link" href="https://github.com/Marwes/combine" target="_blank" rel="noopener"
>combine&lt;/a>ã€‚&lt;/p>
&lt;h3 id="æ‰©å±•èµ„æ–™">æ‰©å±•èµ„æ–™
&lt;/h3>&lt;ul>
&lt;li>&lt;a class="link" href="https://tony612.github.io/tokio-internals/" target="_blank" rel="noopener"
>Tokio Internals - æºç è§£æå’Œè®¾è®¡åˆ†æ&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™
&lt;/h2>&lt;p>&lt;a class="link" href="https://time.geekbang.org/course/intro/348" target="_blank" rel="noopener"
>å¼ æ±‰ä¸œçš„Rustå®æˆ˜è¯¾&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/ZhangHanDong/inviting-rust" target="_blank" rel="noopener"
>å¼ æ±‰ä¸œçš„Rustå®æˆ˜è¯¾è§†é¢‘è¯¾ç¨‹ä»£ç ç¤ºä¾‹&lt;/a>&lt;/p></description></item><item><title>Programming Rust</title><link>https://wenjin1997.github.io/2022/07/05/Programming-Rust/</link><pubDate>Tue, 05 Jul 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/07/05/Programming-Rust/</guid><description>&lt;p>è®°å½•äº†å­¦ä¹ ã€ŠProgramming Rustã€‹ç¬”è®°ã€‚&lt;/p>
&lt;h2 id="chapter-3-fundamental-types">Chapter 3. Fundamental Types
&lt;/h2>&lt;ul>
&lt;li>Rustæœ‰ç±»å‹æ¨æ–­&lt;/li>
&lt;li>å‡½æ•°å¯ä»¥æ˜¯æ³›å‹çš„&lt;/li>
&lt;/ul>
&lt;p>Rustçš„ç±»å‹&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Type&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>i8,i16,i32,i64,i128,u8,u16,u32,u64,u128&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>isize,usize&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>f32,f64&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>bool&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>char&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>(char, u8, i32)&lt;/td>
&lt;td>å…ƒç»„&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>()&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>struct S { x: f32, y:f32 }&lt;/code>&lt;/td>
&lt;td>ç»“æ„ä½“&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>struct T (i32, char);&lt;/code>&lt;/td>
&lt;td>Tuple-like struct&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>struct E;&lt;/code>&lt;/td>
&lt;td>Unit-like struct; has no fields&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>enum Attend { OnTime, Late(u32) }&lt;/code>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>Box&amp;lt;Attend&amp;gt;&lt;/code>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;amp;i32,&amp;amp;mut i32&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>String&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;amp;str&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>[f64; 4], [u8; 256]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>Vec&amp;lt;f64&amp;gt;&lt;/code>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;amp;[u8], &amp;amp;mut [u8]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Option&amp;lt;&amp;amp;str&amp;gt;&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Result&amp;lt;u64, Error&amp;gt;&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;amp;dyn Any, &amp;amp;mut dyn Read&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>fn(&amp;amp;str) -&amp;gt; bool&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>(Clousure types have no written form)&lt;/td>
&lt;td>Clousure&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="fixed-width-numerical-types">Fixed-Width Numerical Types
&lt;/h3>&lt;p>å¦‚æœéœ€è¦ä»»æ„ç²¾åº¦è¡¨ç¤ºçš„ä¸€äº›æ•°å€¼ï¼Œå¯ä»¥æŸ¥çœ‹ &lt;em>num&lt;/em> åŒ…ã€‚&lt;/p>
&lt;h4 id="integer-types">Integer Types
&lt;/h4>&lt;p>ä¸åƒCå’ŒC++ï¼ŒRustå°†å­—ç¬¦çœ‹ä½œæ˜¯å’Œæ•°å€¼ä¸åŒçš„ç±»å‹ï¼Œä¸€ä¸ª char ä¸æ˜¯ u8ï¼Œä¹Ÿä¸æ˜¯ u32ï¼ˆå°½ç®¡å­—ç¬¦æ˜¯32ä½é•¿çš„ï¼‰ã€‚&lt;/p>
&lt;p>Rustè¦æ±‚æ•°ç»„çš„ç´¢å¼•å¿…é¡»æ˜¯ usize ç±»å‹çš„å€¼ã€‚&lt;/p>
&lt;p>åœ¨Rustæ•´æ•°å¯ä»¥å¸¦ä¸€ä¸ªåç¼€æ¥è¡¨ç¤ºå®ƒä»¬çš„ç±»å‹ï¼Œæ¯”å¦‚&lt;code>42u8&lt;/code>ã€‚å¦‚æœæ²¡æœ‰ç»™æ•´æ•°æŒ‡å®šå…·ä½“çš„ç±»å‹ï¼ŒRustä¼šå°†å€¼å­˜æ”¾åœ¨ä¸€ä¸ªç‰¹å®šçš„ç±»å‹ä¸­ï¼Œä¼ ç»™å‡½æ•°æœŸæœ›çš„å‚æ•°ï¼Œæ¯”è¾ƒå¦ä¸€ä¸ªæœ‰åˆ«çš„ç‰¹å®šç±»å‹çš„å€¼ï¼Œæœ€åï¼Œå¦‚æœæœ‰å¤šä¸ªå¯èƒ½ï¼Œè€Œ &lt;code>i32&lt;/code>æ˜¯å…¶ä¸­ä¸€ä¸ªçš„è¯ï¼Œå°±é»˜è®¤æ˜¯ &lt;code>i32&lt;/code>ç±»å‹ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ã€‚&lt;/p>
&lt;p>å‰ç¼€&lt;code>0x&lt;/code>ï¼Œ&lt;code>0o&lt;/code>å’Œ&lt;code>0b&lt;/code>è¡¨ç¤ºåå…­è¿›åˆ¶ã€å…«è¿›åˆ¶å’ŒäºŒè¿›åˆ¶ã€‚&lt;/p>
&lt;p>ä¸ºäº†æ›´æ¸…æ¥šåœ°è¡¨ç¤ºå¾ˆé•¿çš„æ•°å­—ï¼Œè¿˜å¯ä»¥ç»™æ•°å­—åŠ ä¸‹åˆ’çº¿ï¼Œæ¯”å¦‚&lt;code>4_294_967_295&lt;/code>ã€‚æœ‰å‰ç¼€å’Œåç¼€çš„æ•°å­—ä¾ç„¶å¯ä»¥åŠ ä¸‹åˆ’çº¿ã€‚&lt;/p>
&lt;p>å°½ç®¡Rustä¸­æ•°å­—å’Œå­—ç¬¦æ˜¯ä¸åŒçš„ç±»å‹ï¼Œä½†æ˜¯ä¹Ÿæä¾›äº† &lt;strong>å­—èŠ‚å­—é¢é‡&lt;/strong>ï¼ˆ &lt;em>byte literals&lt;/em>ï¼‰ï¼Œå³ç”¨ç±»å­—ç¬¦å­—é¢é‡è¡¨ç¤ºu8å€¼ï¼š&lt;code>b'X'&lt;/code>ä»£è¡¨çš„ASCIIç¼–ç çš„å­—ç¬¦&lt;code>X&lt;/code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªu8å€¼ã€‚æ¯”å¦‚ï¼Œç”±äºå­—ç¬¦Açš„ASCIIç¼–ç æ˜¯65ï¼Œå› æ­¤&lt;code>b'A'&lt;/code>ç­‰ä»·äº&lt;code>65u8&lt;/code>ã€‚å­—èŠ‚å­—é¢é‡ä¸­åªèƒ½å‡ºç°åœ¨ASCIIç¼–ç çš„å­—ç¬¦ã€‚&lt;/p>
&lt;p>ç‰¹æ®Šçš„ACSIIç¼–ç çš„å­—ç¬¦&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Character&lt;/th>
&lt;th>Byte literal&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>å•å¼•å·&lt;/td>
&lt;td>&lt;code>b'\''&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>åæ–œæ &lt;/td>
&lt;td>&lt;code>b'\\'&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æ¢è¡Œ&lt;/td>
&lt;td>&lt;code>b'\n'&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>å›è½¦&lt;/td>
&lt;td>&lt;code>b'\r'&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>åˆ¶è¡¨ç¬¦&lt;/td>
&lt;td>&lt;code>b'\t'&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>å¯¹äºä¸€äº›ASCIIç¼–ç çš„å­—ç¬¦å¯ä»¥ç”¨åå…­è¿›åˆ¶æ¥è¡¨ç¤ºï¼Œè¿™æ ·æ›´å®¹æ˜“é˜…è¯»ã€‚æ¯”å¦‚&lt;code>b'\x1b'&lt;/code>ã€‚&lt;/p>
&lt;p>æ•´æ•°ç±»å‹ä¹‹é—´è½¬æ¢å¯ä»¥ç”¨ &lt;code>as&lt;/code> æ“ä½œç¬¦ã€‚æ¯”å¦‚ &lt;code>10_i8 as u16&lt;/code>ã€‚&lt;/p>
&lt;p>æ•´æ•°çš„ä¸€äº›æ–¹æ³•ï¼Œå‚è§ &lt;a class="link" href="https://rustwiki.org/zh-CN/std/primitive.i32.html#" target="_blank" rel="noopener"
>std::i32&lt;/a>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2_&lt;/span>&lt;span class="k">u16&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">pow&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">16&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">4_&lt;/span>&lt;span class="k">i32&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">abs&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mb">0b101101_&lt;/span>&lt;span class="k">u8&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">count_ones&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>çœ‹ä¸‹é¢è¿™æ®µä»£ç &lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">abs&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™é‡Œæ²¡æœ‰ç»™å‡ºæ•°å€¼çš„ç±»å‹ï¼Œæ˜¯ä¸æ˜¯é»˜è®¤ &lt;code>i32&lt;/code> å‘¢ï¼Ÿä½†å…¶å®ä¼šæŠ¥é”™ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">error: can&amp;#39;t call method `abs` on ambiguous numeric type `{integer}`
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·å­å‘¢ï¼Ÿå› ä¸ºRustæƒ³è¦åœ¨è°ƒç”¨ä¸€ä¸ªç±»å‹è‡ªå·±çš„æ–¹æ³•ä¹‹å‰æ˜ç¡®åœ°çŸ¥é“ä¸€ä¸ªå€¼çš„æ•´æ•°ç±»å‹ã€‚i32 çš„é»˜è®¤å€¼ä»…é€‚ç”¨äºåœ¨æ‰€æœ‰æ–¹æ³•è°ƒç”¨éƒ½å·²è§£å†³åç±»å‹ä»ç„¶ä¸æ˜ç¡®çš„æƒ…å†µï¼Œåœ¨è¿™é‡Œå°±å¤ªæ™šäº†ï¼Œå› æ­¤ä¼šæŠ¥é”™ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯è¿™é‡Œæˆ‘è¦å…ˆè°ƒç”¨ &lt;code>abs()&lt;/code>æ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦ç¡®å®šç±»å‹ï¼Œè¿˜æ²¡ç­‰æ¨æ–­å‡ºé»˜è®¤ç±»å‹ï¼Œå°±å·²ç»æŠ¥é”™äº†ã€‚è§£å†³æ–¹æ¡ˆï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">4_&lt;/span>&lt;span class="k">i32&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">abs&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">i32&lt;/span>::&lt;span class="n">abs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ³¨æ„&lt;strong>æ–¹æ³•è°ƒç”¨ä¼šå‘ç”Ÿåœ¨ä¸€å…ƒå‰ç¼€æ“ä½œç¬¦ä¹‹å‰&lt;/strong>ï¼Œæ‰€ä»¥å¤„ç†è´Ÿæ•°çš„æ—¶å€™è¦å½“å¿ƒã€‚æ¯”å¦‚&lt;code>-4_i32.abs()&lt;/code>ï¼Œè¿™é‡Œæ²¡æœ‰æ‹¬å·ï¼Œä¼šå…ˆè°ƒç”¨å‡½æ•°&lt;code>4_i32.abs()&lt;/code>ï¼Œç„¶åå†å–è´Ÿå·ï¼Œæœ€ç»ˆç»“æœä¸º-4ã€‚&lt;/p>
&lt;h4 id="checked-wrapping-saturating-and-overflowing-arithmetic">Checked, Wrapping, Saturating, and Overflowing Arithmetic
&lt;/h4>&lt;p>åœ¨Debugæ¨¡å¼ä¸‹ï¼Œå¦‚æœæ•´æ•°æ•°å€¼æ“ä½œæº¢å‡ºï¼Œä¼šæŠ¥é”™ã€‚ä½†æ˜¯åœ¨å‘å¸ƒæ¨¡å¼æ„å»ºçš„æ—¶å€™ï¼Œä¼š &lt;em>wraps&lt;/em>ã€‚&lt;/p>
&lt;blockquote>
&lt;p>In a release build, the operation &lt;em>wraps around&lt;/em>: it produces the value equivalent to the mathematically correct result modulo the range of the value. (In neither case is overflow undefined behavior, as it is in C and C++.)&lt;/p>
&lt;/blockquote>
&lt;p>ä¸Šè¿°æ˜¯é»˜è®¤çš„ï¼Œå¦‚æœè¿™ä¸æ˜¯ä½ æƒ³è¦çš„ï¼Œå¯ä»¥è°ƒç”¨ä¸€äº›æ–¹æ³•ï¼Œä¸»è¦æœ‰å››ç±»ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;em>&lt;strong>Checked&lt;/strong>&lt;/em> operations return an Option of the result: Some(v) if the mathematically correct result can be represented as a value of that type, or None if it cannot.&lt;/li>
&lt;li>&lt;em>&lt;strong>Wrapping&lt;/strong>&lt;/em> operations return the value equivalent to the mathematically correct result modulo the range of the value.&lt;/li>
&lt;li>&lt;em>&lt;strong>Saturating&lt;/strong>&lt;/em> operations return the representable value that is closest to the mathematically correct result. In other words, the result is â€œclampedâ€ to the maximum and minimum values the type can represent.&lt;/li>
&lt;li>&lt;em>&lt;strong>Overflowing&lt;/strong>&lt;/em> operations return a tuple (result, overflowed), where result is what the wrapping version of the function would return, and overflowed is a bool indicating whether an overflow occurred.&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Operation&lt;/th>
&lt;th>Name suffix&lt;/th>
&lt;th>Example&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Addition&lt;/td>
&lt;td>add&lt;/td>
&lt;td>100_i8.checked_add(27) == Some(127)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Subtraction&lt;/td>
&lt;td>sub&lt;/td>
&lt;td>10_u8.checked_sub(11) == None&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Multiplication&lt;/td>
&lt;td>mul&lt;/td>
&lt;td>128_u8.saturating_mul(3) == 255&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Division&lt;/td>
&lt;td>div&lt;/td>
&lt;td>64_u16.wrapping_div(8) == 8&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Remainder&lt;/td>
&lt;td>rem&lt;/td>
&lt;td>(-32768_i16).wrapping_rem(-1) == 0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Negation&lt;/td>
&lt;td>neg&lt;/td>
&lt;td>(-128_i8).checked_neg() == None&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Absolute value&lt;/td>
&lt;td>abs&lt;/td>
&lt;td>(-32768_i16).wrapping_abs() == -32768&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Exponentiation&lt;/td>
&lt;td>pow&lt;/td>
&lt;td>3_u8.checked_pow(4) == Some(81)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Bitwise left shift&lt;/td>
&lt;td>shl&lt;/td>
&lt;td>10_u32.wrapping_shl(34) == 40&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Bitwise right shift&lt;/td>
&lt;td>shr&lt;/td>
&lt;td>40_u64.wrapping_shr(66) == 10&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="floating-point-types">Floating-Point Types
&lt;/h4>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/programming-rust-floating-point.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>æ•´æ•°éƒ¨åˆ†åçš„åˆ†æ•°éƒ¨åˆ†ï¼ŒæŒ‡æ•°æˆ–è€…ç±»å‹åç¼€è‡³å°‘åŒ…å«ä¸€ä¸ªï¼Œæ¥åŒºåˆ«äºæ•´æ•°å­—é¢é‡ã€‚&lt;code>5.&lt;/code>æ•´æ•°éƒ¨åˆ†ä¹‹ååªæœ‰ä¸€ä¸ªå°æ•°ç‚¹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æµ®ç‚¹æ•°å¸¸æ•°ã€‚&lt;/p>
&lt;p>æµ®ç‚¹æ•°é»˜è®¤ç±»å‹æ˜¯ f64 ã€‚&lt;/p>
&lt;p>ä¸ºäº†ç±»å‹æ¨æ–­çš„ç›®çš„ï¼ŒRustä¸­æ•´æ•°å’Œæµ®ç‚¹æ•°ä¹‹é—´ä¸ä¼šè¿›è¡Œç›¸äº’æ¨æ–­ã€‚&lt;/p>
&lt;p>f32å’Œf64éƒ½æœ‰ä¸€äº›ç‰¹æ®Šå€¼ï¼Œå¦‚ &lt;code>INFINITY&lt;/code>ï¼Œ&lt;code>NEG_INFINITY&lt;/code>ï¼Œ&lt;code>NAN&lt;/code>ï¼ˆthat not-a-number valueï¼‰ï¼Œ&lt;code>MIN&lt;/code>å’Œ&lt;code>MAX&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://rustwiki.org/zh-CN/std/primitive.f32.html" target="_blank" rel="noopener"
>std::f32&lt;/a>å’Œ&lt;a class="link" href="https://rustwiki.org/zh-CN/std/primitive.f64.html" target="_blank" rel="noopener"
>std::f64&lt;/a>æä¾›äº†å¾ˆå¤šæ–¹æ³•ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://rustwiki.org/zh-CN/std/f32/consts/index.html" target="_blank" rel="noopener"
>std::f32::consts&lt;/a>å’Œ&lt;a class="link" href="https://rustwiki.org/zh-CN/std/f64/consts/index.html" target="_blank" rel="noopener"
>std::f64::consts&lt;/a>æä¾›ä¸€äº›æ•°å­¦å¸¸é‡ã€‚&lt;/p>
&lt;p>Rustæ˜¯æ²¡æœ‰æ•°å€¼çš„éšå¼è½¬æ¢çš„ï¼Œæ‰€ä»¥å¦‚æœä¼ å…¥çš„å‚æ•°ç±»å‹å’Œå‡½æ•°çš„å‚æ•°ç±»å‹ä¸ä¸€è‡´ï¼Œè¿™é‡Œä¸ä¼šå‘ç”Ÿéšå¼è½¬æ¢ï¼Œå› æ­¤ä¼šæŠ¥é”™ã€‚æƒ³è¦è½¬æ¢åªèƒ½æ˜¾å¼åœ°ç”¨ &lt;code>as&lt;/code> æ“ä½œç¬¦ã€‚&lt;/p>
&lt;h3 id="the-bool-type">The bool Type
&lt;/h3>&lt;p>åœ¨Rustä¸­ï¼Œboolç±»å‹çš„å€¼ä¸º true å’Œ falseã€‚&lt;/p>
&lt;p>Rustä¸­åœ¨è¦æ±‚ä¸€ä¸ªBooleanå€¼çš„ä¸Šä¸‹æ–‡ä¸­æ˜¯éå¸¸ä¸¥æ ¼çš„ã€‚æ§åˆ¶ç»“æ„&lt;code>if&lt;/code>å’Œ&lt;code>while&lt;/code>è¦æ±‚æ¡ä»¶å¿…é¡»æ˜¯ bool è¡¨è¾¾å¼ï¼Œ çŸ­è·¯é€»è¾‘æ“ä½œç¬¦ &lt;code>&amp;amp;&amp;amp;&lt;/code> å’Œ &lt;code>||&lt;/code> ä¹Ÿè¦æ±‚å¿…é¡»æ˜¯ bool è¡¨è¾¾å¼ã€‚å¿…é¡» &lt;code>if x!= 0 { ... }&lt;/code>è¿™æ ·å†™ï¼Œè€Œä¸èƒ½ç®€å•åœ°å†™ä¸º &lt;code>if x { ... }&lt;/code>ã€‚&lt;/p>
&lt;p>Rustå¯ä»¥ç”¨ as æ“ä½œç¬¦å°† bool å€¼è½¬æ¢ä¸ºæ•°å­—ï¼Œä½†æ˜¯ä¸èƒ½åè¿‡æ¥å°†æ•°å€¼è½¬æ¢ä¸º bool å€¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">i32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">i32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è™½ç„¶å¯ä»¥åªæœ‰ä¸€ä½å°±è¡¨ç¤º bool å€¼ï¼Œä½†æ˜¯Ruståº•å±‚ç”¨ä¸€æ•´ä¸ªå­—èŠ‚æ¥å­˜å‚¨ bool å€¼ï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆæ¥æŒ‡å‘å®ƒã€‚&lt;/p>
&lt;h3 id="characters">Characters
&lt;/h3>&lt;p>char ç±»å‹è¡¨ç¤ºå•ä¸ªUnicodeå­—ç¬¦ï¼Œå  32 ä½ã€‚&lt;/p>
&lt;p>å­—ç¬¦å¯ä»¥ç”¨åå…­è¿›åˆ¶æ¥è¡¨ç¤ºæˆ–è€…&lt;code>\u{}&lt;/code>æ¥è¡¨ç¤ºã€‚&lt;/p>
&lt;ul>
&lt;li>å¦‚æœå­—ç¬¦ç¼–ç åœ¨ASCIIç¼–ç èŒƒå›´å†…ï¼Œå¯ä»¥ç”¨åå…­è¿›åˆ¶ã€‚ä¾‹å¦‚&lt;code>'\xHH'&lt;/code>ã€‚&lt;/li>
&lt;li>ä¹Ÿå¯ä»¥ç”¨&lt;code>\u{}&lt;/code>æ¥è¡¨ç¤ºä»»ä½•çš„Unicodeç¼–ç å­—ç¬¦ã€‚ä¾‹å¦‚&lt;code>'\u{HHHHHH}'&lt;/code>ã€‚&lt;/li>
&lt;/ul>
&lt;p>å­—ç¬¦å¿…é¡»åœ¨æœ‰æ•ˆçš„ Unicode ç ç‚¹èŒƒå›´å†…ã€‚&lt;/p>
&lt;p>char å’Œå…¶ä»–ç±»å‹ä¹‹é—´æ²¡æœ‰éšå¼åœ°è½¬æ¢ã€‚å½“ç„¶å¯ä»¥æ˜¾å¼ç”¨ as æ“ä½œç¬¦å°† char ç±»å‹è½¬æ¢æˆä¸€ä¸ªæ•´æ•°ç±»å‹ï¼Œå¦‚æœç±»å‹å°äº32ä½ï¼Œä¼šè¿›è¡Œæˆªæ–­ã€‚ç›¸ååœ°ï¼Œåªæœ‰ u8 ç±»å‹èƒ½ç”¨ as æ“ä½œç¬¦æ˜¾å¼åœ°è½¬æ¢ä¸º char ç±»å‹ã€‚è¿™ä¸€ç‚¹ä¹Ÿå¾ˆè‡ªç„¶ï¼ŒRustè¦ä¿è¯å¯é ï¼Œå…¶ä»–æ•°å€¼ç±»å‹è½¬æ¢æˆ char ç±»å‹æ—¶ï¼Œå¯èƒ½æ˜¯æ— æ•ˆçš„å­—ç¬¦ã€‚ä¸è¿‡&lt;code>std::char::from_u32&lt;/code>å¯ä»¥å°†ä»»ä½• u32 ç±»å‹çš„å€¼è½¬æ¢ï¼Œè¿”å›çš„æ˜¯ &lt;code>Option&amp;lt;char&amp;gt;&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://rustwiki.org/zh-CN/std/primitive.char.html" target="_blank" rel="noopener"
>char(primitive type)&lt;/a>æ–‡æ¡£æœ‰ç›¸å…³çš„æ–¹æ³•ã€‚&lt;/p>
&lt;h3 id="tuples">Tuples
&lt;/h3>&lt;p>å…ƒç»„å¯ä»¥å°†ä¸åŒç±»å‹çš„å€¼ç»„åˆåœ¨ä¸€èµ·ï¼Œå¯ä»¥ç”¨åœ¨è¿”å›å¤šä¸ªä¸åŒç±»å‹çš„å€¼çš„å‡½æ•°ä¸­ã€‚&lt;/p>
&lt;p>ç”¨ &lt;code>a.0&lt;/code>å¯ä»¥æ¥è·å–å…·ä½“çš„å…ƒç´ ã€‚&lt;/p>
&lt;p>å…ƒç»„çš„ç´¢å¼•å¿…é¡»æ˜¯å¸¸æ•°ï¼Œä¸å¯ä»¥æ˜¯å˜é‡ï¼Œæ¯”å¦‚&lt;code>t[i]&lt;/code>æˆ–è€…&lt;code>t.i&lt;/code>å°±æ˜¯é”™è¯¯çš„ã€‚&lt;/p>
&lt;p>å¯ä»¥ç”¨æ¨¡å¼åŒ¹é…å¾—åˆ°å…ƒç»„å¯¹åº”çš„å€¼ã€‚åœ¨æŒ‡å®šå˜é‡å€¼æˆ–è€…å‡½æ•°è¿”å›å¤šä¸ªå€¼æ—¶å¾ˆæœ‰ç”¨ã€‚ç”¨å…ƒç»„æ¥è¡¨ç¤ºç›¸å…³çš„å˜é‡æ˜¯å¾ˆæ¸…æ™°çš„ï¼Œæ¯”å¦‚å®½å’Œé«˜ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªå…ƒç»„æŠŠå®ƒä»¬æ”¾åœ¨ä¸€èµ·ï¼Œè¯­ä¹‰æ›´åŠ æ¸…æ™°ã€‚&lt;/p>
&lt;p>unit type &lt;code>()&lt;/code>å¯ä»¥ç”¨äºå‡½æ•°çš„è¿”å›ç±»å‹ï¼Œè¡¨ç¤ºä»€ä¹ˆä¹Ÿä¸è¿”å›ã€‚&lt;/p>
&lt;p>å¯ä»¥åœ¨å…ƒç»„çš„æœ€ååŠ ä¸Šé€—å·ï¼Œå®¹æ˜“çœ‹å‡ºåˆ—è¡¨åˆ é™¤æˆ–æ·»åŠ äº†å…ƒç´ ã€‚å¦‚æœæ˜¯å•ä¸ªå€¼ï¼Œ&lt;code>(&amp;quot;lonely hearts&amp;quot;,)&lt;/code>ç›¸æ¯” &lt;code>(&amp;quot;lonely hearts&amp;quot;)&lt;/code>æ›´åŠ æ¸…æ™°ï¼Œå¯ä»¥åˆ¤æ–­æ˜¯å…ƒç»„è€Œä¸æ˜¯æ‹¬å·è¡¨è¾¾å¼ã€‚&lt;/p>
&lt;h3 id="pointer-types">Pointer Types
&lt;/h3>&lt;h4 id="references">References
&lt;/h4>&lt;p>&lt;code>&amp;amp;x&lt;/code> äº§ç”Ÿäº†å¯¹ &lt;code>x&lt;/code> çš„ä¸€ä¸ªå¼•ç”¨ï¼Œç”¨Rustçš„æœ¯è¯­æ¥è¯´æ˜¯å‘ &lt;code>x&lt;/code> å€Ÿäº†ä¸€ä¸ªå¼•ç”¨ã€‚&lt;/p>
&lt;p>åœ¨Rustä¸­ï¼Œå¼•ç”¨å§‹ç»ˆä¸ä¸ºç©ºã€‚Rustä¼šè·Ÿè¸ªå€¼çš„æ‰€æœ‰æƒå’Œç”Ÿå‘½å‘¨æœŸï¼Œåœ¨ç¼–è¯‘æ—¶æœŸä¼šæ£€æŸ¥å‡ºæ‚¬å‚æŒ‡é’ˆï¼ŒäºŒæ¬¡é‡Šæ”¾ä»¥åŠæŒ‡é’ˆæ— æ•ˆçš„é”™è¯¯ã€‚&lt;/p>
&lt;ul>
&lt;li>&amp;amp; Tï¼šä¸å¯å˜çš„å…±äº«å¼•ç”¨&lt;/li>
&lt;li>&amp;amp;mut Tï¼šå¯å˜çš„ç‹¬å å¼•ç”¨&lt;/li>
&lt;/ul>
&lt;p>å°†ä¸å¯å˜å¼•ç”¨å’Œå¯å˜å¼•ç”¨çœ‹ä½œå•ä¸ªè¯»-å†™è€…å’Œå¤šä¸ªè¯»è€…ã€‚&lt;/p>
&lt;h4 id="boxes">Boxes
&lt;/h4>&lt;p>ç”¨äºå †åˆ†é…çš„æŒ‡é’ˆç±»å‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;eggs&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Box&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œç±»å‹ä¸º Box&amp;lt;(i32, &amp;amp;str)&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="raw-pointers">Raw Pointers
&lt;/h4>&lt;ul>
&lt;li>*const T&lt;/li>
&lt;li>*mut T&lt;/li>
&lt;/ul>
&lt;p>åªèƒ½åœ¨ unsafe å—ä¸­å¯¹åŸå§‹æŒ‡é’ˆè§£å¼•ç”¨ã€‚&lt;/p>
&lt;h3 id="arrays-vectors-and-slices">Arrays, Vectors, and Slices
&lt;/h3>&lt;p>æœ‰ä¸‰ç§ç±»å‹è¡¨ç¤ºå†…å­˜ä¸­è¿ç»­çš„ä¸€å—æ•°æ®ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>[T; N]&lt;/code>è¡¨ç¤ºæ•°ç»„ã€‚æ•°ç»„çš„é•¿åº¦å¿…é¡»è¦åœ¨ç¼–è¯‘æ—¶æœŸå°±ç¡®å®šã€‚&lt;/li>
&lt;li>&lt;code>Vec&amp;lt;T&amp;gt;&lt;/code> è¡¨ç¤º T ç±»å‹çš„å‘é‡ã€‚åŠ¨æ€åˆ†é…çš„ï¼Œå…ƒç´ å­˜æ”¾åœ¨å †ä¸Šã€‚&lt;/li>
&lt;li>&lt;code>&amp;amp;[T]&lt;/code>å’Œ&lt;code>&amp;amp;mut [T]&lt;/code> ç§°ä¸º T çš„å…±äº«åˆ‡ç‰‡æˆ–å¯å˜åˆ‡ç‰‡ã€‚å¯ä»¥æŠŠåˆ‡ç‰‡çœ‹ä½œæ˜¯ä¸€ä¸ªèƒ–æŒ‡é’ˆï¼ŒæŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ŒåŒæ—¶è¿˜åŒ…å«å¯ä»¥è®¿é—®åˆ°çš„å…ƒç´ çš„ä¸ªæ•°ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä¸€äº›æ–¹æ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>v.len()&lt;/code> è¿”å›å…ƒç´ çš„ä¸ªæ•°ã€‚&lt;/li>
&lt;li>&lt;code>v[i]&lt;/code> è¡¨ç¤º v çš„ç¬¬ i ä¸ªå…ƒç´ ï¼Œæ³¨æ„è¿™é‡Œç´¢å¼• i å¿…é¡»æ˜¯ usize ç±»å‹çš„ã€‚Rustæ€»æ˜¯ä¼šå»æ£€æŸ¥ i æœ‰æ²¡æœ‰åœ¨æœ‰æ•ˆçš„èŒƒå›´å†…ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="arrays">Arrays
&lt;/h4>&lt;p>ç›´æ¥ç”¨æ–¹æ‹¬å·ç”Ÿæˆæ•°ç»„ï¼Œæˆ–è€…[T; N]ç”Ÿæˆæ•°ç»„ï¼ŒRustä¸æä¾›æœªåˆå§‹åŒ–çš„æ•°ç»„ã€‚&lt;/p>
&lt;p>æ•°ç»„çš„é•¿åº¦å¿…é¡»åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šï¼Œä¸å¯ä»¥ç”¨å˜é‡ï¼Œæ¯”å¦‚&lt;code>[true; n]&lt;/code> è¿™å°±æ˜¯é”™è¯¯çš„ã€‚å¦‚æœæƒ³åœ¨è¿è¡ŒæœŸé—´è·å¾—æ•°ç»„çš„é•¿åº¦ï¼Œåº”è¯¥ç”¨å‘é‡ã€‚&lt;/p>
&lt;p>åœ¨è°ƒç”¨ä¸€äº›æ•°ç»„çš„æ–¹æ³•æ—¶ï¼ŒRustä¼šéšå¼åœ°å°†ä¸€ä¸ªæ•°ç»„çš„å¼•ç”¨è½¬æ¢ä¸ºåˆ‡ç‰‡ï¼Œè¿™æ ·å¯ä»¥ç›´æ¥åœ¨ä¸€ä¸ªæ•°ç»„ä¸Šä½¿ç”¨ä»»ä½•åˆ‡ç‰‡çš„æ–¹æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">chaos&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">chaos&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">sort&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// è¿™é‡Œéšå¼åœ°è½¬æ¢ä¸º &amp;amp;mut [i32]ï¼Œè°ƒç”¨äº†åˆ‡ç‰‡çš„ sort æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">chaos&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">]);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å…³äºè¿™ä¸€ç‚¹ï¼Œ&lt;a class="link" href="https://rustwiki.org/zh-CN/std/primitive.array.html" target="_blank" rel="noopener"
>å®˜æ–¹æ–‡æ¡£&lt;/a>æ˜¯è¿™æ ·è¯´çš„ã€‚&lt;/p>
&lt;blockquote>
&lt;p>æ•°ç»„å¼ºåˆ¶è½¬æ¢ä¸º &lt;code>slices ([T]) &lt;/code>ï¼Œå› æ­¤å¯ä»¥åœ¨æ•°ç»„ä¸Šè°ƒç”¨ slice æ–¹æ³•ã€‚å®é™…ä¸Šï¼Œè¿™æä¾›äº†ç”¨äºå¤„ç†æ•°ç»„çš„å¤§å¤šæ•° APIã€‚ åˆ‡ç‰‡å…·æœ‰åŠ¨æ€å¤§å°ï¼Œå¹¶ä¸”ä¸å¼ºåˆ¶è½¬æ¢ä¸ºæ•°ç»„ã€‚&lt;/p>
&lt;/blockquote>
&lt;h4 id="vectors">Vectors
&lt;/h4>&lt;p>åœ¨å †ä¸Šåˆ†é…çš„å®¹å™¨ã€‚&lt;/p>
&lt;p>å¯ä»¥ç”¨ &lt;code>vec!&lt;/code>æˆ–è€…&lt;code>Vec::new()&lt;/code>æ¥ç”Ÿæˆæ–°çš„ vectorã€‚&lt;/p>
&lt;p>å¯ä»¥åŠ¨æ€æ·»åŠ å…ƒç´ :&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">primes&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">primes&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">11&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯ä»¥ç”¨é‡å¤è¡¨è¾¾å¼æ¥åˆ›å»º vectorï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">new_pixel_buffer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rows&lt;/span>: &lt;span class="kt">usize&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cols&lt;/span>: &lt;span class="kt">usize&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rows&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cols&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿­ä»£å™¨æ„é€ ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">i32&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">collect&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// è¿™é‡Œå¿…é¡»æŒ‡å®š v çš„ç±»å‹ï¼Œå› ä¸º collect æ–¹æ³•æœ‰å¾ˆå¤šç§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">]);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å’Œæ•°ç»„ä¸€æ ·ï¼Œå‘é‡ä¹Ÿä¼šåœ¨è°ƒç”¨ä¸€äº›æ–¹æ³•æ—¶éšå¼åœ°è½¬æ¢ä¸ºåˆ‡ç‰‡ç±»å‹ã€‚&lt;/p>
&lt;p>ä¸€ä¸ª &lt;code>Vec&amp;lt;T&amp;gt;&lt;/code> åŒ…å«ä¸‰ä¸ªå€¼ï¼šæŒ‡å‘å…ƒç´ çš„å † buffer çš„æŒ‡é’ˆï¼Œè¿™ä¸ªæ˜¯è¢« &lt;code>Vec&amp;lt;T&amp;gt;&lt;/code> æ‰€åˆ›å»ºå’Œæ‹¥æœ‰çš„ï¼› buffer ä¸­çš„å®¹é‡ï¼›åŒ…å«å…ƒç´ çš„ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯é•¿åº¦ã€‚&lt;/p>
&lt;p>çŸ¥é“å‘é‡çš„å®¹é‡ï¼Œå¯ä»¥ç”¨&lt;code>Vec::with_capacity&lt;/code>æ¥åˆ›å»ºã€‚æå‡æ•ˆç‡ï¼Œå‡å°‘é‡æ–°åˆ†é…ç©ºé—´ã€‚&lt;/p>
&lt;p>&lt;code>capacity&lt;/code>æ–¹æ³•è¿”å›å‘é‡ä¸éœ€è¦å†åˆ†é…æ—¶å‘é‡çš„å®¹é‡ã€‚&lt;/p>
&lt;p>ä¸€äº›æ–¹æ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>insert&lt;/li>
&lt;li>remove&lt;/li>
&lt;li>pop&lt;/li>
&lt;/ul>
&lt;p>å¯ä»¥ç”¨ for åœ¨å‘é‡ä¸Šè¿›è¡Œè¿­ä»£ã€‚&lt;/p>
&lt;h4 id="slices">Slices
&lt;/h4>&lt;p>åˆ‡ç‰‡ï¼Œç›´æ¥æŒ‡å‘å¼•ç”¨çš„æ•°æ®ï¼Œçœ‹ä½œä¸€ä¸ªèƒ–æŒ‡é’ˆï¼ŒæŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä»¥åŠåŒ…å« lenã€‚&lt;/p>
&lt;h3 id="string-types">String Types
&lt;/h3>&lt;h4 id="string-literals">String Literals
&lt;/h4>&lt;p>å­—ç¬¦ä¸²å­—é¢é‡åœ¨åŒå¼•å·å†…ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ç©ºæ ¼å’Œæ¢è¡Œç…§æ ·è¾“å‡º
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;In the room the women come and go,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> Singing of Mount Abora&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// å»æ‰æ¢è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;It was a bright, cold day in April, and &lt;/span>&lt;span class="se">\&lt;/span>&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> there were four of usâ€”&lt;/span>&lt;span class="se">\&lt;/span>&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> more or less.&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// raw strings
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">default_win_install_path&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s">&amp;#34;C:\Program Files\Gorillas&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pattern&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Regex&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s">&amp;#34;\d+(\.\d+)*&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// åŒ…å«åŒå¼•å·
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s">###&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> This raw string started with &amp;#39;r###&amp;#34;&amp;#39;.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> Therefore it does not end until we reach a quote mark (&amp;#39;&amp;#34;&amp;#39;)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> followed immediately by three pound signs (&amp;#39;###&amp;#39;):
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34;###&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="byte-strings">Byte Strings
&lt;/h4>&lt;p>å¸¦æœ‰ b å‰ç¼€çš„æ˜¯ä¸€ä¸ªå­—èŠ‚å­—é¢é‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">method&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sa">b&lt;/span>&lt;span class="s">&amp;#34;GET&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// &amp;amp;[u8; 3] ç±»å‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">method&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="sa">b&lt;/span>&lt;span class="sc">&amp;#39;G&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sa">b&lt;/span>&lt;span class="sc">&amp;#39;E&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sa">b&lt;/span>&lt;span class="sc">&amp;#39;T&amp;#39;&lt;/span>&lt;span class="p">]);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="strings-in-memory">Strings in Memory
&lt;/h4>&lt;p>å†…å­˜ä¸­ä»¥UTF-8ç¼–ç å­˜å‚¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">noodles&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;noodles&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// String åº•å±‚æ˜¯ Vec&amp;lt;u8&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">oodles&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">noodles&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// &amp;amp;str
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">poodles&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;à² _à² &amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// &amp;amp;str
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å†…å­˜å¸ƒå±€ï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/rust-programming-string.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h4 id="string">String
&lt;/h4>&lt;p>&lt;code>&amp;amp;str&lt;/code>åƒ&lt;code>&amp;amp;[T]&lt;/code>ï¼Œè€Œ &lt;code>String&lt;/code>åƒ&lt;code>Vec&amp;lt;T&amp;gt;&lt;/code>ã€‚&lt;/p>
&lt;p>åˆ›å»º String:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// to_string æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">error_message&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;too many pets&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// format!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">Â°&lt;/span>&lt;span class="si">{:02}&lt;/span>&lt;span class="s">â€²&lt;/span>&lt;span class="si">{:02}&lt;/span>&lt;span class="s">â€²â€²N&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">24&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">23&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;24Â°05â€²23â€²â€²N&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// æ•°ç»„ã€å‘é‡çš„ concatã€join æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bits&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;veni&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;vidi&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;vici&amp;#34;&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">bits&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">concat&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;venividivici&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">bits&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;, &amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;veni, vidi, vici&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="using-strings">Using Strings
&lt;/h4>&lt;p>Strings support the == and != operators. Two strings are equal if they contain the same characters in the same order (regardless of whether they point to the same location in memory).&lt;/p>
&lt;h4 id="other-string-like-types">Other String-Like Types
&lt;/h4>&lt;ul>
&lt;li>Stick to &lt;strong>String&lt;/strong> and &lt;strong>&amp;amp;str&lt;/strong> for Unicode text.&lt;/li>
&lt;li>When working with filenames, use &lt;strong>std::path::PathBuf&lt;/strong> and &lt;strong>&amp;amp;Path&lt;/strong> instead.&lt;/li>
&lt;li>When working with binary data that isnâ€™t UTF-8 encoded at all, use &lt;strong>&lt;code>Vec&amp;lt;u8&amp;gt;&lt;/code>&lt;/strong> and &lt;strong>&amp;amp;[u8]&lt;/strong>.&lt;/li>
&lt;li>When working with environment variable names and command-line arguments in the native form presented by the operating system, use &lt;strong>OsString&lt;/strong> and &lt;strong>&amp;amp;OsStr&lt;/strong>.&lt;/li>
&lt;li>When interoperating with C libraries that use null-terminated strings, use &lt;strong>std::ffi::CString&lt;/strong> and &lt;strong>&amp;amp;CStr&lt;/strong>.&lt;/li>
&lt;/ul>
&lt;h3 id="type-aliases">Type Aliases
&lt;/h3>&lt;p>ç±»å‹åˆ«åç”¨ &lt;code>type&lt;/code> ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">type&lt;/span> &lt;span class="nc">Bytes&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="chapter-4-ownership-and-moves">Chapter 4. Ownership and Moves
&lt;/h2>&lt;p>ç®¡ç†å†…å­˜ï¼Œæƒ³è¾¾åˆ°çš„æ•ˆæœï¼š&lt;/p>
&lt;ul>
&lt;li>å½“æˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªæ—¶é—´æ—¶ï¼Œå†…å­˜å¯ä»¥åŠæ—¶é‡Šæ”¾&lt;/li>
&lt;li>å†…å­˜é‡Šæ”¾åï¼Œä¸å†æœ‰æŒ‡é’ˆæŒ‡å‘å®ƒ&lt;/li>
&lt;/ul>
&lt;p>ç›®å‰çš„å†…å­˜ç®¡ç†æ–¹æ¡ˆï¼š&lt;/p>
&lt;ul>
&lt;li>GCï¼Œåƒåœ¾å›æ”¶ã€‚è§£å†³äº†æ‚¬å‚æŒ‡é’ˆçš„é—®é¢˜ï¼Œä½†æ˜¯ä¼šå‡ºç°ä¸–ç•Œåœæ—¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æœŸæœ›é‡Šæ”¾å†…å­˜çš„æ—¶å€™ï¼Œå®ƒè¿˜æ²¡æœ‰é‡Šæ”¾ã€‚&lt;/li>
&lt;li>è‡ªå·±å®Œå…¨æ§åˆ¶å†…å­˜ï¼Œæ¯”å¦‚Cå’ŒC++ã€‚ä½†æ˜¯å¯¹ç¨‹åºå‘˜è¦æ±‚é«˜ï¼Œä½¿ç”¨ä¸å½“æœ‰æ—¶ä¹Ÿä¼šå‘ç”Ÿé”™è¯¯ã€‚&lt;/li>
&lt;/ul>
&lt;p>Rustæ˜¯æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„å‘¢ï¼Ÿç§˜å¯†æ­¦å™¨å°±æ˜¯é™åˆ¶ä½ çš„ç¨‹åºå¯¹æŒ‡é’ˆçš„ä½¿ç”¨ã€‚ç»™çš„è¿™äº›é™åˆ¶ä¼šä¿è¯å®‰å…¨ï¼Œä½†ä¹Ÿä¸ä¼šä¸§å¤±è‡ªç”±åº¦ã€‚ä¹¦ä¸­è¿™æ ·å†™é“ï¼š&lt;/p>
&lt;blockquote>
&lt;p>Rustâ€™s radical wager, the claim on which it stakes its success and that forms the root of the language, is that &lt;strong>even with these restrictions in place, youâ€™ll find the language more than flexible enough for almost every task and that the benefits&lt;/strong>â€”the elimination of broad classes of memory management and concurrency bugsâ€”will justify the adaptations youâ€™ll need to make to your style. The authors of this book are bullish on Rust exactly because of our extensive experience with C and C++. For us, Rustâ€™s deal is a no-brainer.&lt;/p>
&lt;/blockquote>
&lt;h3 id="ownership">Ownership
&lt;/h3>&lt;p>åœ¨Rustä¸­ï¼Œæ‰€æœ‰æƒçš„æ¦‚å¿µæ˜¯å†…å»ºåœ¨è¯­è¨€ä¸­çš„ï¼Œå¹¶ä¸”ä¼šé€šè¿‡ç¼–è¯‘å™¨æ£€æŸ¥å¼ºåˆ¶æ‰§è¡Œã€‚æ¯ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼Œè¿™ä¸ªæ‰€æœ‰è€…å†³å®šå®ƒçš„ç”Ÿå‘½å‘¨æœŸã€‚å½“æ‰€æœ‰è€…è¢«é‡Šæ”¾æ—¶ï¼Œå®ƒæ‰€æ‹¥æœ‰çš„å€¼ä¹Ÿä¼šè¢«é‡Šæ”¾ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">point&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Box&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="mf">0.625&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.5&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// point allocated here
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">label&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">point&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// label allocated here , è¿™é‡Œè¿”å› String
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">label&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;(0.625, 0.5)&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// both dropped here
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å†…å­˜å¸ƒå±€ï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/rust-programming-fig4-3.png"
loading="lazy"
alt="image-20220709110854213"
>&lt;/p>
&lt;p>åƒå˜é‡ä¼šæ‹¥æœ‰å®ƒçš„å€¼ï¼Œç»“æ„ä½“ä¼šæ‹¥æœ‰å®ƒä»¬çš„å­—æ®µï¼Œå…ƒç»„ã€æ•°ç»„ä»¥åŠå‘é‡ä¼šæ‹¥æœ‰å®ƒä»¬çš„å…ƒç´ ã€‚&lt;/p>
&lt;p>å†çœ‹ä¸€ä¸ªå¤æ‚çš„ä¾‹å­ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">Person&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>: &lt;span class="nb">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">birth&lt;/span>: &lt;span class="kt">i32&lt;/span> &lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">composers&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Vec&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">composers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Person&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>: &lt;span class="s">&amp;#34;Palestrina&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">birth&lt;/span>: &lt;span class="mi">1525&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">composers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Person&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>: &lt;span class="s">&amp;#34;Dowland&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">birth&lt;/span>: &lt;span class="mi">1563&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">composers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Person&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>: &lt;span class="s">&amp;#34;Lully&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">birth&lt;/span>: &lt;span class="mi">1632&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">composer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">composers&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">, born &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">composer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">composer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">birth&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å†…å­˜å¸ƒå±€ï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220709111433484.png"
loading="lazy"
alt="image-20220709111433484"
>&lt;/p>
&lt;p>æ¯ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„æ‰€æœ‰è€…ï¼Œè¿™ä¸ªæ‰€æœ‰è€…å¾ˆå®¹æ˜“æ¥å†³å®šä»€ä¹ˆæ—¶å€™ drop å®ƒæ‰€æ‹¥æœ‰çš„å€¼ã€‚ä½†æ˜¯ä¸€ä¸ªå•ç‹¬çš„å€¼å¯èƒ½ä¼šæ‹¥æœ‰å¾ˆå¤šå…¶ä»–çš„å€¼ï¼Œå¦‚ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­çš„å‘é‡ composersã€‚æ‰€æœ‰è€…å’Œå®ƒä»¬æ‰€æ‹¥æœ‰çš„å€¼ä¼šå½¢æˆä¸€ä¸ª&lt;strong>æ ‘&lt;/strong>ã€‚åœ¨æ¯ä¸ªæ ‘çš„æ ¹éƒ¨æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå½“è¿™ä¸ªå˜é‡ç¦»å¼€å®ƒçš„ä½œç”¨èŒƒå›´ï¼Œæ•´æ£µæ ‘ä¹Ÿä¼šè·Ÿç€ç¦»å¼€ã€‚&lt;/p>
&lt;p>Rusté€šå¸¸ä¸ä¼šæ˜¾å¼åœ° drop å®ƒçš„å€¼ï¼Œè€Œæ˜¯é€šè¿‡ï¼šç¦»å¼€å˜é‡çš„ä½œç”¨åŸŸï¼Œä»å‘é‡ä¸­åˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼Œæˆ–è€…å…¶ä»–çš„ã€‚&lt;/p>
&lt;p>Rustæ€ä¹ˆåœ¨è¿™äº›ä¸¥æ ¼çš„é™åˆ¶ä¸‹å®ç°çµæ´»æ€§å‘¢ï¼Ÿå¦‚ä¸‹åˆ—å‡ºäº†ä¸€äº›æ–¹å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>You can &lt;strong>move&lt;/strong> values from one owner to another. This allows you to build, rearrange, and tear down the tree.&lt;/li>
&lt;li>Very simple types like integers, floating-point numbers, and characters are excused from the ownership rules. These are called &lt;strong>Copy&lt;/strong> types.&lt;/li>
&lt;li>The standard library provides the reference-counted pointer types &lt;strong>Rc&lt;/strong> and &lt;strong>Arc&lt;/strong>, which allow values to have multiple owners, under some restrictions.&lt;/li>
&lt;li>You can â€œ&lt;strong>borrow a reference&lt;/strong>â€ to a value; references are non-owning pointers, with limited lifetimes.&lt;/li>
&lt;/ul>
&lt;h3 id="moves">Moves
&lt;/h3>&lt;p>In Rust, for most types, operations like assigning a value to a variable, passing it to a function, or returning it from a function donâ€™t copy the value: they &lt;em>move&lt;/em> it. &lt;strong>The source&lt;/strong> relinquishes ownership of the value to the destination and &lt;strong>becomes uninitialized&lt;/strong>; the destination now controls the valueâ€™s lifetime. Rust programs build up and tear down complex structures one value at a time, one move at a time.&lt;/p>
&lt;p>çœ‹çœ‹Pythonä¸­çš„å˜é‡èµ‹å€¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;udon&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;ramen&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;soba&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">t&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">u&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¼€å§‹çš„å†…å­˜å¸ƒå±€ï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220709132630820.png"
loading="lazy"
alt="image-20220709132630820"
>&lt;/p>
&lt;p>æ‰§è¡Œä»£ç åçš„å†…å­˜å¸ƒå±€ï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220709131847520.png"
loading="lazy"
alt="image-20220709131847520"
>&lt;/p>
&lt;p>Python has copied the pointer from s into t and u and updated the listâ€™s reference count to 3. Assignment in Python is cheap, but because it creates a new reference to the object, we must maintain reference counts to know when we can free the value.&lt;/p>
&lt;p>æ¥çœ‹çœ‹C++ä¸­çš„å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c++" data-lang="c++">&lt;span class="line">&lt;span class="cl">&lt;span class="k">using&lt;/span> &lt;span class="k">namespace&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">vector&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="s">&amp;#34;udon&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;ramen&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;soba&amp;#34;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">vector&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">t&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">vector&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">u&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¼€å§‹çš„å†…å­˜å¸ƒå±€&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220709132451059.png"
loading="lazy"
alt="image-20220709132451059"
>&lt;/p>
&lt;p>ä»£ç æ‰§è¡Œåçš„å†…å­˜å¸ƒå±€ï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220709132539575.png"
loading="lazy"
alt="image-20220709132539575"
>&lt;/p>
&lt;p>Depending on the values involved, assignment in C++ can consume unbounded amounts of memory and processor time. The advantage, however, is that itâ€™s easy for the program to decide when to free all this memory: when the variables go out of scope, everything allocated here gets cleaned up automatically.&lt;/p>
&lt;p>Rustä¸­çš„å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;udon&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;ramen&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;soba&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">()];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¼€å§‹çš„å†…å­˜åˆ†å¸ƒï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220709132918760.png"
loading="lazy"
alt="image-20220709132918760"
>&lt;/p>
&lt;p>åœ¨&lt;code>let t = s;&lt;/code>ä¹‹åï¼Œs çš„æ‰€æœ‰æƒå°± move åˆ° t ä¸Šäº†ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220709133027720.png"
loading="lazy"
alt="image-20220709133027720"
>&lt;/p>
&lt;p>è¿™æ—¶ s å˜æˆæœªåˆå§‹åŒ–çŠ¶æ€ï¼Œå†æ‰§è¡Œ &lt;code>let u = s;&lt;/code> å°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºä½¿ç”¨äº†æœªåˆå§‹åŒ–çš„å˜é‡ã€‚&lt;/p>
&lt;p>Consider the consequences of Rustâ€™s use of a move here. Like Python, the assignment is cheap: the program simply moves the three-word header of the vector from one spot to another. But like C++, ownership is always clear: the program doesnâ€™t need reference counting or garbage collection to know when to free the vector elements and string contents.&lt;/p>
&lt;p>å¦‚æœæƒ³å®ç°Pythoné‚£æ ·çš„å¼•ç”¨è®¡æ•°ï¼Œå¯ä»¥ç”¨ Rc å’Œ Arcï¼Œå¦‚æœæƒ³å®ç°C++é‚£æ ·çš„æ·±æ‹·è´ï¼Œå¯ä»¥æ˜¾å¼è°ƒç”¨ clone() æ–¹æ³•ã€‚&lt;/p>
&lt;h4 id="more-operations-that-move">More Operations That Move
&lt;/h4>&lt;p>moveè¯­ä¹‰çš„å‘ç”Ÿï¼š&lt;/p>
&lt;ul>
&lt;li>ç»™ä¸€ä¸ªå‡½æ•°ä¼ é€’å‚æ•°ï¼Œä¼šå°†æ‰€æœ‰æƒç»™å‚æ•°&lt;/li>
&lt;li>ä»å‡½æ•°è¿”å›ä¸€ä¸ªå€¼ä¼šå°†æ‰€æœ‰æƒç»™è°ƒç”¨è€…&lt;/li>
&lt;li>åˆ›å»ºä¸€ä¸ªå…ƒç»„ï¼Œä¼šå°†å€¼çš„æ‰€æœ‰æƒç»™å…ƒç»„&lt;/li>
&lt;/ul>
&lt;p>Moving values around like this may sound inefficient, but there are two things to keep in mind. First, the moves always apply to the value proper, not the heap storage they own. For vectors and strings, the &lt;em>value proper&lt;/em> is the three-word header alone; the potentially large element arrays and text buffers sit where they are in the heap. Second, the Rust compilerâ€™s code generation is good at â€œseeing throughâ€ all these moves; in practice, the machine code often stores the value directly where it belongs.&lt;/p>
&lt;h4 id="moves-and-control-flow">Moves and Control Flow
&lt;/h4>&lt;p>If itâ€™s possible for a variable to have had its value moved away and it hasnâ€™t definitely been given a new value since, itâ€™s considered uninitialized.&lt;/p>
&lt;h4 id="moves-and-indexed-content">Moves and Indexed Content
&lt;/h4>&lt;p>Weâ€™ve mentioned that a move leaves its source uninitialized, as the destination takes ownership of the value. &lt;strong>But not every kind of value owner is prepared to become uninitialized.&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Build a vector of the strings &amp;#34;101&amp;#34;, &amp;#34;102&amp;#34;, ... &amp;#34;105&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Vec&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">101&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">106&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// Pull out random elements from the vector.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">third&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// error: Cannot move out of index of Vec
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fifth&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// here too
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¦å°† vector çœ‹ä½œä¸€ä¸ªæ•´ä½“ï¼Œè¿™é‡Œä¸èƒ½å•ç‹¬å°† v[2] move å‡ºæ¥ã€‚å¦‚æœç¡®å®æƒ³æ‹¿å‡ºå…¶ä¸­çš„å…ƒç´ ï¼Œæœ‰ä¸‹é¢ä¸€äº›æ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Build a vector of the strings &amp;#34;101&amp;#34;, &amp;#34;102&amp;#34;, ... &amp;#34;105&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Vec&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">101&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">106&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// 1. Pop a value off the end of the vector:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fifth&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">expect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;vector empty!&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fifth&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;105&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// [&amp;#34;101&amp;#34;, &amp;#34;102&amp;#34;, &amp;#34;103&amp;#34;, &amp;#34;104&amp;#34;]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// 2. Move a value out of a given index in the vector,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// and move the last element into its spot:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">second&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">swap_remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">second&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;102&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// [&amp;#34;101&amp;#34;, &amp;#34;104&amp;#34;, &amp;#34;103&amp;#34;]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// 3. Swap in another value for the one we&amp;#39;re taking out:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">third&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">mem&lt;/span>::&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;substitute&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">third&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;103&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// [&amp;#34;101&amp;#34;, &amp;#34;104&amp;#34;, &amp;#34;substitute&amp;#34;]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// Let&amp;#39;s see what&amp;#39;s left of our vector.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;101&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;104&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;substitute&amp;#34;&lt;/span>&lt;span class="p">]);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¥çœ‹çœ‹å¾ªç¯&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;libertÃ©&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Ã©galitÃ©&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;fraternitÃ©&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">()];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">&amp;#39;!&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™é‡Œåœ¨forå¾ªç¯ä¸­ï¼Œv çš„æ‰€æœ‰æƒç»™äº†forå¾ªç¯ï¼Œv å°±å˜æˆæœªåˆå§‹åŒ–çš„çŠ¶æ€ï¼Œç„¶å for å¾ªç¯åˆ†ç¦»æ¯ä¸€ä¸ªå…ƒç´ ï¼Œå°†æ‰€æœ‰æƒç»™æ¯ä¸€ä¸ªã€‚å› ä¸º s æœ‰æ‰€æœ‰æƒï¼Œå°±å¯ä»¥åœ¨å†…éƒ¨ä¿®æ”¹å­—ç¬¦ä¸²äº†ã€‚&lt;/p>
&lt;p>ç”±äºåœ¨å¾ªç¯ä¸­å°† v çš„æ‰€æœ‰æƒç»™äº†å¾ªç¯ï¼Œå› æ­¤åé¢å°±ä¸èƒ½å†ä½¿ç”¨ v äº†ï¼Œä¸‹é¢ä»£ç å°±ä¼šæŠ¥é”™ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;libertÃ©&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Ã©galitÃ©&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;fraternitÃ©&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">()];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">&amp;#39;!&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_u&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// error[E0382]: use of moved value: `v`
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚æœæƒ³å¾—åˆ°ç»“æ„ä½“ä¸­çš„å…ƒç´ å€¼ï¼Œå¯ä»¥è°ƒç”¨ &lt;code>std::mem::replace&lt;/code>æ–¹æ³•ï¼Œå°†åŸæ¥çš„å€¼ç”¨&lt;code>None&lt;/code>æ¥å ä½ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">Person&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>: &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">birth&lt;/span>: &lt;span class="kt">i32&lt;/span> &lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">composers&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Vec&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">composers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Person&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>: &lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Palestrina&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">()),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">birth&lt;/span>: &lt;span class="mi">1525&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">mem&lt;/span>::&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">composers&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// let first_name = composers[0].name.take(); // å’Œä¸Šè¿°è¯­å¥è¾¾åˆ°çš„æ•ˆæœä¸€æ ·
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Palestrina&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">()));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">composers&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="copy-types-the-exception-to-moves">Copy Types: The Exception to Moves
&lt;/h3>&lt;p>Assigning a value of a Copy type copies the value, rather than moving it. The source of the assignment remains initialized and usable, with the same value it had before. Passing Copy types to functions and constructors behaves similarly.&lt;/p>
&lt;p>The standard Copy types include all the machine integer and floating-point numeric types, the char and bool types, and a few others. A tuple or fixed-size array of Copy types is itself a Copy type.&lt;/p>
&lt;p>Only types for which a simple bit-for-bit copy suffices can be Copy. As a rule of thumb, any type that needs to do something special when a value is dropped cannot be Copy.&lt;/p>
&lt;p>è‡ªå®šä¹‰çš„ç»“æ„ä½“æˆ–è€…æšä¸¾ç±»å‹å¯ä»¥ç”¨å±æ€§å®å®ç° Copy traitã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[derive(Copy, Clone)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Label&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">number&lt;/span>: &lt;span class="kt">u32&lt;/span> &lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>In Rust, every move is a byte-for-byte, shallow copy that leaves the source uninitialized. Copies are the same, except that the source remains initialized.&lt;/p>
&lt;p>One of Rustâ€™s principles is that costs should be apparent to the programmer. Basic operations must remain simple. Potentially expensive operations should be explicit, like the calls to &lt;code>clone&lt;/code> in the earlier example that make deep copies of vectors and the strings they contain.&lt;/p>
&lt;h3 id="rc-and-arc-shared-ownership">Rc and Arc: Shared Ownership
&lt;/h3>&lt;p>The Rc and Arc types are very similar; the only difference between them is that an Arc is safe to share between threads directlyâ€”the name Arc is short for &lt;em>atomic reference count&lt;/em>â€”whereas a plain Rc uses faster non-thread-safe code to update its reference count.&lt;/p>
&lt;p>å‰é¢çš„ä¾‹å­ç”¨Rustå®ç°Pythonä¸­å¼•ç”¨è®¡æ•°çš„æ•ˆæœï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">rc&lt;/span>::&lt;span class="n">Rc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// Rust can infer all these types; written out for clarity
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>: &lt;span class="nc">Rc&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Rc&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;shirataki&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>: &lt;span class="nc">Rc&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">clone&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>: &lt;span class="nc">Rc&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">clone&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å†…å­˜å¸ƒå±€ï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/image-20220709143228683.png"
loading="lazy"
alt="image-20220709143228683"
>&lt;/p>
&lt;p>Rustâ€™s memory and thread-safety guarantees depend on ensuring that no value is ever simultaneously shared and mutable. Rust assumes the referent of an Rc pointer might in general be shared, so it must not be mutable.&lt;/p>
&lt;p>However, Rust does provide ways to create mutable portions of otherwise immutable values; this is called &lt;em>interior mutability&lt;/em>. è¿™å¯èƒ½é€ æˆå¾ªç¯å¼•ç”¨ã€‚&lt;/p>
&lt;p>æƒ³è¦ç”¨Rcé¿å…å¾ªç¯å¼•ç”¨ã€‚You can sometimes avoid creating cycles of Rc pointers by using &lt;em>weak pointers&lt;/em>, &lt;strong>std::rc::Weak&lt;/strong>, for some of the links instead.&lt;/p>
&lt;h2 id="chapter-5-references">Chapter 5. References
&lt;/h2>&lt;p>Rust also has non-owning pointer types called &lt;em>references&lt;/em>, which have no effect on their referentsâ€™ lifetimes.&lt;/p>
&lt;p>In fact, itâ€™s rather the opposite: &lt;strong>references must never outlive their referents&lt;/strong>. You must make it apparent in your code that no reference can possibly outlive the value it points to. To emphasize this, Rust refers to creating a reference to some value as &lt;em>borrowing&lt;/em> the value: what you have borrowed, you must eventually return to its owner.&lt;/p>
&lt;h3 id="references-to-values">&lt;strong>References to Values&lt;/strong>
&lt;/h3>&lt;p>A reference lets you access a value without affecting its ownership. References come in two kinds:&lt;/p>
&lt;ul>
&lt;li>A &lt;em>shared reference&lt;/em> lets you read but not modify its referent. However, you can have as many shared references to a particular value at a time as you like. The expression &lt;code>&amp;amp;e &lt;/code>yields a shared reference to eâ€™s value; if e has the type T, then &amp;amp;e has the type &amp;amp;T, pronounced â€œref T.â€ Shared references are Copy.&lt;/li>
&lt;li>If you have a &lt;em>mutable reference&lt;/em> to a value, you may both read and modify the value. However, &lt;strong>you may not have any other references of any sort to that value active at the same time&lt;/strong>. The expression &amp;amp;mut e yields a mutable reference to eâ€™s value; you write its type as &amp;amp;mut T, which is pronounced â€œref mute T.â€ Mutable references are not Copy.&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">show&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">table&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Table&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">artist&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">works&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;works by &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">:&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">artist&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">work&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">works&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34; &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">work&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Iterating over a shared reference to a HashMap is defined to produce shared references to each entryâ€™s key and value: artist has changed from a &lt;code>String&lt;/code> to a &lt;code>&amp;amp;String&lt;/code>, and works from a &lt;code>Vec&amp;lt;String&amp;gt;&lt;/code> to a &lt;code>&amp;amp;Vec&amp;lt;String&amp;gt;&lt;/code>.&lt;/p>
&lt;p>The inner loop is changed similarly. Iterating over a shared reference to a vector is defined to produce shared references to its elements, so work is now a &amp;amp;String. No ownership changes hands anywhere in this function; itâ€™s just passing around non-owning references.&lt;/p>
&lt;p>When we pass a value to a function in a way that moves ownership of the value to the function, we say that we have passed it &lt;em>&lt;strong>by value&lt;/strong>&lt;/em>. If we instead pass the function a reference to the value, we say that we have passed the value &lt;em>&lt;strong>by reference&lt;/strong>&lt;/em>.&lt;/p>
&lt;h3 id="working-with-references">&lt;strong>Working with References&lt;/strong>
&lt;/h3>&lt;h4 id="rust-references-versus-c-references">&lt;strong>Rust References Versus C++ References&lt;/strong>
&lt;/h4>&lt;p>In Rust, references are created explicitly with the &lt;code>&amp;amp;&lt;/code> operator, and dereferenced explicitly with the &lt;code>*&lt;/code> operator.&lt;/p>
&lt;p>Since references are so widely used in Rust, the . operator implicitly dereferences its left operand, if needed.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">Anime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span> &lt;span class="kt">str&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bechdel_pass&lt;/span>: &lt;span class="kt">bool&lt;/span> &lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">aria&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Anime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>: &lt;span class="s">&amp;#34;Aria: The Animation&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bechdel_pass&lt;/span>: &lt;span class="nc">true&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">anime_ref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">aria&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">anime_ref&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Aria: The Animation&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// Equivalent to the above, but with the dereference written out:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">anime_ref&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Aria: The Animation&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The &lt;code>println!&lt;/code> macro used in the show function expands to code that uses the &lt;code>. &lt;/code>operator.&lt;/p>
&lt;p>The &lt;code>. &lt;/code>operator can also implicitly borrow a reference to its left operand, if needed for a method call.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1973&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1968&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">sort&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// implicitly borrows a mutable reference to v
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">sort&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// equivalent, but more verbose
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="assigning-references">&lt;strong>Assigning References&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The reference r initially points to x. But if b is true, the code points it at y instead.&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220711094925795.png"
loading="lazy"
alt="image-20220711094925795"
>&lt;/p>
&lt;h4 id="references-to-references">&lt;strong>References to References&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">Point&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="kt">i32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>: &lt;span class="kt">i32&lt;/span> &lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">point&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Point&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="mi">1000&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>: &lt;span class="mi">729&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">r&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Point&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">point&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rr&lt;/span>: &lt;span class="kp">&amp;amp;&amp;amp;&lt;/span>&lt;span class="nc">Point&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rrr&lt;/span>: &lt;span class="kp">&amp;amp;&amp;amp;&amp;amp;&lt;/span>&lt;span class="nc">Point&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">rr&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The . operator follows as many references as it takes to find its target.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rrr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">729&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220711095223237.png"
loading="lazy"
alt="image-20220711095223237"
>&lt;/p>
&lt;p>So the expression &lt;code>rrr.y&lt;/code>, guided by the type of &lt;code>rrr&lt;/code>, actually traverses three references to get to the &lt;code>Point&lt;/code> before fetching its &lt;code>y&lt;/code> field.&lt;/p>
&lt;h4 id="comparing-references">&lt;strong>Comparing References&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rx&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ry&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rrx&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">rx&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rry&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">ry&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rrx&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rry&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rrx&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rry&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¯”è¾ƒæ“ä½œç¬¦å’Œ&lt;code>.&lt;/code>æ“ä½œç¬¦ä¸€æ ·å¯ä»¥è§£å¼•ç”¨åˆ°æœ€ç»ˆçš„ç›®æ ‡å€¼ã€‚&lt;/p>
&lt;p>å¯ä»¥ç”¨&lt;code>std::ptr::eq&lt;/code>æ¥æ¯”è¾ƒåœ°å€æ˜¯å¦ç›¸ç­‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="fm">assert!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rx&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ry&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// their referents are equal
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="fm">assert!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">ptr&lt;/span>::&lt;span class="n">eq&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rx&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ry&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// but occupy different addresses
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¯”è¾ƒæ“ä½œç¬¦ä¸¤ç«¯çš„ç±»å‹å¿…é¡»ç›¸åŒï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="fm">assert!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rx&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rrx&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// error: type mismatch: `&amp;amp;i32` vs `&amp;amp;&amp;amp;i32`
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="fm">assert!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rx&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">rrx&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// this is okay
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="references-are-never-null">&lt;strong>References Are Never Null&lt;/strong>
&lt;/h4>&lt;p>Rust references are never null. There is no default initial value for a reference (you canâ€™t use any variable until itâ€™s been initialized, regardless of its type) and Rust wonâ€™t convert integers to references (outside of unsafe code), so you canâ€™t convert zero into a reference.&lt;/p>
&lt;p>In Rust, if you need a value that is either a reference to something or not, use the type &lt;code>Option&amp;lt;&amp;amp;T&amp;gt;&lt;/code>.&lt;/p>
&lt;h4 id="borrowing-references-to-arbitrary-expressions">&lt;strong>Borrowing References to Arbitrary Expressions&lt;/strong>
&lt;/h4>&lt;p>Rust lets you borrow a reference to the value of any sort of expression at all:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">factorial&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>: &lt;span class="kt">usize&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">usize&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">product&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">factorial&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// Arithmetic operators can see through one level of references.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="mi">1009&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1729&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Rust simply creates an anonymous variable to hold the expressionâ€™s value and makes the reference point to that. The lifetime of this anonymous variable depends on what you do with the reference:&lt;/p>
&lt;ul>
&lt;li>If you immediately assign the reference to a variable in a let statement (or make it part of some struct or array that is being immediately assigned), then Rust makes the anonymous variable live as long as the variable the let initializes.&lt;/li>
&lt;li>Otherwise, the anonymous variable lives to the end of the enclosing statement.&lt;/li>
&lt;/ul>
&lt;h4 id="references-to-slices-and-trait-objects">&lt;strong>References to Slices and Trait Objects&lt;/strong>
&lt;/h4>&lt;p>&lt;em>&lt;strong>fat pointers&lt;/strong>&lt;/em>:&lt;/p>
&lt;ul>
&lt;li>&lt;strong>A reference to a slice&lt;/strong> is a fat pointer, carrying the starting address of the slice and its length.&lt;/li>
&lt;li>Rustâ€™s other kind of fat pointer is a &lt;em>&lt;strong>trait object&lt;/strong>&lt;/em>, a reference to a value that implements a certain trait. A trait object carries a valueâ€™s address and a pointer to the traitâ€™s implementation appropriate to that value, for invoking the traitâ€™s methods.&lt;/li>
&lt;/ul>
&lt;h3 id="reference-safety">&lt;strong>Reference Safety&lt;/strong>
&lt;/h3>&lt;h4 id="borrowing-a-local-variable">&lt;strong>Borrowing a Local Variable&lt;/strong>
&lt;/h4>&lt;p>You canâ€™t borrow a reference to a local variable and take it out of the variableâ€™s scope:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// bad: reads memory `x` used to occupy
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The variables r and x both have a lifetime, extending from the point at which &lt;strong>theyâ€™re initialized until the point that the compiler can prove they are no longer in use&lt;/strong>. The third lifetime is that of a reference type: the type of the reference we borrow to x and store in r.&lt;/p>
&lt;p>&lt;strong>We say that the variableâ€™s lifetime must &lt;em>contain&lt;/em> or &lt;em>enclose&lt;/em> that of the reference borrowed from it.&lt;/strong> å˜é‡çš„ç”Ÿå‘½å‘¨æœŸå¿…é¡»åŒ…å«æˆ–æ¶µç›–ä»å®ƒé‚£é‡Œå€Ÿæ¥çš„å¼•ç”¨çš„ç”Ÿå‘½æœŸã€‚&lt;/p>
&lt;p>Hereâ€™s another kind of constraint: &lt;strong>if you store a reference in a variable r, the referenceâ€™s type must be good for the entire lifetime of the variable, from its initialization until its last us&lt;/strong>.&lt;/p>
&lt;p>&lt;strong>We say that the referenceâ€™s lifetime must contain or enclose the variableâ€™s.&lt;/strong> å¼•ç”¨çš„ç”Ÿå‘½æœŸå¿…é¡»åŒ…å«æˆ–æ¶µç›–ä¿å­˜å®ƒçš„å˜é‡çš„ç”Ÿå‘½æœŸã€‚&lt;/p>
&lt;p>The first kind of constraint limits how large a referenceâ€™s lifetime can be, while the second kind limits how small it can be.&lt;/p>
&lt;p>ä¸‹é¢çš„ç”Ÿå‘½å‘¨æœŸæ˜¯æ­£ç¡®çš„ï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220711103418336.png"
loading="lazy"
alt="image-20220711103418336"
>&lt;/p>
&lt;p>First, understand the constraints arising from the way the program uses references; then, find lifetimes that satisfy them.&lt;/p>
&lt;h4 id="receiving-references-as-function-arguments">&lt;strong>Receiving References as Function Arguments&lt;/strong>
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>Every static must be initialized.&lt;/strong>&lt;/li>
&lt;li>Mutable statics are inherently not thread-safe (after all, any thread can access a static at any time), and even in single-threaded programs, they can fall prey to other sorts of reentrancy problems. For these reasons, you may access a mutable static only within an unsafe block. In this example weâ€™re not concerned with those particular problems, so weâ€™ll just throw in an unsafe block and move on.&lt;/li>
&lt;/ul>
&lt;p>&lt;code>fn f&amp;lt;'a&amp;gt;(p: &amp;amp;'a i32)&lt;/code>, weâ€™re defining a function that takes a reference to an i32 with any given lifetime &amp;lsquo;a.&lt;/p>
&lt;p>In other words, we were unable to write a function that stashed a reference in a global variable without reflecting that intention in the functionâ€™s signature. In Rust, a functionâ€™s signature always exposes the bodyâ€™s behavior.&lt;/p>
&lt;p>If we do see a function with a signature like &lt;code>g(p: &amp;amp;i32)&lt;/code> (or with the lifetimes written out, &lt;code>g&amp;lt;'a&amp;gt;(p: &amp;amp;'a i32)&lt;/code>), we can tell that it &lt;em>does not&lt;/em> stash its argument &lt;code>p&lt;/code> anywhere that will outlive the call.&lt;/p>
&lt;h4 id="passing-references-to-functions">&lt;strong>Passing References to Functions&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// This could be written more briefly: fn g(p: &amp;amp;i32),
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// but let&amp;#39;s write out the lifetimes for now.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">g&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">p&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span> &lt;span class="kt">i32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">g&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä»gçš„ç­¾åçœ‹ï¼ŒRustçŸ¥é“å®ƒä¸ä¼šæŠŠpä¿å­˜åˆ°è¶…å‡ºè°ƒç”¨ç”Ÿå‘½å‘¨æœŸçš„å˜é‡é‡Œï¼›ä»»ä½•æ¶µç›–è°ƒç”¨çš„ç”Ÿå‘½å‘¨æœŸéƒ½æ»¡è¶³&lt;code>'a&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">f&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">p&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span> &lt;span class="kt">i32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// error
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™é‡Œ &lt;code>&amp;amp;x&lt;/code>ä¸èƒ½å­˜æ´»å¾—æ¯”&lt;code>x&lt;/code>é•¿ï¼Œè€Œå‡½æ•°ç­¾åè¦æ±‚&lt;code>&amp;amp;x&lt;/code>æ´»å¾—å’Œ&lt;code>&amp;amp;'static&lt;/code>ä¸€æ ·é•¿ï¼Œè¿™å°±æ— æ³•å¾—åˆ°æ»¡è¶³ï¼Œå› æ­¤æŠ¥é”™ã€‚&lt;/p>
&lt;h4 id="returning-references">&lt;strong>Returning References&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// v should have at least one element.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">smallest&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">i32&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="kt">i32&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚æœä¸€ä¸ªå‡½æ•°åªæœ‰ä¸€ä¸ªå¼•ç”¨ä½œä¸ºå‚æ•°å¹¶è¿”å›ä¸€ä¸ªå¼•ç”¨ï¼Œåˆ™å®ƒä»¬æ‹¥æœ‰ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸã€‚&lt;/p>
&lt;h4 id="structs-containing-references">&lt;strong>Structs Containing References&lt;/strong>
&lt;/h4>&lt;p>å½“å¼•ç”¨ç±»å‹å‡ºç°åœ¨å¦ä¸€ä¸ªç±»å‹çš„å®šä¹‰ä¸­æ—¶ï¼Œå¿…é¡»å†™å‡ºå…¶ç”Ÿå‘½å‘¨æœŸã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">S&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">r&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span> &lt;span class="kt">i32&lt;/span> &lt;span class="c1">// è¿™é‡Œ r å¿…é¡»å†™ä¸Šç”Ÿå‘½å‘¨æœŸ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æˆ–è€…&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">S&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">r&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span> &lt;span class="kt">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¿å­˜åœ¨rä¸­çš„ä»»ä½•å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸæœ€å¥½åŒ…å«&lt;code>'a&lt;/code>ï¼Œè€Œ&lt;code>'a&lt;/code>ä¹Ÿå¿…é¡»æ¯”ä¿å­˜åœ¨Sçš„ä»»ä½•å€¼éƒ½é•¿å¯¿ã€‚&lt;/p>
&lt;p>The lifetime of any reference you store in r had better enclose &amp;lsquo;a, and &amp;lsquo;a must outlast the lifetime of wherever you store the S.&lt;/p>
&lt;p>The assignment s = S { &amp;hellip; } stores this S in a variable whose lifetime extends to the end of the example, constraining &amp;lsquo;a to outlast the lifetime of s.&lt;/p>
&lt;p>And now Rust has arrived at the same contradictory constraints as before: &amp;lsquo;a must not outlive x, yet must live at least as long as s.&lt;/p>
&lt;h4 id="distinct-lifetime-parameters">&lt;strong>Distinct Lifetime Parameters&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">S&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span> &lt;span class="kt">i32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span> &lt;span class="kt">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚ä¸‹ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">S&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">x&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">y&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>If you work through the code carefully, you can follow its reasoning:&lt;/p>
&lt;ul>
&lt;li>Both fields of S are references with the same lifetime &amp;lsquo;a, so Rust must find a single lifetime that works for both s.x and s.y.&lt;/li>
&lt;li>We assign r = s.x, requiring &amp;lsquo;a to enclose râ€™s lifetime. (r &amp;lt;= &amp;lsquo;a)&lt;/li>
&lt;li>We initialized s.y with &amp;amp;y, requiring &amp;lsquo;a to be no longer than yâ€™s lifetime. (&amp;lsquo;a &amp;lt;= y)&lt;/li>
&lt;/ul>
&lt;h4 id="omitting-lifetime-parameters">&lt;strong>Omitting Lifetime Parameters&lt;/strong>
&lt;/h4>&lt;p>ä¸‰æ¡è§„åˆ™ï¼ˆè§&lt;a class="link" href="https://rustwiki.org/zh-CN/book/ch10-03-lifetime-syntax.html" target="_blank" rel="noopener"
>ç”Ÿå‘½å‘¨æœŸä¸å¼•ç”¨æœ‰æ•ˆæ€§&lt;/a>ï¼‰ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ç¬¬ä¸€æ¡è§„åˆ™æ˜¯æ¯ä¸€ä¸ªæ˜¯å¼•ç”¨çš„å‚æ•°éƒ½æœ‰å®ƒè‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸå‚æ•°ã€‚æ¢å¥è¯è¯´å°±æ˜¯ï¼Œæœ‰ä¸€ä¸ªå¼•ç”¨å‚æ•°çš„å‡½æ•°æœ‰ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼š&lt;code>fn foo&amp;lt;'a&amp;gt;(x: &amp;amp;'a i32)&lt;/code>ï¼Œæœ‰ä¸¤ä¸ªå¼•ç”¨å‚æ•°çš„å‡½æ•°æœ‰ä¸¤ä¸ªä¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œ&lt;code>fn foo&amp;lt;'a, 'b&amp;gt;(x: &amp;amp;'a i32, y: &amp;amp;'b i32)&lt;/code>ï¼Œä¾æ­¤ç±»æ¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¬¬äºŒæ¡è§„åˆ™æ˜¯å¦‚æœåªæœ‰ä¸€ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œé‚£ä¹ˆå®ƒè¢«èµ‹äºˆæ‰€æœ‰è¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼š&lt;code>fn foo&amp;lt;'a&amp;gt;(x: &amp;amp;'a i32) -&amp;gt; &amp;amp;'a i32&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¬¬ä¸‰æ¡è§„åˆ™æ˜¯å¦‚æœæ–¹æ³•æœ‰å¤šä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°å¹¶ä¸”å…¶ä¸­ä¸€ä¸ªå‚æ•°æ˜¯ &lt;code>&amp;amp;self&lt;/code> æˆ– &lt;code>&amp;amp;mut self&lt;/code>ï¼Œè¯´æ˜æ˜¯ä¸ªå¯¹è±¡çš„æ–¹æ³•(method)(è¯‘è€…æ³¨ï¼š è¿™é‡Œæ¶‰åŠ Rust çš„é¢å‘å¯¹è±¡å‚è§ 17 ç« ), é‚£ä¹ˆæ‰€æœ‰è¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°è¢«èµ‹äºˆ &lt;code>self&lt;/code> çš„ç”Ÿå‘½å‘¨æœŸã€‚ç¬¬ä¸‰æ¡è§„åˆ™ä½¿å¾—æ–¹æ³•æ›´å®¹æ˜“è¯»å†™ï¼Œå› ä¸ºåªéœ€æ›´å°‘çš„ç¬¦å·ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="sharing-versus-mutation">Sharing Versus Mutation
&lt;/h3>&lt;p>Throughout its lifetime, a shared reference makes its referent read-only: you may not assign to the referent or move its value elsewhere.&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;em>Shared access is read-only access.&lt;/em>&lt;/p>
&lt;p>Values borrowed by shared references are read-only. Across the lifetime of a shared reference, neither its referent, nor anything reachable from that referent, can be changed &lt;em>by anything&lt;/em>. There exist no live mutable references to anything in that structure, its owner is held read-only, and so on. Itâ€™s really frozen.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;em>Mutable access is exclusive access.&lt;/em>&lt;/p>
&lt;p>A value borrowed by a mutable reference is reachable exclusively via that reference. Across the lifetime of a mutable reference, there is no other usable path to its referent or to any value reachable from there. The only references whose lifetimes may overlap with a mutable reference are those you borrow from the mutable reference itself.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="taking-arms-against-a-sea-of-objects">&lt;strong>Taking Arms Against a Sea of Objects&lt;/strong>
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220712115540366.png"
loading="lazy"
alt="image-20220712115540366"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220712115559036.png"
loading="lazy"
alt="image-20220712115559036"
>&lt;/p>
&lt;h2 id="chapter-6-expressions">Chapter 6. Expressions
&lt;/h2>&lt;p>Rustä¸­ç»å¤§å¤šæ•°éƒ½æ˜¯è¡¨è¾¾å¼ã€‚&lt;/p>
&lt;h3 id="an-expression-language">An Expression Language
&lt;/h3>&lt;ul>
&lt;li>åœ¨Rustä¸­ï¼Œif å’Œ match éƒ½å¯ä»¥äº§ç”Ÿå€¼ã€‚ä¸€ä¸ªmatchè¡¨è¾¾å¼å¯ä»¥ç»™ä¸€ä¸ªå‡½æ•°æˆ–è€…å®æ¥ä¼ å‚ã€‚&lt;/li>
&lt;li>Rust ä¸­æ²¡æœ‰ä¸‰å…ƒæ“ä½œç¬¦ã€‚&lt;/li>
&lt;li>Rustä¸­æ‰€æœ‰çš„æ§åˆ¶æµç¨‹å·¥å…·æ˜¯è¡¨è¾¾å¼ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="precedence-and-associativity">Precedence and Associativity
&lt;/h3>&lt;ul>
&lt;li>é—­åŒ…çš„ä¼˜å…ˆçº§åœ¨æœ€åã€‚&lt;/li>
&lt;li>All of the operators that can usually be chained are left-associative. æ‰€æœ‰è¿™äº›æ“ä½œç¬¦åœ¨é“¾å¼æ“ä½œæ—¶éƒ½å…·æœ‰å·¦å…³è”æ€§ã€‚&lt;/li>
&lt;li>æ¯”è¾ƒæ“ä½œç¬¦ï¼Œèµ‹å€¼æ“ä½œç¬¦ï¼ˆassignment iperatorsï¼‰ä»¥åŠèŒƒå›´æ“ä½œç¬¦ï¼ˆ&lt;code>..&lt;/code>range operatorsï¼‰ä¸èƒ½é“¾å¼é“¾æ¥ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="blocks-and-semicolons">Blocks and Semicolons
&lt;/h3>&lt;ul>
&lt;li>block çš„å€¼æ˜¯æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚&lt;/li>
&lt;li>&lt;strong>let å£°æ˜å¿…é¡»è¦æœ‰åˆ†å·ã€‚&lt;/strong>&lt;/li>
&lt;li>&lt;strong>å¦‚æœ if è¡¨è¾¾å¼æ²¡æœ‰ elseï¼Œé‚£ä¹ˆæ€»æ˜¯è¿”å› ()ã€‚&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h3 id="declarations">Declarations
&lt;/h3>&lt;ul>
&lt;li>let å£°æ˜å¿…é¡»è¦æœ‰åˆ†å·ã€‚&lt;/li>
&lt;li>let å£°æ˜å¯ä»¥åªå£°æ˜å˜é‡è€Œä¸åˆå§‹åŒ–å®ƒã€‚&lt;/li>
&lt;li>åœ¨æ²¡æœ‰åˆå§‹åŒ–ä¸€ä¸ªå˜é‡ä¹‹å‰æ˜¯ä¸èƒ½ä½¿ç”¨å®ƒçš„ã€‚&lt;/li>
&lt;li>å˜é‡é®è”½ï¼Œå¯ä»¥æ˜¯ä¸åŒçš„ç±»å‹ã€‚&lt;/li>
&lt;li>&lt;strong>ä¸€ä¸ªå—å¯ä»¥åŒ…å«&lt;em>ç‰¹æ€§é¡¹&lt;/em>ï¼ˆ itemï¼‰ declarations&lt;/strong>ï¼Œå°±æ˜¯æŒ‡ä»»ä½•å¯ä»¥åœ¨ç¨‹åºæˆ–æ¨¡å—çš„å…¨å±€ä¸­å‡ºç°çš„å£°æ˜ï¼Œæ¯”å¦‚ fnï¼Œstruct æˆ–è€… useã€‚&lt;/li>
&lt;li>åµŒå¥—çš„ fn ä¸èƒ½ä½¿ç”¨ scope ä¸­çš„å±€éƒ¨å˜é‡ã€‚&lt;/li>
&lt;li>å—ä¸­ç”šè‡³å¯ä»¥åŒ…å«ä¸€ä¸ªå®Œæ•´çš„æ¨¡å—ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="if-and-match">if and match
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>if è¡¨è¾¾å¼çš„ condition å¿…é¡»æ˜¯ bool ç±»å‹çš„&lt;/strong>ï¼ŒRust ä¸ä¼šå°†æ•°å€¼æˆ–è€…æŒ‡é’ˆéšå¼è½¬æ¢æˆ Boolean ç±»å‹ã€‚&lt;/li>
&lt;li>åœ¨ if è¡¨è¾¾å¼å½¢å¼ä¸­ï¼Œå›´ç»•æ¡ä»¶çš„åœ†æ‹¬å·ä¸æ˜¯å¿…éœ€çš„ã€‚äº‹å®ä¸Šï¼Œrustcåœ¨å‘ç°ä¸å¿…è¦çš„åœ†æ‹¬å·æ—¶ä¼šç»™å‡ºè­¦å‘Šã€‚ä½†èŠ±æ‹¬å·æ˜¯å¿…éœ€çš„ã€‚&lt;/li>
&lt;li>ä¸€ä¸ªåªæœ‰ if æ²¡æœ‰ else çš„è¡¨è¾¾å¼ç›¸å½“äºæœ‰ä¸€ä¸ª ç©ºçš„else å—ã€‚å› æ­¤&lt;strong>å¦‚æœ if è¡¨è¾¾å¼æ²¡æœ‰ elseï¼Œé‚£ä¹ˆæ€»æ˜¯è¿”å› &lt;code>()&lt;/code>ã€‚&lt;/strong>&lt;/li>
&lt;li>ç¼–è¯‘å™¨å¯ä»¥ç”¨ä¸€ä¸ªè·³è½¬è¡¨ï¼ˆ jump table ï¼‰æ¥ä¼˜åŒ– match è¡¨è¾¾å¼ã€‚å¦‚æœ match çš„æ¯ä¸ªåˆ†æ”¯éƒ½äº§ç”Ÿä¸€ä¸ªå¸¸é‡å€¼ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥åº”ç”¨åŒæ ·çš„ä¼˜åŒ–ã€‚æ­¤æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæ„å»ºä¸€ä¸ªè¿™äº›å€¼çš„æ•°ç»„ï¼Œè€Œ match ä¼šè¢«ç¼–è¯‘ä¸ºå¯¹æ•°ç»„çš„è®¿é—®ã€‚é™¤äº†è¾¹ç•Œæ£€æŸ¥ï¼Œç¼–è¯‘åçš„ä»£ç ä¸­æ ¹æœ¬æ²¡æœ‰åˆ†æ”¯ã€‚&lt;/li>
&lt;li>&lt;strong>Rust ç¦æ­¢ match è¡¨è¾¾å¼æ²¡æœ‰è¦†ç›–åˆ°æ‰€æœ‰æƒ…å†µã€‚&lt;/strong>&lt;/li>
&lt;li>&lt;strong>ä¸€ä¸ª if è¡¨è¾¾å¼çš„æ‰€æœ‰å—å¿…é¡»äº§ç”Ÿç›¸åŒç±»å‹çš„å€¼ï¼Œå¯¹äº match è¡¨è¾¾å¼ä¹Ÿæ˜¯ä¸€æ ·çš„&lt;/strong>ï¼Œmatch è¡¨è¾¾å¼çš„æ‰€æœ‰åˆ†æ”¯ä¹Ÿéƒ½å¿…é¡»è¿”å›ç›¸åŒç±»å‹çš„å€¼ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="if-let">if let
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pattern&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">expr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">block1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">block2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç­‰ä»·äº&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">expr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">pattern&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">block1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">block2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="loops">Loops
&lt;/h3>&lt;p>æœ‰å››ç§ looping è¡¨è¾¾å¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">condition&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">block&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pattern&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">expr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">block&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">loop&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">block&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pattern&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">iterable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">block&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>while å’Œ for çš„å€¼ä¸€ç›´éƒ½æ˜¯ ()ï¼Œå¾ªç¯çš„å€¼æ˜¯&lt;code>()&lt;/code>ã€‚&lt;/li>
&lt;li>ç”¨ loop å¯ä»¥æ— é™å¾ªç¯ï¼Œé™¤éé‡åˆ° breakï¼Œreturnæˆ–è€…çº¿ç¨‹ panicsã€‚&lt;/li>
&lt;li>&lt;strong>&lt;code>for&lt;/code> å¾ªç¯æ¯è¿­ä»£ä¸€ä¸ªå€¼å°±ä¼šæ¶ˆè€—ä¸€ä¸ªå€¼ï¼Œæœ‰æ—¶å€™å¯ä»¥ä½¿ç”¨å¼•ç”¨ã€‚&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h3 id="control-flow-in-loops">Control Flow in Loops
&lt;/h3>&lt;ul>
&lt;li>break åªèƒ½åœ¨ loop ä¸­ï¼Œä¸èƒ½åœ¨ match ä¸­ã€‚&lt;/li>
&lt;li>&lt;strong>å¯ä»¥ç»™ break ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿™ä¸ªè¡¨è¾¾å¼çš„å€¼å°±æ˜¯ loop çš„å€¼ã€‚&lt;/strong>&lt;/li>
&lt;li>è‡ªç„¶åœ°ï¼Œ&lt;strong>æ‰€æœ‰ break è¡¨è¾¾å¼åœ¨ä¸€ä¸ªå¾ªç¯ä¸­å¿…é¡»æ˜¯ç›¸åŒç±»å‹çš„&lt;/strong>ï¼Œå¹¶ä¸”è¿™ä¸ªç±»å‹å°±æ˜¯ loop çš„ç±»å‹ã€‚&lt;/li>
&lt;li>&lt;strong>å¾ªç¯å¯ä»¥åŠ ä¸Šç”Ÿå‘½å‘¨æœŸçš„æ ‡ç­¾&lt;/strong>ï¼Œç„¶åå¯ä»¥ break è¿™ä¸ªæ ‡ç­¾ï¼Œbreak ä¹Ÿå¯ä»¥åŒæ—¶å¸¦ä¸Šå€¼è¡¨è¾¾å¼ã€‚&lt;/li>
&lt;li>æ ‡ç­¾åŒæ ·å¯ä»¥ç”¨äº continueã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="return-expressions">return Expressions
&lt;/h3>&lt;ul>
&lt;li>return è¡¨è¾¾å¼ä¼šé€€å‡ºå½“å‰å‡½æ•°ï¼Œå¹¶ä¸”ç»™è°ƒç”¨è€…è¿”å›ä¸€ä¸ªå€¼ã€‚&lt;/li>
&lt;li>å¯ä»¥å°†å‡½æ•°ä½“çœ‹æˆä¸€ä¸ªå—è¡¨è¾¾å¼ã€‚&lt;/li>
&lt;li>&lt;strong>return å¯ä»¥æ”¾å¼ƒæ­£åœ¨è¿è¡Œä¸­çš„å·¥ä½œã€‚&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h3 id="why-rust-has-loop">Why Rust Has loop
&lt;/h3>&lt;p>Rustç¼–è¯‘å™¨åˆ†æä½ çš„ç¨‹åºçš„æ§åˆ¶æµç¨‹ï¼š&lt;/p>
&lt;ul>
&lt;li>æ£€æŸ¥è¿”å›ç±»å‹&lt;/li>
&lt;li>æ£€æŸ¥å±€éƒ¨å˜é‡ä¸ä¼šä½¿ç”¨æœªåˆå§‹åŒ–çš„å€¼&lt;/li>
&lt;li>è­¦å‘Šä¸å¯åˆ°è¾¾çš„ä»£ç &lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸Šè¿™äº›ç§°ä¸º&lt;strong>æµæ•æ„Ÿ&lt;/strong>ï¼ˆflow-sensitiveï¼‰åˆ†æã€‚&lt;/p>
&lt;p>Rustè¿½æ±‚ç®€å•ï¼Œå…¶æµæ•æ„Ÿåˆ†æå‹æ ¹ä¸ä¼šæ£€æŸ¥å¾ªç¯æ¡ä»¶ï¼Œè€Œåªæ˜¯å‡è®¾ç¨‹åºä¸­çš„ä»»ä½•æ¡ä»¶ä¸æ˜¯trueå°±æ˜¯falseã€‚&lt;/p>
&lt;p>&lt;code>!&lt;/code> è¡¨ç¤ºæ˜¯ä¸€ä¸ªå‘æ•£å‡½æ•°ã€‚æ¯”å¦‚ breakï¼Œreturnï¼Œpanic!()ï¼Œæ— ç©·å¾ªç¯ï¼Œstd::process::exit() ï¼Œå®ƒä»¬éƒ½ä¸ä»¥æƒ¯å¸¸çš„æ–¹å¼ç»“æŸï¼Œè¿™äº›å¯ä»¥è·³è¿‡ä¹‹å‰è¯´çš„ç±»å‹ä¸€è‡´è§„åˆ™ã€‚&lt;/p>
&lt;h3 id="function-and-method-calls">Function and Method Calls
&lt;/h3>&lt;ul>
&lt;li>&lt;code>.location()&lt;/code> æ–¹æ³•å¯èƒ½å– player çš„å€¼æˆ–è€…å¼•ç”¨ã€‚&lt;/li>
&lt;li>&lt;code>.&lt;/code> æ“ä½œç¬¦å¯ä»¥è‡ªåŠ¨çš„è§£å¼•ç”¨ &lt;code>player&lt;/code>æˆ–è€…å€Ÿä¸€ä¸ªå¼•ç”¨ã€‚å¯ä»¥æ¥æ”¶å€¼æˆ–å¼•ç”¨ã€‚&lt;/li>
&lt;li>é™æ€æ–¹æ³•&lt;code>Vec::new()&lt;/code> ï¼Œéé™æ€æ–¹æ³•é€šè¿‡å€¼è°ƒç”¨ï¼š&lt;code>my_vec.len()&lt;/code>ã€‚&lt;/li>
&lt;li>å¯¹äºæ³›å‹ï¼Œå‡½æ•°æˆ–è€…æ–¹æ³•è°ƒç”¨è¦ç”¨æ¯”ç›®é±¼ turbofish æ“ä½œç¬¦ï¼Œæ¯”å¦‚ï¼š&lt;code>return Vec::&amp;lt;i32&amp;gt;::with_capcity(1000);&lt;/code>&lt;/li>
&lt;/ul>
&lt;h3 id="fields-and-elements">Fields and Elements
&lt;/h3>&lt;p>ç‚¹æ“ä½œç¬¦æˆ–è€…æ–¹æ‹¬å·çš„å·¦ä¾§æ˜¯ä¸€ä¸ªå¼•ç”¨æˆ–è€…æ™ºèƒ½æŒ‡é’ˆï¼Œé‚£ä¹ˆå®ƒå¯ä»¥è¢«è‡ªåŠ¨åœ°è§£å¼•ç”¨ï¼Œè¿™æ ·çš„è¡¨è¾¾å¼è¢«ç§°ä¸º &lt;strong>&lt;code>lvalues&lt;/code>&lt;/strong>ï¼Œå®ƒä»¬å¯ä»¥å‡ºç°åœ¨ä¸€ä¸ª assignment çš„å·¦ä¾§ã€‚&lt;/p>
&lt;p>æ“ä½œç¬¦ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="o">..&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">..=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="reference-operators">Reference Operators
&lt;/h3>&lt;ul>
&lt;li>&amp;amp;&lt;/li>
&lt;li>&amp;amp; mut&lt;/li>
&lt;li>&lt;code>*&lt;/code>æ“ä½œç¬¦å¯ä»¥ç”¨æ¥è§£å¼•ç”¨&lt;/li>
&lt;/ul>
&lt;h3 id="arithmetic-bitwise-comparsion-and-logical-operators">Arithmetic, Bitwise, Comparsion, and Logical Operators
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>ä¸èƒ½å°†&lt;code>-&lt;/code>å’Œ&lt;code>+&lt;/code> ç”¨åˆ°æ— ç¬¦å·çš„æ•°å€¼ç±»å‹ä¸Šã€‚&lt;/strong>&lt;/li>
&lt;li>&lt;code>%&lt;/code>ä¹Ÿå¯ä»¥ç”¨åœ¨æµ®ç‚¹æ•°ä¸Šã€‚&lt;/li>
&lt;li>&lt;code>!&lt;/code>è¡¨ç¤ºæŒ‰ä½éã€‚&lt;/li>
&lt;li>ä½æ“ä½œç¬¦çš„ä¼˜å…ˆçº§é«˜äºæ¯”è¾ƒæ“ä½œç¬¦çš„ä¼˜å…ˆçº§ã€‚&lt;/li>
&lt;li>æ¯”è¾ƒæ“ä½œç¬¦ä¸¤ç«¯çš„ç±»å‹å¿…é¡»éƒ½æ˜¯ bool ç±»å‹ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="assignment">Assignment
&lt;/h3>&lt;ul>
&lt;li>Rustä¸­å¯ä»¥æœ‰å¤åˆæ“ä½œç¬¦ï¼š&lt;code>+=&lt;/code> &lt;code>-=&lt;/code> &lt;code>*=&lt;/code>&lt;/li>
&lt;li>Rust&lt;strong>ä¸æ”¯æŒ&lt;/strong>é“¾å¼ assignmentï¼Œæ¯”å¦‚ &lt;code>a = b = 3&lt;/code>&lt;/li>
&lt;li>Rust&lt;strong>æ²¡æœ‰&lt;/strong>è‡ªå¢å’Œè‡ªå‡æ“ä½œç¬¦ï¼š&lt;code>++&lt;/code>å’Œ&lt;code>--&lt;/code>ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="type-casts">Type Casts
&lt;/h3>&lt;p>å¯ä»¥ç”¨ &lt;code>as&lt;/code> è¿›è¡Œç±»å‹è½¬æ¢ã€‚å‡ ç§ç±»å‹è½¬æ¢æ˜¯å…è®¸çš„ï¼š&lt;/p>
&lt;ul>
&lt;li>ä»»ä½•å†…ç½®çš„æ•°å€¼ä¹‹é—´å¯ä»¥è½¬æ¢ã€‚&lt;/li>
&lt;li>boolã€char æˆ–è€… C-like enum ç±»å‹å¯ä»¥è½¬æ¢ä¸ºæ•´æ•°ã€‚u8 å¯èƒ½è½¬æ¢ä¸º char ç±»å‹ã€‚&lt;/li>
&lt;li>æœ‰äº›å«æœ‰ unsafe çš„æŒ‡é’ˆç±»å‹çš„è½¬æ¢ä¹Ÿæ˜¯å…è®¸çš„ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä¸€äº›è‡ªåŠ¨è½¬æ¢ï¼Œè¢«ç§°ä¸º&lt;em>è§£å¼•ç”¨å¼ºåˆ¶è½¬æ¢&lt;/em>ï¼ˆderef coercionsï¼‰ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>&amp;amp;String&lt;/code> -&amp;gt; &lt;code>&amp;amp;str&lt;/code>&lt;/li>
&lt;li>&lt;code>&amp;amp;Vec&amp;lt;i32&amp;gt;&lt;/code> -&amp;gt; &lt;code>&amp;amp;[i32]&lt;/code>&lt;/li>
&lt;li>&lt;code>&amp;amp;Box[Chessboard]&lt;/code> -&amp;gt; &lt;code>&amp;amp;Chessboard&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>å®ƒä»¬å®ç°äº†å†…ç½®çš„ Deref traitã€‚&lt;/p>
&lt;h3 id="closures">Closures
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">is_even&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">%&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Rustè‡ªåŠ¨æ¨æ–­ç±»å‹ã€‚è°ƒç”¨é—­åŒ…å°±åƒè°ƒç”¨ä¸€ä¸ªå‡½æ•°é‚£æ ·ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">is_even&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="onward">Onward
&lt;/h3>&lt;p>è¡¨è¾¾å¼åªæ˜¯æˆ‘ä»¬æ€è€ƒ running codeã€‚&lt;/p>
&lt;h2 id="chapter-7--error-handling">Chapter 7. Error Handling
&lt;/h2>&lt;h3 id="panic">Panic
&lt;/h3>&lt;p>panic æ˜¯ç¨‹åºæœ¬èº«å‡ºç°ä¸€ä¸ªbugã€‚æ¯”å¦‚ï¼š&lt;/p>
&lt;ul>
&lt;li>æ•°ç»„è¶Šç•Œ&lt;/li>
&lt;li>æ•´æ•°é™¤é›¶&lt;/li>
&lt;li>å¯¹äºä¸€ä¸ª &lt;code>Result&lt;/code>è°ƒç”¨&lt;code>.expect()&lt;/code>ã€‚&lt;/li>
&lt;li>æ–­è¨€å¤±è´¥&lt;/li>
&lt;/ul>
&lt;p>panicæ—¶è¦ä¹ˆå±•å¼€æ ˆï¼Œè¦ä¹ˆä¸­æ­¢ç¨‹åºï¼Œå±•å¼€æ ˆæ˜¯é»˜è®¤çš„ã€‚&lt;/p>
&lt;h4 id="unwinding">Unwinding
&lt;/h4>&lt;p>panicå‘ç”Ÿï¼š&lt;/p>
&lt;ul>
&lt;li>ç»ˆç«¯æ‰“å°é”™è¯¯ä¿¡æ¯&lt;/li>
&lt;li>è¿è¡Œ &lt;code>RUST_BACKTRACE=1&lt;/code>ä¼šå°†æ ˆå±•å¼€ã€‚èµ„æºä¼šå…³é—­ï¼Œä¼šè°ƒç”¨dropæ–¹æ³•ã€‚&lt;/li>
&lt;li>æœ€åï¼Œçº¿ç¨‹é€€å‡ºã€‚&lt;/li>
&lt;/ul>
&lt;p>panicä¸æ˜¯å´©æºƒï¼Œä¸æ˜¯æœªå®šä¹‰è¡Œä¸ºã€‚panicåƒJavaä¸­çš„è¿è¡Œæ—¶å¼‚å¸¸ï¼Œå…¶è¡Œä¸ºæ˜¯æ˜ç¡®å®šä¹‰çš„ï¼Œåªæ˜¯ä¸åº”è¯¥å‘ç”Ÿè€Œå·²ã€‚&lt;/p>
&lt;p>panicæ˜¯å®‰å…¨çš„ï¼Œå®ƒä¸è¿åä»»ä½•Rustçš„å®‰å…¨è§„åˆ™ã€‚ä¸ä¼šåœ¨å†…å­˜ä¸­å¯¼è‡´æ‚¬ç©ºæŒ‡é’ˆæˆ–åˆå§‹åŒ–ä¸€åŠçš„å€¼ï¼ŒRustå±•å¼€æ ˆåï¼Œè¿›ç¨‹çš„å…¶ä»–éƒ¨åˆ†è¿˜å¯ä»¥è¿è¡Œã€‚&lt;/p>
&lt;p>panicæ˜¯çº¿ç¨‹çº§åˆ«çš„ã€‚&lt;/p>
&lt;p>æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥æ•è·æ ˆå±•å¼€ï¼Œè¿è¡Œpanicçº¿ç¨‹å­˜æ´»å¹¶ç»§ç»­è¿è¡Œã€‚ä½¿ç”¨æ ‡å‡†åº“ä¸­çš„&lt;code>std::panic::catch_unwind()&lt;/code>å‡½æ•°ã€‚&lt;/p>
&lt;h4 id="aborting">Aborting
&lt;/h4>&lt;ul>
&lt;li>å¦‚æœ&lt;code>.drop()&lt;/code>æ–¹æ³•è§¦å‘äº†ç¬¬äºŒä¸ªpanicå½“Ruståœ¨ç¬¬ä¸€ä¸ªpanicåå°è¯• clean upï¼Œè¿™ä¼šè¢«å½“ä½œæ˜¯è‡´å‘½çš„ã€‚Rustä¼šåœæ­¢å±•å¼€å¹¶ä¸”ç›´æ¥ç»ˆæ­¢æ•´ä¸ªæµç¨‹ã€‚&lt;/li>
&lt;li>ç¼–è¯‘åŠ ä¸Š&lt;code>-C panic=abort&lt;/code>ï¼Œç¬¬ä¸€ä¸ª panic å°±ç«‹é©¬ç»ˆæ­¢ç¨‹åºã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="result">Result
&lt;/h3>&lt;p>å¦‚æœä¸ä½¿ç”¨Resultå€¼ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªè­¦å‘Šã€‚&lt;/p>
&lt;h4 id="catching-errors">Catching Errors
&lt;/h4>&lt;p>ç”¨ match æ¥å¤„ç† error&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">get_weather&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hometown&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">report&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">display_weather&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hometown&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">report&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Err&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">err&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;error querying the weather: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">err&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">schedule_weather_retry&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½†æ˜¯ä¸Šé¢è¿™ç§æ–¹å¼å¤ªå†—é•¿äº†ã€‚è¿™é‡Œæœ‰ä¸€äº›æ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 1. è¿”å›ä¸€ä¸ªboolå€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">is_ok&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">is_err&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// 2. è¿”å›æˆåŠŸçš„å€¼ï¼Œè¿”å› Option&amp;lt;T&amp;gt;, æˆåŠŸå°±è¿”å›å€¼ï¼Œå¤±è´¥å°±è¿”å› None
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ok&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// 3. è¿”å›å¤±è´¥çš„å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">err&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// 4. è¿”å›æˆåŠŸçš„å€¼ï¼Œå¦åˆ™å°±è¿”å› fallbackï¼ŒæŠ›å¼ƒé”™è¯¯çš„å€¼ï¼Œåªæœ‰åœ¨å­˜åœ¨é€‚å½“åå¤‡å€¼çš„æƒ…å†µä¸‹æ‰å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">unwrap_or&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fallback&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// 5. è¿”å›æˆåŠŸçš„å€¼ï¼Œå¦åˆ™è¿”å› fallback_fnï¼Œè¿™é‡Œå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–è€…é—­åŒ…ï¼Œè¿™ä¸ªæ–¹æ³•é€‚åˆè®¡ç®—
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// åå¤‡å€¼å¦‚æœç”¨ä¸ä¸Šä¼šæµªè´¹çš„æƒ…å†µã€‚åªæœ‰åœ¨è¿”å›é”™è¯¯ç»“æœæ—¶æ‰ä¼šè°ƒç”¨ fallback_fn
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">unwrap_or_else&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fallback_fn&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// 6. è¿”å›æˆåŠŸçš„å€¼ï¼Œå¦åˆ™å°± panic
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">unwrap&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">expect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">message&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// panic æ—¶æ‰“å°ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 7. å°† Result&amp;lt;T, E&amp;gt; è½¬æ¢ä¸º Result&amp;lt;&amp;amp;T, &amp;amp;E&amp;gt;ï¼Œè¿™å¯¹äºè¿˜è¦ç”¨åŸæ¥çš„ result çš„å€¼å¾ˆæœ‰ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">as_ref&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// 8. å°† Result&amp;lt;T, E&amp;gt; è½¬æ¢ä¸º Result&amp;lt;&amp;amp;mut T, &amp;amp;mut E&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">as_mut&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="result-type-aliases">Result Type Aliases
&lt;/h4>&lt;p>åœ¨æ ‡å‡†åº“ std::io æ¨¡å—ä¸­æœ‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>::&lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Error&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™é‡Œç”¨äº† type aliasesã€‚&lt;/p>
&lt;h4 id="printing-errors">Printing Errors
&lt;/h4>&lt;p>&lt;code>std::io::Error&lt;/code>ã€&lt;code>std::fmt::Error&lt;/code>ã€&lt;code>std::str::Utf8Error&lt;/code>ç­‰ç­‰å®ç°äº†&lt;code>std::error::Error&lt;/code> traitã€‚ä¸€äº›å…¬ç”¨çš„æ–¹æ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>println!()&lt;/code>&lt;/p>
&lt;p>æ‰“å°é”™è¯¯ï¼Œç”¨&lt;code>{}&lt;/code>å¯ä»¥æ‰“å°ç®€çŸ­çš„é”™è¯¯ä¿¡æ¯ï¼Œç”¨&lt;code>{:?}&lt;/code>çš„Debugæ¨¡å¼æ‰“å°å‡ºé”™è¯¯ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>err.to_string()&lt;/code>&lt;/p>
&lt;p>è¿”å›é”™è¯¯ä¿¡æ¯å­—ç¬¦ä¸²ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>err.source()&lt;/code>&lt;/p>
&lt;p>è¿”å›ä¸€ä¸ªOptionï¼ŒåŒ…å«æ½œåœ¨çš„é”™è¯¯ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">error&lt;/span>::&lt;span class="n">Error&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">io&lt;/span>::&lt;span class="p">{&lt;/span>&lt;span class="n">Write&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stderr&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="sd">/// Dump an error message to `stderr`.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// If another error happens while building the error message or
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// writing to `stderr`, it is ignored.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">print_error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">err&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Error&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">writeln!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">stderr&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;error: {}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">err&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">source&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">err&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">source&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">writeln!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">stderr&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;caused by: {}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">source&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">err&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">source&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æƒ³è¦å±•å¼€é”™è¯¯ï¼Œåœ¨Rustä¸ç¨³å®šç‰ˆæœ¬ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨&lt;code>anyhow&lt;/code>åŒ…ã€‚&lt;/p>
&lt;h4 id="propagating-errors">Propagating Errors
&lt;/h4>&lt;p>å¦‚æœé”™è¯¯å‘ç”Ÿï¼Œæˆ‘ä»¬å¸Œæœ›è°ƒç”¨è€…æ¥å¤„ç†ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">weather&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">get_weather&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hometown&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">weather&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kr">try&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">get_weather&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hometown&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>?&lt;/code>æ“ä½œç¬¦çš„è¡Œä¸ºå–å†³äºè¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ï¼š&lt;/p>
&lt;ul>
&lt;li>å¦‚æœæ˜¯æˆåŠŸç»“æœï¼Œé‚£ä¹ˆå®ƒä¼šæ‰“å¼€Resultå¹¶å–å‡ºå…¶ä¸­çš„æˆåŠŸå€¼ã€‚&lt;/li>
&lt;li>å¦‚æœæ˜¯é”™è¯¯ç»“æœï¼Œé‚£ä¹ˆå®ƒä¼šç«‹å³ä»é—­åˆå‡½æ•°ä¸­è¿”å›ï¼Œå°†é”™è¯¯ç»“æœæ²¿è°ƒç”¨é“¾å‘ä¸Šä¼ æ’­ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;code>?&lt;/code>æ“ä½œç¬¦ä¸€æ ·å¯ä»¥ä½¿ç”¨matchè¡¨è¾¾å¼å®ç°ã€‚&lt;/p>
&lt;p>&lt;code>?&lt;/code>å¯ä»¥ç±»ä¼¼åœ°ç”¨åœ¨&lt;code>Option&lt;/code>ç±»å‹çš„å€¼ä¸Šé¢ã€‚In a function that returns Option, you can use ? to unwrap a value and return early in the case of None.&lt;/p>
&lt;h4 id="working-with-multiple-error-types">Working with Multiple Error Types
&lt;/h4>&lt;ul>
&lt;li>&lt;code>?&lt;/code>ä¸èƒ½å°†&lt;code>std::num::ParseIntError&lt;/code>è½¬æ¢ä¸º&lt;code>std::io::Error&lt;/code>ç±»å‹ã€‚&lt;/li>
&lt;li>æ‰€æœ‰æ ‡å‡†åº“ä¸­çš„é”™è¯¯éƒ½å¯ä»¥è½¬æˆ&lt;code>Box&amp;lt;dyn std::error::Error + Send + Sync + 'static'&amp;gt;&lt;/code>ç±»å‹ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">type&lt;/span> &lt;span class="nc">GenericError&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Box&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">error&lt;/span>::&lt;span class="n">Error&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Send&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Sync&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">GenericResult&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">GenericError&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>?&lt;/code>ä¼šè°ƒç”¨&lt;code>GenericError::from()&lt;/code>æ–¹æ³•æ¥è¿›è¡Œè‡ªåŠ¨è½¬æ¢ã€‚&lt;/p>
&lt;ul>
&lt;li>å¦‚æœæƒ³è¦å…¶ä¸­ä¸€ç§ç‰¹åˆ«çš„é”™è¯¯ç±»å‹è¿›è¡Œå¤„ç†ï¼Œå…¶å®ƒçš„é”™è¯¯è¿›è¡Œä¼ æ’­çš„è¯ï¼Œå¯ä»¥ç”¨æ³›å‹æ–¹æ³•&lt;code>error.downcast_ref::&amp;lt;ErrorType&amp;gt;()&lt;/code>&lt;/li>
&lt;/ul>
&lt;h4 id="dealing-with-errors-that-cant-happen">Dealing with Errors That &amp;ldquo;Can&amp;rsquo;t Happen&amp;rdquo;
&lt;/h4>&lt;ul>
&lt;li>å½“æˆ‘ä»¬ä¸æƒ³å¤„ç†ä¸ä¼šå‘ç”Ÿçš„é”™è¯¯æ—¶ï¼Œç”¨&lt;code>.unwrap()&lt;/code>æ–¹æ³•ã€‚&lt;/li>
&lt;li>ä¹Ÿå¯ä»¥ç”¨&lt;code>.expect(message)&lt;/code>æ–¹æ³•ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="ingoring-errors">Ingoring Errors
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">writeln!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">stderr&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;error: {}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">err&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç”¨ &lt;code>let _ = ...&lt;/code>ç”¨æ¥ç¦æ­¢è­¦å‘Šã€‚&lt;/p>
&lt;h4 id="handling-errors-in-main">Handling Errors in main()
&lt;/h4>&lt;ul>
&lt;li>ä¸€èˆ¬æƒ…å†µä¸‹åœ¨ main å‡½æ•°ä¸­ä¸èƒ½ç”¨ &lt;code>?&lt;/code> ï¼Œå› ä¸º &lt;code>main()&lt;/code> å‡½æ•°çš„è¿”å›ç±»å‹ä¸æ˜¯ &lt;code>Result&lt;/code>ã€‚&lt;/li>
&lt;li>æœ€ç®€å•çš„æ–¹æ³•æ˜¯ç”¨ &lt;code>.expect()&lt;/code>æ–¹æ³•ã€‚å‘ç”Ÿé”™è¯¯æ—¶ä¼š panic å¹¶ä¸”è¿”å›ä¸€ä¸ªéé›¶çš„é€€å‡ºä»£ç ã€‚&lt;/li>
&lt;li>æˆ–è€…å¯ä»¥è¿”å›ä¸€ä¸ª &lt;code>Result&lt;/code> ç±»å‹ï¼Œè¿™æ ·å°±èƒ½ç”¨&lt;code>?&lt;/code>ï¼ŒåŒæ—¶ç”¨debug &lt;code>{:?}&lt;/code>æ–¹å¼æ‰“å°å‡ºé”™è¯¯ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TideCalcError&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>æˆ–è€…è‡ªå·±å¤„ç†ç›¸åº”çš„é”™è¯¯ã€‚ç”¨&lt;code>print_error()&lt;/code>æ–¹æ³•ç»“åˆ&lt;code>if let&lt;/code> æ‰“å°ç®€ä»‹çš„é”™è¯¯ä¿¡æ¯ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="declaring-a-custom-error-type">Declaring a Custom Error Type
&lt;/h4>&lt;ul>
&lt;li>å¯ä»¥è‡ªå®šä¹‰&lt;code>Error&lt;/code>ç±»å‹ï¼Œç”¨ struct å®ç°ã€‚Errors åº”è¯¥å®ç°&lt;code>fmt::Display&lt;/code>å’Œ &lt;code>std::error::Error&lt;/code> traitã€‚&lt;/li>
&lt;li>æˆ–è€…ç›´æ¥ç”¨&lt;code>thiserror&lt;/code> ä¸­çš„ï¼ŒåŠ ä¸Šå±æ€§å®&lt;code>#[derive(Error)]&lt;/code>ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">thiserror&lt;/span>::&lt;span class="n">Error&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[derive(Error, Debug)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[error(&lt;/span>&lt;span class="s">&amp;#34;{message:} ({line:}, {column})&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">JsonError&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">message&lt;/span>: &lt;span class="nb">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">line&lt;/span>: &lt;span class="kt">usize&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">column&lt;/span>: &lt;span class="kt">usize&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="why-results">Why Results?
&lt;/h4>&lt;ul>
&lt;li>åœ¨ä»£ç ä¸­è®°å½•é”™è¯¯ï¼Œå¯¹é”™è¯¯åšå‡ºå†³å®šã€‚&lt;/li>
&lt;li>å…è®¸é”™è¯¯ä¼ æ’­ï¼Œä¼ æ’­è·¯å¾„å¯è§ã€‚&lt;/li>
&lt;li>æ¯ä¸€ä¸ªå‡½æ•°éƒ½æœ‰è¿”å›ç±»å‹ï¼Œè¿™æ ·æ›´æ¸…æ¥šå‡½æ•°å¯ä¸å¯èƒ½å¤±è´¥ã€‚&lt;/li>
&lt;li>Rust ä¼šæ£€æŸ¥ Result ç±»å‹çš„å€¼æ˜¯å¦è¢«ä½¿ç”¨ã€‚&lt;/li>
&lt;li>å› ä¸º Result æ˜¯ä¸€ä¸ªæ•°æ®ç±»å‹ï¼Œå› æ­¤æ›´å®¹æ˜“å¤„ç†ä¸€ç³»åˆ—æˆåŠŸæˆ–è€…å¤±è´¥çš„å€¼ï¼Œä¹Ÿæ›´å®¹æ˜“å­˜å‚¨ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="chapter-8-crates-and-modules">Chapter 8. Crates and Modules
&lt;/h2>&lt;h3 id="crates">Crates
&lt;/h3>&lt;p>Rust programs are made of &lt;em>crates&lt;/em>. Each crate is a complete, cohesive unit: all the source code for a single library or executable, plus any associated tests, examples, tools, configuration, and other junk.&lt;/p>
&lt;p>è¦äº†è§£åŒ…æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•åä½œï¼Œå¯ä»¥å¯¹ä¸€ä¸ªä½¿ç”¨äº†ä¾èµ–çš„å·²æœ‰é¡¹ç›®è¿è¡Œ &lt;code>cargo build&lt;/code> å‘½ä»¤ï¼ŒåŒæ—¶åŠ ä¸Š &lt;code>--verbose&lt;/code> æ ‡è®°ã€‚&lt;/p>
&lt;p>Cargo çš„ä¾èµ–ä¼šå½¢æˆ &lt;em>dependency graph&lt;/em> ã€‚&lt;/p>
&lt;p>Cargo ä¼šä½¿ç”¨ &lt;code>--crate-type lib&lt;/code>é€‰é¡¹ï¼Œä¼šå‘Šè¯‰ rustc ä¸è¦å»æ‰¾ main() å‡½æ•°ï¼Œè€Œæ˜¯ç”Ÿæˆä¸€ä¸ª &lt;code>.rlib&lt;/code> æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç¼–è¯‘åçš„ä»£ç ï¼Œå¯ä»¥ä¾›ä»¥ååœ¨åˆ›å»ºåº“æˆ–è€…&lt;code>.rlib&lt;/code>æ–‡ä»¶ä½¿ç”¨ã€‚&lt;/p>
&lt;blockquote>
&lt;p>When compiling libraries, Cargo uses the &amp;ndash; crate-type lib option. This tells rustc not to look for a main() function but instead to produce an &lt;em>.rlib&lt;/em> file containing compiled code that can be used to create binaries and other &lt;em>.rlib&lt;/em> files.&lt;/p>
&lt;/blockquote>
&lt;p>Cargoä½¿ç”¨ &lt;code>--crate-type bin&lt;/code> é€‰é¡¹ï¼Œç¼–è¯‘ç»“æœå°†æ˜¯ä¸€ä¸ªé’ˆå¯¹ç›®æ ‡å¹³å°çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ã€‚&lt;/p>
&lt;p>è¿è¡Œæ¯ä¸ª rustc å‘½ä»¤æ—¶ï¼ŒCargoä¼šé€šè¿‡&lt;code>--extern&lt;/code>é€‰é¡¹ç»™å‡ºå½“å‰åŒ…ç”¨åˆ°çš„æ¯ä¸ªåº“çš„æ–‡ä»¶åã€‚è¿™æ ·ï¼Œå½“rustcçœ‹åˆ°&lt;code>use image::png::PNGEncoder&lt;/code>è¿™è¡Œä»£ç æ—¶ï¼Œå®ƒå°±çŸ¥é“åˆ°ç£ç›˜çš„ä»€ä¹ˆä½ç½®å»æ‰¾è¿™ä¸ªåº“ç¼–ç åçš„ä»£ç äº†ã€‚Rustç¼–è¯‘å™¨éœ€è¦è®¿é—®&lt;code>.rlib&lt;/code>æ–‡ä»¶ï¼Œå› ä¸ºå…¶ä¸­åŒ…å«ç¬¬ä¸‰æ–¹åº“ç¼–è¯‘åçš„ä»£ç ã€‚Rustä¼šå°†è¿™äº›ä»£ç é™æ€é“¾æ¥åˆ°æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸Šã€‚&lt;code>.rlib&lt;/code>æ–‡ä»¶ä¹ŸåŒ…å«ç±»å‹ä¿¡æ¯ï¼ŒRustå¯ä»¥æ®æ­¤æ£€æŸ¥æˆ‘ä»¬ä»£ç ä¸­ç”¨åˆ°çš„åº“ç‰¹æ€§ç¡®å®åœ¨å¯¹åº”çš„åŒ…é‡Œå­˜åœ¨ï¼Œä»è€Œä¿è¯æ­£ç¡®åœ°ä½¿ç”¨å®ƒä»¬ã€‚è¿™ä¸ªæ–‡ä»¶é‡Œè¿˜åŒ…å«åŒ…çš„å…¬å…±å†…è”å‡½æ•°ã€æ³›å‹å’Œå®çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œè¿™äº›ç‰¹æ€§ç›´åˆ°Rusté‡åˆ°è°ƒç”¨å®ƒä»¬çš„ä»£ç æ—¶æ‰ä¼šç¼–è¯‘ä¸ºæœºå™¨ç ã€‚&lt;/p>
&lt;p>&lt;code>cargo build --release&lt;/code>äº§ç”Ÿä¼˜åŒ–ä»£ç ï¼Œä¼˜åŒ–ä»£ç çš„è¿è¡Œé€Ÿåº¦æ›´å¿«ï¼Œä½†ç¼–è¯‘æ—¶é—´æ¯”è¾ƒé•¿ï¼Œè€Œä¸”ä¸ä¼šæ£€æŸ¥æ•´å‹æº¢å‡ºï¼Œè¿˜ä¼šè·³è¿‡&lt;code>debug_assert!()&lt;/code>æ–­è¨€ï¼Œå¦å¤–å®ƒä»¬é’ˆå¯¹ panic ç”Ÿæˆçš„æ ˆè¿½è¸ªä¿¡æ¯ä¸€èˆ¬ä¸å¤ªå¯é ã€‚&lt;/p>
&lt;h4 id="editions">Editions
&lt;/h4>&lt;p>To evolve without breaking existing code, Rust uses &lt;em>editions&lt;/em>. The 2015 edition of Rust is compatible with Rust 1.0. The 2018 edition changed &lt;strong>async&lt;/strong> and &lt;strong>await&lt;/strong> into keywords, streamlined the module system, and introduced various other language changes that are incompatible with the 2015 edition.&lt;/p>
&lt;p>Rust promises that the compiler will always accept all extant editions of the language, and programs can freely mix crates written in different editions. Itâ€™s even fine for a 2015 edition crate to depend on a 2018 edition crate. In other words, &lt;strong>a crateâ€™s edition only affects how its source code is construed; edition distinctions are gone by the time the code has been compiled&lt;/strong>. This means thereâ€™s no pressure to update old crates just to continue to participate in the modern Rust ecosystem. Similarly, &lt;strong>thereâ€™s no pressure to keep your crate on an older edition to avoid inconveniencing its users&lt;/strong>. &lt;strong>You only need to change editions when you want to use new language features in your own code.&lt;/strong>&lt;/p>
&lt;p>If you have a crate written in an older edition of Rust, the &lt;strong>cargo fix&lt;/strong> command may be able to help you automatically upgrade your code to the newer edition. The Rust Edition Guide explains the cargo fix command in detail.&lt;/p>
&lt;h4 id="build-profiles">Build Profiles
&lt;/h4>&lt;p>æ„å»ºåˆ†æ&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å‘½ä»¤è¡Œ&lt;/th>
&lt;th>Cargo.tomlä½¿ç”¨çš„åŒºå—&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>cargo build&lt;/td>
&lt;td>[profile.dev]&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>cargo build &amp;ndash;realse&lt;/td>
&lt;td>[profile.realse]&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>cargo test&lt;/td>
&lt;td>[profile.test]&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>æƒ³è¦åŒæ—¶å¯ç”¨ä¼˜åŒ–å’Œè°ƒè¯•ï¼Œå¯ä»¥è¿™æ ·è®¾ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">profile&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">realse&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">debug&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">true&lt;/span> &lt;span class="c"># åœ¨å‘å¸ƒæ„å»ºä¸­å¯ç”¨è°ƒè¯•æ ‡è®°&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™é‡Œdebugè®¾ç½®æ§åˆ¶ rustc ä¸­çš„ -g é€‰é¡¹ã€‚æœ‰äº†è¿™ä¸ªé…ç½®ï¼Œå†æ‰§è¡Œ &lt;code>cargo build --realse&lt;/code>ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå¸¦æœ‰è°ƒè¯•ç¬¦å·çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ä¼˜åŒ–è®¾ç½®ä¸å—å½±å“ã€‚&lt;/p>
&lt;h3 id="modules">Modules
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">mod&lt;/span> &lt;span class="nn">spores&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cells&lt;/span>::&lt;span class="p">{&lt;/span>&lt;span class="n">Cell&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Gene&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// A cell made by an adult fern. It disperses on the wind as part of
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// the fern life cycle. A spore grows into a prothallus -- a whole
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// separate organism, up to 5mm across -- which produces the zygote
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// that grows into a new fern. (Plant sex is complicated.)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Spore&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Simulate the production of a spore by meiosis.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">produce_spore&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">factory&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Sporangium&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Spore&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Extract the genes in a particular spore.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">crate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">genes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">spore&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Spore&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Gene&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Mix genes to prepare for meiosis (part of interphase).
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">recombine&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">parent&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Cell&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>One function is marked pub(crate), &lt;strong>meaning that it is available anywhere inside this crate&lt;/strong>, but isnâ€™t exposed as part of the external interface. It canâ€™t be used by other crates, and it wonâ€™t show up in this crateâ€™s documentation.&lt;/p>
&lt;p>Anything that isnâ€™t marked pub is private and &lt;strong>can only be used in the same module&lt;/strong> in which it is defined, or &lt;strong>any child modules&lt;/strong>.&lt;/p>
&lt;h4 id="nested-modules">Nested Modules
&lt;/h4>&lt;p>modå¯ä»¥åµŒå¥—ã€‚&lt;/p>
&lt;p>Itâ€™s also possible to specify&lt;code>pub(super)&lt;/code>, making an item visible to the parent module only, and &lt;code>pub(in &amp;lt;path&amp;gt;)&lt;/code>, which makes it visible in a specific parent module and its descendants.&lt;/p>
&lt;h4 id="modules-in-separate-files">Modules in Separate Files
&lt;/h4>&lt;p>These three optionsâ€”modules in their own file, modules in their own directory with a &lt;em>mod.rs&lt;/em>, and modules in their own file with a supplementary directory containing submodulesâ€”give the module system enough flexibility to support almost any project structure you might desire.&lt;/p>
&lt;h4 id="paths-and-imports">Paths and Imports
&lt;/h4>&lt;p>ç”¨&lt;code>::&lt;/code>æ“ä½œç¬¦ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">mem&lt;/span>::&lt;span class="n">swap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s2&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æˆ–è€…ç”¨&lt;code>use&lt;/code>å¯¼å…¥ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">mem&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">mem&lt;/span>::&lt;span class="n">swap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s2&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸€æ¬¡å¯¼å…¥å¤šä¸ªæ¨¡å—ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">collections&lt;/span>::&lt;span class="p">{&lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashSet&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// import both
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">fs&lt;/span>::&lt;span class="p">{&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">File&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// import both `std::fs` and `std::fs::File`.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">io&lt;/span>::&lt;span class="n">prelude&lt;/span>::&lt;span class="o">*&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// import everything
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯¼å…¥æ—¶èµ·åˆ«å&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">io&lt;/span>::&lt;span class="nb">Result&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">IOResult&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// This return type is just another way to write `std::io::Result&amp;lt;()&amp;gt;`:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">save_spore&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">spore&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Spore&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">IOResult&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¨¡å—ä¸ä¼šè‡ªåŠ¨ä»è‡ªå·±çš„çˆ¶æ¨¡å—ç»§æ‰¿åå­—ã€‚å…³é”®å­—superæ˜¯çˆ¶æ¨¡å—çš„ä¸€ä¸ªåˆ«åï¼Œselfåˆ™æ˜¯å½“å‰æ¨¡å—çš„ä¸€ä¸ªåˆ«åï¼Œå…³é”®è¯ crate è¡¨ç¤ºåŒ…å«å½“å‰æ¨¡å—çš„åŒ…ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// proteins/synthesis.rs
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">crate&lt;/span>::&lt;span class="n">proteins&lt;/span>::&lt;span class="n">AminoAcid&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// explicitly import relative to crate root
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">synthesize&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">seq&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">AminoAcid&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// ok
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½¿ç”¨ç›¸å¯¹äºæ ¹çš„è·¯å¾„ï¼Œè¿™æ ·å½“æ¨¡å—ç§»åŠ¨æ—¶ï¼Œä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚&lt;/p>
&lt;p>&lt;code>use super::*&lt;/code>å¯ä»¥è®©å­æ¨¡å—è·å¾—çˆ¶æ¨¡å—çš„ç§æœ‰é¡¹ã€‚&lt;/p>
&lt;p>ç»å¯¹è·¯å¾„ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å¤–éƒ¨ crate
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>::&lt;span class="n">image&lt;/span>::&lt;span class="n">Pixels&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// the `image` crate&amp;#39;s `Pixels`
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è‡ªå·±å®šä¹‰çš„æ¨¡å—
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>::&lt;span class="n">image&lt;/span>::&lt;span class="n">Sampler&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// the `image` module&amp;#39;s `Sampler`
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="the-standard-prelude">&lt;strong>The Standard Prelude&lt;/strong>
&lt;/h4>&lt;p>Furthermore, a few particularly handy names, like Vec and Result, are included in the &lt;em>standard prelude&lt;/em> and automatically imported. Rust behaves as though every module, including the root module, started with the following import:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">prelude&lt;/span>::&lt;span class="n">v1&lt;/span>::&lt;span class="o">*&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The standard prelude contains a few dozen commonly used traits and types.&lt;/p>
&lt;p>å‚è€ƒ&lt;a class="link" href="https://rustwiki.org/zh-CN/std/prelude/index.html" target="_blank" rel="noopener"
>&lt;code>std::prelude&lt;/code>&lt;/a>ã€‚&lt;/p>
&lt;h4 id="making-use-declarations-pub">&lt;strong>Making use Declarations pub&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// in plant_structures/mod.rs
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>::&lt;span class="n">leaves&lt;/span>::&lt;span class="n">Leaf&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>::&lt;span class="n">roots&lt;/span>::&lt;span class="n">Root&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>This means that Leaf and Root are public items of the plant_structures module. They are still simple aliases for &lt;code>plant_structures::leaves::Leaf&lt;/code> and &lt;code>plant_structures::roots::Root&lt;/code>.&lt;/p>
&lt;h4 id="making-struct-fields-pub">&lt;strong>Making Struct Fields pub&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Fern&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">roots&lt;/span>: &lt;span class="nc">RootSet&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stems&lt;/span>: &lt;span class="nc">StemSet&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Outside the module, only public fields are accessible.&lt;/p>
&lt;h4 id="statics-and-constants">&lt;strong>Statics and Constants&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">ROOM_TEMPERATURE&lt;/span>: &lt;span class="kt">f64&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">20.0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// degrees Celsius
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">ROOM_TEMPERATURE&lt;/span>: &lt;span class="kt">f64&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">68.0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// degrees Fahrenheit
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>A constant is a bit like a C++ #define: the value is compiled into your code every place itâ€™s used. A static is a variable thatâ€™s set up before your program starts running and lasts until it exits. Use constants for magic numbers and strings in your code. Use statics for larger amounts of data, or any time you need to borrow a reference to the constant value.&lt;/p>
&lt;p>There are no mut constants.&lt;/p>
&lt;h3 id="turning-a-program-into-a-library">&lt;strong>Turning a Program into a Library&lt;/strong>
&lt;/h3>&lt;p>The first step is to factor your existing project into two parts: &lt;strong>a library crate&lt;/strong>, which contains all the shared code, and &lt;strong>an executable&lt;/strong>, which contains the code thatâ€™s only needed for your existing command-line program.&lt;/p>
&lt;p>By default, cargo build looks at the files in our source directory and figures out what to build. When it sees the file &lt;em>src/lib.rs&lt;/em>, it knows to build a library. The code in &lt;em>src/lib.rs&lt;/em> forms the &lt;em>root module&lt;/em> of the library. Other crates that use our library can only access the public items of this root module.&lt;/p>
&lt;h3 id="the-srcbin-directory">&lt;strong>The src/bin Directory&lt;/strong>
&lt;/h3>&lt;p>We can keep our program and our library in the same crate, too. Put this code into a file named &lt;em>src/bin/efern.rs&lt;/em>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fern_sim&lt;/span>::&lt;span class="p">{&lt;/span>&lt;span class="n">Fern&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">run_simulation&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fern&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Fern&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">size&lt;/span>: &lt;span class="mf">1.0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">growth_rate&lt;/span>: &lt;span class="mf">0.001&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">run_simulation&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fern&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;final fern size: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fern&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Because weâ€™ve put this file into &lt;em>src/bin&lt;/em>, Cargo will compile both the fern_sim library and this program the next time we run cargo build. We can run the efern program using cargo run &amp;ndash;bin efern. Hereâ€™s what it looks like, using &amp;ndash;verbose to show the commands Cargo is running.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">dependencies&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">fern_sim&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">path&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;../fern_sim&amp;#34;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯ä»¥å°† fern_sim ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„é¡¹ç›®ï¼Œç„¶ååœ¨ Cargo.toml ä¸ŠåŠ ä¸Šä¾èµ–ã€‚&lt;/p>
&lt;h3 id="attributes">Attributes
&lt;/h3>&lt;p>Rustç¨‹åºä¸­çš„ä»»ä½• item éƒ½å¯ä»¥ç”¨å±æ€§æ¥ä¿®é¥°ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>#[allow(non_camel_case_types)]&lt;/code> å¯ä»¥ä¸ä½¿ç”¨é©¼å³°å‘½åæ³•ã€‚&lt;/li>
&lt;li>&lt;code>#[cfg]&lt;/code> æ¡ä»¶ç¼–è¯‘&lt;/li>
&lt;li>&lt;code>#[inline]&lt;/code> å†…è”å‡½æ•°ã€‚å½“å‡ºç°ä¸€ä¸ªå‡½æ•°æˆ–è€…ä¸€ä¸ªæ–¹æ³•å®šä¹‰åœ¨ä¸€ä¸ª crate ä¸­ï¼Œè€Œæˆ‘ä»¬åœ¨å¦ä¸€ä¸ª crate ä¸­å»è°ƒç”¨ï¼Œå¯ä»¥æ˜¾å¼ä½¿ç”¨è¿™ä¸ªå±æ€§ã€‚
&lt;ul>
&lt;li>&lt;code>#[inline(always)]&lt;/code> è¦æ±‚å‡½æ•°åœ¨æ¯ä¸€æ¬¡è°ƒç”¨çš„ç‚¹éƒ½å±•å¼€å†…è”&lt;/li>
&lt;li>&lt;code>#[inline(never)]&lt;/code> è¦æ±‚ä¸€ä¸ªå‡½æ•°ä»ä¸è¿›è¡Œå†…è”&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>#[cfg]&lt;/code>å’Œ&lt;code>#[allow]&lt;/code>å¯ä»¥ç”¨åœ¨ä¸€æ•´ä¸ªæ¨¡å—æˆ–è€…é‡Œé¢çš„ä»»ä½•ä¸œè¥¿ï¼Œä½†æ˜¯ &lt;code>#[inline]&lt;/code> å’Œ &lt;code>#[test]&lt;/code>åªèƒ½ç”¨åœ¨å•ä¸ªé¡¹ä¸Šé¢ã€‚&lt;/li>
&lt;li>æƒ³åœ¨æ•´ä¸ª crate ä¸Šé¢ç»‘å®šå±æ€§ï¼Œåœ¨main.rs&lt;code>æˆ–è€…&lt;/code>lib.rs&lt;code>æ–‡ä»¶é¡¶éƒ¨ä¸­ç”¨&lt;/code>#!ã€‚&lt;code>#!&lt;/code>ä¹Ÿå¯ä»¥ç”¨åœ¨å‡½æ•°ï¼Œç»“æ„ä½“ä¸­ï¼Œä½†æ˜¯å®ƒåªèƒ½ä¸€è´¯åœ°ç”¨åœ¨æ–‡ä»¶çš„å¼€å¤´ï¼Œæ¥ç»‘å®šç»™æ•´ä¸ªæ¨¡å—æˆ–è€… crate ç»‘å®šä¸€ä¸ªå±æ€§ã€‚è€Œæœ‰çš„å±æ€§æ€»æ˜¯ç”¨ &lt;code>#!&lt;/code>ï¼Œå› ä¸ºå®ƒåªèƒ½ä½œç”¨åœ¨æ•´ä¸ª crate ä¸Šï¼Œæ¯”å¦‚ &lt;code>#![feature]&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>#![feature]&lt;/code> ç”¨æ¥è¡¨ç¤º Rust è¯­è¨€ä¸ç¨³å®šçš„ featuresï¼Œè¿™äº›æ˜¯å®éªŒæ€§è´¨çš„ã€‚å½“åé¢è¿™ä¸ª feature ç¨³å®šä¹‹åï¼Œç¼–è¯‘å™¨å°±ä¼šè­¦å‘Šï¼Œå»ºè®®ç§»é™¤ &lt;code>#![feature]&lt;/code>ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="tests-and-documention">Tests and Documention
&lt;/h3>&lt;ul>
&lt;li>&lt;code>#[test]&lt;/code> æ ‡è®°å‡½æ•°ï¼Œè¡¨æ˜è¿™ä¸ªæ˜¯æµ‹è¯•å‡½æ•°ï¼Œç”¨&lt;code>cargo test&lt;/code> å¯ä»¥æµ‹è¯•æ‰€æœ‰æµ‹è¯•å‡½æ•°ï¼Œå¦‚æœåªæƒ³æµ‹è¯•æŸä¸€ä¸ªï¼Œå¯ä»¥ç”¨&lt;code>cargo test name&lt;/code>æ¥æµ‹è¯•å…·ä½“çš„å‡½æ•°ã€‚&lt;/li>
&lt;li>&lt;code>assert!(expr)&lt;/code>ï¼šå¦‚æœè¡¨è¾¾å¼ä¸ºçœŸå°±é€šè¿‡æµ‹è¯•ï¼Œå¦åˆ™ panicã€‚&lt;/li>
&lt;li>&lt;code>assert_eq!(v1, v2)&lt;/code>ï¼šåˆ¤åˆ« v1 å’Œ v2 æ˜¯å¦ç›¸ç­‰ã€‚&lt;/li>
&lt;li>å¦‚æœåªæƒ³åœ¨ debug æ¨¡å¼ä¸‹æ£€éªŒæ˜¯å¦ç›¸ç­‰ï¼Œå¯ä»¥ç”¨ &lt;code>debug_assert!&lt;/code> å’Œ &lt;code>debug_assert_eq!&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>#[should_panic]&lt;/code> è¡¨ç¤ºä¼š panicã€‚æˆ–è€…è¿”å›&lt;code>Result&amp;lt;(), E&amp;gt;&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>cargo build&lt;/code>å’Œ&lt;code>cargo build --realse&lt;/code>ä¼šè·³è¿‡&lt;code>#[test]&lt;/code>æµ‹è¯•ä»£ç ã€‚&lt;/li>
&lt;li>å½“è¿è¡Œ &lt;code>cargo test&lt;/code> ï¼Œcargo ä¼šç¼–è¯‘ä¸¤æ¬¡ä»£ç ã€‚ä¸€æ¬¡æ˜¯å¸¸è§„çš„ï¼Œè¿˜æœ‰ä¸€æ¬¡æ˜¯æµ‹è¯•ç¨‹åºå¹¶å¯ç”¨æµ‹è¯•å¥—ä»¶ã€‚&lt;/li>
&lt;li>&lt;code>#[cfg(test)]&lt;/code>æ ‡è®°æ•´ä¸ªæ¨¡å—ã€‚&lt;/li>
&lt;li>ä¸€èˆ¬ cargo test ä¼šå¯ç”¨å¤šçº¿ç¨‹æ¥ä¸€æ¬¡è¿è¡Œå¤šä¸ªæµ‹è¯•ï¼Œç”¨ &lt;code>cargo test name&lt;/code> å’Œ &lt;code>cargo test -- --test-threads 1&lt;/code>æ¥é™åˆ¶åªç”¨ä¸€ä¸ªçº¿ç¨‹æµ‹è¯•ã€‚&lt;/li>
&lt;li>&lt;code>cargo test -- --no-capture&lt;/code>ï¼šä¹Ÿè¾“å‡ºé‚£äº›é€šè¿‡çš„æµ‹è¯•ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="integration-tests">Integration Tests
&lt;/h4>&lt;ul>
&lt;li>é›†æˆæµ‹è¯•ï¼Œå¯ä»¥ç”¨æ¥æµ‹è¯•ä¸€äº›å…¬å…±çš„APIï¼Œç«™åœ¨ç”¨æˆ·çš„è§’åº¦ã€‚&lt;/li>
&lt;li>å•ç‹¬å»ºç«‹ä¸€ä¸ª &lt;code>tests&lt;/code>çš„æ–‡ä»¶å¤¹ï¼Œæ”¾åœ¨å’Œ &lt;code>src&lt;/code> åŒä¸€ä¸ªè·¯å¾„ä¸‹ï¼Œå½“è¿è¡Œ &lt;code>cargo test&lt;/code> çš„æ—¶å€™ï¼Œé›†æˆæµ‹è¯•å’Œå•å…ƒæµ‹è¯•éƒ½ä¼šè¿è¡Œã€‚å¦‚æœåªæƒ³è¿è¡Œé›†æˆæµ‹è¯•ï¼Œå¯ä»¥ç”¨å‘½ä»¤&lt;code>cargo test --test unfurl&lt;/code>æ¥è¿è¡Œä¸€ä¸ªå…·ä½“çš„é›†æˆæµ‹è¯•ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="documentation">Documentation
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="n">cargo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">doc&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">--&lt;/span>&lt;span class="n">no&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">deps&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">--&lt;/span>&lt;span class="n">open&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&amp;ndash;no-deps ï¼šåªç”Ÿæˆè‡ªå·±çš„æ–‡æ¡£ï¼Œä¸ç”Ÿæˆæ‰€æœ‰å®ƒä¾èµ–çš„ cratesã€‚&lt;/li>
&lt;li>&amp;ndash;openï¼šåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æ–‡æ¡£ã€‚&lt;/li>
&lt;li>ç”Ÿæˆçš„æ–‡æ¡£æ”¾åœ¨ target/doc ç›®å½•ä¸‹ã€‚&lt;/li>
&lt;li>&lt;code>///&lt;/code>çš„æ–‡æ¡£æ³¨é‡Šç±»ä¼¼&lt;code>#[doc]&lt;/code>å±æ€§ã€‚è€Œ&lt;code>//!&lt;/code>å’Œ&lt;code>#![doc]&lt;/code>ä¸€æ ·ã€‚&lt;/li>
&lt;li>æ–‡æ¡£æ³¨é‡Šä¸­markdown çš„é“¾æ¥ä¹Ÿå¯ä»¥é“¾æ¥åˆ°ç›¸åº”ä»£ç çš„æ–‡æ¡£ã€‚&lt;/li>
&lt;li>One special feature of doc comments in Rust is that Markdown links can use Rust item paths, like leaves::Leaf, instead of relative URLs, to indicate what they refer to.&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// Create and return a [`VascularPath`] which represents the path of
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// nutrients from the given [`Root`][r] to the given [`Leaf`](leaves::Leaf).
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// [r]: roots::Root
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">trace_path&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">leaf&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">leaves&lt;/span>::&lt;span class="n">Leaf&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">root&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">roots&lt;/span>::&lt;span class="n">Root&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">VascularPath&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>You can also add search aliases to make it easier to find things using the built-in search feature.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[doc(alias = &lt;/span>&lt;span class="s">&amp;#34;route&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">VascularPath&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ–‡æ¡£ä¸­çš„ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// A block of code in a doc comment:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="c1">//// if samples::everything().works() {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//// println!(&amp;#34;ok&amp;#34;);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//// }
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æˆ–è€…ç”¨Markdownæ ¼å¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Another snippet, the same code, but written differently:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// if samples::everything().works() {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// println!(&amp;#34;ok&amp;#34;);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ```
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="doc-tests">Doc-Tests
&lt;/h4>&lt;ul>
&lt;li>Rust ä¹Ÿä¼šæµ‹è¯•åœ¨æ–‡æ¡£æ³¨é‡Šä¸­çš„ä»£ç ï¼Œä¼šéšå¼çš„åŠ åœ¨ &lt;code>fn main()&lt;/code> å‡½æ•°é‡Œé¢ã€‚&lt;/li>
&lt;li>The idea behind doc-tests is not to put all your tests into comments. Rather, you write the best possible documentation, and Rust makes sure the code samples in your documentation actually compile and run.&lt;/li>
&lt;li>To hide a line of a code sample, put a # followed by a space at the beginning of that line.&lt;/li>
&lt;li>rustdoc therefore treats any code block containing the exact string fn main as a complete program and doesnâ€™t add anything to it.&lt;/li>
&lt;li>To tell Rust to compile your example, but stop short of actually running it, use a fenced code block with the &lt;code>no_run&lt;/code> annotation.&lt;/li>
&lt;li>If the code isnâ€™t even expected to compile, use &lt;code>ignore&lt;/code> instead of &lt;code>no_run&lt;/code>. Blocks marked with &lt;code>ignore&lt;/code> donâ€™t show up in the output of cargo run, but no_run tests show up as having passed if they compile.&lt;/li>
&lt;li>If the code block isnâ€™t Rust code at all, use the name of the language, like c++ or sh, or text for plain text.&lt;/li>
&lt;/ul>
&lt;h3 id="specifying-dependencies">&lt;strong>Specifying Dependencies&lt;/strong>
&lt;/h3>&lt;p>ç”¨ç‰ˆæœ¬å·ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">image&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;0.6.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Gitä»“åº“åœ°å€å’Œä¿®è®¢ç‰ˆæœ¬å·ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">image&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">git&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;https://github.com/Piston/image.git&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rev&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;528f19c&amp;#34;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯ä»¥æŒ‡å®šä½¿ç”¨å“ªä¸ª revã€tag æˆ– branchã€‚&lt;/p>
&lt;p>å¦ä¸€ç§æ–¹å¼æ˜¯æŒ‡å®šåŒ…å«ä¾èµ–åŒ…æºä»£ç çš„ç›®å½•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">image&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">path&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;vendor/image&amp;#34;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="versions">&lt;strong>Versions&lt;/strong>
&lt;/h4>&lt;p>å¯¹äºåœ¨ Cargo.toml ä¸­å†™çš„ &lt;code>image = &amp;quot;0.6.1&amp;quot;&lt;/code> ï¼ŒCargo çš„è§£é‡Šå¹¶æ²¡æœ‰é‚£ä¹ˆä¸¥æ ¼ã€‚å®ƒä¼šä½¿ç”¨ä¸ 0.6.1 ç‰ˆå…¼å®¹çš„æœ€æ–°ç‰ˆæœ¬çš„ image ã€‚&lt;/p>
&lt;p>å…¼å®¹æ€§çš„åˆ¤æ–­åŸºæœ¬ä¸Šéµå¾ªâ€œè¯­ä¹‰åŒ–ç‰ˆæœ¬â€çš„æ€æƒ³ã€‚&lt;/p>
&lt;ul>
&lt;li>ä»¥0.0å¼€å¤´çš„ç‰ˆæœ¬è¿‡äºåŸå§‹ï¼ŒCargoä¸ä¼šå‡è®¾å®ƒä¸ä»»ä½•å…¶ä»–ç‰ˆæœ¬å…¼å®¹ã€‚&lt;/li>
&lt;li>ä»¥0.xï¼ˆåŸºæœ¬xä¸æ˜¯0ï¼‰å¼€å¤´çš„ç‰ˆæœ¬ï¼Œä¼šè¢«è®¤ä¸ºåŒå…¶ä»–ä»¥0.xå¼€å¤´çš„ç‰ˆæœ¬å…¼å®¹ã€‚&lt;/li>
&lt;li>å¦‚æœé¡¹ç›®è¾¾åˆ°1.0ç‰ˆï¼Œåˆ™åªæœ‰æ–°çš„ä¸»ç‰ˆæœ¬å·æ‰ä¼šç ´åå…¼å®¹æ€§ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä¸åŒé¡¹ç›®å¯¹ä¾èµ–å’Œç‰ˆæœ¬æœ‰ä¸åŒçš„éœ€æ±‚ã€‚å› æ­¤ï¼ŒæŒ‡å®šç‰ˆæœ¬æ—¶å¯ä»¥ä½¿ç”¨æ“ä½œç¬¦ã€‚ä¾‹å¦‚&lt;code>&amp;gt;&lt;/code>ã€&lt;code>&amp;gt;=&lt;/code>ã€&lt;code>&amp;lt;=&lt;/code>ã€‚&lt;/p>
&lt;p>ä½¿ç”¨é€šé…ç¬¦&lt;code>*&lt;/code>è¡¨ç¤ºä»»ä½•ç‰ˆæœ¬éƒ½å¯ä»¥ï¼Œè¿™ä¸ªå¹¶ä¸å¤šè§ã€‚&lt;/p>
&lt;h4 id="cargolock">&lt;strong>Cargo.lock&lt;/strong>
&lt;/h4>&lt;p>åœ¨ç¬¬ä¸€æ¬¡æ„å»ºé¡¹ç›®æ—¶ï¼ŒCargoä¼šè¾“å‡ºä¸€ä¸ªCargo.lockæ–‡ä»¶ï¼Œè®°å½•å®ƒä½¿ç”¨çš„æ¯ä¸ªåŒ…çš„ç¡®åˆ‡çš„ç‰ˆæœ¬å·ã€‚å¦‚æœæ‰‹åŠ¨ä¿®æ”¹äº†Cargo.tomlæ–‡ä»¶ä¸­çš„ç‰ˆæœ¬å·æˆ–è€…è¿è¡Œ&lt;code>cargo update&lt;/code>æ—¶ï¼Œä¼šæŠŠæ–°ç‰ˆæœ¬å·ä¿å­˜åˆ°Cargo.lockæ–‡ä»¶ä¸­ã€‚&lt;/p>
&lt;p>å¯¹äºä¿å­˜åœ¨Gitä»£ç åº“çš„ä¾èµ–ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚&lt;/p>
&lt;p>å¦‚æœä½ çš„é¡¹ç›®æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œåº”è¯¥æŠŠCargo.lockæäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚å¦‚æœæ˜¯ä¸€ä¸ªæ™®é€šçš„Ruståº“ï¼Œå°±ä¸ç”¨æäº¤Cargo.lockäº†ã€‚å¦‚æœæ°å¥½ä½ çš„é¡¹ç›®æ˜¯ä¸€ä¸ªå…±äº«åº“ï¼Œæ²¡æœ‰è¿™ç§ä¸‹æ¸¸çš„cargoç”¨æˆ·ï¼Œé‚£å°±åº”è¯¥æä¾›Cargo.lockã€‚&lt;/p>
&lt;h3 id="publishing-crates-to-cratesio">&lt;strong>Publishing Crates to crates.io&lt;/strong>
&lt;/h3>&lt;p>&lt;code>cargo package&lt;/code> è®©Cargoæ‰“åŒ…ã€‚ä¼šåˆ›å»ºä¸€ä¸ª&lt;code>.crate&lt;/code>æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«åº“çš„æºæ–‡ä»¶ä»¥åŠCargo.tomlã€‚&lt;/p>
&lt;p>&lt;code>cargo package --list&lt;/code>å¯ä»¥æŸ¥çœ‹å…¶ä¸­åŒ…å«ä»€ä¹ˆæ–‡ä»¶ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">package&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">name&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;fern_sim&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">version&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;0.1.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">edition&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;2018&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">authors&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;You &amp;lt;you@example.com&amp;gt;&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">license&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;MIT&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">homepage&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;https://fernsim.example.com/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">repository&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;https://gitlair.com/sporeador/fern_sim&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">documentation&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;http://fernsim.example.com/docs&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">description&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">Fern simulation, from the cellular level up.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯ä»¥åŒæ—¶æŒ‡å®šæœ¬åœ°ä¾èµ–å’Œç‰ˆæœ¬å·ï¼Œä¸è¿‡è¦ä¿è¯äºŒè€…åŒæ­¥ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">image&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">path&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;vendor/image&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">version&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;0.13.0&amp;#34;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¥ç€å°±æ˜¯å‘å¸ƒäº†ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ cargo login 5j0dV54BjlXBpUUbfIj7G9DvNl1vsWW1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ cargo publish
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Updating registry &lt;span class="sb">`&lt;/span>https://github.com/rust-lang/crates.io-index&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Uploading fern_sim v0.1.0 &lt;span class="o">(&lt;/span>file:///.../fern_sim&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="workspace">Workspace
&lt;/h3>&lt;p>ä½¿ç”¨Cargoå·¥ä½œç©ºé—´å¯ä»¥èŠ‚çœç¼–è¯‘æ—¶é—´å’Œç£ç›˜ç©ºé—´ã€‚æ‰€è°“å·¥ä½œç©ºé—´ï¼Œå°±æ˜¯å…±äº«ç›¸åŒæ„å»ºç›®å½•å’ŒCargo.lockæ–‡ä»¶çš„ä¸€ç»„åŒ…ã€‚&lt;/p>
&lt;p>è¦ä½¿ç”¨å·¥ä½œç©ºé—´ï¼Œåªéœ€åœ¨å­˜å‚¨åº“çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªCargo.tomlæ–‡ä»¶ï¼Œå¹¶æŠŠä¸‹é¢å‡ è¡Œæ”¾è¿›å»ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">workspace&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">members&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;fern_sim&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;fern_img&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;fern_video&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Here fern_sim etc. are the names of the subdirectories containing your crates. Delete any leftover &lt;em>Cargo.lock&lt;/em> files and &lt;em>target&lt;/em> directories that exist in those subdirectories.&lt;/p>
&lt;p>The command &lt;code>cargo build --workspace&lt;/code> builds all crates in the current workspace. &lt;code>cargo test&lt;/code> and &lt;code>cargo doc&lt;/code> accept the &lt;code>--workspace&lt;/code> option as well.&lt;/p>
&lt;h2 id="chapter-9-structs">&lt;strong>Chapter 9. Structs&lt;/strong>
&lt;/h2>&lt;p>Rust has three kinds of struct types, &lt;em>&lt;strong>named-field&lt;/strong>&lt;/em>, &lt;em>&lt;strong>tuple-like&lt;/strong>&lt;/em>, and &lt;em>&lt;strong>unit-like&lt;/strong>&lt;/em>, which differ in how you refer to their components: a named-field struct gives a name to each component, whereas a tuple- like struct identifies them by the order in which they appear. Unit-like structs have no components at all; these are not common, but more useful than you might think.&lt;/p>
&lt;h3 id="named-field-structs">&lt;strong>Named-Field Structs&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// A rectangle of eight-bit grayscale pixels.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">GrayscaleMap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">pixels&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">size&lt;/span>: &lt;span class="p">(&lt;/span>&lt;span class="kt">usize&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">usize&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç»“æ„ä½“çš„åå­—ç”¨é©¼å³°å‘½åæ³•ï¼Œå…¶ä¸­çš„å­—æ®µç”¨è›‡å½¢æ‹¼å†™æ³•ã€‚&lt;/p>
&lt;p>You can use &lt;code>key: value&lt;/code> syntax for some fields and shorthand for others in the same struct expression.&lt;/p>
&lt;p>To access a structâ€™s fields, use the familiar &lt;code>.&lt;/code> operator.&lt;/p>
&lt;p>å¯ä»¥å°†ç»“æ„ä½“è®¾ä¸ºpubï¼Œä½†æ˜¯å­—æ®µé»˜è®¤ç§æœ‰ã€‚è¿™æ ·å¯ä»¥é€šè¿‡ä¸€äº›å…¬æœ‰çš„æ–¹æ³•åˆ›å»ºç»“æ„ä½“æˆ–è€…ä¿®æ”¹å®ƒã€‚&lt;/p>
&lt;p>ä½¿ç”¨&lt;code>.. EXPR&lt;/code>ï¼Œä»»ä½•æ²¡æœ‰å‡ºç°çš„å­—æ®µéƒ½å°†ä»&lt;code>EXPR&lt;/code>ä¸­å–å¾—è‡ªå·±çš„å€¼ï¼Œå‰ææ˜¯&lt;code>EXPR&lt;/code>å¿…é¡»ä¸ºåŒä¸€ç»“æ„ä½“ç±»å‹çš„å¦ä¸€ä¸ªå€¼ã€‚&lt;/p>
&lt;h3 id="tuple-like-structs">&lt;strong>Tuple-Like Structs&lt;/strong>
&lt;/h3>&lt;p>ç±»å…ƒç»„ç»“æ„ä½“ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">Bounds&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">usize&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">usize&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é€šè¿‡&lt;code>.&lt;/code>æ“ä½œç¬¦æ¥è®¿é—®ã€‚&lt;/p>
&lt;p>å®šä¹‰æ­¤ç»“æ„ä½“ä¼šéšå¼å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">Bounds&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">elem0&lt;/span>: &lt;span class="kt">usize&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">elem1&lt;/span>: &lt;span class="kt">usize&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Bounds&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;em>newtypes&lt;/em>ï¼Œå³åªåŒ…å«ä¸€ä¸ªè¦ç»è¿‡æ›´ä¸¥æ ¼ç±»å‹æ£€æŸ¥çš„ç»„ä»¶çš„ç»“æ„ä½“ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">Ascii&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="unit-like-structs">&lt;strong>Unit-Like Structs&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">Onesuch&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ç§ç±»å‹çš„å€¼ä¸å ä»»ä½•å†…å­˜ï¼Œåƒ&lt;code>()&lt;/code>ã€‚&lt;/p>
&lt;blockquote>
&lt;p>Rust doesnâ€™t bother actually storing unit-like struct values in memory or generating code to operate on them, because it can tell everything it might need to know about the value from its type alone. But logically, an empty struct is a type with values like any otherâ€”or more precisely, &lt;strong>a type of which there is only a single value&lt;/strong>.&lt;/p>
&lt;/blockquote>
&lt;h3 id="struct-layout">&lt;strong>Struct Layout&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">GrayscaleMap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">pixels&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">size&lt;/span>: &lt;span class="p">(&lt;/span>&lt;span class="kt">usize&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">usize&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸€ç§å¯èƒ½çš„å†…å­˜å¸ƒå±€ï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220715110333582.png"
loading="lazy"
alt="image-20220715110333582"
>&lt;/p>
&lt;p>Rustä¸ä¿è¯ç»“æ„ä½“çš„å­—æ®µæˆ–å…ƒç´ åœ¨å†…å­˜ä¸­ä¼šä»¥æŸç§é¡ºåºå­˜å‚¨ï¼Œä½†æ˜¯ä¿è¯æŠŠå­—æ®µçš„å€¼ç›´æ¥å­˜å‚¨åœ¨ç»“æ„ä½“çš„å†…å­˜å—ä¸­ã€‚&lt;/p>
&lt;h3 id="defining-methods-with-impl">&lt;strong>Defining Methods with impl&lt;/strong>
&lt;/h3>&lt;p>Functions defined in an impl block are called &lt;em>associated functions&lt;/em>, since theyâ€™re associated with a specific type. The opposite of an associated function is a &lt;em>free function&lt;/em>, one that is not defined as an impl blockâ€™s item.&lt;/p>
&lt;ul>
&lt;li>&lt;code>self&lt;/code>&lt;/li>
&lt;li>&lt;code>&amp;amp;self&lt;/code>&lt;/li>
&lt;li>&lt;code>&amp;amp;mut self&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>å½“è°ƒç”¨æ–¹æ³•æ—¶ï¼Œ&lt;code>.&lt;/code> æ“ä½œç¬¦ä¼šéšå¼è½¬æ¢ï¼Œå¦‚æœæ–¹æ³•å®šä¹‰çš„æ˜¯å€Ÿç”¨ï¼Œå°±ä¼šéšå¼è½¬æ¢ä¸ºå¼•ç”¨ã€‚æ³¨æ„&lt;code>self&lt;/code>ä¼šç§»åŠ¨æ‰€æœ‰æƒã€‚&lt;/p>
&lt;h4 id="passing-self-as-a-box-rc-or-arc">&lt;strong>Passing Self as a Box, Rc, or Arc&lt;/strong>
&lt;/h4>&lt;p>A methodâ€™s self argument can also be a &lt;code>Box&amp;lt;Self&amp;gt;&lt;/code>, &lt;code>Rc&amp;lt;Self&amp;gt;&lt;/code>, or &lt;code>Arc&amp;lt;Self&amp;gt;&lt;/code>. Such a method can only be called on a value of the given pointer type. Calling the method passes ownership of the pointer to it.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bq&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Box&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Queue&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// `Queue::push` expects a `&amp;amp;mut Queue`, but `bq` is a `Box&amp;lt;Queue&amp;gt;`.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// This is fine: Rust borrows a `&amp;amp;mut Queue` from the `Box` for the
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// duration of the call.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">bq&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">&amp;#39;â– &amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Rust automatically borrows a reference from pointer types like Box, Rc, and Arc, so &amp;amp;self and &amp;amp;mut self are almost always the right thing in a method signature, along with the occasional self.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Node&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">append_to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>: &lt;span class="nc">Rc&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parent&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Node&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">parent&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">children&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>If the caller has an &lt;code>Rc&amp;lt;Node&amp;gt;&lt;/code> at hand, it can call append_to directly, passing the Rc by value:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">shared_node&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Rc&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Node&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;first&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">shared_node&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">append_to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parent&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Again, for most methods, &amp;amp;self, &amp;amp;mut self, and self (by value) are all you need. But if a methodâ€™s purpose is to affect the ownership of the value, using other pointer types for self can be just the right thing.&lt;/p>
&lt;h4 id="type-associated-functions">&lt;strong>Type-Associated Functions&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Queue&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">new&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Queue&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Queue&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">older&lt;/span>: &lt;span class="nb">Vec&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">younger&lt;/span>: &lt;span class="nb">Vec&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Separating a typeâ€™s methods from its definition may seem unusual, but there are several advantages to doing so:&lt;/p>
&lt;ul>
&lt;li>Itâ€™s always easy to find a typeâ€™s data members.&lt;/li>
&lt;li>Pulling methods out into an impl block allows a single syntax for all three. In fact, Rust uses this same syntax for defining methods on types that are not structs at all, such as enum types and primitive types like i32.&lt;/li>
&lt;li>The same impl syntax also serves neatly for implementing traits, which weâ€™ll go into in Chapter 11.&lt;/li>
&lt;/ul>
&lt;h3 id="associated-consts">&lt;strong>Associated Consts&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Vector2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="kt">f32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>: &lt;span class="kt">f32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Vector2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">ZERO&lt;/span>: &lt;span class="nc">Vector2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Vector2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="mf">0.0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>: &lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">UNIT&lt;/span>: &lt;span class="nc">Vector2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Vector2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="mf">1.0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>: &lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½¿ç”¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">scaled&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Vector2&lt;/span>::&lt;span class="no">UNIT&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">scaled_by&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">2.0&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// scaled_by() æ–¹æ³•éœ€è¦è‡ªå·±å®šä¹‰ï¼Œè¿™é‡Œæ²¡æœ‰åˆ—å‡º
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="generic-structs">&lt;strong>Generic Structs&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-RUST" data-lang="RUST">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Queue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">older&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">younger&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç›¸å…³æ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Queue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">new&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Queue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Queue&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">older&lt;/span>: &lt;span class="nb">Vec&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">younger&lt;/span>: &lt;span class="nb">Vec&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>: &lt;span class="nc">T&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">younger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">is_empty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">older&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">is_empty&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">younger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">is_empty&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½¿ç”¨&lt;code>Self&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">new&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Self&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Queue&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">older&lt;/span>: &lt;span class="nb">Vec&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">younger&lt;/span>: &lt;span class="nb">Vec&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>For associated function calls, you can supply the type parameter explicitly using the ::&amp;lt;&amp;gt; (turbofish) notation:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">q&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Queue&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">char&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="structs-with-lifetime-parameters">&lt;strong>Structs with Lifetime Parameters&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">find_extrema&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="na">&amp;#39;s&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">slice&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;s&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="kt">i32&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Extrema&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="na">&amp;#39;s&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">greatest&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">slice&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">least&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">slice&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="n">slice&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">slice&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">least&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">least&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">slice&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">slice&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">greatest&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">greatest&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">slice&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Extrema&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">greatest&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">least&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å½“ç„¶è¿™é‡Œç”Ÿå‘½å‘¨æœŸå‚æ•°ä¹Ÿå¯ä»¥çœç•¥ï¼Œå› ä¸ºå¯ä»¥æ ¹æ®ä¸‰æ¡è§„åˆ™è¿›è¡Œæ¨æ–­ã€‚&lt;/p>
&lt;h3 id="deriving-common-traits-for-struct-types">&lt;strong>Deriving Common Traits for Struct Types&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[derive(Copy, Clone, Debug, PartialEq)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Point&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="kt">f64&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>: &lt;span class="kt">f64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="interior-mutability">&lt;strong>Interior Mutability&lt;/strong>
&lt;/h3>&lt;p>æ”¯æŒå†…éƒ¨å¯å˜æ€§ï¼Œç”¨&lt;code>Cell&amp;lt;T&amp;gt;&lt;/code>å’Œ&lt;code>RefCell&amp;lt;T&amp;gt;&lt;/code>ï¼Œå®šä¹‰åœ¨&lt;code>std::cell&lt;/code>æ¨¡å—ä¸­ã€‚&lt;/p>
&lt;p>&lt;code>Cell&amp;lt;T&amp;gt;&lt;/code>æ˜¯åªåŒ…å«ä¸€ä¸ª&lt;code>T&lt;/code>ç±»å‹ç§æœ‰å€¼çš„ç»“æ„ä½“ã€‚Cellå”¯ä¸€ç‰¹åˆ«çš„åœ°æ–¹æ˜¯ä¸éœ€è¦å¯¹å…¶è‡ªèº«çš„mutå¼•ç”¨ï¼Œä½ ä¹Ÿèƒ½å–å¾—æˆ–è®¾ç½®å…¶ç§æœ‰å­—æ®µçš„å€¼ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>Cell::new(value)&lt;/code>ï¼šåˆ›å»ºä¸€ä¸ªæ–°Cellï¼Œå°†valueè½¬ç§»åˆ°å…¶ä¸­ã€‚&lt;/li>
&lt;li>&lt;code>cell.get()&lt;/code>ï¼šè¿”å›cellä¸­å€¼çš„å‰¯æœ¬ã€‚è¦æ±‚ cell å®ç° Copy traitã€‚&lt;/li>
&lt;li>&lt;code>cell.set(value)&lt;/code>ï¼šæŠŠvalueä¿å­˜åˆ°cellï¼Œä¸¢å¼ƒä¹‹é—´ä¿å­˜çš„å€¼ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;code>RefCell&amp;lt;T&amp;gt;&lt;/code>æ˜¯åªåŒ…å«ä¸€ä¸ªTç±»å‹å€¼çš„æ³›å‹ç±»å‹ã€‚ä½†ä¸Cellä¸åŒï¼Œ&lt;code>RefCell&amp;lt;T&amp;gt;&lt;/code>æ”¯æŒå€Ÿç”¨å®ƒçš„Tç±»å‹å€¼çš„å¼•ç”¨ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>RefCell::new(value)&lt;/code>ï¼šåˆ›å»ºä¸€ä¸ªæ–°RefCellï¼Œå°†valueè½¬ç§»åˆ°å…¶ä¸­ã€‚&lt;/li>
&lt;li>&lt;code>ref_cell.borrow()&lt;/code>ï¼šè¿”å›ä¸€ä¸ª&lt;code>Ref&amp;lt;T&amp;gt;&lt;/code>ï¼ŒåŸºæœ¬ä¸Šæ˜¯å¯¹ ref_cell ä¸­å€¼çš„å…±äº«å¼•ç”¨ã€‚This method panics if the value is already mutably borrowed.&lt;/li>
&lt;li>&lt;code>ref_cell.borrow_mut()&lt;/code>: Returns a &lt;code>RefMut&amp;lt;T&amp;gt;&lt;/code>, essentially a mutable reference to the value in ref_cell. This method panics if the value is already borrowed.&lt;/li>
&lt;li>&lt;code>ref_cell.try_borrow()&lt;/code>, &lt;code>ref_cell.try_borrow_mut()&lt;/code> : Work just like &lt;code>borrow()&lt;/code> and &lt;code>borrow_mut()&lt;/code>, but return a &lt;code>Result&lt;/code>. Instead of panicking if the value is already mutably borrowed, they return an &lt;code>Err&lt;/code> value.&lt;/li>
&lt;/ul>
&lt;p>This is a lot like how normal references work. The only difference is that normally, when you borrow a reference to a variable, Rust checks at compile time to ensure that youâ€™re using the reference safely. If the checks fail, you get a compiler error. RefCell enforces the same rule using run-time checks. So if youâ€™re breaking the rules, you get a panic (or an Err, for try_borrow and try_borrow_mut).&lt;/p>
&lt;p>The other drawback is less obvious and more serious: cellsâ€”and any types that contain themâ€”are not thread-safe.&lt;/p>
&lt;p>&lt;strong>è¡¥å……ï¼šå‚è€ƒ&lt;a class="link" href="https://rustwiki.org/zh-CN/book/ch15-05-interior-mutability.html#refcellt-%e5%92%8c%e5%86%85%e9%83%a8%e5%8f%af%e5%8f%98%e6%80%a7%e6%a8%a1%e5%bc%8f" target="_blank" rel="noopener"
>&lt;code>RefCell&lt;/code> å’Œå†…éƒ¨å¯å˜æ€§æ¨¡å¼&lt;/a>&lt;/strong>ã€‚&lt;/p>
&lt;ul>
&lt;li>å› ä¸º &lt;code>RefCell&amp;lt;T&amp;gt;&lt;/code> å…è®¸åœ¨è¿è¡Œæ—¶æ‰§è¡Œå¯å˜å€Ÿç”¨æ£€æŸ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨å³ä¾¿ &lt;code>RefCell&amp;lt;T&amp;gt;&lt;/code> è‡ªèº«æ˜¯ä¸å¯å˜çš„æƒ…å†µä¸‹ä¿®æ”¹å…¶å†…éƒ¨çš„å€¼ã€‚&lt;/li>
&lt;/ul>
&lt;p>ç»“æ„ä½“æ˜¯â€œä¸â€çš„é€»è¾‘ï¼Œè€Œæšä¸¾æ˜¯â€œæˆ–â€çš„é€»è¾‘ã€‚&lt;/p>
&lt;h2 id="chapter-10-enums-and-patterns">Chapter 10. Enums and Patterns
&lt;/h2>&lt;h3 id="enums">&lt;strong>Enums&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">enum&lt;/span> &lt;span class="nc">Ordering&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Less&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Equal&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Greater&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¸ªæ˜¯æ ‡å‡†åº“ä¸­çš„ï¼Œå¯¼å…¥ç”¨useã€‚ä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰æšä¸¾ï¼Œè‡ªå·±å¯¼å…¥ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">enum&lt;/span> &lt;span class="nc">Pet&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Orca&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Giraffe&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>::&lt;span class="n">Pet&lt;/span>::&lt;span class="o">*&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>In memory, values of C-style enums are stored as integers. Occasionally itâ€™s useful to tell Rust
which integers to use:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">enum&lt;/span> &lt;span class="nc">HttpStatus&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">200&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">NotModified&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">304&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">NotFound&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">404&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Otherwise Rust will assign the numbers for you, starting at 0.&lt;/p>
&lt;p>By default, Rust stores C-style enums using the smallest built-in integer type that can accommodate them. Most fit in a single byte.&lt;/p>
&lt;p>&lt;code>#[repr]&lt;/code>å¯ä»¥è‡ªå·±é€‰æ‹©æšä¸¾çš„å†…å­˜è¡¨ç¤ºã€‚&lt;/p>
&lt;p>å¯ä»¥å°†Cå¼æšä¸¾è½¬æ¢ä¸ºæ•´æ•°ï¼Œä½†æ˜¯åè¿‡æ¥ä¸å¯ä»¥ã€‚&lt;/p>
&lt;p>å’Œç»“æ„ä½“ä¸€æ ·ï¼Œå¯ä»¥ç»™æšä¸¾åŠ ä¸Šå±æ€§ï¼Œå®šä¹‰ç›¸å…³æ–¹æ³•ã€‚&lt;/p>
&lt;h4 id="enums-with-data">Enums with Data
&lt;/h4>&lt;p>ä¸€ä¸ªæšä¸¾å¯ä»¥åŒæ—¶åŒ…å«ä¸‰ç§å˜ä½“ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">enum&lt;/span> &lt;span class="nc">RelationshipStatus&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Single&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">InARelationship&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ItsComplicated&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ItsExtremelyComplicated&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">car&lt;/span>: &lt;span class="nc">DifferentialEquation&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">cdr&lt;/span>: &lt;span class="nc">EarlyModernistPoem&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">},&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>All constructors and fields of an enum share the same visibility as the enum itself.&lt;/p>
&lt;h4 id="enums-in-memory">Enums in Memory
&lt;/h4>&lt;p>åœ¨å†…å­˜ä¸­ï¼Œå¸¦æ•°æ®çš„æ¯ä¸ªæ„é€ å¼éƒ½éœ€è¦ä¸€ä¸ªå°æ•´æ•°æ ‡ç­¾ã€‚&lt;/p>
&lt;p>&lt;code>RoughTime&lt;/code>çš„æ¯ä¸ªæ„é€ å¼å ç”¨8ä¸ªå­—èŠ‚ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220715164735845.png"
loading="lazy"
alt="image-20220715164735845"
>&lt;/p>
&lt;p>ä¸ºäº†æ–¹ä¾¿ä¼˜åŒ–ï¼ŒRustå¹¶æœªå¯¹æšä¸¾çš„å†…å­˜å¸ƒå±€æ–¹å¼åšå‡ºä»»ä½•æ‰¿è¯ºã€‚For instance, some generic structs can be stored without a tag at all, as weâ€™ll see later.&lt;/p>
&lt;h4 id="rich-data-structures-using-enums">&lt;strong>Rich Data Structures Using Enums&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">collections&lt;/span>::&lt;span class="n">HashMap&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">enum&lt;/span> &lt;span class="nc">Json&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Null&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">bool&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Number&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">f64&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Json&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">Box&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Json&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å†…å­˜å¸ƒå±€ï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220716084624016.png"
loading="lazy"
alt="image-20220716084624016"
>&lt;/p>
&lt;p>åœ¨å†…å­˜ä¸­ï¼ŒJsonç±»å‹çš„å€¼å 4ä¸ªæœºå™¨å­—ã€‚Stringå’ŒVecå€¼å 3ä¸ªæœºå™¨å­—ï¼ŒRustè¿˜ä¼šåŠ ä¸€ä¸ªæ ‡ç­¾å­—èŠ‚ã€‚Nullå’ŒBooleanå€¼ç”¨ä¸äº†é‚£ä¹ˆå¤šå†…å­˜ç©ºé—´ï¼Œä½†æ‰€æœ‰Jsonå€¼çš„å¤§å°å¿…é¡»ç›¸åŒã€‚&lt;/p>
&lt;p>&lt;code>Box&amp;lt;HashMap&amp;gt;&lt;/code>åªå ä¸€ä¸ªæœºå™¨å­—ï¼Œå› ä¸ºå®ƒåªæ˜¯ä¸€ä¸ªæŒ‡å‘åˆ†é…åˆ°å †å†…å­˜æ•°æ®çš„æŒ‡é’ˆã€‚&lt;/p>
&lt;h4 id="generic-enums">&lt;strong>Generic Enums&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">enum&lt;/span> &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">enum&lt;/span> &lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Err&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>**å¦‚æœç±»å‹&lt;code>T&lt;/code>æ˜¯å¼•ç”¨æˆ–&lt;code>Box&lt;/code>æˆ–å…¶ä»–æ™ºèƒ½æŒ‡é’ˆç±»å‹ï¼ŒRustå°±ä¼šçœæ‰&lt;code>Option&amp;lt;T&amp;gt;&lt;/code>çš„æ ‡ç­¾å­—æ®µã€‚**å› æ­¤&lt;code>Option&amp;lt;Box&amp;lt;i32&amp;gt;&amp;gt;&lt;/code>åœ¨å†…å­˜ä¸­åªç”¨1ä¸ªæœºå™¨å­—èŠ‚å­˜å‚¨ã€‚0è¡¨ç¤º&lt;code>None&lt;/code>ï¼Œéé›¶è¡¨ç¤º&lt;code>Some&lt;/code>å°è£…çš„å€¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// An ordered collection of `T`s.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">enum&lt;/span> &lt;span class="nc">BinaryTree&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Empty&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">NonEmpty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">Box&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">TreeNode&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// A part of a BinaryTree.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">TreeNode&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">element&lt;/span>: &lt;span class="nc">T&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>: &lt;span class="nc">BinaryTree&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>: &lt;span class="nc">BinaryTree&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220716091503724.png"
loading="lazy"
alt="image-20220716091503724"
>&lt;/p>
&lt;p>è®¿é—®æšä¸¾æ•°æ®å”¯ä¸€çš„æ–¹å¼æ˜¯ä¸€ç§å®‰å…¨çš„æ–¹å¼ï¼šä½¿ç”¨æ¨¡å¼ã€‚&lt;/p>
&lt;h3 id="patterns">&lt;strong>Patterns&lt;/strong>
&lt;/h3>&lt;p>åœ¨æšä¸¾ä¸­ä¸èƒ½ç›´æ¥é€šè¿‡&lt;code>.&lt;/code>æ“ä½œç¬¦è®¿é—®æšä¸¾çš„å­—æ®µã€‚å¯ä»¥ç”¨matchè¡¨è¾¾å¼æ¥è¿›è¡Œæ¨¡å¼åŒ¹é…ã€‚&lt;/p>
&lt;p>è¡¨è¾¾å¼äº§ç”Ÿå€¼ï¼Œæ¨¡å¼æ¶ˆè´¹å€¼ã€‚&lt;/p>
&lt;p>æ¨¡å¼åŒ¹é…ä¼šä»å·¦åˆ°å³å¯¹æ¯”æ¨¡å¼çš„æ¯ä¸ªç»„ä»¶ï¼Œä¾æ¬¡æ£€æŸ¥å½“å‰å€¼æ˜¯å¦ä¸ä¹‹åŒ¹é…ã€‚å¦‚æœä¸åŒ¹é…ï¼Œå°±å‰è¿›åˆ°ä¸‹ä¸€ä¸ªæ¨¡å¼ã€‚&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ¨¡å¼ç±»å‹&lt;/th>
&lt;th>ç¤ºä¾‹&lt;/th>
&lt;th>è¯´æ˜&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Literal&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Range&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wildcard Variable&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ref variable&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Binding with subpattern&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Enum pattern&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuple pattern&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Array pattern&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Slice pattern&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Struct pattern&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Reference&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Multiple patterns&lt;/td>
&lt;td>`&amp;lsquo;a&amp;rsquo;&lt;/td>
&lt;td>&amp;lsquo;A&amp;rsquo;`&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Guard expression&lt;/td>
&lt;td>&lt;code>x if x * x &amp;lt;= r2&lt;/code>&lt;/td>
&lt;td>In match only (not valid in let, etc.)&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="literals-variables-and-wildcards-in-patterns">&lt;strong>Literals, Variables, and Wildcards in Patterns&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">calendar&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">settings&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">get_string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;calendar&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;gregorian&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Calendar&lt;/span>::&lt;span class="n">Gregorian&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;chinese&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Calendar&lt;/span>::&lt;span class="n">Chinese&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;ethiopian&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Calendar&lt;/span>::&lt;span class="n">Ethiopian&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">other&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parse_error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;calendar&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">other&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯ä»¥ä½¿ç”¨é€šé…ç¬¦&lt;code>_&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">caption&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">photo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">tagged_pet&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Pet&lt;/span>::&lt;span class="n">Tyrannosaur&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;RRRAAAAAHHHHHH&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Pet&lt;/span>::&lt;span class="n">Samoyed&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;*dog thoughts*&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;I&amp;#39;m cute, love me&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// generic caption, works for any pet
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å³ä¾¿ä½ éå¸¸ç¡®å®šå…¶ä»–æƒ…å†µä¸ä¼šå‘ç”Ÿï¼Œä¹Ÿå¿…é¡»è‡³å°‘åŠ ä¸Šä¸€ä¸ªåå¤‡çš„panicåˆ†æ”¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// There are many Shapes, but we only support &amp;#34;selecting&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// either some text, or everything in a rectangular area.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// You can&amp;#39;t select an ellipse or trapezoid.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">selection&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Shape&lt;/span>::&lt;span class="n">TextSpan&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">start&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">end&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">paint_text_selection&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">start&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">end&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Shape&lt;/span>::&lt;span class="n">Rectangle&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rect&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">paint_rect_selection&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rect&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">panic!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;unexpected selection type&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="tuple-and-struct-patterns">Tuple and Struct Patterns
&lt;/h4>&lt;p>å…ƒç»„æ¨¡å¼åŒ¹é…å…ƒç»„ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">describe_point&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="kt">i32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>: &lt;span class="kt">i32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span> &lt;span class="kt">str&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">cmp&lt;/span>::&lt;span class="n">Ordering&lt;/span>::&lt;span class="o">*&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">cmp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">cmp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Equal&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Equal&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;at the origin&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Equal&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;on the x axis&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Equal&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;on the y axis&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Greater&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Greater&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;in the first quadrant&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Less&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Greater&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;in the second quadrant&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;somewhere else&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç»“æ„ä½“æ¨¡å¼ä½¿ç”¨èŠ±æ‹¬å·ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">balloon&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">location&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Point&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>: &lt;span class="nc">height&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;straight up &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s"> meters&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">height&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Point&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="nc">x&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>: &lt;span class="nc">y&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;at (&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">m, &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">m)&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨ç»“æ„ä½“æ¨¡å¼åŒ¹é…ä¸­ï¼Œå¯ä»¥ä½¿ç”¨&lt;code>...&lt;/code>æ¥å‘Šè¯‰Rustä½ å¹¶ä¸å…³å¿ƒå…¶ä»–å­—æ®µï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Account&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">language&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">language&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">show_custom_greeting&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="array-and-slice-patterns">Array and Slice Patterns
&lt;/h4>&lt;p>æ•°ç»„åŒ¹é…ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">hsl_to_rgb&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hsl&lt;/span>: &lt;span class="p">[&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="p">[&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hsl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">255&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">255&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">255&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">255&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åˆ‡ç‰‡åŒ¹é…ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">greet_people&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">names&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">names&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Hello, nobody.&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">},&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Hello, &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">.&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">},&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Hello, &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s"> and &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">.&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">},&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Hello, everyone from &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s"> to &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">.&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="reference-patterns">Reference Patterns
&lt;/h4>&lt;p>å¯¹äºå¼•ç”¨ï¼ŒRustæ”¯æŒä¸¤ç§æ¨¡å¼ï¼š&lt;code>ref&lt;/code>æ¨¡å¼å’Œ&lt;code>&amp;amp;&lt;/code>æ¨¡å¼ã€‚&lt;strong>å‰è€…å€Ÿç”¨åŒ¹é…å€¼çš„å…ƒç´ ï¼Œåè€…åŒ¹é…å¼•ç”¨&lt;/strong>ã€‚&lt;/p>
&lt;p>éœ€è¦ä¸€ç§æ¨¡å¼æ¥å€Ÿç”¨è€Œä¸&lt;code>move&lt;/code>åŒ¹é…çš„å€¼ã€‚ç”¨å…³é”®å­—&lt;code>ref&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">account&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Account&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">language&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ui&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">greet&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">language&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ui&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">show_settings&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">account&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// ok
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>ä½¿ç”¨&lt;code>ref mut&lt;/code>å€Ÿç”¨&lt;code>mut&lt;/code>å¼•ç”¨&lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">line_result&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Err&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">ref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">err&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">log_error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">err&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// `err` is &amp;amp;Error (shared ref)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">ref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// `line` is &amp;amp;mut String (mut ref)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">trim_comments&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// modify the String in place
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handle&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä»¥&lt;code>&amp;amp;&lt;/code>å¼€å¤´çš„æ¨¡å¼åŒ¹é…å¼•ç”¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sphere&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">center&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">Point3d&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">z&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// è¿™é‡Œ x, y, z æ˜¯å€¼ï¼Œå®ç°äº† Copy trait
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¡¨è¾¾å¼å’Œæ¨¡å¼å¤©ç”Ÿæ˜¯ç›¸åçš„ã€‚è¡¨è¾¾å¼&lt;code>(x, y)&lt;/code>ç”¨ä¸¤ä¸ªå€¼åˆ›å»ºä¸€ä¸ªæ–°å…ƒç»„ï¼Œæ¨¡å¼&lt;code>(x, y)&lt;/code>åˆ™ç›¸åï¼šå®ƒåŒ¹é…å…ƒç»„å¹¶ç ´ååå–å‡ºä¸¤ä¸ªå€¼ã€‚å¯¹&lt;code>&amp;amp;&lt;/code>è€Œè¨€ä¹Ÿä¸€æ ·ï¼šè¡¨è¾¾å¼&lt;code>&amp;amp;&lt;/code>åˆ›å»ºå¼•ç”¨ï¼Œæ¨¡å¼ä¸­çš„&lt;code>&amp;amp;&lt;/code>åŒ¹é…å¼•ç”¨ã€‚åŒ¹é…å¼•ç”¨ä¸­ï¼Œç”Ÿå‘½å‘¨æœŸæ˜¯å¿…è¦æ¡ä»¶ã€‚ä¸èƒ½å¯¹å…±äº«å¼•ç”¨é‡‡å–&lt;code>mut&lt;/code>æ“ä½œã€‚ä¸èƒ½ä»å¼•ç”¨ï¼ˆåŒ…æ‹¬&lt;code>mut&lt;/code>å¼•ç”¨ï¼‰ä¸­moveå‡ºå€¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">borrow_car&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">Car&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">engine&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// error: can&amp;#39;t move out of borrow è¿™é‡Œ engine æ²¡æœ‰å®ç° Copy trait
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¿®æ”¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">Car&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">engine&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// ok, engine is a reference
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯ä»¥ä½¿ç”¨&lt;code>&amp;amp;&lt;/code>æ¨¡å¼å–å¾—å¼•ç”¨æ‰€æŒ‡å‘çš„å­—ç¬¦ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">chars&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">peek&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// chars.peek() è¿”å› Option&amp;lt;&amp;amp;char&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;coming up: &lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;end of chars&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="match-guards">Match Guards
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">point_to_hex&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">click&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Err&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;That&amp;#39;s not a game space.&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hex&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hex&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">current_hex&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Err&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;You are already there! You must click somewhere else&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hex&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>But Rust also provides match guards, extra conditions that must be true in order for a match arm to apply, written as &lt;code>if CONDITION&lt;/code>, between the pattern and the armâ€™s &lt;code>=&amp;gt;&lt;/code> token:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">point_to_hex&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">click&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Err&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;That&amp;#39;s not a game space.&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hex&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hex&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">current_hex&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Err&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;You are already there! You must click somewhere else&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hex&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hex&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>If the pattern matches, but the condition is false, matching continues with the next arm.&lt;/p>
&lt;h4 id="matching-multiple-possibilities">Matching Multiple Possibilities
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">at_end&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">chars&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">peek&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="sc">&amp;#39;\r&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="sc">&amp;#39;\n&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æˆ–è€…&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">next_char&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">&amp;#39;0&amp;#39;&lt;/span>&lt;span class="o">..=&lt;/span>&lt;span class="sc">&amp;#39;9&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">read_number&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">&amp;#39;a&amp;#39;&lt;/span>&lt;span class="o">..=&lt;/span>&lt;span class="sc">&amp;#39;z&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">&amp;#39;A&amp;#39;&lt;/span>&lt;span class="o">..=&lt;/span>&lt;span class="sc">&amp;#39;Z&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">read_word&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">&amp;#39; &amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">&amp;#39;\t&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">&amp;#39;\n&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">skip_whitespace&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">handle_punctuation&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="binding-with--patterns">Binding with @ Patterns
&lt;/h4>&lt;p>&lt;strong>&lt;code>x @ pattern&lt;/code>åŒ¹é…ç»™å®šçš„ patternï¼Œä½†æˆåŠŸä¹‹åï¼Œä¸æ˜¯åŸºäºåŒ¹é…å€¼çš„å…ƒç´ æ¥åˆ›å»ºå˜é‡ï¼Œè€Œæ˜¯æŠŠåŒ¹é…å€¼æ•´ä¸ªç§»åŠ¨æˆ–å¤åˆ¶åˆ°ä¸€ä¸ªå˜é‡ &lt;code>x&lt;/code> ä¸­&lt;/strong>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="n">rect&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Shape&lt;/span>::&lt;span class="n">Rect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">optimized_paint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">rect&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>@ &lt;/code> patterns are also useful with ranges:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">chars&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">digit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">&amp;#39;0&amp;#39;&lt;/span>&lt;span class="o">..=&lt;/span>&lt;span class="sc">&amp;#39;9&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">read_number&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">digit&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">chars&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">},&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="where-patterns-are-allowed">Where Patterns Are Allowed
&lt;/h4>&lt;p>The meaning is always the same: instead of just storing a value in a single variable, Rust uses pattern matching to take the value apart.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ...unpack a struct into three new local variables
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Track&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">album&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">track_number&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">title&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">song&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// ...unpack a function argument that&amp;#39;s a tuple
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">distance_to&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="p">)&lt;/span>: &lt;span class="p">(&lt;/span>&lt;span class="kt">f64&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">f64&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">f64&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// ...iterate over keys and values of a HashMap
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">document&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">cache_map&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Document #&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">title&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// ...automatically dereference an argument to a closure
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// (handy because sometimes other code passes you a reference
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// when you&amp;#39;d rather have a copy)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">numbers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">fold&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">num&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">num&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸Šé¢çš„éƒ½æ˜¯ &lt;em>irrefutable patterns&lt;/em>ï¼Œä¸‹é¢çš„æ˜¯&lt;em>refutable pattern&lt;/em>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ...handle just one enum variant specially
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">RoughTime&lt;/span>::&lt;span class="n">InTheFuture&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">date_of_birth&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">set_time_traveler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// ...run some code only if a table lookup succeeds
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">document&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cache_map&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">send_cached_response&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">document&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// ...repeatedly try something until it succeeds
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Err&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">err&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">present_cheesy_anti_robot_task&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">log_robot_attempt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">err&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// let the user try again (it might still be a human)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// ...manually loop over an iterator
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lines&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">peek&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">read_paragraph&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lines&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="populating-a-binary-tree">Populating a Binary Tree
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">enum&lt;/span> &lt;span class="nc">BinaryTree&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Empty&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">NonEmpty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">Box&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">TreeNode&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">TreeNode&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">element&lt;/span>: &lt;span class="nc">T&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>: &lt;span class="nc">BinaryTree&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>: &lt;span class="nc">BinaryTree&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nb">Ord&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BinaryTree&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>: &lt;span class="nc">T&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">BinaryTree&lt;/span>::&lt;span class="n">Empty&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BinaryTree&lt;/span>::&lt;span class="n">NonEmpty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">Box&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">TreeNode&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">element&lt;/span>: &lt;span class="nc">value&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>: &lt;span class="nc">BinaryTree&lt;/span>::&lt;span class="n">Empty&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>: &lt;span class="nc">BinaryTree&lt;/span>::&lt;span class="n">Empty&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">})),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">BinaryTree&lt;/span>::&lt;span class="n">NonEmpty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">ref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">element&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tree&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BinaryTree&lt;/span>::&lt;span class="n">Empty&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tree&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Mercury&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tree&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Venus&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="chapter-11-traits-and-generics">&lt;strong>Chapter 11. Traits and Generics&lt;/strong>
&lt;/h2>&lt;p>Rust supports polymorphism with two related features: &lt;strong>traits&lt;/strong> and &lt;strong>generics&lt;/strong>.&lt;/p>
&lt;p>Generics and traits are closely related: generic functions use traits in bounds to spell out what types of arguments they can be applied to. So weâ€™ll also talk about &lt;strong>how &lt;code>&amp;amp;mut dyn Write&lt;/code> and &lt;code>&amp;lt;T: Write&amp;gt;&lt;/code> are similar, how theyâ€™re different&lt;/strong>, and how to choose between these two ways of using traits.&lt;/p>
&lt;h3 id="using-traits">&lt;strong>Using Traits&lt;/strong>
&lt;/h3>&lt;ul>
&lt;li>A value that implements &lt;code>std::io::Write&lt;/code> can write out bytes.&lt;/li>
&lt;li>A value that implements &lt;code>std::iter::Iterator&lt;/code> can produce a sequence of values.&lt;/li>
&lt;li>A value that implements &lt;code>std::clone::Clone&lt;/code> can make clones of itself in memory.&lt;/li>
&lt;li>A value that implements &lt;code>std::fmt::Debug&lt;/code> can be printed using println!() with the {:?} format specifier.&lt;/li>
&lt;/ul>
&lt;p>traitæœ¬èº«å¿…é¡»åœ¨ä½œç”¨åŸŸä¸­ã€‚å¦åˆ™ï¼Œtraitçš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯éšè—çš„ã€‚&lt;/p>
&lt;p>But since Rust makes you import the traits you plan to use, crates are free to take advantage of this superpower. To get a conflict, youâ€™d have to import two traits that add a method with the same name to the same type. This is rare in practice. (If you do run into a conflict, you can spell out what you want using fully qualified method syntax, covered later in the chapter.)&lt;/p>
&lt;p>The reason &lt;strong>Clone and Iterator&lt;/strong> methods work without any special imports is that theyâ€™re always in scope by default: theyâ€™re part of &lt;strong>the standard prelude&lt;/strong>, names that Rust automatically imports into every module.&lt;/p>
&lt;h4 id="trait-objects">&lt;strong>Trait Objects&lt;/strong>
&lt;/h4>&lt;p>Rust doesnâ€™t permit variables of type dyn Write:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">io&lt;/span>::&lt;span class="n">Write&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">buf&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">writer&lt;/span>: &lt;span class="nc">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Write&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">buf&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// error: `Write` does not have a constant size
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>A variableâ€™s size has to be known at compile time, and types that implement Write can be any size.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">buf&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">writer&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Write&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">buf&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// ok
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>A reference to a trait type, like writer, is called a &lt;em>&lt;strong>trait object&lt;/strong>&lt;/em>. Like any other reference, a trait object points to some value, it has a lifetime, and it can be either mut or shared.&lt;/p>
&lt;h4 id="trait-object-layout">&lt;strong>Trait object layout&lt;/strong>
&lt;/h4>&lt;p>In memory, &lt;strong>a trait object is a fat pointer&lt;/strong> consisting of a pointer to the value, plus a pointer to a table representing that valueâ€™s type. &lt;strong>Each trait object therefore takes up two machine words.&lt;/strong>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220716142028472.png"
loading="lazy"
alt="image-20220716142028472"
>&lt;/p>
&lt;p>In Rust, as in C++, &lt;strong>the vtable is generated once, at compile time&lt;/strong>, and shared by all objects of the same type. Everything shown in the darker shade in Figure 11-1, &lt;strong>including the vtable, is a private implementation&lt;/strong> detail of Rust. Again, these arenâ€™t fields and data structures that you can access directly. Instead, the language automatically uses the vtable when you call a method of a trait object, to determine which implementation to call.&lt;/p>
&lt;p>Rust automatically converts ordinary references into trait objects when needed.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">local_file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">File&lt;/span>::&lt;span class="n">create&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;hello.txt&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">say_hello&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">local_file&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Likewise, Rust will happily convert a &lt;code>Box&amp;lt;File&amp;gt;&lt;/code> to a &lt;code>Box&amp;lt;dyn Write&amp;gt;&lt;/code>, a value that owns a writer in the heap:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">w&lt;/span>: &lt;span class="nb">Box&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Write&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Box&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">local_file&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>This kind of conversion is the only way to create a trait object. What the compiler is actually doing here is very simple. At the point where the conversion happens, Rust knows the referentâ€™s true type (in this case, File), so it just adds the address of the appropriate vtable, turning the regular pointer into a fat pointer.&lt;/p>
&lt;h4 id="generic-functions-and-type-parameters">&lt;strong>Generic Functions and Type Parameters&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">say_hello&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">out&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Write&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// plain function
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">say_hello&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">W&lt;/span>: &lt;span class="nc">Write&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">out&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">W&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// generic function
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">say_hello&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">W&lt;/span>: &lt;span class="nc">Write&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">out&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">W&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// generic function
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">say_hello&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">local_file&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// calls say_hello::&amp;lt;File&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">say_hello&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bytes&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// calls say_hello::&amp;lt;Vec&amp;lt;u8&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>This process is known as &lt;em>&lt;strong>monomorphization&lt;/strong>&lt;/em>, and the compiler handles it all automatically.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// calling a generic method collect&amp;lt;C&amp;gt;() that takes no arguments
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">collect&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// error: can&amp;#39;t infer type
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">collect&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">i32&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// ok
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">run_query&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">M&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">R&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">DataSet&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">map&lt;/span>: &lt;span class="nc">M&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">reduce&lt;/span>: &lt;span class="nc">R&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Results&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">M&lt;/span>: &lt;span class="nc">Mapper&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Serialize&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">R&lt;/span>: &lt;span class="nc">Reducer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Serialize&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// Return a reference to the point in `candidates` that&amp;#39;s
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// closest to the `target` point.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">nearest&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="na">&amp;#39;t&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="na">&amp;#39;c&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">P&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">target&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;t&lt;/span> &lt;span class="nc">P&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">candidates&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;c&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">P&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;c&lt;/span> &lt;span class="nc">P&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">P&lt;/span>: &lt;span class="nc">MeasureDistance&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç”Ÿå‘½å‘¨æœŸä¸ä¼šå¯¹æœºå™¨ç æœ‰ä»»ä½•å½±å“ã€‚&lt;/p>
&lt;p>All the features introduced in this sectionâ€”bounds, where clauses, lifetime parameters, and so forthâ€”&lt;strong>can be used on all generic items&lt;/strong>, not just functions.&lt;/p>
&lt;h4 id="which-to-use">Which to Use
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Vegetable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Salad&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">V&lt;/span>: &lt;span class="nc">Vegetable&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">veggies&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ²™æ‹‰ç»“æ„ä½“ç”¨æ³›å‹å‡½æ•°å®ç°ï¼Œä½†æ˜¯åªèƒ½æ”¾ä¸€ç§è”¬èœã€‚&lt;/p>
&lt;p>è€ƒè™‘åˆ°è”¬èœå€¼çš„å¤§å°å¯èƒ½å·®åˆ«æ¯”è¾ƒå¤§ï¼Œä¸èƒ½ç›´æ¥ç”¨ Vecã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">Salad&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">veggies&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Vegetable&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// error: `dyn Vegetable` does
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// not have a constant size
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯ä»¥è¿™æ ·å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">Salad&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">veggies&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">Box&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Vegetable&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Another possible reason to use trait objects is to reduce the total amount of compiled code.&lt;/p>
&lt;p>é‚£ä¹ˆåœ¨ä¸è€ƒè™‘æ²™æ‹‰æˆ–è€…low-resource environmentsè¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œé€‰æ‹©æ³›å‹å‡½æ•°æœ‰ä¸‰ä¸ªä¼˜ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>The first advantage is &lt;strong>speed&lt;/strong>. ä¼šé€šè¿‡é™æ€åˆ†å‘çš„æ–¹å¼ï¼Œæ¶ˆé™¤åŠ¨æ€æŸ¥æ‰¾çš„æ—¶é—´ã€‚&lt;/li>
&lt;li>The second advantage of generics is that &lt;strong>not every trait can support trait objects&lt;/strong>.&lt;/li>
&lt;li>The third advantage of generics is that itâ€™s easy to &lt;strong>bound a generic type parameter with several traits at once&lt;/strong>, as our top_ten function did when it required its T parameter to implement Debug + Hash + Eq. Trait objects canâ€™t do this: types like &amp;amp;mut (dyn Debug + Hash + Eq) arenâ€™t supported in Rust. (You can work around this with subtraits, defined later in this chapter, but itâ€™s a bit involved.)&lt;/li>
&lt;/ul>
&lt;h3 id="defining-and-implementing-traits">Defining and Implementing Traits
&lt;/h3>&lt;p>å®šä¹‰traitï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// A trait for characters, items, and scenery -
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// anything in the game world that&amp;#39;s visible on screen.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Visible&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Render this object on the given canvas.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">draw&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">canvas&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Canvas&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Return true if clicking at (x, y) should /// select this object.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">hit_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="kt">i32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>: &lt;span class="kt">i32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å®ç°traitï¼Œç”¨&lt;code>impl TraitName for Type&lt;/code>ã€‚&lt;/p>
&lt;p>Everything defined in a trait &lt;code>impl&lt;/code> must actually be a feature of the trait.&lt;/p>
&lt;p>ä¸åœ¨traité‡Œçš„è¾…åŠ©æ–¹æ³•è¦å•ç‹¬æ”¾åœ¨&lt;code>impl Type&lt;/code>é‡Œé¢å®ç°ã€‚è€Œä¸”å®ç°traitæ—¶ä¹Ÿå¯ä»¥è°ƒç”¨è¿™ä¸ªè¾…åŠ©æ–¹æ³•ã€‚&lt;/p>
&lt;h4 id="default-methods">Default Methods
&lt;/h4>&lt;p>traitçš„é»˜è®¤å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Write&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">buf&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">usize&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">flush&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">write_all&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">buf&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bytes_written&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bytes_written&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">buf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">bytes_written&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">buf&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">bytes_written&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(())&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="traits-and-other-peoples-types">&lt;strong>Traits and Other Peopleâ€™s Types&lt;/strong>
&lt;/h4>&lt;p>Rust lets you implement any trait on any type, as long as &lt;strong>either the trait or the type is introduced in the current crate&lt;/strong>.&lt;/p>
&lt;p>The sole purpose of this particular trait is to add a method to an existing type, char. This is called an &lt;em>&lt;strong>extension trait&lt;/strong>&lt;/em>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">IsEmoji&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">is_emoji&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="sd">/// Implement IsEmoji for the built-in character type.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">IsEmoji&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">char&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">is_emoji&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">&amp;#39;$&amp;#39;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">is_emoji&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>You can even use a generic impl block to add an extension trait to a whole family of types at once.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// You can write HTML to any std::io writer.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">W&lt;/span>: &lt;span class="nc">Write&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">WriteHtml&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">W&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">write_html&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">html&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">HtmlDocument&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">io&lt;/span>::&lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>We said earlier that when you implement a trait, either the trait or the type must be new in the current crate. This is called the &lt;strong>orphan rule&lt;/strong>. It helps Rust ensure that trait implementations are unique.&lt;/p>
&lt;h4 id="self-in-traits">Self in Traits
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Clone&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">clone&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Self&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Selfä½œä¸ºè¿”å›ç±»å‹æ„å‘³ç€&lt;code>x.clone()&lt;/code>çš„ç±»å‹å°±æ˜¯&lt;code>x&lt;/code>çš„ç±»å‹ï¼Œä¸ç®¡å…·ä½“ä»€ä¹ˆç±»å‹ã€‚&lt;/p>
&lt;p>&lt;strong>ä½¿ç”¨Selfç±»å‹çš„traitä¸trait objectsä¸èƒ½å…±å­˜ã€‚&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Spliceable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">splice&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">other&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Self&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// error: the trait `Spliceable` cannot be made into an object
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">splice_anything&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">left&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Spliceable&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Spliceable&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">combo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">splice&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Rust rejects this code because it has no way to type-check the call &lt;code>left.splice(right)&lt;/code>. The whole point of trait objects is that the type isnâ€™t known until run time. Rust has no way to know at compile time if left and right will be the same type, as required.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">MegaSpliceable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">splice&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">other&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">MegaSpliceable&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Box&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">MegaSpliceable&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Thereâ€™s no problem type-checking calls to this &lt;code>.splice()&lt;/code> method because the type of the argument other is not required to match the type of self, as long as both types are MegaSpliceable.&lt;/p>
&lt;h4 id="subtraits">Subtraits
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// Someone in the game world, either the player or some other
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// pixie, gargoyle, squirrel, ogre, etc.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Creature&lt;/span>: &lt;span class="nc">Visible&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">position&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="p">(&lt;/span>&lt;span class="kt">i32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">i32&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">facing&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Direction&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Here, we say that &lt;strong>Creature is a subtrait of Visible&lt;/strong>, and that Creature is Visibleâ€™s supertrait.&lt;/p>
&lt;p>But in Rust, &lt;strong>a subtrait does not inherit the associated items of its supertrait&lt;/strong>; each trait still needs to be in scope if you want to call its methods.&lt;/p>
&lt;p>In fact, &lt;strong>Rustâ€™s subtraits are really just a shorthand for a bound on Self&lt;/strong>. A definition of Creature like this is exactly equivalent to the one shown earlier:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Creature&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nc">Visible&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="type-associated-functions-1">Type-Associated Functions
&lt;/h4>&lt;p>Traits can include type-associated functions, Rustâ€™s analog to static methods:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StringSet&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Return a new empty set.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">new&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Self&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ²¡æœ‰ self å‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Return a set that contains all the strings in `strings`.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">from_slice&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">strings&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Self&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ²¡æœ‰ self å‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Find out if this set contains a particular `value`.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">contains&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">string&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Add a string to this set.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">string&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>If you want to use &lt;code>&amp;amp;dyn StringSet&lt;/code> trait objects, you must change the trait, adding the bound where &lt;code>Self: Sized&lt;/code> to each associated function that doesnâ€™t take a self argument by reference:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StringSet&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">new&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Self&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">from_slice&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">strings&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Self&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">contains&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">string&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">string&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>With these additions, StringSet trait objects are allowed; they still donâ€™t support &lt;code>new&lt;/code> or &lt;code>from_slice&lt;/code>, but you can create them and use them to call &lt;code>.contains()&lt;/code> and &lt;code>.add()&lt;/code>.&lt;/strong>&lt;/p>
&lt;h3 id="fully-qualified-method-calls">Fully Qualified Method Calls
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34;hello&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kt">str&lt;/span>::&lt;span class="n">to_string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;hello&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nb">ToString&lt;/span>::&lt;span class="n">to_string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;hello&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">ToString&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>::&lt;span class="n">to_string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;hello&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// a fully qualified method call
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>With fully qualified calls, you can say exactly which method you mean, and that can help in a few odd cases:&lt;/p>
&lt;ul>
&lt;li>When two methods have the same name.
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="n">outlaw&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">draw&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// error: draw on screen or draw pistol?
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Visible&lt;/span>::&lt;span class="n">draw&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">outlaw&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// ok: draw on screen
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">HasPistol&lt;/span>::&lt;span class="n">draw&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">outlaw&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// ok: corral
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>When the type of the self argument canâ€™t be inferred:
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">zero&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// type unspecified; could be `i8`, `u8`, ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">zero&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">abs&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// error: can&amp;#39;t call method `abs`
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// on ambiguous numeric type
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kt">i64&lt;/span>::&lt;span class="n">abs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">zero&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// ok
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>When using the function itself as a function value:
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">words&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">split_whitespace&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// iterator produces &amp;amp;str values
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">ToString&lt;/span>::&lt;span class="n">to_string&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// ok
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">collect&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>When calling trait methods in macros.&lt;/li>
&lt;/ul>
&lt;h3 id="traits-that-define-relationships-between-types">Traits That Define Relationships Between Types
&lt;/h3>&lt;p>Traits can also be used in situations where there are multiple types that have to work together. They can describe relationships between types.&lt;/p>
&lt;h4 id="associated-types-or-how-iterators-work">Associated Types (or How Iterators Work)
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Item&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">next&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The first feature of this trait, &lt;code>type Item;&lt;/code>, is an associated type.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">fmt&lt;/span>::&lt;span class="n">Debug&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">dump&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">I&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iter&lt;/span>: &lt;span class="nc">I&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">I&lt;/span>: &lt;span class="nb">Iterator&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">I&lt;/span>::&lt;span class="n">Item&lt;/span>: &lt;span class="nc">Debug&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>trait object:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">dump&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iter&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">enumerate&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">: &lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="generic-traits-or-how-operator-overloading-works">Generic Traits (or How Operator Overloading Works)
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// std::ops::Mul, the trait for types that support `*`.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Mul&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="no">RHS&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// The resulting type after applying the `*` operator
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Output&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// The method for the `*` operator
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">mul&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rhs&lt;/span>: &lt;span class="nc">RHS&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Self&lt;/span>::&lt;span class="n">Output&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The type parameter here means the same thing that it means on a struct or function: &lt;strong>Mul is a generic trait, and its instances &lt;code>Mul&amp;lt;f64&amp;gt;&lt;/code>, &lt;code>Mul&amp;lt;String&amp;gt;&lt;/code>, &lt;code>Mul&amp;lt;Size&amp;gt;&lt;/code>, etc., are all different traits&lt;/strong>.&lt;/p>
&lt;p>Generic traits get a special dispensation when it comes to the orphan rule: &lt;strong>you can implement a foreign trait for a foreign type&lt;/strong>, so long as one of the traitâ€™s type parameters is a type defined in the current crate.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Mul&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="no">RHS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">Self&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The syntax &lt;code>RHS=Self&lt;/code> means that RHS defaults to Self. If I write &lt;code>impl Mul for Complex&lt;/code>, without specifying Mulâ€™s type parameter, it means impl &lt;code>Mul&amp;lt;Complex&amp;gt; for Complex&lt;/code>. In a bound, if I write &lt;code>where T: Mul&lt;/code>, it means where &lt;code>T: Mul&amp;lt;T&amp;gt;&lt;/code>.&lt;/p>
&lt;h4 id="impl-trait">impl Trait
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">iter&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">vec&lt;/span>::&lt;span class="n">IntoIter&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">cyclical_zip&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nc">iter&lt;/span>::&lt;span class="n">Cycle&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">iter&lt;/span>::&lt;span class="n">Chain&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">IntoIter&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">IntoIter&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">into_iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">chain&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">into_iter&lt;/span>&lt;span class="p">()).&lt;/span>&lt;span class="n">cycle&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ç§å†™æ³•å¤ªç¹çï¼Œå¯ä»¥è¿™æ ·å†™ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">cyclical_zip&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Box&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Box&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">into_iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">chain&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">into_iter&lt;/span>&lt;span class="p">()).&lt;/span>&lt;span class="n">cycle&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½†æ˜¯è¿™æ˜¯åŠ¨æ€åˆ†å‘ï¼Œå½±å“æ•ˆç‡ã€‚å¯ä»¥ä½¿ç”¨ &lt;code>impl Trait&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">cyclical_zip&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">into_iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">chain&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">into_iter&lt;/span>&lt;span class="p">()).&lt;/span>&lt;span class="n">cycle&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">make_shape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">shape&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Shape&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">shape&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;circle&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Circle&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;triangle&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Triangle&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// error: incompatible types
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;shape&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Rectangle&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Itâ€™s important to note that &lt;strong>Rust doesnâ€™t allow trait methods to use &lt;code>impl Trait&lt;/code> return values&lt;/strong>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">print&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nc">Display&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">val&lt;/span>: &lt;span class="nc">T&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">val&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">val&lt;/span>: &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Display&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">val&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>There is one important exception. Using generics allows callers of the function to specify the type of the generic arguments, like &lt;code>print::&amp;lt;i32&amp;gt;(42)&lt;/code>, while using impl Trait does not.&lt;/p>
&lt;h4 id="associated-consts-1">Associated Consts
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-RUST" data-lang="RUST">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Greet&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">GREETING&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span> &lt;span class="kt">str&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Hello&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">greet&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">String&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">fib&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nc">Float&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Add&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Output&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>: &lt;span class="kt">usize&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">T&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>::&lt;span class="no">ZERO&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>::&lt;span class="no">ONE&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fib&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fib&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="reverse-engineering-bounds">Reverse-Engineering Bounds
&lt;/h3>&lt;p>å’Œç¼–è¯‘å™¨åšæ–—äº‰ï¼ŒåŠ ä¸Š Boundsã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">ops&lt;/span>::&lt;span class="p">{&lt;/span>&lt;span class="n">Add&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Mul&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">dot&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">N&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v1&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">N&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v2&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">N&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">N&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">N&lt;/span>: &lt;span class="nc">Add&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Output&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">N&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Mul&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Output&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">N&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Copy&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">total&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">N&lt;/span>::&lt;span class="n">default&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">total&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">total&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v2&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">total&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[test]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">test_dot&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mf">53.0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">7.0&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">5.0&lt;/span>&lt;span class="p">]),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">88.0&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æˆ–è€…ç”¨ç¬¬ä¸‰æ–¹åº“&lt;code>num&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">num&lt;/span>::&lt;span class="n">Num&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">dot&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">N&lt;/span>: &lt;span class="nc">Num&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Copy&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v1&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">N&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v2&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">N&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">N&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">total&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">N&lt;/span>::&lt;span class="n">zero&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">total&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">total&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v2&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">total&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Rustä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡å‘¢ï¼Ÿä¸ºä»€ä¹ˆä¸æ¨¡ä»¿â€œé¸­å­ç±»å‹â€ï¼Ÿè¿™æ ·è®¾è®¡çš„ä¼˜ç‚¹æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>å¯ä»¥è®©æ³›å‹ä»£ç å…·æœ‰å‘å‰å…¼å®¹çš„èƒ½åŠ›ã€‚&lt;/li>
&lt;li>ä½ èƒ½é€šè¿‡ç¼–è¯‘å™¨ä¿å­˜å°±çŸ¥é“è¦è§£å†³çš„éº»çƒ¦åœ¨å“ªé‡Œã€‚&lt;/li>
&lt;li>æˆ–è®¸ï¼Œæ˜ç¡®å†™å‡ºç»‘å®šæœ€é‡è¦çš„å¥½å¤„æ˜¯å®ƒä»¬åœ¨ä»£ç å’Œæ–‡æ¡£é‡Œéƒ½å­˜åœ¨ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="traits-as-a-foundation">Traits as a Foundation
&lt;/h3>&lt;p>Traits are one of the main organizing features in Rust, and with good reason. Thereâ€™s nothing better to design a program or library around than a good interface.&lt;/p>
&lt;h2 id="chapter-12-operator-overloading">&lt;strong>Chapter 12. Operator Overloading&lt;/strong>
&lt;/h2>&lt;p>The traits for operator overloading fall into a few categories depending on what part of the language they support.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>ç±»åˆ«&lt;/th>
&lt;th>Trait&lt;/th>
&lt;th>æ“ä½œç¬¦&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Unary operators&lt;/td>
&lt;td>std::ops::Neg&lt;/td>
&lt;td>&lt;code>-x&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>std::ops::Not&lt;/td>
&lt;td>&lt;code>!x&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Arithmetic operators&lt;/td>
&lt;td>std::ops::Add&lt;/td>
&lt;td>&lt;code>x + y&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>std::ops::Sub&lt;/td>
&lt;td>&lt;code>x - y&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>std::ops::Mul&lt;/td>
&lt;td>&lt;code>x * y&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>std::ops::Div&lt;/td>
&lt;td>&lt;code>x / y&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>std::ops::Rem&lt;/td>
&lt;td>&lt;code>x % y&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Bitwise operators&lt;/td>
&lt;td>std::ops::BitAnd&lt;/td>
&lt;td>&lt;code>x &amp;amp; y&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>std::ops::BitOr&lt;/td>
&lt;td>`x&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>std::ops::BitXor&lt;/td>
&lt;td>&lt;code>x ^ y&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>std::ops::Shl&lt;/td>
&lt;td>&lt;code>x &amp;lt;&amp;lt; y&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>std::ops::Shr&lt;/td>
&lt;td>&lt;code>x &amp;gt;&amp;gt; y&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Compound assignment&lt;/td>
&lt;td>std::ops::AddAssign&lt;/td>
&lt;td>&lt;code>x += y&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>arithmetic operators&lt;/td>
&lt;td>std::ops::SubAssign&lt;/td>
&lt;td>&lt;code>x -= y&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>std::ops::MulAssign&lt;/td>
&lt;td>&lt;code>x *= y&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>std::ops::DivAssign&lt;/td>
&lt;td>&lt;code>x /= y&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>std::ops::RemAssign&lt;/td>
&lt;td>&lt;code>x %= y&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Compound assignment&lt;/td>
&lt;td>std::ops::BitAddAssign&lt;/td>
&lt;td>&lt;code>x &amp;amp;= y&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>bitwise operators&lt;/td>
&lt;td>std::ops::BitOrAssign&lt;/td>
&lt;td>`x&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>std::ops::BitXorAssign&lt;/td>
&lt;td>&lt;code>x ^= y&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>std::ops::ShlAssign&lt;/td>
&lt;td>&lt;code>x &amp;lt;&amp;lt;= y&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>std::ops::ShrAssign&lt;/td>
&lt;td>&lt;code>x &amp;gt;&amp;gt;= y&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Comparison&lt;/td>
&lt;td>std::cmp::PartialEq&lt;/td>
&lt;td>&lt;code>x == y&lt;/code>, &lt;code>x != y&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>std::cmp::PartialOrd&lt;/td>
&lt;td>&lt;code>x &amp;lt; y&lt;/code>, &lt;code>x &amp;lt;= y&lt;/code>, &lt;code>x &amp;gt; y&lt;/code>, &lt;code>x &amp;gt;= y&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Indexing&lt;/td>
&lt;td>std::ops::Index&lt;/td>
&lt;td>&lt;code>x[y]&lt;/code>ã€&lt;code>&amp;amp;x[y]&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>std::ops::IndexMut&lt;/td>
&lt;td>&lt;code>x[y] = z&lt;/code>ã€&lt;code>&amp;amp;mut x[y]&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="arithmetic-and-bitwise-operators">&lt;strong>Arithmetic and Bitwise Operators&lt;/strong>
&lt;/h3>&lt;p>&lt;code>std::ops::Add&lt;/code>å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Add&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Rhs&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Output&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rhs&lt;/span>: &lt;span class="nc">Rhs&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Self&lt;/span>::&lt;span class="n">Output&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å®ç°:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">ops&lt;/span>::&lt;span class="n">Add&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Add&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Complex&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nc">Add&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Output&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Output&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rhs&lt;/span>: &lt;span class="nc">Self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Self&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Complex&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">re&lt;/span>: &lt;span class="nc">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">re&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rhs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">re&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">im&lt;/span>: &lt;span class="nc">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">im&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rhs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">im&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ··åˆå®ç°ï¼ŒåŠ æ³•çš„å·¦è¾¹å’Œå³è¾¹ä¸è¦æ±‚æ˜¯åŒä¸€ç±»å‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">ops&lt;/span>::&lt;span class="n">Add&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">L&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">R&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Add&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Complex&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">R&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Complex&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">L&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">L&lt;/span>: &lt;span class="nc">Add&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">R&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Output&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Complex&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">L&lt;/span>::&lt;span class="n">Output&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rhs&lt;/span>: &lt;span class="nc">Complex&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">R&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Self&lt;/span>::&lt;span class="n">Output&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Complex&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">re&lt;/span>: &lt;span class="nc">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">re&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rhs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">re&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">im&lt;/span>: &lt;span class="nc">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">im&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rhs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">im&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="unary-operators">&lt;strong>Unary Operators&lt;/strong>
&lt;/h4>&lt;p>Note that ! complements bool values and performs a bitwise complement (that is, flips the bits) when applied to integers; it plays the role of both the ! and ~ operators from C and C++.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Neg&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Output&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">neg&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Self&lt;/span>::&lt;span class="n">Output&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Not&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Output&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">not&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Self&lt;/span>::&lt;span class="n">Output&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¤æ•°çš„å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">ops&lt;/span>::&lt;span class="n">Neg&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Neg&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Complex&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nc">Neg&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Output&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Output&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Complex&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">neg&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Complex&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Complex&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">re&lt;/span>: &lt;span class="o">-&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">re&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">im&lt;/span>: &lt;span class="o">-&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">im&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="binary-operators">&lt;strong>Binary Operators&lt;/strong>
&lt;/h4>&lt;p>All of Rustâ€™s numeric types implement the arithmetic operators. Rustâ€™s integer types and bool implement the bitwise operators. There are also implementations that accept references to those types as either or both operands.&lt;/p>
&lt;p>You can use the + operator to concatenate a String with a &amp;amp;str slice or another String. However, Rust does not permit the left operand of + to be a &amp;amp;str, to discourage building up long strings by repeatedly concatenating small pieces on the left. (This performs poorly, requiring time quadratic in the final length of the string.)&lt;/p>
&lt;h4 id="compound-assignment-operators">&lt;strong>Compound Assignment Operators&lt;/strong>
&lt;/h4>&lt;p>A compound assignment expression is one like &lt;code>x += y&lt;/code> or &lt;code>x &amp;amp;= y&lt;/code>: it takes two operands, performs some operation on them like addition or a bitwise AND, and stores the result back in the left operand. In Rust, t&lt;strong>he value of a compound assignment expression is always &lt;code>()&lt;/code>, never the value stored&lt;/strong>.&lt;/p>
&lt;p>Many languages have operators like these and usually define them as shorthand for expressions like &lt;code>x = x + y&lt;/code> or &lt;code>x = x &amp;amp; y&lt;/code>. However, Rust doesnâ€™t take that approach. Instead, &lt;strong>&lt;code>x += y&lt;/code> is shorthand for the method call &lt;code>x.add_assign(y)&lt;/code>, where &lt;code>add_assign&lt;/code> is the sole method of the &lt;code>std::ops::AddAssign&lt;/code> trait&lt;/strong>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">AddAssign&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Rhs&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">add_assign&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rhs&lt;/span>: &lt;span class="nc">Rhs&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The built-in trait for a compound assignment operator is &lt;strong>completely independent&lt;/strong> of the built-in trait for the corresponding binary operator.&lt;/p>
&lt;h3 id="equivalence-comparisons">&lt;strong>Equivalence Comparisons&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">PartialEq&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Rhs&lt;/span>: &lt;span class="o">?&lt;/span>&lt;span class="nb">Sized&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// This method tests for `self` and `other` values to be equal, and is used
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// by `==`.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[must_use]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">eq&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">other&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Rhs&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// This method tests for `!=`.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[inline]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[must_use]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[default_method_body_is_const]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">ne&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">other&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Rhs&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">eq&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">other&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç”¨å±æ€§å¿«é€Ÿå®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[derive(Clone, Copy, Debug, PartialEq)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Complex&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Rustâ€™s automatically generated implementation is essentially identical to our hand-written code, comparing each field or element of the type in turn.&lt;/p>
&lt;p>This means that comparing non-Copy values like Strings, Vecs, or HashMaps doesnâ€™t cause them to be moved, which would be troublesome:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;d&lt;/span>&lt;span class="se">\x6f&lt;/span>&lt;span class="s">v&lt;/span>&lt;span class="se">\x65&lt;/span>&lt;span class="s">t&lt;/span>&lt;span class="se">\x61&lt;/span>&lt;span class="s">i&lt;/span>&lt;span class="se">\x6c&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\x64&lt;/span>&lt;span class="s">o&lt;/span>&lt;span class="se">\x76&lt;/span>&lt;span class="s">e&lt;/span>&lt;span class="se">\x74&lt;/span>&lt;span class="s">a&lt;/span>&lt;span class="se">\x69&lt;/span>&lt;span class="s">l&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// s and t are only borrowed...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// ... so they still have their values here.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s"> &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;dovetail dovetail&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Why is this trait called PartialEq? The traditional mathematical definition of an &lt;em>equivalence relation&lt;/em>, of which equality is one instance, imposes three requirements. For any values x and y:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å¯¹ç§°æ€§ï¼šIf x == y is true, then y == x must be true as well. In other words, swapping the two sides of an equality comparison doesnâ€™t affect the result.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¼ é€’æ€§ï¼šIf x == y and y == z, then it must be the case thatx == z. Given any chain of values, each equal to the next, each value in the chain is directly equal to every other. Equality is contagious.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è‡ªåæ€§ï¼šIt must always be true that x == x.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>&lt;code>PartialEq&lt;/code>åªå®ç°äº†å‰ä¸¤æ¡ï¼Œè‡ªåæ€§ä¸ä¿è¯&lt;/strong>ï¼Œæ¯”å¦‚&lt;code>f32&lt;/code>å’Œ&lt;code>f64&lt;/code>å°±ä¸æ»¡è¶³ã€‚&lt;code>0.0/0.0&lt;/code>ä¼šäº§ç”Ÿéæ•°å­—çš„å€¼&lt;code>NaN&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="fm">assert!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">f64&lt;/span>::&lt;span class="n">is_nan&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>Eq&lt;/code> Traitï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Eq&lt;/span>: &lt;span class="nb">PartialEq&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¹Ÿå¯ä»¥ç”¨å±æ€§æ¥å¿«é€Ÿå®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[derive(Clone, Copy, Debug, Eq, PartialEq)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Complex&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ordered-comparisons">&lt;strong>Ordered Comparisons&lt;/strong>
&lt;/h3>&lt;p>&lt;code>std::cmp::PartialOrd&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">PartialOrd&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Rhs&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>: &lt;span class="nb">PartialEq&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Rhs&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Rhs&lt;/span>: &lt;span class="o">?&lt;/span>&lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">partial_cmp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">other&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Rhs&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Ordering&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">lt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">other&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Rhs&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">le&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">other&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Rhs&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">gt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">other&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Rhs&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">ge&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">other&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Rhs&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">enum&lt;/span> &lt;span class="nc">Ordering&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// An ordering where a compared value is less than another.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Less&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// An ordering where a compared value is equal to another.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Equal&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// An ordering where a compared value is greater than another.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Greater&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>But if partial_cmp returns None, that means self and other are unordered with respect to each other: neither is greater than the other, nor are they equal. Among all of Rustâ€™s primitive types, only comparisons between floating-point values ever return None: specifically, &lt;strong>comparing a NaN (not-a-number) value with anything else returns None&lt;/strong>.&lt;/p>
&lt;p>If you know that values of two types &lt;strong>are always ordered with respect to each other&lt;/strong>, then you can implement the stricter &lt;code>std::cmp::Ord&lt;/code> trait:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Ord&lt;/span>: &lt;span class="nb">Eq&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">PartialOrd&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// This method returns an [`Ordering`] between `self` and `other`.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// By convention, `self.cmp(&amp;amp;other)` returns the ordering matching the expression
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// `self &amp;lt;operator&amp;gt; other` if true.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// # Examples
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// use std::cmp::Ordering;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// assert_eq!(5.cmp(&amp;amp;10), Ordering::Less);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// assert_eq!(10.cmp(&amp;amp;5), Ordering::Greater);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// assert_eq!(5.cmp(&amp;amp;5), Ordering::Equal);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[must_use]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">cmp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">other&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Ordering&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Almost all types that implement PartialOrd should also implement Ord. In the standard library, &lt;strong>f32 and f64 are the only exceptions to this rule&lt;/strong>.&lt;/p>
&lt;p>&lt;strong>æ’åºåº”è¯¥åŒæ—¶å®ç° &lt;code>Partial Ord&lt;/code> å’Œ &lt;code>Ord&lt;/code>&lt;/strong> ã€‚You might want to sort by upper bound, for instance, and itâ€™s easy to do that with &lt;code>sort_by_key&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="n">intervals&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">sort_by_key&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">upper&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>The &lt;code>Reverse&lt;/code> wrapper type&lt;/strong> takes advantage of this by implementing &lt;code>Ord&lt;/code> with a method that simply inverts any ordering.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">cmp&lt;/span>::&lt;span class="n">Reverse&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">intervals&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">sort_by_key&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Reverse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">lower&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="index-and-indexmut">&lt;strong>Index and IndexMut&lt;/strong>
&lt;/h3>&lt;p>On any other type, the expression &lt;code>a[i]&lt;/code> is normally shorthand for &lt;code>*a.index(i)&lt;/code>, where index is a method of the &lt;code>std::ops::Index&lt;/code> trait. However, if the expression is being assigned to or borrowed mutably, itâ€™s instead shorthand for &lt;code>*a.index_mut(i)&lt;/code>, a call to the method of the &lt;code>std::ops::IndexMut&lt;/code> trait.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Index&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Idx&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Output&lt;/span>: &lt;span class="o">?&lt;/span>&lt;span class="nb">Sized&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">index&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">index&lt;/span>: &lt;span class="nc">Idx&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Self&lt;/span>::&lt;span class="n">Output&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">IndexMut&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Idx&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>: &lt;span class="nc">Index&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Idx&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">index_mut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">index&lt;/span>: &lt;span class="nc">Idx&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Output&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>You can refer to a subslice with an expression like &lt;code>a[i..j]&lt;/code> because they also implement &lt;code>Index&amp;lt;Range&amp;lt;usize&amp;gt;&amp;gt;&lt;/code>. That expression is shorthand for:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="o">*&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">ops&lt;/span>::&lt;span class="n">Range&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">start&lt;/span>: &lt;span class="nc">i&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">end&lt;/span>: &lt;span class="nc">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">collections&lt;/span>::&lt;span class="n">HashMap&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// HashMap&amp;lt;&amp;amp;str, i32&amp;gt;, å®ç°äº† Index&amp;lt;&amp;amp;str&amp;gt; trait
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;å&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;ç™¾&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;åƒ&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;ä¸‡&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1_0000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;å„„&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1_0000_0000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;å&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;åƒ&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// ç­‰ä»·äº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">ops&lt;/span>::&lt;span class="n">Index&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;å&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;åƒ&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The Index traitâ€™s associated type &lt;code>Output&lt;/code> specifies what type an indexing expression produces: for our HashMap, the Index implementationâ€™s Output type is &lt;code>i32&lt;/code>.&lt;/p>
&lt;p>Rust automatically selects &lt;code>index_mut&lt;/code> when the indexing expression occurs in a context where itâ€™s necessary.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">desserts&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;Howalon&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Soan papdi&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">()];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">desserts&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">push_str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34; (fictional)&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">desserts&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">push_str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34; (real)&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åä¸¤è¡Œå’Œä¸‹é¢çš„ä»£ç ä¸€æ ·ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">ops&lt;/span>::&lt;span class="n">IndexMut&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">desserts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">index_mut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)).&lt;/span>&lt;span class="n">push_str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34; (fictional)&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">desserts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">index_mut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)).&lt;/span>&lt;span class="n">push_str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34; (real)&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>One limitation of &lt;code>IndexMut&lt;/code> is that, by design, it &lt;strong>must return a mutable reference to some value&lt;/strong>.&lt;/p>
&lt;p>The most common use of indexing is &lt;strong>for collections&lt;/strong>.&lt;/p>
&lt;p>This is how &lt;code>Index&lt;/code> and &lt;code>IndexMut&lt;/code> implementations are supposed to behave: &lt;strong>out-of-bounds access is detected and causes a panic&lt;/strong>, the same as when you index an array, slice, or vector out of bounds.&lt;/p>
&lt;h3 id="other-operators">&lt;strong>Other Operators&lt;/strong>
&lt;/h3>&lt;p>&lt;strong>Not all operators can be overloaded in Rust&lt;/strong>. As of Rust 1.50, &lt;strong>the error-checking &lt;code>?&lt;/code> operator&lt;/strong> works only with Result and Option values, though work is in progress to expand this to user-defined types as well. Similarly, &lt;strong>the logical operators &lt;code>&amp;amp;&amp;amp;&lt;/code> and &lt;code>||&lt;/code>&lt;/strong> are limited to Boolean values only. &lt;strong>The &lt;code>..&lt;/code> and &lt;code>..=&lt;/code> operators&lt;/strong> always create a struct representing the rangeâ€™s bounds, &lt;strong>the &lt;code>&amp;amp;&lt;/code> operator&lt;/strong> always borrows references, and &lt;strong>the &lt;code>=&lt;/code> operator&lt;/strong> always moves or copies values. None of them can be overloaded.&lt;/p>
&lt;p>Rust &lt;strong>does not support overloading the function call operator, &lt;code>f(x)&lt;/code>&lt;/strong>. Instead, when you need a callable value, youâ€™ll typically just write a closure.&lt;/p>
&lt;h2 id="chapter-13-utility-traits">&lt;strong>Chapter 13. Utility Traits&lt;/strong>
&lt;/h2>&lt;p>&lt;em>Language extension traits&lt;/em>&lt;/p>
&lt;ul>
&lt;li>Drop, Deref and DerefMut&lt;/li>
&lt;li>From and Into&lt;/li>
&lt;/ul>
&lt;p>&lt;em>Marker traits&lt;/em>&lt;/p>
&lt;ul>
&lt;li>Sized&lt;/li>
&lt;li>Copy&lt;/li>
&lt;/ul>
&lt;p>&lt;em>Public vocabulary traits&lt;/em>&lt;/p>
&lt;ul>
&lt;li>Default&lt;/li>
&lt;li>AsRef, AsMut, Borrow and BorrowMut&lt;/li>
&lt;li>TryFrom and TryInto&lt;/li>
&lt;li>ToOwned&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Trait&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;a class="link" href="#drop" >Drop&lt;/a>&lt;/td>
&lt;td>Destructors. Cleanup code that Rust runs automatically whenever a value is dropped.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="#sized" >Sized&lt;/a>&lt;/td>
&lt;td>Marker trait for types with a fixed size known at compile time, as opposed to types (such as slices) that are dynamically sized.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="#clone" >Clone&lt;/a>&lt;/td>
&lt;td>Types that support cloning values.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="#copy" >Copy&lt;/a>&lt;/td>
&lt;td>Marker trait for types that can be cloned simply by making a byte-for-byte copy of the memory containing the value.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="#deref-and-derefmut" >Deref and DerefMut&lt;/a>&lt;/td>
&lt;td>Traits for smart pointer types.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="#default" >Default&lt;/a>&lt;/td>
&lt;td>Types that have a sensible â€œdefault value.â€&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="#asref-and-asmut" >AsRef and AsMut&lt;/a>&lt;/td>
&lt;td>Conversion traits for borrowing one type of reference from another.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="#borrow-and-borrowmut" >Borrow and BorrowMut&lt;/a>&lt;/td>
&lt;td>Conversion traits, like AsRef/AsMut, but additionally guaranteeing consistent hashing, ordering, and equality.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="#from-and-into" >From and Into&lt;/a>&lt;/td>
&lt;td>Conversion traits for transforming one type of value into another.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="#tryfrom-and-tryinto" >TryFrom and TryInto&lt;/a>&lt;/td>
&lt;td>Conversion traits for transforming one type of value into another, for transformations that might fail.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="#toowned" >ToOwned&lt;/a>&lt;/td>
&lt;td>Conversion trait for converting a reference to an owned value.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="drop">Drop
&lt;/h3>&lt;p>&lt;code>std::ops::Drop&lt;/code> trait&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Drop&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">drop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>This implicit invocation of drop is the only way to call that method&lt;/strong>; if you try to invoke it explicitly yourself, Rust flags that as an error.&lt;/p>
&lt;p>If a variableâ€™s value gets moved elsewhere, so that the variable is uninitialized when it goes out of scope, then Rust will not try to drop that variable: there is no value in it to drop. Although a value may be moved from place to place, &lt;strong>Rust drops it only once&lt;/strong>.&lt;/p>
&lt;p>You usually wonâ€™t need to implement &lt;code>std::ops::Drop&lt;/code> unless youâ€™re defining &lt;strong>a type that owns resources Rust doesnâ€™t already know about&lt;/strong>.&lt;/p>
&lt;p>&lt;strong>If a type implements &lt;code>Drop&lt;/code>, it cannot implement the &lt;code>Copy&lt;/code> trait&lt;/strong>. If a type is Copy, that means that simple byte-for-byte duplication is sufficient to produce an independent copy of the value. But it is typically a mistake to call the same drop method more than once on the same data.&lt;/p>
&lt;p>The standard prelude includes a function to drop a value, drop, but its definition is anything but magical:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">drop&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">_x&lt;/span>: &lt;span class="nc">T&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä»è°ƒç”¨è€…é‚£é‡Œè·å¾—æ‰€æœ‰æƒï¼Œç„¶åä»€ä¹ˆä¹Ÿä¸åšã€‚Rustä¼šåœ¨è¶…å‡ºä½œç”¨åŸŸæ—¶æ¸…æ¥š&lt;code>_x&lt;/code>çš„å€¼ï¼Œè·Ÿæ¸…é™¤å…¶ä»–å˜é‡çš„å€¼ä¸€æ ·ã€‚&lt;/p>
&lt;h3 id="sized">&lt;strong>Sized&lt;/strong>
&lt;/h3>&lt;p>A &lt;em>sized type&lt;/em> is one whose values all have the same size in memory.&lt;/p>
&lt;p>All sized types implement the &lt;code>std::marker::Sized&lt;/code> trait, which has no methods or associated types. Rust implements it automatically for all types to which it applies; &lt;strong>you canâ€™t implement it yourself&lt;/strong>. The only use for &lt;code>Sized&lt;/code> is as a bound for type variables: a bound like &lt;strong>&lt;code>T: Sized&lt;/code>&lt;/strong> requires T to be a type whose size is known at compile time. Traits of this sort are called &lt;em>&lt;strong>marker traits&lt;/strong>&lt;/em>, because the Rust language itself uses them to mark certain types as having characteristics of interest.&lt;/p>
&lt;p>&lt;strong>Rust canâ€™t store unsized values in variables or pass them as arguments&lt;/strong>. You can only deal with them through pointers like &lt;code>&amp;amp;str&lt;/code> or &lt;code>Box&amp;lt;dyn Write&amp;gt;&lt;/code>, which themselves are sized.&lt;/p>
&lt;p>In fact, this is necessary so often that it is the implicit default in Rust: if you write struct &lt;code>S&amp;lt;T&amp;gt; { ... }&lt;/code>, Rust understands you to mean struct &lt;code>S&amp;lt;T: Sized&amp;gt; { ... }&lt;/code>. If you do not want to constrain T this way, you must explicitly opt out, writing &lt;code>struct S&amp;lt;T: ?Sized&amp;gt; { ... }&lt;/code>. The &lt;code>?Sized&lt;/code> syntax is specific to this case and means â€œ&lt;strong>not necessarily Sized&lt;/strong>.â€ For example, if you write struct &lt;code>S&amp;lt;T: ?Sized&amp;gt; { b: Box&amp;lt;T&amp;gt; }&lt;/code>, then Rust will allow you to write &lt;code>S&amp;lt;str&amp;gt;&lt;/code> and &lt;code> S&amp;lt;dyn Write&amp;gt;&lt;/code>, where the box becomes a fat pointer, as well as &lt;code>S&amp;lt;i32&amp;gt;&lt;/code> and &lt;code>S&amp;lt;String&amp;gt;&lt;/code>, where the box is an ordinary pointer.&lt;/p>
&lt;p>Aside from slices and trait objects, there is one more kind of unsized type. &lt;strong>A struct typeâ€™s last field (but only its last) may be unsized, and such a struct is itself unsized&lt;/strong>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[cfg_attr(not(test), rustc_diagnostic_item = &lt;/span>&lt;span class="s">&amp;#34;Rc&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[rustc_insignificant_dtor]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Rc&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="o">?&lt;/span>&lt;span class="nb">Sized&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ptr&lt;/span>: &lt;span class="nc">NonNull&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">RcBox&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">phantom&lt;/span>: &lt;span class="nc">PhantomData&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">RcBox&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// This is repr(C) to future-proof against possible field-reordering, which
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// would interfere with otherwise safe [into|from]_raw() of transmutable
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// inner types.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="cp">#[repr(C)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">RcBox&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="o">?&lt;/span>&lt;span class="nb">Sized&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">strong&lt;/span>: &lt;span class="nc">Cell&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">usize&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">weak&lt;/span>: &lt;span class="nc">Cell&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">usize&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>: &lt;span class="nc">T&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="clone">&lt;strong>Clone&lt;/strong>
&lt;/h3>&lt;p>&lt;code>std::clone::Clone&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Clone&lt;/span>: &lt;span class="nb">Sized&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Returns a copy of the value.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// # Examples
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// # #![allow(noop_method_call)]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// let hello = &amp;#34;Hello&amp;#34;; // &amp;amp;str implements Clone
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// assert_eq!(&amp;#34;Hello&amp;#34;, hello.clone());
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[must_use = &lt;/span>&lt;span class="s">&amp;#34;cloning is often expensive and is not expected to have side effects&amp;#34;&lt;/span>&lt;span class="cp">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">clone&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Self&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Performs copy-assignment from `source`.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// `a.clone_from(&amp;amp;b)` is equivalent to `a = b.clone()` in functionality,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// but can be overridden to reuse the resources of `a` to avoid unnecessary
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// allocations.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[inline]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[default_method_body_is_const]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[cfg_attr(not(bootstrap), allow(drop_bounds))]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// FIXME remove `~const Drop` and this attr when bumping
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">clone_from&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">source&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="o">~&lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Drop&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">~&lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Destruct&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">source&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">clone&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>clone_from&lt;/code>æ–¹æ³•å°†&lt;code>self&lt;/code>ä¿®æ”¹ä¸º&lt;code>source&lt;/code>çš„ä¸€ä¸ªå‰¯æœ¬ã€‚è¿™ä¸ªæ–¹æ³•çš„é»˜è®¤å®šä¹‰çŸ¥è¯†ç®€å•åœ°å…‹éš†äº†&lt;code>source&lt;/code>ï¼Œç„¶åå°†å‰¯æœ¬è½¬ç§»åˆ°&lt;code>*self&lt;/code>ä¸­ã€‚è¯­å¥&lt;code>s = t.clone();&lt;/code>å¿…é¡»å…ˆå…‹éš†&lt;code>t&lt;/code>ï¼Œæ¸…é™¤&lt;code>s&lt;/code>åŸæ¥çš„å€¼ï¼Œç„¶åå†å°†å…‹éš†çš„å€¼è½¬ç§»åˆ°&lt;code>s&lt;/code>ä¸­ã€‚è¿™æ¶‰åŠä¸€æ¬¡å †åˆ†é…å’Œä¸€æ¬¡å †é‡Šæ”¾ã€‚åœ¨æ³›å‹ä»£ç ä¸­ï¼Œåº”è¯¥å°½å¯èƒ½ä½¿ç”¨&lt;code>clone_from&lt;/code>ï¼Œä»è€Œåœ¨å¯èƒ½çš„æƒ…å†µä¸‹åº”ç”¨è¿™ç§ä¼˜åŒ–ã€‚&lt;/p>
&lt;p>åŠ ä¸Š&lt;code>#[derive(Clone)]&lt;/code>å®ç°ã€‚&lt;/p>
&lt;p>æ²¡æœ‰å®ç°&lt;code>Clone&lt;/code>ï¼š&lt;code>std::sync::Mutex&lt;/code>ã€&lt;code>stf::file::File&lt;/code>ï¼ˆä½†æ˜¯æä¾›äº†ä¸€ä¸ª&lt;code>try_clone()&lt;/code>æ–¹æ³•ï¼‰ã€‚&lt;/p>
&lt;h3 id="copy">&lt;strong>Copy&lt;/strong>
&lt;/h3>&lt;p>A type is &lt;code>Copy&lt;/code> if it implements the &lt;code>std::marker::Copy&lt;/code> marker trait, which is defined as follows:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Copy&lt;/span>: &lt;span class="nb">Clone&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Empty.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>But because &lt;code>Copy&lt;/code> is a marker trait with special meaning to the language, Rust permits a type to implement &lt;code>Copy&lt;/code> only if &lt;strong>a shallow byte-for-byte copy&lt;/strong> is all it needs. Types that own any other resources, like heap buffers or operating system handles, cannot implement &lt;code>Copy&lt;/code>. &lt;strong>Any type that implements the &lt;code>Drop&lt;/code> trait cannot be &lt;code>Copy&lt;/code>&lt;/strong>. Rust presumes that if a type needs special cleanup code, it must also require special copying code and thus canâ€™t be &lt;code>Copy&lt;/code>.&lt;/p>
&lt;p>As with &lt;code>Clone&lt;/code>, you can ask Rust to derive Copy for you, using &lt;code>#[derive(Copy)]&lt;/code>. You will often see both derived at once, with &lt;code>#[derive(Copy, Clone)]&lt;/code>.&lt;/p>
&lt;h3 id="deref-and-derefmut">&lt;strong>Deref and DerefMut&lt;/strong>
&lt;/h3>&lt;p>&lt;code>std::ops::Deref&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[lang = &lt;/span>&lt;span class="s">&amp;#34;deref&amp;#34;&lt;/span>&lt;span class="cp">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[doc(alias = &lt;/span>&lt;span class="s">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[doc(alias = &lt;/span>&lt;span class="s">&amp;#34;&amp;amp;*&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[rustc_diagnostic_item = &lt;/span>&lt;span class="s">&amp;#34;Deref&amp;#34;&lt;/span>&lt;span class="cp">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Deref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// The resulting type after dereferencing.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[rustc_diagnostic_item = &lt;/span>&lt;span class="s">&amp;#34;deref_target&amp;#34;&lt;/span>&lt;span class="cp">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[lang = &lt;/span>&lt;span class="s">&amp;#34;deref_target&amp;#34;&lt;/span>&lt;span class="cp">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Target&lt;/span>: &lt;span class="o">?&lt;/span>&lt;span class="nb">Sized&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Dereferences the value.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[must_use]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[rustc_diagnostic_item = &lt;/span>&lt;span class="s">&amp;#34;deref_method&amp;#34;&lt;/span>&lt;span class="cp">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">deref&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Self&lt;/span>::&lt;span class="n">Target&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>std::ops::DerefMut&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[lang = &lt;/span>&lt;span class="s">&amp;#34;deref_mut&amp;#34;&lt;/span>&lt;span class="cp">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[doc(alias = &lt;/span>&lt;span class="s">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">DerefMut&lt;/span>: &lt;span class="nc">Deref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Mutably dereferences the value.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">deref_mut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Target&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Since the methods return a reference with the same lifetime as &lt;code>&amp;amp;self&lt;/code>, &lt;strong>&lt;code>self&lt;/code> remains borrowed for as long as the returned reference lives&lt;/strong>.&lt;/p>
&lt;p>ç”±äº&lt;code>deref&lt;/code>æ¥æ”¶&lt;code>&amp;amp;self&lt;/code>å¼•ç”¨å¹¶è¿”å›&lt;code>&amp;amp;Self::Target&lt;/code>å¼•ç”¨ï¼Œå› æ­¤Rustä¼šåˆ©ç”¨è¿™ä¸€ç‚¹è‡ªåŠ¨å°†å‰ä¸€ç§ç±»å‹çš„å¼•ç”¨è½¬æ¢ä¸ºåä¸€ç§ç±»å‹çš„å¼•ç”¨ã€‚æ¢ä¸€å¥è¯è¯´ï¼Œ&lt;strong>å¦‚æœæ’å…¥ä¸€æ¬¡&lt;code>deref&lt;/code>è°ƒç”¨å¯ä»¥é˜²æ­¢ç±»å‹é”™é…ï¼Œé‚£Rustä¼šä¸ºä½ æ’å…¥ä¸€æ¬¡&lt;/strong>ã€‚å®ç°&lt;code>DerefMut&lt;/code>å¯ä»¥å®ç°å¯¹å¯ä¿®æ”¹å¼•ç”¨çš„ç±»å‹è½¬æ¢ã€‚è¿™ç§ç±»å‹è½¬æ¢ç§°ä¸ºè§£å¼•ç”¨å¼ºåˆ¶è½¬å‹(deref coercion)ï¼Œå³ä¸€ç§ç±»å‹è¢«â€œå¼ºåˆ¶â€è¡¨ç°å‡ºå¦ä¸€ç§ç±»å‹çš„è¡Œä¸ºã€‚&lt;/p>
&lt;p>ä½¿ç”¨è§£å¼•ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢å¾ˆæ–¹ä¾¿ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>Rc&amp;lt;T&amp;gt;&lt;/code>å®ç°äº†&lt;code>Deref&amp;lt;Target=T&amp;gt;&lt;/code>&lt;/li>
&lt;li>&lt;code>String&lt;/code>å®ç°äº†&lt;code>Deref&amp;lt;Target=str&amp;gt;&lt;/code>&lt;/li>
&lt;li>&lt;code>Vec&amp;lt;T&amp;gt;&lt;/code>å®ç°äº†&lt;code>Deref&amp;lt;Target=[T]&amp;gt;&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>å¿…è¦æƒ…å†µä¸‹ï¼Œ&lt;strong>Rustä¼šè¿ç»­å¤šæ¬¡åº”ç”¨è§£å¼•ç”¨å¼ºåˆ¶è½¬æ¢&lt;/strong>ã€‚&lt;/p>
&lt;p>&lt;code>Deref&lt;/code>å’Œ&lt;code>DerefMut&lt;/code> traitçš„è®¾è®¡åˆè¡·æ˜¯ä¸ºäº†å®ç°&lt;strong>æ™ºèƒ½æŒ‡é’ˆç±»å‹&lt;/strong>ï¼ˆå¦‚&lt;code>Box&lt;/code>ã€&lt;code>Rc&lt;/code>å’Œ&lt;code>Arc&lt;/code>ï¼‰ï¼Œä»¥åŠæŸäº›&lt;strong>é¢‘ç¹é€šè¿‡å¼•ç”¨æ¥ä½¿ç”¨çš„ç±»å‹çš„æ‰€æœ‰è€…ç‰ˆæœ¬&lt;/strong>ï¼ˆå¦‚&lt;code>Vec&amp;lt;T&amp;gt;&lt;/code>å’Œ&lt;code>String&lt;/code>å°±æ˜¯&lt;code>[T]&lt;/code>å’Œ&lt;code>str&lt;/code>çš„æ‰€æœ‰è€…ç‰ˆæœ¬ï¼‰ã€‚&lt;/p>
&lt;p>Rusté€šè¿‡åº”ç”¨è§£å¼•ç”¨å¼ºåˆ¶è½¬æ¢æ¥è§£å†³ç±»å‹å†²çªï¼Œä½†&lt;strong>ä¸ä¼šåº”ç”¨å®ƒæ¥æ»¡è¶³ç±»å‹å˜é‡çš„ç»‘å®š&lt;/strong>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">fmt&lt;/span>::&lt;span class="n">Display&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">show_it_generic&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nc">Display&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">thing&lt;/span>: &lt;span class="nc">T&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">thing&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">show_it_generic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// error
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Rustä¸ä¼šåœ¨æ»¡è¶³ç±»å‹å˜é‡çš„ç»‘å®šæ—¶åº”ç”¨è§£å¼•ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œæ‰€ä»¥æ£€æŸ¥å¤±è´¥ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è§£å†³è¿™ä¸ªé—®é¢˜
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">show_it_generic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// Or
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">show_it_generic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;*&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="default">&lt;strong>Default&lt;/strong>
&lt;/h3>&lt;p>&lt;code>std::default::Default&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[cfg_attr(not(test), rustc_diagnostic_item = &lt;/span>&lt;span class="s">&amp;#34;Default&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Default&lt;/span>: &lt;span class="nb">Sized&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Returns the &amp;#34;default value&amp;#34; for a type.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Default values are often some kind of initial value, identity value, or anything else that
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// may make sense as a default.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// # Examples
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Using built-in default values:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// let i: i8 = Default::default();
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// let (x, y): (Option&amp;lt;String&amp;gt;, f64) = Default::default();
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// let (a, b, (c, d)): (i32, u32, (bool, bool)) = Default::default();
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Making your own:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// # #[allow(dead_code)]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// enum Kind {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// A,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// B,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// C,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// impl Default for Kind {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// fn default() -&amp;gt; Self { Kind::A }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">default&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Self&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">collections&lt;/span>::&lt;span class="n">HashSet&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">squares&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">16&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">25&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">36&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">49&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">powers_of_two&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">impure&lt;/span>&lt;span class="p">)&lt;/span>: &lt;span class="p">(&lt;/span>&lt;span class="n">HashSet&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">i32&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashSet&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">i32&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">squares&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">partition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&amp;amp;&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">powers_of_two&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">impure&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>But of course, partition isnâ€™t specific to &lt;code>HashSets&lt;/code>; you can use it to produce any sort of collection you like, as long as the collection type implements &lt;code>Default&lt;/code>, to produce an empty collection to start with, and &lt;code>Extend&amp;lt;T&amp;gt;&lt;/code>, to add a T to the collection. &lt;code>String&lt;/code> implements &lt;code>Default&lt;/code> and &lt;code>Extend&amp;lt;char&amp;gt;&lt;/code>, so you can write:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">upper&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lower&lt;/span>&lt;span class="p">)&lt;/span>: &lt;span class="p">(&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Great Teacher Onizuka&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">chars&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">partition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&amp;amp;&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">is_uppercase&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">upper&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;GTO&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">lower&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;reat eacher nizuka&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Another common use of &lt;code>Default&lt;/code> is to produce default values for structs that represent a large collection of parameters, most of which you wonâ€™t usually need to change.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">params&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">glium&lt;/span>::&lt;span class="n">DrawParameters&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">line_width&lt;/span>: &lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">0.02&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">point_size&lt;/span>: &lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">0.02&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Default&lt;/span>::&lt;span class="n">default&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">draw&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">params&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">unwrap&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>If a type &lt;code>T&lt;/code> implements Default, then the standard library implements Default automatically for &lt;code>Rc&amp;lt;T&amp;gt;&lt;/code>, &lt;code>Arc&amp;lt;T&amp;gt;&lt;/code>, &lt;code>Box&amp;lt;T&amp;gt;&lt;/code>, &lt;code>Cell&amp;lt;T&amp;gt;&lt;/code>, &lt;code>RefCell&amp;lt;T&amp;gt;&lt;/code>, &lt;code>Cow&amp;lt;T&amp;gt;&lt;/code>, &lt;code>Mutex&amp;lt;T&amp;gt;&lt;/code>, and &lt;code>RwLock&amp;lt;T&amp;gt;&lt;/code>. The default value for the type &lt;code>Rc&amp;lt;T&amp;gt;&lt;/code>, for example, is an Rc pointing to the default value for type T.&lt;/p>
&lt;p>å¦‚æœå…ƒç»„ç±»å‹çš„æ‰€æœ‰ç±»å‹éƒ½å®ç°äº†Defaultï¼Œä¸”è¯¥è¯¥å…ƒç»„ç±»å‹ä¹Ÿå®ç°äº†Defaultï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç»„é»˜è®¤ä¼šæŒæœ‰æ¯ä¸ªå…ƒç´ çš„é»˜è®¤å€¼ã€‚&lt;/p>
&lt;p>Rust does not implicitly implement Default for &lt;strong>struct&lt;/strong> types, but if all of a structâ€™s fields implement Default, you can implement Default for the struct automatically using &lt;code># [derive(Default)]&lt;/code>.&lt;/p>
&lt;h3 id="asref-and-asmut">&lt;strong>AsRef and AsMut&lt;/strong>
&lt;/h3>&lt;p>&lt;code>std::convert::AsRef&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[cfg_attr(not(test), rustc_diagnostic_item = &lt;/span>&lt;span class="s">&amp;#34;AsRef&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">AsRef&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="o">?&lt;/span>&lt;span class="nb">Sized&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Converts this type into a shared reference of the (usually inferred) input type.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">as_ref&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">T&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>std::convert::RefMut&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[cfg_attr(not(test), rustc_diagnostic_item = &lt;/span>&lt;span class="s">&amp;#34;AsMut&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">AsMut&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="o">?&lt;/span>&lt;span class="nb">Sized&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Converts this type into a mutable reference of the (usually inferred) input type.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">as_mut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>So, for example, &lt;code>Vec&amp;lt;T&amp;gt;&lt;/code> implements &lt;code>AsRef&amp;lt;[T]&amp;gt;&lt;/code>, and String implements &lt;code>AsRef&amp;lt;str&amp;gt;&lt;/code>. You can also borrow a Stringâ€™s contents as an array of bytes, so String implements AsRef&amp;lt;[u8]&amp;gt; as well.&lt;/p>
&lt;p>But this canâ€™t be the whole story. A string literal is a &amp;amp;str, but the type that implements &lt;code>AsRef&amp;lt;Path&amp;gt;&lt;/code> is str, without an &amp;amp;. And as we explained in â€œDeref and DerefMutâ€, Rust doesnâ€™t try deref coercions to satisfy type variable bounds, so they wonâ€™t help here either.&lt;/p>
&lt;p>Fortunately, the standard library includes the blanket implementation:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">U&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">AsRef&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">U&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nb">AsRef&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">U&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="o">?&lt;/span>&lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">U&lt;/span>: &lt;span class="o">?&lt;/span>&lt;span class="nb">Sized&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">as_ref&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">U&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">as_ref&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>In other words, for any types T and U, if &lt;code>T: AsRef&amp;lt;U&amp;gt;&lt;/code>, then &lt;code>&amp;amp;T: AsRef&amp;lt;U&amp;gt;&lt;/code> as well: simply follow the reference and proceed as before.&lt;/p>
&lt;p>You might assume that if a type implements AsRef&lt;T>, it should also implement AsMut&lt;T>. However, there are cases where this isnâ€™t appropriate.&lt;/p>
&lt;h3 id="borrow-and-borrowmut">&lt;strong>Borrow and BorrowMut&lt;/strong>
&lt;/h3>&lt;p>The std::borrow::Borrow trait is similar to AsRef: if a type implements &lt;code>Borrow&amp;lt;T&amp;gt;&lt;/code>, then its borrow method efficiently borrows a &amp;amp;T from it. But Borrow imposes more restrictions: a type should implement Borrow&lt;T> only when a &amp;amp;T hashes and compares the same way as the value itâ€™s borrowed from. (Rust doesnâ€™t enforce this; itâ€™s just the documented intent of the trait.) This makes Borrow valuable in dealing with keys in hash tables and trees or when dealing with values that will be hashed or compared for some other reason.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[rustc_diagnostic_item = &lt;/span>&lt;span class="s">&amp;#34;Borrow&amp;#34;&lt;/span>&lt;span class="cp">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Borrow&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Borrowed&lt;/span>: &lt;span class="o">?&lt;/span>&lt;span class="nb">Sized&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">borrow&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Borrowed&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Borrow is designed to address a specific situation with generic hash tables and other associative collection types.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">K&lt;/span>: &lt;span class="nb">Eq&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Hash&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">get&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Q&lt;/span>: &lt;span class="o">?&lt;/span>&lt;span class="nb">Sized&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">key&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Q&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&amp;amp;&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">K&lt;/span>: &lt;span class="nc">Borrow&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Q&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Q&lt;/span>: &lt;span class="nb">Eq&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Hash&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Vec&lt;T> and [T: N] implement Borrow&amp;lt;[T]&amp;gt;. Every string-like type allows borrowing its corresponding slice type: String implements Borrow&lt;str>, PathBuf implements Borrow&lt;Path>, and so on. And all the standard libraryâ€™s associative collection types use Borrow to decide which types can be passed to their lookup functions.&lt;/p>
&lt;p>The standard library includes a blanket implementation so that every type T can be borrowed from itself: T: Borrow&lt;T>. This ensures that &amp;amp;K is always an acceptable type for looking up entries in a HashMap&amp;lt;K, V&amp;gt;.&lt;/p>
&lt;p>&lt;code>std::borrow::BorrowMut&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BorrowMut&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Borrowed&lt;/span>: &lt;span class="o">?&lt;/span>&lt;span class="nb">Sized&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>: &lt;span class="nc">Borrow&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Borrowed&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">borrow_mut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Borrowed&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="from-and-into">&lt;strong>From and Into&lt;/strong>
&lt;/h3>&lt;p>The &lt;code>std::convert::From&lt;/code> and &lt;code>std::convert::Into&lt;/code> traits represent conversions that consume a value of one type and return a value of another.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Into&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>: &lt;span class="nb">Sized&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">into&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">T&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">From&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>: &lt;span class="nb">Sized&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">from&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">other&lt;/span>: &lt;span class="nc">T&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Self&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The standard library automatically implements the trivial conversion from each type to itself: every type T implements &lt;code>From&amp;lt;T&amp;gt;&lt;/code> and &lt;code>Into&amp;lt;T&amp;gt;&lt;/code>.&lt;/p>
&lt;p>You generally use Into to make your functions more flexible in the arguments they accept.&lt;/p>
&lt;p>The from method serves as a generic constructor for producing an instance of a type from some other single value.&lt;/p>
&lt;p>Given an appropriate From implementation, the standard library automatically implements the corresponding Into trait.&lt;/p>
&lt;p>However, cheap conversions are not part of Into and Fromâ€™s contract. Whereas AsRef and AsMut conversions are expected to be cheap, From and Into conversions may allocate, copy, or otherwise process the valueâ€™s contents.&lt;/p>
&lt;p>The &lt;code>?&lt;/code> operator uses From and Into to help clean up code in functions that could fail in multiple ways by automatically converting from specific error types to general ones when needed.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">type&lt;/span> &lt;span class="nc">GenericError&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Box&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">error&lt;/span>::&lt;span class="n">Error&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Send&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Sync&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">GenericResult&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">GenericError&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">parse_i32_bytes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">b&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">u8&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">GenericResult&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">i32&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="kt">str&lt;/span>::&lt;span class="n">from_utf8&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">parse&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">i32&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">E&lt;/span>: &lt;span class="nc">Error&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Send&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Sync&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">From&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Box&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Error&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Send&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Sync&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">from&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">err&lt;/span>: &lt;span class="nc">E&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Box&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Error&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Send&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Sync&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Box&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">err&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>From and Into are infallible traitsâ€”their API requires that conversions will not fail.&lt;/p>
&lt;h3 id="tryfrom-and-tryinto">&lt;strong>TryFrom and TryInto&lt;/strong>
&lt;/h3>&lt;p>Instead, i32 implements TryFrom&lt;i64>. TryFrom and TryInto are the fallible cousins of From and Into and are similarly reciprocal; implementing TryFrom means that TryInto is implemented as well.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TryFrom&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>: &lt;span class="nb">Sized&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Error&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">try_from&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">value&lt;/span>: &lt;span class="nc">T&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Error&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TryInto&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>: &lt;span class="nb">Sized&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Error&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">try_into&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Error&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Where From and Into relate types with simple conversions, TryFrom and TryInto extend the simplicity of From and Into conversions with the expressive error handling afforded by Result. These four traits can be used together to relate many types in a single crate.&lt;/p>
&lt;h3 id="toowned">&lt;strong>ToOwned&lt;/strong>
&lt;/h3>&lt;p>The &lt;code>std::borrow::ToOwned&lt;/code> trait provides a slightly looser way to convert a reference to an owned value:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">ToOwned&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Owned&lt;/span>: &lt;span class="nc">Borrow&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">to_owned&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Self&lt;/span>::&lt;span class="n">Owned&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="borrow-and-toowned-at-work-the-humble-cow">&lt;strong>Borrow and ToOwned at Work: The Humble Cow&lt;/strong>
&lt;/h3>&lt;p>But in some cases you cannot decide whether to borrow or own until the program is running ; the std::borrow::Cow type (for â€œclone on writeâ€) provides one way to do this.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">enum&lt;/span> &lt;span class="nc">Cow&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">B&lt;/span>: &lt;span class="o">?&lt;/span>&lt;span class="nb">Sized&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">B&lt;/span>: &lt;span class="nb">ToOwned&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Borrowed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Owned&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">ToOwned&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>::&lt;span class="n">Owned&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>A &lt;code>Cow&amp;lt;B&amp;gt;&lt;/code> either borrows a shared reference to a B or owns a value from which we could borrow such a reference. Since Cow implements Deref, you can call methods on it as if it were a shared reference to a B: if itâ€™s Owned, it borrows a shared reference to the owned value; and if itâ€™s Borrowed, it just hands out the reference itâ€™s holding.&lt;/p>
&lt;p>You can also get a mutable reference to a Cowâ€™s value by calling its to_mut method, which returns a &amp;amp;mut B. If the Cow happens to be Cow::Borrowed, to_mut simply calls the referenceâ€™s to_owned method to get its own copy of the referent, changes the Cow into a Cow::Owned, and borrows a mutable reference to the newly owned value. This is the â€œclone on writeâ€ behavior the typeâ€™s name refers to.&lt;/p>
&lt;p>One common use for Cow is to return either a statically allocated string constant or a computed string.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">path&lt;/span>::&lt;span class="n">PathBuf&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">borrow&lt;/span>::&lt;span class="n">Cow&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">describe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">error&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Error&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Cow&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">error&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Error&lt;/span>::&lt;span class="n">OutOfMemory&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;out of memory&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">into&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Error&lt;/span>::&lt;span class="n">StackOverflow&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;stack overflow&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">into&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Error&lt;/span>::&lt;span class="n">MachineOnFire&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;machine on fire&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">into&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Error&lt;/span>::&lt;span class="n">Unfathomable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;machine bewildered&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">into&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Error&lt;/span>::&lt;span class="n">FileNotFound&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">ref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;file not found: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">display&lt;/span>&lt;span class="p">()).&lt;/span>&lt;span class="n">into&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="chapter-14-closures">&lt;strong>Chapter 14. Closures&lt;/strong>
&lt;/h2>&lt;p>Itâ€™s more concise to write the helper function as a &lt;em>closure&lt;/em>, an anonymous function expression:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">sort_cities&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cities&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">City&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">cities&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">sort_by_key&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">city&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">city&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">population&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="capturing-variables">&lt;strong>Capturing Variables&lt;/strong>
&lt;/h3>&lt;p>A closure can use data that belongs to an enclosing function.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">sort_cities&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cities&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">City&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">cities&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">sort_by_key&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">city&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">city&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">population&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="closures-that-borrow">Closures That Borrow
&lt;/h4>&lt;p>In this case, when Rust creates the closure, it automatically borrows a reference to stat. It stands to reason: the closure refers to stat, so it must have a reference to it.&lt;/p>
&lt;p>In short, Rust ensures safety by using lifetimes instead of garbage collection. Rustâ€™s way is faster: even a fast GC allocation will be slower than storing stat on the stack, as Rust does in this case.&lt;/p>
&lt;h4 id="closures-that-steal">&lt;strong>Closures That Steal&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">start_sorting_thread&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cities&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">City&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stat&lt;/span>: &lt;span class="nc">Statistic&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">thread&lt;/span>::&lt;span class="n">JoinHandle&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">City&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">key_fn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">move&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">city&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">City&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">i64&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">city&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">get_statistic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">stat&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">thread&lt;/span>::&lt;span class="n">spawn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">move&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">cities&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">sort_by_key&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key_fn&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">cities&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The only thing weâ€™ve changed is to add the move keyword before each of the two closures. The move keyword tells Rust that a closure doesnâ€™t borrow the variables it uses: it steals them.&lt;/p>
&lt;p>Rust thus offers two ways for closures to get data from enclosing scopes: moves and borrowing.&lt;/p>
&lt;p>We get something important by accepting Rustâ€™s strict rules: thread safety. It is precisely because the vector is moved, rather than being shared across threads, that we know the old thread wonâ€™t free the vector while the new thread is modifying it.&lt;/p>
&lt;h3 id="function-and-closure-types">&lt;strong>Function and Closure Types&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// Given a list of cities and a test function,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// return how many cities pass the test.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">count_selected_cities&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cities&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">City&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">test_fn&lt;/span>: &lt;span class="nc">fn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">City&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">usize&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">city&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cities&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test_fn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">city&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="sd">/// An example of a test function. Note that the type of
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// this function is `fn(&amp;amp;City) -&amp;gt; bool`, the same as
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">/// the `test_fn` argument to `count_selected_cities`.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">has_monster_attacks&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">city&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">City&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">city&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">monster_attack_risk&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// How many cities are at risk for monster attack?
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">count_selected_cities&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">my_cities&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">has_monster_attacks&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">count_selected_cities&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cities&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">City&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test_fn&lt;/span>: &lt;span class="nc">F&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">usize&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nc">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">Fn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">City&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">city&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cities&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test_fn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">city&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">City&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span> &lt;span class="c1">// fn type (functions only)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nb">Fn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">City&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span> &lt;span class="c1">// Fn trait (both functions and closures)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>In fact, every closure you write has its own type, because a closure may contain data: values either borrowed or stolen from enclosing scopes. This could be any number of variables, in any combination of types. So every closure has an ad hoc type created by the compiler, large enough to hold that data. No two closures have exactly the same type. But every closure implements an Fn trait; the closure in our example implements &lt;code>Fn(&amp;amp;City) -&amp;gt; i64&lt;/code>.&lt;/p>
&lt;h3 id="closure-performance">&lt;strong>Closure Performance&lt;/strong>
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220719092655451.png"
loading="lazy"
alt="image-20220719092655451"
>&lt;/p>
&lt;p>As the figure shows, these closures donâ€™t take up much space. But even those few bytes are not always needed in practice. Often, the compiler can inline all calls to a closure, and then even the small structs shown in this figure are optimized away.&lt;/p>
&lt;h3 id="closures-and-safety">&lt;strong>Closures and Safety&lt;/strong>
&lt;/h3>&lt;h4 id="closures-that-kill">&lt;strong>Closures That Kill&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">my_str&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;hello&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">drop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">my_str&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// ok
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// error: use of moved value
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>A closure that can be called only once may seem like a rather extraordinary thing, but weâ€™ve been talking throughout this book about ownership and lifetimes. The idea of values being used up (that is, moved) is one of the core concepts in Rust. It works the same with closures as with everything else.&lt;/p>
&lt;h4 id="fnonce">&lt;strong>FnOnce&lt;/strong>
&lt;/h4>&lt;p>The first time you call a FnOnce closure, &lt;em>the closure itself is used up.&lt;/em> Itâ€™s as though the two traits, Fn and FnOnce, were defined like this:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Pseudocode for `Fn` and `FnOnce` traits with no arguments.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Fn&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">R&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">R&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">FnOnce&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">R&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">call_once&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">R&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Just as an arithmetic expression like a + b is shorthand for a method call, Add::add(a, b), Rust treats closure() as shorthand for one of the two trait methods shown in the preceding example. For an Fn closure, closure() expands to closure.call(). This method takes self by reference, so the closure is not moved. But if the closure is only safe to call once, then closure() expands to closure.call_once(). That method takes self by value, so the closure is used up.&lt;/p>
&lt;h4 id="fnmut">FnMut
&lt;/h4>&lt;p>Therefore, Rust has one more category of closure, FnMut, the category of closures that write. FnMut closures are called by mut reference, as if they were defined like this:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Pseudocode for `Fn`, `FnMut`, and `FnOnce` traits.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Fn&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">R&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">R&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">FnMut&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">R&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">call_mut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">R&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">FnOnce&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">R&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">call_once&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">R&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Any closure that requires mut access to a value, but doesnâ€™t drop any values, is an FnMut closure.&lt;/p>
&lt;ul>
&lt;li>Fn is the family of closures and functions that you can call multiple times without restriction. This highest category also includes all fn functions.&lt;/li>
&lt;li>FnMut is the family of closures that can be called multiple times if the closure itself is declared mut.&lt;/li>
&lt;li>FnOnce is the family of closures that can be called once, if the caller owns the closure.&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220719095623728.png"
loading="lazy"
alt="image-20220719095623728"
>&lt;/p>
&lt;h4 id="copy-and-clone-for-closures">&lt;strong>Copy and Clone for Closures&lt;/strong>
&lt;/h4>&lt;p>Just as Rust automatically figures out which closures can be called only once, it can figure out which closures can implement Copy and Clone, and which cannot.&lt;/p>
&lt;p>A non-move closure that doesnâ€™t mutate variables holds only shared references, which are both Clone and Copy, so that closure is both Clone and Copy as well.&lt;/p>
&lt;p>On the other hand, a non-move closure that &lt;em>does&lt;/em> mutate values has mutable references within its internal representation. Mutable references are neither Clone nor Copy, so neither is a closure that uses them.&lt;/p>
&lt;p>For a move closure, the rules are even simpler. If everything a move closure captures is Copy, itâ€™s Copy. If everything it captures is Clone, itâ€™s Clone.&lt;/p>
&lt;h3 id="callbacks">&lt;strong>Callbacks&lt;/strong>
&lt;/h3>&lt;p>Closures have unique types because each one captures different variables, so among other things, theyâ€™re each a different size. If they donâ€™t capture anything, though, thereâ€™s nothing to store. By using fn pointers in functions that take callbacks, you can restrict a caller to use only these noncapturing closures, gaining some perfomance and flexibility within the code using callbacks at the cost of flexibility for the users of your API.&lt;/p>
&lt;h3 id="using-closures-effectively">&lt;strong>Using Closures Effectively&lt;/strong>
&lt;/h3>&lt;p>MVC&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220719103619045.png"
loading="lazy"
alt="image-20220719103619045"
>&lt;/p>
&lt;p>æ›¿ä»£æ–¹æ¡ˆï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220719104801927.png"
loading="lazy"
alt="image-20220719104801927"
>&lt;/p>
&lt;h2 id="chapter-15-iterators">&lt;strong>Chapter 15. Iterators&lt;/strong>
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">triangle&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>: &lt;span class="kt">i32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">i32&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">..=&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™é‡Œ&lt;code>1..=n&lt;/code>æ˜¯ä¸€ä¸ª&lt;code>RangeInclusive&amp;lt;i32&amp;gt;&lt;/code>çš„å€¼ã€‚A &lt;code>RangeInclusive&amp;lt;i32&amp;gt;&lt;/code> is an iterator that produces the integers from its start value to its end value (both inclusive), so you can use it as the operand of the for loop to sum the values from 1 to n.&lt;/p>
&lt;p>ä¹Ÿå¯ä»¥ç”¨é—­åŒ…å†™ï¼Œæ›´ç®€æ´å’Œä¼˜é›…ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">triangle&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>: &lt;span class="kt">i32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">i32&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">..=&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">fold&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="the-iterator-and-intoiterator-traits">&lt;strong>The Iterator and IntoIterator Traits&lt;/strong>
&lt;/h3>&lt;p>&lt;code>std::iter::Iterator&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Item&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">next&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// many default methods
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>std::iter::IntoIterator&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">IntoIterator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">IntoIter&lt;/span>: &lt;span class="nb">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Item&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">IntoIter&lt;/span>: &lt;span class="nb">Iterator&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">into_iter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Self&lt;/span>::&lt;span class="n">IntoIter&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¸ªè¡¨ç¤ºå¯è¿­ä»£çš„ï¼Œå¯ä»¥è°ƒç”¨ &lt;code>into_iter()&lt;/code> æ–¹æ³•äº§ç”Ÿä¸€ä¸ªè¿­ä»£å™¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;There&amp;#39;s:&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;antimony&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;arsenic&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;aluminum&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;selenium&amp;#34;&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">element&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">element&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç­‰ä»·äº&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">iterator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">into_iter&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">element&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">iterator&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">element&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Although a for loop always calls into_iter on its operand, you can also pass iterators to for loops directly; this occurs when you loop over a Range, for example. All iterators automatically implement IntoIterator, with an into_iter method that simply returns the iterator.&lt;/p>
&lt;h3 id="creating-iterators">&lt;strong>Creating Iterators&lt;/strong>
&lt;/h3>&lt;h4 id="iter-and-iter_mut-methods">&lt;strong>iter and iter_mut Methods&lt;/strong>
&lt;/h4>&lt;p>Most collection types provide iter and iter_mut methods that return the natural iterators over the type, producing a shared or mutable reference to each item.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">iterator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iterator&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iterator&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iterator&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iterator&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iterator&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iterator&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>This iteratorâ€™s item type is &amp;amp;i32: each call to next produces a reference to the next element, until we reach the end of the vector.&lt;/p>
&lt;p>For example, there is no iter method on the &amp;amp;str string slice type. Instead, if s is a &amp;amp;str, then s.bytes() returns an iterator that produces each byte of s, whereas s.chars() interprets the contents as UTF-8 and produces each Unicode character.&lt;/p>
&lt;h4 id="intoiterator-implementations">&lt;strong>IntoIterator Implementations&lt;/strong>
&lt;/h4>&lt;p>Most collections actually provide several implementations of IntoIterator, for shared references (&amp;amp;T), mutable references (&amp;amp;mut T), and moves (T):&lt;/p>
&lt;ul>
&lt;li>Given a &lt;em>shared reference&lt;/em> to the collection, into_iter returns an iterator that produces shared references to its items. For example, in the preceding code, (&amp;amp;favorites).into_iter() would return an iterator whose Item type is &amp;amp;String.&lt;/li>
&lt;li>Given a &lt;em>mutable reference&lt;/em> to the collection, into_iter returns an iterator that produces mutable references to the items. For example, if vector is some Vec&lt;String>, the call (&amp;amp;mut vector).into_iter() returns an iterator whose Item type is &amp;amp;mut String.&lt;/li>
&lt;li>When passed the collection &lt;em>by value&lt;/em>, into_iter returns an iterator that takes ownership of the collection and returns items by value; the itemsâ€™ ownership moves from the collection to the consumer, and the original collection is consumed in the process. For example, the call favorites.into_iter() in the preceding code returns an iterator that produces each string by value; the consumer receives ownership of each string. When the iterator is dropped, any elements remaining in the BTreeSet are dropped too, and the setâ€™s now-empty husk is disposed of.&lt;/li>
&lt;/ul>
&lt;p>The general principle is that iteration should be efficient and predictable, so rather than providing implementations that are expensive or could exhibit surprising behavior (for example, rehashing modified HashSet entries and potentially encountering them again later in the iteration), Rust omits them entirely.&lt;/p>
&lt;p>ç”¨åœ¨æ³›å‹ä¸Šï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">fmt&lt;/span>::&lt;span class="n">Debug&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">dump&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">U&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">t&lt;/span>: &lt;span class="nc">T&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nb">IntoIterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">U&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">U&lt;/span>: &lt;span class="nc">Debug&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="from_fn-and-successors">&lt;strong>from_fn and successors&lt;/strong>
&lt;/h4>&lt;p>&lt;code>std::iter::from_fn&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">from_fn&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">f&lt;/span>: &lt;span class="nc">F&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">FromFn&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">FromFn&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Item&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rand&lt;/span>::&lt;span class="n">random&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// In Cargo.toml dependencies: rand = &amp;#34;0.7&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">iter&lt;/span>::&lt;span class="n">from_fn&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// Generate the lengths of 1000 random line segments whose endpoints
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// are uniformly distributed across the interval [0, 1]. (This isn&amp;#39;t a
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// distribution you&amp;#39;re going to find in the `rand_distr` crate, but
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// it&amp;#39;s easy to make yourself.)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lengths&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">f64&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">from_fn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">random&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">f64&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">random&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">f64&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()).&lt;/span>&lt;span class="n">abs&lt;/span>&lt;span class="p">()))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">take&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">collect&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>If each item depends on the one before, &lt;code>std::iter::successors&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">successors&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">first&lt;/span>: &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">succ&lt;/span>: &lt;span class="nc">F&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Successors&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="err">â“˜&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Successors&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Item&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">num&lt;/span>::&lt;span class="n">Complex&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">iter&lt;/span>::&lt;span class="n">successors&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">escape_time&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">c&lt;/span>: &lt;span class="nc">Complex&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">f64&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">limit&lt;/span>: &lt;span class="kt">usize&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">usize&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">zero&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Complex&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">re&lt;/span>: &lt;span class="mf">0.0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">im&lt;/span>: &lt;span class="mf">0.0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">successors&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">zero&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&amp;amp;&lt;/span>&lt;span class="n">z&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">z&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">z&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">take&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">limit&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">enumerate&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">find&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">_i&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">z&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">z&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">norm_sqr&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">4.0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_z&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ–æ³¢é‚£å¥‘æ•°åˆ—&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">fibonacci&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kt">usize&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">state&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">iter&lt;/span>::&lt;span class="n">from_fn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">move&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">state&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fibonacci&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">take&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">collect&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">13&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">21&lt;/span>&lt;span class="p">]);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="drain-methods">&lt;strong>drain Methods&lt;/strong>
&lt;/h4>&lt;p>Many collection types provide a drain method that takes a mutable reference to the collection and returns an iterator that passes ownership of each element to the consumer. However, unlike the into_iter() method, which takes the collection by value and consumes it, drain merely borrows a mutable reference to the collection, and when the iterator is dropped, it removes any remaining elements from the collection and leaves it empty.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">iter&lt;/span>::&lt;span class="n">FromIterator&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">outer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Earth&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">inner&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">String&lt;/span>::&lt;span class="n">from_iter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">outer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">drain&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">outer&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Eh&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">inner&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;art&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="other-iterator-sources">&lt;strong>Other Iterator Sources&lt;/strong>
&lt;/h4>&lt;p>çœç•¥&lt;/p>
&lt;h3 id="iterator-adapters">&lt;strong>Iterator Adapters&lt;/strong>
&lt;/h3>&lt;h4 id="map-and-filter">&lt;strong>map and filter&lt;/strong>
&lt;/h4>&lt;p>The Iterator traitâ€™s map adapter lets you transform an iterator by applying a closure to its items. The filter adapter lets you filter out items from an iterator, using a closure to decide which to keep and which to drop.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34; ponies &lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s"> giraffes&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">iguanas &lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">squid&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">lines&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">str&lt;/span>::&lt;span class="n">trim&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">collect&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;ponies&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;giraffes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;iguanas&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;squid&amp;#34;&lt;/span>&lt;span class="p">]);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34; ponies &lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s"> giraffes&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">iguanas &lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">squid&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_string&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">lines&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">str&lt;/span>::&lt;span class="n">trim&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">filter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;iguanas&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">collect&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;ponies&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;giraffes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;squid&amp;#34;&lt;/span>&lt;span class="p">]);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ ‡å‡†åº“ä¸­è¿”å›çš„æ˜¯ std::iter::Map
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">f&lt;/span>: &lt;span class="nc">F&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">B&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// æ ‡å‡†åº“ä¸­è¿”å›çš„æ˜¯ std::iter::Filter
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">filter&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">P&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">predicate&lt;/span>: &lt;span class="nc">P&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">P&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>First, simply calling an adapter on an iterator doesnâ€™t consume any items; it just returns a new iterator, ready to produce its own items by drawing from the first iterator as needed. In a chain of adapters, the only way to make any work actually get done is to call next on the final iterator.&lt;/p>
&lt;p>&lt;strong>The term â€œlazyâ€&lt;/strong> in the error message is not a disparaging term; itâ€™s just jargon for any mechanism that puts off a computation until its value is needed. It is Rustâ€™s convention that iterators should do the minimum work necessary to satisfy each call to next; in the example, there are no such calls at all, so no work takes place.&lt;/p>
&lt;p>The second important point is that iterator adapters are a &lt;strong>zero-overhead abstraction&lt;/strong>.&lt;/p>
&lt;h4 id="filter_map-and-flat_map">&lt;strong>filter_map and flat_map&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">filter_map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">f&lt;/span>: &lt;span class="nc">F&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="kt">str&lt;/span>::&lt;span class="n">FromStr&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;1&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">frond .25 289&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">3.1415 estuary&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">number&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">split_whitespace&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">filter_map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">w&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">f64&lt;/span>::&lt;span class="n">from_str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">w&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">ok&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{:4.2}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">number&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">sqrt&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">flat_map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">U&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">f&lt;/span>: &lt;span class="nc">F&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">U&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">U&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">U&lt;/span>: &lt;span class="nb">IntoIterator&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">collections&lt;/span>::&lt;span class="n">HashMap&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">major_cities&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">major_cities&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Japan&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;Tokyo&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Kyoto&amp;#34;&lt;/span>&lt;span class="p">]);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">major_cities&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;The United States&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;Portland&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Nashville&amp;#34;&lt;/span>&lt;span class="p">]);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">major_cities&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Brazil&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;SÃ£o Paulo&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;BrasÃ­lia&amp;#34;&lt;/span>&lt;span class="p">]);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">major_cities&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Kenya&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;Nairobi&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Mombasa&amp;#34;&lt;/span>&lt;span class="p">]);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">major_cities&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;The Netherlands&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;Amsterdam&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Utrecht&amp;#34;&lt;/span>&lt;span class="p">]);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">countries&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;Japan&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Brazil&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Kenya&amp;#34;&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">city&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">countries&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">flat_map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">country&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">major_cities&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">country&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">city&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿è¡Œç»“æœï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Tokyo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Kyoto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SÃ£o Paulo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BrasÃ­lia
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Nairobi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Mombasa
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="flatten">&lt;strong>flatten&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">collections&lt;/span>::&lt;span class="n">BTreeMap&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// A table mapping cities to their parks: each value is a vector.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parks&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BTreeMap&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">parks&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Portland&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;Mt. Tabor Park&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Forest Park&amp;#34;&lt;/span>&lt;span class="p">]);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parks&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Kyoto&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;Tadasu-no-Mori Forest&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Maruyama Koen&amp;#34;&lt;/span>&lt;span class="p">]);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parks&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Nashville&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;Percy Warner Park&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Dragon Park&amp;#34;&lt;/span>&lt;span class="p">]);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// Build a vector of all parks. `values` gives us an iterator producing
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// vectors, and then `flatten` produces each vector&amp;#39;s elements in turn.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">all_parks&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parks&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">values&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">flatten&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">cloned&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">collect&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">all_parks&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;Tadasu-no-Mori Forest&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Maruyama Koen&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Percy Warner Park&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Dragon Park&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Mt. Tabor Park&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Forest Park&amp;#34;&lt;/span>&lt;span class="p">]);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">flatten&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>: &lt;span class="nb">IntoIterator&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="take-and-take_while">&lt;strong>take and take_while&lt;/strong>
&lt;/h4>&lt;p>The Iterator traitâ€™s take and take_while adapters let you end an iteration after a certain number of items or when a closure decides to cut things off.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">take&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>: &lt;span class="kt">usize&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">take_while&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">P&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">predicate&lt;/span>: &lt;span class="nc">P&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">P&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">message&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;To: jimb&lt;/span>&lt;span class="se">\r\n\&lt;/span>&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> From: superego &amp;lt;editor@oreilly.com&amp;gt;&lt;/span>&lt;span class="se">\r\n\&lt;/span>&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &lt;/span>&lt;span class="se">\r\n\&lt;/span>&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> Did you get any writing done today?&lt;/span>&lt;span class="se">\r\n\&lt;/span>&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> When will you stop wasting time plotting fractals?&lt;/span>&lt;span class="se">\r\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">header&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">message&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">lines&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">take_while&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">l&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">l&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">is_empty&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">header&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç»“æœï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="n">To&lt;/span>: &lt;span class="nc">jimb&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nb">From&lt;/span>: &lt;span class="nc">superego&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">editor&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">oreilly&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="skip-and-skip_while">&lt;strong>skip and skip_while&lt;/strong>
&lt;/h4>&lt;p>The Iterator traitâ€™s skip and skip_while methods are the complement of take and take_while: they drop a certain number of items from the beginning of an iteration, or drop items until a closure finds one acceptable, and then pass the remaining items through unchanged.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">skip&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>: &lt;span class="kt">usize&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">skip_while&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">P&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">predicate&lt;/span>: &lt;span class="nc">P&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">P&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">body&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">message&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">lines&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">skip_while&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">l&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">l&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">is_empty&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">skip&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">body&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¾“å‡ºç»“æœä¸ºï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Did you get any writing done today?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">When will you stop wasting time plotting fractals?
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="peekable">&lt;strong>peekable&lt;/strong>
&lt;/h4>&lt;p>A peekable iterator lets you peek at the next item that will be produced without actually consuming it. You can turn any iterator into a peekable iterator by calling the Iterator traitâ€™s peekable method:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">peekable&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">std&lt;/span>::&lt;span class="n">iter&lt;/span>::&lt;span class="n">Peekable&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Here, &lt;code>Peekable&amp;lt;Self&amp;gt;&lt;/code> is a struct that implements &lt;code>Iterator&amp;lt;Item=Self::Item&amp;gt;&lt;/code>, and Self is the type of the underlying iterator.&lt;/p>
&lt;h4 id="fuse">&lt;strong>fuse&lt;/strong>
&lt;/h4>&lt;p>&lt;code>fuse&lt;/code> é€‚é…å™¨å¯ä»¥å°†ä»»ä½•é€‚é…å™¨è½¬æ¢ä¸ºç¬¬ä¸€æ¬¡è¿”å›&lt;code>None&lt;/code>ä¹‹åå§‹ç»ˆç»§ç»­è¿”å›&lt;code>None&lt;/code>çš„è¿­ä»£å™¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">Flaky&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">bool&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Flaky&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Item&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">next&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;totally the last item&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// D&amp;#39;oh!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">flaky&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Flaky&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">flaky&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;totally the last item&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">flaky&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">flaky&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;totally the last item&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">not_flaky&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Flaky&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">fuse&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">not_flaky&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;totally the last item&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">not_flaky&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">not_flaky&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="reversible-iterators-and-rev">&lt;strong>Reversible Iterators and rev&lt;/strong>
&lt;/h4>&lt;p>ä»åºåˆ—ä¸¤ç«¯å–å¾—é¡¹ã€‚å®ç°&lt;code>std::iter::DoubleEndedIterator&lt;/code> traitã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">DoubleEndedIterator&lt;/span>: &lt;span class="nb">Iterator&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">next_back&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bee_parts&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;head&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;thorax&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;abdomen&amp;#34;&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bee_parts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="s">&amp;#34;head&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next_back&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="s">&amp;#34;abdomen&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="s">&amp;#34;thorax&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next_back&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>If an iterator is double-ended, you can reverse it with the rev adapter:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">rev&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">Self&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">DoubleEndedIterator&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The returned iterator is also double-ended: its next and next_back methods are simply exchanged:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">meals&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;breakfast&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;lunch&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;dinner&amp;#34;&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">meals&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">rev&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="s">&amp;#34;dinner&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="s">&amp;#34;lunch&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="s">&amp;#34;breakfast&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="inspect">&lt;strong>inspect&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">upper_case&lt;/span>: &lt;span class="nb">String&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;groÃŸe&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">chars&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">inspect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;before: &lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">flat_map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">to_uppercase&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">inspect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34; after: &lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">collect&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">upper_case&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;GROSSE&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="chain">&lt;strong>chain&lt;/strong>
&lt;/h4>&lt;p>å°†ä¸€ä¸ªè¿­ä»£å™¨åŠ åˆ°å¦ä¸€ä¸ªè¿­ä»£å™¨åé¢ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">chain&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">U&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">other&lt;/span>: &lt;span class="nc">U&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">U&lt;/span>: &lt;span class="nb">IntoIterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>In other words, you can chain an iterator together with any iterable that produces the same item type.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">i32&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">chain&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">40&lt;/span>&lt;span class="p">]).&lt;/span>&lt;span class="n">collect&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">40&lt;/span>&lt;span class="p">]);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="enumerate">&lt;strong>enumerate&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">band&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bands&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">into_iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">enumerate&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">top&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">band_rows&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// start a thread to render rows `top..top + band_rows` ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>You can think of the (index, item) pairs that enumerate produces as analogous to the (key, value) pairs that you get when iterating over a HashMap or other associative collection. If youâ€™re iterating over a slice or vector, the index is the â€œkeyâ€ under which the item appears.&lt;/p>
&lt;h4 id="zip">&lt;strong>zip&lt;/strong>
&lt;/h4>&lt;p>The zip adapter combines two iterators into a single iterator that produces pairs holding one value from each iterator, like a zipper joining its two sides into a single seam. The zipped iterator ends when either of the two underlying iterators ends.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">zip&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;ABCD&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">chars&lt;/span>&lt;span class="p">()).&lt;/span>&lt;span class="n">collect&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">&amp;#39;A&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">&amp;#39;B&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">&amp;#39;C&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">&amp;#39;D&amp;#39;&lt;/span>&lt;span class="p">)]);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The argument to zip doesnâ€™t need to be an iterator itself; it can be any iterable:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">iter&lt;/span>::&lt;span class="n">repeat&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">endings&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;once&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;twice&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;chicken soup with rice&amp;#34;&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rhyme&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">repeat&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;going&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">zip&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">endings&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">collect&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rhyme&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[(&lt;/span>&lt;span class="s">&amp;#34;going&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;once&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;going&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;twice&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;going&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;chicken soup with rice&amp;#34;&lt;/span>&lt;span class="p">)]);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="by_ref">&lt;strong>by_ref&lt;/strong>
&lt;/h4>&lt;p>An iteratorâ€™s by_ref method borrows a mutable reference to the iterator so that you can apply adapters to the reference. When youâ€™re done consuming items from these adapters, you drop them, the borrow ends, and you regain access to your original iterator.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">message&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;To: jimb&lt;/span>&lt;span class="se">\r\n&lt;/span>&lt;span class="s">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> From: id&lt;/span>&lt;span class="se">\r\n\&lt;/span>&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &lt;/span>&lt;span class="se">\r\n\&lt;/span>&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> Oooooh, donuts!!&lt;/span>&lt;span class="se">\r\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lines&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">message&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">lines&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Headers:&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">header&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lines&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">by_ref&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">take_while&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">l&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">l&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">is_empty&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">header&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">Body:&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">body&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lines&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">body&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="cloned-copied">cloned, copied
&lt;/h4>&lt;p>The cloned adapter takes an iterator that produces references and returns an iterator that produces values cloned from those references, much like iter.map(|item| item.clone()). Naturally, the referent type must implement Clone.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="sc">&amp;#39;1&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">&amp;#39;2&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">&amp;#39;3&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">&amp;#39;âˆ&amp;#39;&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="sc">&amp;#39;1&amp;#39;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">cloned&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">&amp;#39;1&amp;#39;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The copied adapter is the same idea, but more restrictive: the referent type must implement Copy. A call like iter.copied() is roughly the same as iter.map(|r| *r).&lt;/p>
&lt;h4 id="cycle">&lt;strong>cycle&lt;/strong>
&lt;/h4>&lt;p>The cycle adapter returns an iterator that endlessly repeats the sequence produced by the underlying iterator. The underlying iterator must implement std::clone::Clone so that cycle can save its initial state and reuse it each time the cycle starts again.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dirs&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;North&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;East&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;South&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;West&amp;#34;&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">spin&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dirs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">cycle&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">spin&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="s">&amp;#34;North&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">spin&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="s">&amp;#34;East&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">spin&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="s">&amp;#34;South&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">spin&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="s">&amp;#34;West&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">spin&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="s">&amp;#34;North&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">spin&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="s">&amp;#34;East&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="consuming-iterators">&lt;strong>Consuming Iterators&lt;/strong>
&lt;/h3>&lt;h4 id="simple-accumulation-count-sum-product">&lt;strong>Simple Accumulation: count, sum, product&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">usize&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nc">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">fold&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[rustc_inherit_overflow_checks]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The count method draws items from an iterator until it returns None and tells you how many it got.&lt;/p>
&lt;p>The sum and product methods compute the sum or product of the iteratorâ€™s items, which must be integers or floating-point numbers.&lt;/p>
&lt;h4 id="max-min">&lt;strong>max, min&lt;/strong>
&lt;/h4>&lt;p>&lt;code>std::iter::Iterator&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">max&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>: &lt;span class="nb">Ord&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">max_by&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">Ord&lt;/span>::&lt;span class="n">cmp&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="max_by-min_by">&lt;strong>max_by, min_by&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">max_by&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">compare&lt;/span>: &lt;span class="nc">F&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Ordering&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">cmp&lt;/span>::&lt;span class="n">Ordering&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// Compare two f64 values. Panic if given a NaN.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">cmp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">lhs&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="kt">f64&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rhs&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="kt">f64&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Ordering&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">lhs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">partial_cmp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rhs&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">unwrap&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">numbers&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">4.0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">2.0&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">numbers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">copied&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">max_by&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cmp&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">4.0&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">numbers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">copied&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">min_by&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cmp&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">numbers&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">4.0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="kt">f64&lt;/span>::&lt;span class="no">NAN&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">2.0&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">numbers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">copied&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">max_by&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cmp&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">4.0&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// panics
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="max_by_key-min_by_key">&lt;strong>max_by_key, min_by_key&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">max_by_key&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">B&lt;/span>: &lt;span class="nb">Ord&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">f&lt;/span>: &lt;span class="nc">F&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">B&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">min_by_key&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">B&lt;/span>: &lt;span class="nb">Ord&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">f&lt;/span>: &lt;span class="nc">F&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">B&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">collections&lt;/span>::&lt;span class="n">HashMap&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">populations&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">populations&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Portland&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">583_776&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">populations&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Fossil&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">449&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">populations&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Greenhorn&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">populations&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Boring&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">7_762&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">populations&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;The Dalles&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">15_340&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">populations&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">max_by_key&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&amp;amp;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">_name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="s">&amp;#34;Portland&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="mi">583_776&lt;/span>&lt;span class="p">)));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">populations&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">min_by_key&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&amp;amp;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">_name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="s">&amp;#34;Greenhorn&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="comparing-item-sequences">&lt;strong>Comparing Item Sequences&lt;/strong>
&lt;/h4>&lt;p>Iterators provide the eq and ne methods for equality comparisons, and lt, le, gt, and ge methods for ordered comparisons. The cmp and partial_cmp methods behave like the corresponding methods of the Ord and PartialOrd traits.&lt;/p>
&lt;h4 id="any-and-all">&lt;strong>any and all&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">any&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">f&lt;/span>: &lt;span class="nc">F&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nc">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">all&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">f&lt;/span>: &lt;span class="nc">F&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nc">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="position-rposition-and-exactsizeiterator">&lt;strong>position, rposition, and ExactSizeIterator&lt;/strong>
&lt;/h4>&lt;p>The position method applies a closure to each item from the iterator and returns the index of the first item for which the closure returns true.&lt;/p>
&lt;p>The rposition method is the same, except that it searches from the right.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">rposition&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">P&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">predicate&lt;/span>: &lt;span class="nc">P&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">usize&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">P&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">ExactSizeIterator&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">DoubleEndedIterator&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">ExactSizeIterator&lt;/span>: &lt;span class="nb">Iterator&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">usize&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// è¿”å›å‰©ä½™é¡¹æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">is_empty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// åœ¨è¿­ä»£å®Œæˆæ—¶è¿”å› true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="fold-and-rfold">&lt;strong>fold and rfold&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">fold&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">init&lt;/span>: &lt;span class="nc">B&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">f&lt;/span>: &lt;span class="nc">F&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">B&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">B&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>foldæ–¹æ³•æ˜¯ä¸€ä¸ªé€šç”¨å·¥å…·ï¼Œå¯ä»¥å¯¹è¿­ä»£å™¨äº§ç”Ÿé¡¹çš„æ•´ä¸ªåºåˆ—æ‰§è¡ŒæŸäº›ç´¯è®¡æ“ä½œã€‚è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸€ä¸ªåä¸ºç´¯åŠ å™¨çš„åˆå§‹å€¼å’Œä¸€ä¸ªé—­åŒ…ï¼Œç„¶åå¯¹å½“å‰ç´¯åŠ å™¨å’Œè¿­ä»£å™¨çš„ä¸‹ä¸€é¡¹é‡å¤åº”ç”¨é—­åŒ…ã€‚æ¯æ¬¡é—­åŒ…çš„è¿”å›å€¼éƒ½ä¼šæˆä¸ºç´¯åŠ å™¨çš„æ–°å€¼ï¼Œç„¶åå†å’Œè¿­ä»£å™¨çš„ä¸‹ä¸€é¡¹ä¸€å—ä¼ ç»™é—­åŒ…ã€‚ç´¯åŠ å™¨çš„æœ€ç»ˆå€¼ä¹Ÿæ˜¯foldæ–¹æ³•è¿”å›çš„å€¼ã€‚å¦‚æœåºåˆ—æ˜¯ç©ºçš„ï¼Œåˆ™foldè¿”å›ç´¯åŠ å™¨çš„åˆå§‹å€¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">fold&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// count
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">fold&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">45&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// sum
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">fold&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">151200&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// product
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">cloned&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">fold&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">i32&lt;/span>::&lt;span class="n">min_value&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">cmp&lt;/span>::&lt;span class="n">max&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// max
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç´¯åŠ å™¨çš„å€¼ä¼šè½¬ç§»åˆ°é—­åŒ…ä¸­å†è½¬ç§»å‡ºæ¥ï¼Œå› æ­¤å¯ä»¥å¯¹éCopyç±»å‹çš„ç´¯åŠ å™¨ä½¿ç”¨foldï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;Pack&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;my&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;box&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;with&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;five&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;dozen&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;liquor&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;jugs&amp;#34;&lt;/span>&lt;span class="p">];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// See also: the `join` method on slices, which won&amp;#39;t
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// give you that extra space at the end.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pangram&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">fold&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">String&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">w&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">w&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34; &amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pangram&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Pack my box with five dozen liquor jugs &amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The rfold method is the same as fold, except that it requires a double-ended iterator, and processes its items from last to first.&lt;/p>
&lt;h4 id="try_fold-and-try_rfold">&lt;strong>try_fold and try_rfold&lt;/strong>
&lt;/h4>&lt;p>The try_fold method is the same as fold, except that the process of iteration can exit early, without consuming all the values from the iterator. The closure you pass to try_fold must return a Result: if it returns Err(e), try_fold returns immediately with Err(e) as its value. Otherwise, it continues folding with the success value. The closure can also return an Option: returning None exits early, and the result is an Option of the folded value.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">try_fold&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">R&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">init&lt;/span>: &lt;span class="nc">B&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">f&lt;/span>: &lt;span class="nc">F&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">R&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">R&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">R&lt;/span>: &lt;span class="nc">Try&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Output&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">error&lt;/span>::&lt;span class="n">Error&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">io&lt;/span>::&lt;span class="n">prelude&lt;/span>::&lt;span class="o">*&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="kt">str&lt;/span>::&lt;span class="n">FromStr&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Box&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Error&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stdin&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">io&lt;/span>::&lt;span class="n">stdin&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stdin&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">lines&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">try_fold&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u64&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Box&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Error&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">u64&lt;/span>::&lt;span class="n">from_str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">trim&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(())&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">all&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">P&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">predicate&lt;/span>: &lt;span class="nc">P&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nc">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">P&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">try_fold&lt;/span>&lt;span class="p">((),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">predicate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}).&lt;/span>&lt;span class="n">is_some&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="nth-nth_back">&lt;strong>nth, nth_back&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">nth&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>: &lt;span class="kt">usize&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="last">&lt;strong>last&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">last&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>This consumes all the iteratorâ€™s items starting from the front, even if the iterator is reversible. If you have a reversible iterator and donâ€™t need to consume all its items, you should instead just write iter.next_back().&lt;/p>
&lt;h4 id="find-rfind-and-find_map">&lt;strong>find, rfind, and find_map&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">find&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">P&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">predicate&lt;/span>: &lt;span class="nc">P&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">P&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">populations&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">find&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&amp;amp;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">_name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1_000_000&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">populations&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">find&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&amp;amp;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">_name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">500_000&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="s">&amp;#34;Portland&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="mi">583_776&lt;/span>&lt;span class="p">)));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">find_map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">f&lt;/span>: &lt;span class="nc">F&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="building-collections-collect-and-fromiterator">&lt;strong>Building Collections: collect and FromIterator&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">collect&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">B&lt;/span>: &lt;span class="nc">FromIterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">B&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">FromIterator&lt;/span>::&lt;span class="n">from_iter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">FromIterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>: &lt;span class="nb">Sized&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">from_iter&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nb">IntoIterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iter&lt;/span>: &lt;span class="nc">T&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Self&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åˆ†é…æ—¶æé«˜æ•ˆç‡ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">size_hint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="p">(&lt;/span>&lt;span class="kt">usize&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">usize&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>This method returns a lower bound and optional upper bound on the number of items the iterator will produce. The default definition returns zero as the lower bound and declines to name an upper bound, saying, in effect, â€œI have no idea,â€ but many iterators can do better than this. An iterator over a Range, for example, knows exactly how many items it will produce, as does an iterator over a Vec or HashMap. Such iterators provide their own specialized definitions for size_hint.&lt;/p>
&lt;h4 id="the-extend-trait">&lt;strong>The Extend Trait&lt;/strong>
&lt;/h4>&lt;p>If a type implements the std::iter::Extend trait, then its extend method adds an iterableâ€™s items to the collection.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Extend&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">extend&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">iter&lt;/span>: &lt;span class="nc">T&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nb">IntoIterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="partition">&lt;strong>partition&lt;/strong>
&lt;/h4>&lt;p>The partition method divides an iteratorâ€™s items among two collections, using a closure to decide where each item belongs.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">partition&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">f&lt;/span>: &lt;span class="nc">F&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="p">(&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">B&lt;/span>: &lt;span class="nb">Default&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Extend&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[inline]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">extend&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">B&lt;/span>: &lt;span class="nb">Extend&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">f&lt;/span>: &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span> &lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span> &lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">FnMut&lt;/span>&lt;span class="p">((),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">move&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">extend_one&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">extend_one&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>: &lt;span class="nc">B&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Default&lt;/span>::&lt;span class="n">default&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>: &lt;span class="nc">B&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Default&lt;/span>::&lt;span class="n">default&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">fold&lt;/span>&lt;span class="p">((),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">extend&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Other languages offer partition operations that just split the iterator into two iterators, instead of building two collections. But this isnâ€™t a good fit for Rust: items drawn from the underlying iterator but not yet drawn from the appropriate partitioned iterator would need to be buffered somewhere; you would end up building a collection of some sort internally, anyway.&lt;/p>
&lt;h4 id="for_each-and-try_for_each">&lt;strong>for_each and try_for_each&lt;/strong>
&lt;/h4>&lt;p>The for_each method simply applies a closure to each item.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">for_each&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">f&lt;/span>: &lt;span class="nc">F&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>: &lt;span class="nb">Sized&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[inline]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">call&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">f&lt;/span>: &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">FnMut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">FnMut&lt;/span>&lt;span class="p">((),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">move&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">fold&lt;/span>&lt;span class="p">((),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;doves&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;hens&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;birds&amp;#34;&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">zip&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="s">&amp;#34;turtle&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;french&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;calling&amp;#34;&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">zip&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">rev&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">kind&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">quantity&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s"> &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s"> &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">quantity&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">kind&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">for_each&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">gift&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;You have received: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gift&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ‰“å°è¾“å‡ºï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">You have received: &lt;span class="m">4&lt;/span> calling birds
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">You have received: &lt;span class="m">3&lt;/span> french hens
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">You have received: &lt;span class="m">2&lt;/span> turtle doves
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>If your closure needs to be fallible or exit early, you can use try_for_each.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">try_for_each&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">gift&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">writeln!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">output_file&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;You have received: {}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gift&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="implementing-your-own-iterators">Implementing Your Own Iterators
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">iter&lt;/span>::&lt;span class="nb">Iterator&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">I32Range&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">start&lt;/span>: &lt;span class="kt">i32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å½“å‰çš„å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">end&lt;/span>: &lt;span class="kt">i32&lt;/span> &lt;span class="c1">// è¿­ä»£ç»“æŸçš„å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">I32Range&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Item&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">i32&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">next&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">i32&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">start&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">end&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">start&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">start&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pi&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">numerator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">I32Range&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">start&lt;/span>: &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">end&lt;/span>: &lt;span class="mi">14&lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">pi&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">numerator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">f64&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">numerator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">3.0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">pi&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">f64&lt;/span>::&lt;span class="n">sqrt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">12.0&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// IEEE 754 specifies this result exactly
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pi&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">f32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="kt">f32&lt;/span>::&lt;span class="n">consts&lt;/span>::&lt;span class="no">PI&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">crate&lt;/span>::&lt;span class="n">BinaryTree&lt;/span>::&lt;span class="n">NonEmpty&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">enum&lt;/span> &lt;span class="nc">BinaryTree&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Empty&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">NonEmpty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">Box&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">TreeNode&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">TreeNode&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">element&lt;/span>: &lt;span class="nc">T&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>: &lt;span class="nc">BinaryTree&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>: &lt;span class="nc">BinaryTree&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nb">Ord&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BinaryTree&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>: &lt;span class="nc">T&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">BinaryTree&lt;/span>::&lt;span class="n">Empty&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BinaryTree&lt;/span>::&lt;span class="n">NonEmpty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">Box&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">TreeNode&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">element&lt;/span>: &lt;span class="nc">value&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>: &lt;span class="nc">BinaryTree&lt;/span>::&lt;span class="n">Empty&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>: &lt;span class="nc">BinaryTree&lt;/span>::&lt;span class="n">Empty&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">})),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">BinaryTree&lt;/span>::&lt;span class="n">NonEmpty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">ref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">element&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">TreeIter&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// A stack of references to tree nodes. Since we use `Vec`&amp;#39;s
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// `push` and `pop` methods, the top of the stack in the end of the
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// vector.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// The node the iterator will visit next is at the top of the stack,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// with those ancestors still unvisited below it. If the stack is empty,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// the iteration is over.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">unvisited&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TreeNode&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TreeIter&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">push_left_edge&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tree&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span> &lt;span class="nc">BinaryTree&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">NonEmpty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">ref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">tree&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">unvisited&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tree&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BinaryTree&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">iter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">TreeIter&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TreeIter&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">unvisited&lt;/span>: &lt;span class="nb">Vec&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push_left_edge&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">IntoIterator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BinaryTree&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Item&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">IntoIter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TreeIter&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">into_iter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Self&lt;/span>::&lt;span class="n">IntoIter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TreeIter&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Item&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">next&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Find the node this iteration must produce,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// or finish the iteration. (Use the `?` operator
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// to return immediately if it&amp;#39;s `None`.)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">unvisited&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// After `node`, the next thing we produce must be the leftmost
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// child in `node`&amp;#39;s right subtree, so push the path from here
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// down. Our helper method turns out to be just what we need.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push_left_edge&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Produce a reference to this node&amp;#39;s value.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">element&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Build a small tree.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tree&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BinaryTree&lt;/span>::&lt;span class="n">Empty&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tree&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;jaeger&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tree&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;robot&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tree&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;droid&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tree&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;mecha&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Iterate over it.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Vec&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">kind&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">tree&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">kind&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;droid&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;jaeger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;mecha&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;robot&amp;#34;&lt;/span>&lt;span class="p">]);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tree&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">iter&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;mega-&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">collect&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;mega-droid&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;mega-jaeger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;mega-mecha&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;mega-robot&amp;#34;&lt;/span>&lt;span class="p">]);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220721130532202.png"
loading="lazy"
alt="image-20220721130532202"
>&lt;/p>
&lt;h2 id="chapter-19-concurrency">Chapter 19. Concurrency
&lt;/h2>&lt;p>æƒ¯ç”¨çš„å¤šçº¿ç¨‹ä»£ç å†™æ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸€ä¸ª&lt;strong>åå°çº¿ç¨‹&lt;/strong>åªè´Ÿè´£ä¸€ä»¶äº‹ï¼Œè€Œä¸”å‘¨æœŸæ€§â€œé†’æ¥â€å»åšè¿™ä»¶äº‹ã€‚&lt;/li>
&lt;li>é€šç”¨&lt;strong>çº¿ç¨‹æ± &lt;/strong>é€šè¿‡&lt;strong>ä»»åŠ¡é˜Ÿåˆ—&lt;/strong>ä¸å®¢æˆ·ç«¯é€šä¿¡ã€‚&lt;/li>
&lt;li>&lt;strong>ç®¡é“&lt;/strong>å°†æ•°æ®ä»ä¸€ä¸ªçº¿ç¨‹å¯¼å…¥åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åªåšä¸€å°éƒ¨åˆ†å·¥ä½œã€‚&lt;/li>
&lt;li>&lt;strong>æ•°æ®å¹¶è¡Œ&lt;/strong>å‡è®¾ï¼ˆä¸ç®¡æ­£ç¡®ä¸å¦ï¼‰æ•´ä¸ªè®¡ç®—æœºä¸»è¦ç”¨äºä¸€é¡¹å¤§å‹è®¡ç®—ï¼Œè¿™ä¸ªå¤§å‹è®¡ç®—è¿›è€Œåˆæ‹†åˆ†æˆnä¸ªå°ä»»åŠ¡ï¼Œåœ¨nä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œå¸Œæœ›æ‰€æœ‰nä¸ªæœºå™¨çš„æ ¸å¿ƒåŒæ—¶å·¥ä½œã€‚&lt;/li>
&lt;li>&lt;strong>åŒæ­¥å¯¹è±¡æµ·&lt;/strong>ä¸­å¤šä¸ªçº¿ç¨‹æ‹¥æœ‰åŒä¸€ä¸ªæ•°æ®æƒé™ï¼Œä½¿ç”¨åŸºäºäº’æ–¥é‡ç­‰ä½çº§åŸè¯­çš„ä¸´æ—¶é”æ–¹æ¡ˆé¿å…äº‰ç”¨ã€‚&lt;/li>
&lt;li>&lt;strong>åŸå­æ•´æ•°æ“ä½œ&lt;/strong>å…è®¸å¤šæ ¸å¿ƒé€šè¿‡ä¸€ä¸ªæœºå™¨å­—å¤§å°çš„å­—æ®µä¼ é€’ä¿¡æ¯è€Œå®ç°é€šä¿¡ã€‚ï¼ˆé™¤éè¦äº¤æ¢çš„æ•°æ®å°±æ˜¯æ•´æ•°å€¼ï¼Œå¦åˆ™è¿™ç§æ–¹æ³•æ¯”å…¶ä»–æ‰‹æ®µæ›´éš¾ä»¥ä¿è¯æ­£ç¡®ã€‚è¿™é€šå¸¸æ„å‘³ç€ä¼ é€’æŒ‡é’ˆã€‚ï¼‰&lt;/li>
&lt;/ul>
&lt;h3 id="fork-join-parallelism">Fork-Join Parallelism
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220806202715909.png"
loading="lazy"
alt="image-20220806202715909"
>&lt;/p>
&lt;p>Fork-join parallelism æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>éå¸¸ç®€å•ã€‚&lt;/li>
&lt;li>é¿å…ç“¶é¢ˆã€‚&lt;/li>
&lt;li>æ€§èƒ½è®¡ç®—ç›´è§‚ã€‚&lt;/li>
&lt;li>å®¹æ˜“æ¨æ–­ç¨‹åºæ˜¯å¦æ­£ç¡®ã€‚&lt;/li>
&lt;/ul>
&lt;p>Fork-join çš„ä¸»è¦ç¼ºç‚¹æ˜¯è¦æ±‚å·¥ä½œå•å…ƒéš”ç¦»ã€‚&lt;/p>
&lt;h4 id="spawn-and-join">spawn and join
&lt;/h4>&lt;p>&lt;code>std::thread::spawn&lt;/code> åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">thread&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">thread&lt;/span>::&lt;span class="n">spawn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;hello from a child thread&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å®ƒæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œä¸€ä¸ª FnOnce é—­åŒ…æˆ–è€…å‡½æ•°ã€‚&lt;/p>
&lt;p>ç”¨ &lt;code>spawn&lt;/code> æ¥å®ç°å‰é¢çš„ &lt;code>process_file&lt;/code> å‡½æ•°çš„å¹¶è¡Œç‰ˆï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="p">{&lt;/span>&lt;span class="n">thread&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">process_file_in_parallel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">filename&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">io&lt;/span>::&lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Divide the work into several chunks.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">NTHREADS&lt;/span>: &lt;span class="kt">usize&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">worklists&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">split_vec_into_chunks&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">filename&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">NTHREADS&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Fork: Spawn a thread to handle each chunck.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">thread_handles&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">worklist&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">worklists&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">thread_handles&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// worklist move è¿›é—­åŒ…ä¸­ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// spawn move é—­åŒ…åˆ°å­çº¿ç¨‹ä¸­ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬ worklist vecã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">thread&lt;/span>::&lt;span class="n">spawn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">move&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">process_files&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">worklist&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Join: Wait for all threads to finish.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ¯ä¸€ä¸ª handle æ˜¯ä¸€ä¸ª JoinHandleã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handle&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">thread_handles&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">handle&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">unwrap&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¾ªç¯ç»“æŸï¼Œ8ä¸ªå­çº¿ç¨‹éƒ½å·²ç»æˆåŠŸå®Œæˆã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(())&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>spawn&lt;/code> å‡½æ•°å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">spawn&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">f&lt;/span>: &lt;span class="nc">F&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">JoinHandle&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">FnOnce&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">T&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">F&lt;/span>: &lt;span class="nb">Send&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nb">Send&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å› æ­¤ &lt;code>thread::spawn(move || process_files(worklist))&lt;/code> ä¼šè¿”å› &lt;code>JoinHandle&lt;/code> ï¼Œå¹¶å°†å®ƒä»¬æ”¾è¿›ä¸€ä¸ª vector ä¸­ã€‚&lt;/p>
&lt;h4 id="error-handling-across-threads">Error Handling Across Threads
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="n">handle&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">unwrap&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¸ª&lt;code>.join()&lt;/code>æ–¹æ³•åšäº†ä¸¤ä»¶äº‹æƒ…ã€‚&lt;/p>
&lt;p>é¦–å…ˆï¼Œ&lt;code>handle.join()&lt;/code>è¿”å›ä¸€ä¸ª &lt;code>std::thread::Result&lt;/code>ã€‚&lt;/p>
&lt;p>å…¶æ¬¡ï¼Œ&lt;code>handle.join()&lt;/code> æŠŠå­çº¿ç¨‹è¿”å›çš„å€¼ä¼ ç»™äº†çˆ¶çº¿ç¨‹ã€‚&lt;code>handle.join()&lt;/code> è¿”å›çš„å®Œæ•´ç±»å‹æ˜¯&lt;code>std::thread::Result&amp;lt;std::io::Result&amp;lt;()&amp;gt;&amp;gt;&lt;/code>ã€‚å…¶ä¸­&lt;code>thread::Result&lt;/code> æ˜¯ &lt;code>spawn/join&lt;/code> APIçš„ä¸€éƒ¨åˆ†ï¼Œè€Œ &lt;code>io::Result&lt;/code> æ˜¯æˆ‘ä»¬åº”ç”¨çš„ç›¸å…³ç±»å‹ã€‚&lt;/p>
&lt;p>åœ¨Rustä¸­ï¼Œé”™è¯¯æ˜¯ä¸€ç§ Result å€¼ï¼ˆæ•°æ®ï¼‰è€Œä¸æ˜¯å¼‚å¸¸ï¼ˆæ§åˆ¶æµï¼‰ã€‚å¯ä»¥åƒä»»ä½•å€¼ä¸€æ ·è·¨çº¿ç¨‹ä¼ é€å®ƒä»¬ã€‚&lt;/p>
&lt;h4 id="sharing-immutable-data-across-threads">Sharing Immutable Data Across Threads
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// before
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">process_files&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">filename&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// after
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">process_files&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">filename&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">glossary&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">GigabyteMap&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚æœåƒä¹‹å‰é‚£æ ·ä¼ è¿›çº¿ç¨‹ä¼šæŠ¥é”™ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">process_file_in_parallel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">filename&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">glossary&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">GigabyteMap&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">io&lt;/span>::&lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">worklist&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">worklists&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">thread_handles&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">thread&lt;/span>::&lt;span class="n">spawn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">move&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">process_files&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">worklist&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">glossary&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// error
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¼šæŠ±æ€¨ &lt;code>spawn&lt;/code> ä¸­é—­åŒ…çš„ç”Ÿå‘½å‘¨æœŸä¸æ˜¯ &lt;code>'static&lt;/code>ã€‚&lt;code>spawn&lt;/code> ä¼šå¯åŠ¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ã€‚Rustæ— æ³•çŸ¥é“ä¸€ä¸ªå­çº¿ç¨‹ä¼šå…è®¸å¤šé•¿æ—¶é—´ï¼Œå› æ­¤å®ƒå‡è®¾ä¸€ç§æœ€åçš„æƒ…å†µï¼Œå³å­çº¿ç¨‹å¯èƒ½ä¼šåœ¨çˆ¶çº¿ç¨‹å·²ç»å®Œæˆä¸”çˆ¶çº¿ç¨‹ä¸­æ‰€æœ‰çš„å€¼éƒ½æ¶ˆå¤±ä¹‹åç»§ç»­è¿è¡Œã€‚&lt;/p>
&lt;p>å¯ä»¥ä½¿ç”¨ &lt;code>Arc&lt;/code> æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">sync&lt;/span>::&lt;span class="n">Arc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">process_file_in_parallel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">filename&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">glossary&lt;/span>: &lt;span class="nc">Arc&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">GigabyteMap&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">io&lt;/span>::&lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">worklist&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">worklists&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// This call to .clone() only clones the Arc and bumps the
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// reference count. It does not clone the GigabyteMap.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">glossary_for_child&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">glossary&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">clone&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">thread_handles&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">thread&lt;/span>::&lt;span class="n">spawn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">move&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">process_files&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">worklist&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">glossary_for_child&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è°ƒç”¨&lt;code>glossary.clone()&lt;/code>åï¼Œä¼šåˆ›å»º&lt;code>Arc&lt;/code>æ™ºèƒ½æŒ‡é’ˆè€Œä¸æ˜¯æ•´ä¸ª &lt;code>GigabyteMap&lt;/code> çš„ä¸€ä¸ªå‰¯æœ¬ã€‚è¿™ç›¸å½“äºå¢åŠ ä¸€æ¬¡å¼•ç”¨è®¡æ•°ã€‚&lt;/p>
&lt;p>è¿™æ ·ä¿®æ”¹ä¹‹åï¼Œç¨‹åºå°±å¯ä»¥ç¼–è¯‘é€šè¿‡å¹¶è¿è¡Œäº†ã€‚å› ä¸ºå®ƒä¸å†ä¾èµ–å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸã€‚åªè¦æœ‰ä»»ä½•çº¿ç¨‹æ‹¥æœ‰ &lt;code>Arc&amp;lt;GigabyteMap&amp;gt;&lt;/code> ï¼Œæ˜ å°„å°±ä¸ä¼šé‡Šæ”¾ï¼Œå³ä½¿çˆ¶çº¿ç¨‹æ—©å°±é€€å‡ºäº†ã€‚å› ä¸º &lt;code>Arc&lt;/code> ä¸­çš„æ•°æ®æ˜¯ä¸å¯ä¿®æ”¹çš„ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šå‡ºç°ä»»ä½•æ•°æ®äº‰ç”¨ã€‚&lt;/p>
&lt;h4 id="rayon">Rayon
&lt;/h4>&lt;p>Rayon åº“ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rayon&lt;/span>::&lt;span class="n">prelude&lt;/span>::&lt;span class="o">*&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// &amp;#34;do 2 things in parallel&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rayon&lt;/span>::&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fn1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fn2&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// &amp;#34;do N things in parallel&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">giant_vector&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">par_iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">for_each&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">do_thing_with_value&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>rayon::join(fn1, fn2)&lt;/code> å°±æ˜¯è°ƒç”¨ä¸¤ä¸ªå‡½æ•°å¹¶è¿”å›ä¸¤ä¸ªç»“æœã€‚è€Œ&lt;code>.par_iter()&lt;/code> æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ª &lt;code>ParallelIterator&lt;/code> ï¼Œè¿™ä¸ªå€¼æœ‰ mapã€filterå’Œå…¶ä»–æ–¹æ³•ï¼Œéå¸¸ç±»ä¼¼äºRustçš„Iteratorã€‚&lt;/p>
&lt;p>ä¸‹å›¾å±•ç¤ºäº†ä¸¤ç§ç†è§£ &lt;code>giant_vector.par_iter().for_each(...)&lt;/code> è°ƒç”¨çš„æ–¹å¼ã€‚(a) è¡¨é¢ä¸Šçœ‹ï¼ŒRayonä¼šä¸ºå‘é‡ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ã€‚(b)åœ¨åå°ï¼ŒRayonä¼šè®©æ¯ä¸ªå·¥ä½œçº¿ç¨‹å¯¹åº”ä¸€ä¸ªCPUæ ¸å¿ƒï¼Œè¿™æ ·æ•ˆç‡æ›´é«˜ã€‚è¿™ä¸ªå·¥ä½œçº¿ç¨‹æ± ç”±ç¨‹åºçš„æ‰€æœ‰çº¿ç¨‹å…±äº«ã€‚åœ¨åŒæ—¶æ•°åƒä¸ªä»»åŠ¡æ—¶ï¼ŒRayonä¼šè‡ªåŠ¨æ‹†åˆ†å·¥ä½œã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220807082831278.png"
loading="lazy"
alt="image-20220807082831278"
>&lt;/p>
&lt;p>ç”¨Rayonå†™&lt;code>process_files_in_parallel&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rayon&lt;/span>::&lt;span class="n">prelude&lt;/span>::&lt;span class="o">*&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">process_files_in_parallel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">filenames&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">glossary&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">GiabyteMap&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">io&lt;/span>::&lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">filenames&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">par_iter&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">filename&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">process_file&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">filename&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">glossary&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">reduce_with&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">r1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">r2&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">r1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">is_err&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">r1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">r2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">unwrap_or&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(()))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>First, we use filenames.par_iter() to create a parallel iterator.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>.map()&lt;/code> å¯¹æ¯ä¸ªæ–‡ä»¶åè°ƒç”¨ &lt;code>process_file&lt;/code>ã€‚è¿™æ ·ä¼šå¾—åˆ° &lt;code>io::Result&amp;lt;()&amp;gt;&lt;/code>å€¼çš„ä¸€ä¸ª ParallelIteratorã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç„¶åç”¨ .reduce_with() ç»„åˆç»“æœã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¿ç•™ç¬¬ä¸€ä¸ªé”™è¯¯ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œç„¶åä¸¢å¼ƒå…¶ä»–é”™è¯¯ã€‚&lt;/p>
&lt;p>The .reduce_with() method is also handy when you pass a .map() closure that returns a useful value on success. Then you can pass .reduce_with() a closure that knows how to combine two success results.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>reduce_with returns an Option that is None only if filenames was empty. We use the Optionâ€™s .unwrap_or() method to make the result Ok(()) in that case.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="channels">Channels
&lt;/h3>&lt;p>A &lt;em>channel&lt;/em> is a one-way conduit for sending values from one thread to another. In other words, itâ€™s a thread-safe queue.&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220807090828202.png"
loading="lazy"
alt="image-20220807090828202"
>&lt;/p>
&lt;p>å›¾ç‰‡ä¸­åº”è¯¥æœ‰è¯¯ï¼Œä¸‹é¢ä¸€ä¸ªçº¿ç¨‹åº”è¯¥æ˜¯ thread 2ã€‚&lt;/p>
&lt;p>Rust channels are faster than Unix pipes. Sending a value moves it rather than copying it, and moves are fast even when youâ€™re moving data structures that contain many megabytes of data.&lt;/p>
&lt;h4 id="sending-values">Sending Values
&lt;/h4>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220807092647679.png"
loading="lazy"
alt="image-20220807092647679"
>&lt;/p>
&lt;p>The code to start our file-reading thread looks like this:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="p">{&lt;/span>&lt;span class="n">fs&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">thread&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">sync&lt;/span>::&lt;span class="n">mpsc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sender&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">receiver&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mpsc&lt;/span>::&lt;span class="n">channel&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handle&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">thread&lt;/span>::&lt;span class="n">spawn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">move&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">filename&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">documents&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fs&lt;/span>::&lt;span class="n">read_to_string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">filename&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°† text å€¼ move è¿› channelï¼Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// æœ€ç»ˆï¼Œå®ƒä¼šå†æ¬¡ move åˆ°æ¥æ”¶åˆ°è¿™ä¸ªå€¼çš„åœ°æ–¹ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sender&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">send&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">is_err&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(())&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Whether text contains 10 lines of text or 10 megabytes, this operation copies three machine words (the size of a String struct), and t&lt;strong>he corresponding receiver.recv() call will also copy three machine words&lt;/strong>.&lt;/p>
&lt;p>&lt;strong>The send and recv methods both return Results, but these methods fail only if the other end of the channel has been dropped.&lt;/strong>&lt;/p>
&lt;p>In our code, sender.send(text) will fail only if the receiverâ€™s thread has exited early. This is typical for code that uses channels. Whether that happened deliberately or due to an error, itâ€™s OK for our reader thread to quietly shut itself down.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">start_file_reader_thread&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">documents&lt;/span>: &lt;span class="nb">Vec&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">PathBuf&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="p">(&lt;/span>&lt;span class="n">mpsc&lt;/span>::&lt;span class="n">Receiver&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">thread&lt;/span>::&lt;span class="n">JoinHandle&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">io&lt;/span>::&lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sender&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">receiver&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mpsc&lt;/span>::&lt;span class="n">channel&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handle&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">thread&lt;/span>::&lt;span class="n">spawn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">move&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">receiver&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handle&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="receiving-values">Receiving Values
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">receiver&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">recv&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">do_something_with&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç­‰ä»·äº&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">receiver&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">do_something_with&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The loop will exit normally when the channel is empty and the Sender has been dropped.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">start_file_indexing_thread&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">texts&lt;/span>: &lt;span class="nc">mpsc&lt;/span>::&lt;span class="n">Receiver&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="p">(&lt;/span>&lt;span class="n">mpsc&lt;/span>::&lt;span class="n">Receiver&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">InMemoryIndex&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">thread&lt;/span>::&lt;span class="n">JoinHandle&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sender&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">receiver&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mpsc&lt;/span>::&lt;span class="n">channel&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handle&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">thread&lt;/span>::&lt;span class="n">spawn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">move&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">doc_id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">texts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">into_iter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">enumerate&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">InMemoryIndex&lt;/span>::&lt;span class="n">from_single_document&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">doc_id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sender&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">send&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">is_err&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">receiver&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handle&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="running-the-pipeline">Running the Pipeline
&lt;/h4>&lt;p>Stage3:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">start_in_memory_merge_thread&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file_indexs&lt;/span>: &lt;span class="nc">mpsc&lt;/span>::&lt;span class="n">Receiver&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">InMemoryIndex&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="p">(&lt;/span>&lt;span class="n">mpsc&lt;/span>::&lt;span class="n">Receiver&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">InMemoryIndex&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">thread&lt;/span>::&lt;span class="n">JoinHandle&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Stage 4:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">start_index_writer_thread&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">big_indexs&lt;/span>: &lt;span class="nc">mpsc&lt;/span>::&lt;span class="n">Receiver&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">InMemoryIndex&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">output_dir&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Path&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="p">(&lt;/span>&lt;span class="n">mpsc&lt;/span>::&lt;span class="n">Receiver&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">PathBuf&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">thread&lt;/span>::&lt;span class="n">JoinHandle&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">io&lt;/span>::&lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Stage 5:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fn&lt;/span> &lt;span class="nf">merge_index_files&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">files&lt;/span>: &lt;span class="nc">mpsc&lt;/span>::&lt;span class="n">Receiver&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">PathBuf&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">output_dir&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Path&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">io&lt;/span>::&lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æœ€ç»ˆè¿è¡Œä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">fn run_pipeline(documents: Vec&amp;lt;PathBuf&amp;gt;, output_dir: PathBuf)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -&amp;gt; io::Result&amp;lt;()&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // Launch all five stages of the pipeline.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let (texts, h1) = start_file_reader_thread(documents);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let (pints, h2) = start_file_indexing_thread(texts);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let (gallons, h3) = start_in_memory_merge_thread(pints);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let (files, h4) = start_index_writer_thread(gallons, &amp;amp;output_dir);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let result = merge_index_files(files, &amp;amp;output_dir);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // Wait for threads to finish, holding on to any errors that they encounter.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let r1 = h1.join().unwrap();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> h2.join().unwrap();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> h3.join().unwrap();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let r4 = h4.join().unwrap();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // Return the first error encountered, if any.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // (As it happens, h2 and h3 can&amp;#39;t fail: those threads
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // are pure in-memory data processing.)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r1?;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r4?;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> result
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="channel-features-and-performance">Channel Features and Performance
&lt;/h4>&lt;p>&lt;code>std::sync::mpsc&lt;/code> å°±æ˜¯ &amp;ldquo;multiproducer, single-consumer&amp;rdquo;ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220807101845246.png"
loading="lazy"
alt="image-20220807101845246"
>&lt;/p>
&lt;p>&lt;code>Sender&amp;lt;T&amp;gt;&lt;/code> implements the Clone trait. To get a channel with multiple senders, simply create a regular channel and clone the sender as many times as you like. You can move each Sender value to a different thread.&lt;/p>
&lt;p>A &lt;code>Receiver&amp;lt;T&amp;gt;&lt;/code> canâ€™t be cloned, so if you need to have multiple threads receiving values from the same channel, you need a &lt;code>Mutex&lt;/code>.&lt;/p>
&lt;p>Rusté€šé“æ˜¯ç»è¿‡è®¤çœŸä¼˜åŒ–çš„ã€‚åœ¨åˆšåˆ›å»ºé€šé“æ—¶ï¼ŒRustä½¿ç”¨â€œä¸€æ¬¡æ€§â€é˜Ÿåˆ—å®ç°ã€‚å¦‚æœåªæ˜¯ç”¨è¿™ä¸ªé€šé“å‘é€ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£å¯ä»¥ä¿è¯å¼€é”€æœ€å°ã€‚å¦‚æœå†å‘é€ç¬¬äºŒä¸ªå€¼ï¼ŒRuståˆ™ä¼šåˆ‡æ¢åˆ°ä¸€ä¸ªä¸åŒçš„é˜Ÿåˆ—å®ç°ã€‚è¿™ä¸ªå®ç°ä¼šä»é•¿è¿œè€ƒè™‘ï¼Œå‡†å¤‡è®©é€šé“ä¼ è¾“å¾ˆå¤šå€¼ï¼ŒåŒæ—¶åˆä¿æŒåˆ†é…å¼€é”€æœ€å°åŒ–ã€‚å¦‚æœä½ é€‰æ‹©å…‹éš† Sender ï¼ŒRuståˆ™å¿…é¡»å›é€€åˆ°å¦å¤–ä¸€ä¸ªå®ç°ï¼Œè¯¥å®ç°å¯ä»¥ä¿è¯å¤šä¸ªçº¿ç¨‹åŒæ—¶å‘é€å€¼æ—¶çš„å®‰å…¨ã€‚ä¸è¿‡å³ä½¿æ˜¯è¿™3ä¸ªå®ç°ä¸­æœ€æ…¢çš„å®ç°ä¹Ÿæ˜¯æ²¡æœ‰é”çš„é˜Ÿåˆ—ï¼Œå› æ­¤å‘é€å’Œæ¥æ”¶å€¼æœ€å¤šåªæ˜¯å‡ ä¸ªåŸå­æ“ä½œï¼Œæ¶‰åŠä¸€æ¬¡å †å†…å­˜åˆ†é…ï¼Œå¤–åŠ è½¬ç§»è‡ªèº«ã€‚åªæœ‰åœ¨é˜Ÿåˆ—ä¸ºç©ºä¸”æ¥æ”¶çº¿ç¨‹éœ€è¦ä¼‘çœ æ—¶æ‰éœ€è¦ç³»ç»Ÿè°ƒç”¨ã€‚å½“ç„¶ï¼Œæ­¤æ—¶ç»è¿‡é€šé“çš„æµé‡æ— è®ºå¦‚ä½•ä¹Ÿä¸æ˜¯æœ€å¤§çš„ã€‚&lt;/p>
&lt;p>å‘é€è‡³çš„é€Ÿåº¦è¶…è¿‡æ¥æ”¶å’Œå¤„ç†å€¼çš„é€Ÿåº¦ã€‚è¿™ä¼šå¯¼è‡´é€šé“å†…éƒ¨çš„å€¼è¶Šç§¯è¶Šå¤šã€‚Rustå€Ÿç”¨Unixç®¡é“ã€‚Unixä½¿ç”¨ &lt;em>backpressure&lt;/em> ï¼Œä»è€Œå¼ºè¿«å¿«é€Ÿå‘é€ç«¯æ”¾æ…¢é€Ÿåº¦ã€‚Unixç³»ç»Ÿçš„æ¯ä¸ªç®¡é“éƒ½æœ‰å›ºå®šå¤§å°ï¼Œå¦‚æœä¸€ä¸ªè¿›ç¨‹å°è¯•å‘éšæ—¶å¯èƒ½æ»¡çš„ç®¡é“å†™å…¥æ•°æ®ï¼Œç³»ç»Ÿå°±ä¼šç›´æ¥é˜»å¡è¯¥è¿›ç¨‹ï¼Œç›´è‡³ç®¡é“ä¸­æœ‰äº†ç©ºé—´ã€‚Rustä¸­çš„ç­‰ä»·æœºåˆ¶åŠ  &lt;em>synchronous channel&lt;/em>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">sync&lt;/span>::&lt;span class="n">mpsc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sender&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">receiver&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mpsc&lt;/span>::&lt;span class="n">sync_channel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åŒæ­¥é€šé“å°±åƒå¸¸è§„é€šé“ä¸€æ ·ï¼Œåªæ˜¯åœ¨åˆ›å»ºæ—¶éœ€è¦æŒ‡å®šå®ƒå¯ä»¥ä¿å­˜å¤šå°‘å€¼ã€‚å¯¹äºåŒæ­¥é€šé“è€Œè¨€ï¼Œ&lt;code>sender.send(value)&lt;/code> æ˜¯ä¸€ä¸ªæ½œåœ¨çš„é˜»å¡æ“ä½œã€‚&lt;/p>
&lt;h4 id="thread-safety-send-and-sync">Thread Safety: Send and Sync
&lt;/h4>&lt;p>This is mostly true, but Rustâ€™s full thread safety story hinges on two built-in traits, &lt;code>std::marker::Send&lt;/code> and &lt;code>std::marker::Sync&lt;/code>.&lt;/p>
&lt;ul>
&lt;li>Types that implement &lt;code>Send&lt;/code> are safe to pass by value to another thread. &lt;strong>They can be moved across threads&lt;/strong>.&lt;/li>
&lt;li>Types that implement &lt;code>Sync&lt;/code> are safe to pass by &lt;strong>non-mut reference to another thread&lt;/strong>. They can be shared across threads.&lt;/li>
&lt;/ul>
&lt;p>By &lt;em>safe&lt;/em> here, we mean the same thing we always mean: free from data races and other undefined behavior.&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220807104741772.png"
loading="lazy"
alt="image-20220807104741772"
>&lt;/p>
&lt;p>The few types that are neither Send nor Sync are mostly those that use mutability in a way that isnâ€™t thread-safe. For example, consider &lt;code>std::rc::Rc&amp;lt;T&amp;gt;&lt;/code>, the type of reference-counting smart pointers.&lt;/p>
&lt;h4 id="piping-almost-any-iterator-to-a-channel">Piping Almost Any Iterator to a Channel
&lt;/h4>&lt;p>ç»Ÿä¸€è¿­ä»£å™¨ç®¡é“å’Œçº¿ç¨‹ç®¡é“ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="n">documents&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">into_iter&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">read_whole_file&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">errors_to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">error_sender&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// filter out error results
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">off_thread&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// spawn a thread for the above work
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">make_single_file_index&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">off_thread&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// spawn another thread for stage 2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯ä»¥å®šä¹‰ä¸€ä¸ª traitã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">sync&lt;/span>::&lt;span class="n">mpsc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">OffThreadExt&lt;/span>: &lt;span class="nb">Iterator&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Transform this iterator into an off-thread iterator: the
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// `next()` calls happen to a separate worker thread, so the
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// iterator and the body of your loop run concurrently.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">off_thread&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">mpsc&lt;/span>::&lt;span class="n">IntoIter&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç„¶åä¸ºè¿™ä¸ªè¿­ä»£å™¨å®ç°è¿™ä¸ª traitã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">thread&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">OffThreadExt&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nb">Iterator&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Send&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>::&lt;span class="n">Item&lt;/span>: &lt;span class="nb">Send&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">off_thread&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">mpsc&lt;/span>::&lt;span class="n">IntoIter&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Item&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Create a channel to transfer items from the worker thread.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sender&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">receiver&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mpsc&lt;/span>::&lt;span class="n">sync_channel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1024&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Move this iterator to a new worker thread and run it there.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">thread&lt;/span>::&lt;span class="n">spawn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">move&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sender&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">send&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">is_err&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Return an iterator that pulls values from the channel.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">receiver&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">into_iter&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="beyond-pipelines">Beyond Pipelines
&lt;/h4>&lt;p>é€šé“ä¸ä»…åœ¨ç®¡é“ä¸­æœ‰ç”¨ï¼Œå®ƒä»¬ä¹Ÿæ˜¯åœ¨ç›¸åŒè¿›ç¨‹ä¸­ä¸ºå…¶ä»–çº¿ç¨‹æä¾›å¼‚æ­¥æœåŠ¡çš„å¿«é€Ÿè€Œç®€å•çš„æ–¹å¼ã€‚&lt;/p>
&lt;p>é€šé“ä¹Ÿé€‚ç”¨äºä¸€ä¸ªçº¿ç¨‹å‘å¦ä¸€ä¸ªçº¿ç¨‹å‘é€è¯·æ±‚å¹¶æœŸå¾…å¾—åˆ°æŸç§å“åº”çš„æƒ…å½¢ã€‚&lt;/p>
&lt;h3 id="shared-mutable-state">Shared Mutable State
&lt;/h3>&lt;h4 id="what-is-a-mutex">What Is a Mutex?
&lt;/h4>&lt;p>&lt;strong>äº’æ–¥é‡&lt;/strong>ï¼ˆæˆ–è€…å«é”ï¼‰ç”¨äºå¼ºåˆ¶å¤šçº¿ç¨‹ä¾æ¬¡è®¿é—®ç‰¹å®šçš„æ•°æ®ã€‚&lt;/p>
&lt;p>äº’æ–¥é‡ä¿æŠ¤æ•°æ®ã€‚äº’æ–¥é‡çš„ä½œç”¨ä½“ç°åœ¨ä»¥ä¸‹å‡ æ–¹é¢ã€‚&lt;/p>
&lt;ul>
&lt;li>é˜²æ­¢ data racesï¼Œå³é¿å…å¤šä¸ªçº¿ç¨‹å¹¶å‘è¯»å†™åŒä¸€å—å†…å­˜ã€‚&lt;/li>
&lt;li>å³ä½¿æ²¡æœ‰æ•°æ®äº‰ç”¨ï¼Œå³ä½¿æ‰€æœ‰è¯»å†™åœ¨ç¨‹åºä¸­éƒ½æ˜¯é¡ºåºæ‰§è¡Œï¼Œå¦‚æœæ²¡æœ‰äº’æ–¥é‡ï¼Œä¸åŒçº¿ç¨‹çš„æ“ä½œä¹Ÿå¯èƒ½ä»¥ä»»æ„æ–¹å¼ç›¸äº’äº¤é”™ã€‚&lt;/li>
&lt;li>äº’æ–¥é‡æ”¯æŒé€šè¿‡ invariant ç¼–ç¨‹ï¼Œå³å—ä¿æŠ¤æ•°æ®ç”±ä½ è´Ÿè´£åˆå§‹åŒ–ä½†æ¯ä¸ªä¸´ç•ŒåŒºæ¥ç»´æŠ¤çš„è§„åˆ™ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="mutext">&lt;code>Mutex&amp;lt;T&amp;gt;&lt;/code>
&lt;/h4>&lt;p>å› ä¸ºç­‰å¾…åˆ—è¡¨æ—¢æ˜¯å…±äº«çš„ä¹Ÿæ˜¯å¯ä¿®æ”¹çš„ï¼Œæ‰€ä»¥å¿…é¡»ç”±ä¸€ä¸ª &lt;code>Mutex&lt;/code> æ¥æä¾›ä¿æŠ¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">sync&lt;/span>::&lt;span class="n">Mutex&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="sd">/// All threads have shared access to this big contex struct.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">FernEmpireApp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">waiting_list&lt;/span>: &lt;span class="nc">Mutex&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">WaitingList&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åˆ›å»º &lt;code>Mutex&lt;/code> ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">sync&lt;/span>::&lt;span class="n">Arc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Arc&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">FernEmpireApp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">waiting_list&lt;/span>: &lt;span class="nc">Mutex&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="fm">vec!&lt;/span>&lt;span class="p">[]),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åˆ›å»ºä¸€ä¸ªæ–°çš„ &lt;code>Mutex&lt;/code> å°±åƒåˆ›å»ºä¸€ä¸ªæ–° &lt;code>Box&lt;/code> æˆ– &lt;code>Arc&lt;/code>ï¼Œä½† &lt;code>Box&lt;/code> å’Œ &lt;code>Arc&lt;/code> éƒ½æ„å‘³ç€å †åˆ†é…ï¼Œè€Œ &lt;code>Mutex&lt;/code> å°±æ˜¯å•çº¯çš„ä¸€ç§é”ã€‚å¦‚æœæƒ³æŠŠ &lt;code>Mutex&lt;/code> åˆ†é…åœ¨å †ä¸Šï¼Œåˆ™å¿…é¡»æ˜ç¡®åœ°è¡¨ç¤ºå‡ºæ¥ï¼Œå°±åƒè¿™é‡Œä½¿ç”¨ &lt;code>Arc::new&lt;/code> åˆ›å»ºæ•´ä¸ªåº”ç”¨ï¼Œè€Œä½¿ç”¨ &lt;code>Mutex::new&lt;/code> åªæ˜¯ä¸ºäº†ä¿æŠ¤æ•°æ®ä¸€æ ·ã€‚è¿™ä¸¤ä¸ªç±»å‹ç»å¸¸ä¸€å—ä½¿ç”¨ï¼Œ &lt;code>Arc&lt;/code> æ–¹ä¾¿è·¨çº¿ç¨‹å…±äº«æ•°æ®ï¼Œè€Œ &lt;code>Mutex&lt;/code> æ–¹ä¾¿è·¨çº¿ç¨‹å…±äº«å¯ä¿®æ”¹æ•°æ®ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ &lt;code>Mutex&lt;/code> ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">FernEmpireApp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Add a player to the waiting list for the next game.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Start a new game immediately if enough players are waiting.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">join_waiting_list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">player&lt;/span>: &lt;span class="nc">PlayerId&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Lock the mutex and gain access to the data inside.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// The scope of `guard` is a critical section.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">guard&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">waiting_list&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">unwrap&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Now do the game logic.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">guard&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">player&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">guard&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">GAME_SIZE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">players&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">guard&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">split_off&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">start_game&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">players&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å–å¾—æ•°æ®çš„å”¯ä¸€æ–¹æ³•æ˜¯è°ƒç”¨ &lt;code>.lock()&lt;/code> æ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">guard&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">waiting_list&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">unwrap&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>self.waiting_list.lock()&lt;/code> ä¼šä¸€ç›´é˜»å¡åˆ°å¯ä»¥å†æ¬¡è·å¾—äº’æ–¥é‡ã€‚è¿™ä¸ªæ–¹æ³•è°ƒç”¨è¿”å›çš„ &lt;code>MutexGuard&amp;lt;WaitingList&amp;gt;&lt;/code> å€¼æ˜¯å¯¹ &lt;code>&amp;amp;mut WaitingList&lt;/code> çš„ä¸€ä¸ªç®€å•å°è£…ã€‚å€ŸåŠ© Deref ç±»å‹è½¬æ¢ï¼Œå¯ä»¥ç›´æ¥åœ¨è¿™ä¸ª guard ä¸Šè°ƒç”¨ WaitingList æ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="n">guard&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">player&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¸ª guard ç”šè‡³è¿˜å…è®¸æˆ‘ä»¬ç›´æ¥å¼•ç”¨åº•å±‚æ•°æ®ã€‚Rustçš„ç”Ÿå‘½å‘¨æœŸç³»ç»Ÿä¿è¯è¿™äº›å¼•ç”¨çš„å¯¿å‘½æ¯”ä¸ä¼šè¶…å‡º guard è‡ªèº«ã€‚å¦‚æœæ²¡æœ‰æ‹¿åˆ°é”ï¼Œåˆ™ä¸å¯èƒ½åœ¨ Mutex ä¸­è®¿é—®æ•°æ®ã€‚&lt;/p>
&lt;p>åœ¨ guard è¢«æ¸…é™¤åï¼Œé”ä¹Ÿä¼šè¢«é‡Šæ”¾ã€‚é€šå¸¸è¿™ä¼šåœ¨é˜»å¡ç»“æŸæ—¶å‘ç”Ÿï¼Œä½†ä¹Ÿå¯ä»¥æ‰‹å·¥æ¸…é™¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">guard&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">GAME_SIZE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">players&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">guard&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">split_off&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">drop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">guard&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// don&amp;#39;t keep the list locked while starting a game
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">start_game&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">players&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="mut-and-mutex">mut and Mutex
&lt;/h4>&lt;p>åœ¨Rustä¸­ï¼Œ&lt;code>&amp;amp;mut&lt;/code> æ„å‘³ç€ &lt;em>exclusive access&lt;/em>ã€‚Plain &amp;amp; means &lt;em>shared access&lt;/em>.&lt;/p>
&lt;p>But Mutex does have a way: the lock. In fact, a mutex is little more than a way to do exactly this, to provide &lt;em>exclusive&lt;/em> (mut) access to the data inside, even though many threads may have &lt;em>shared&lt;/em> (non-mut) access to the Mutex itself.&lt;/p>
&lt;p>Rustâ€™s type system is telling us what Mutex does. It dynamically enforces exclusive access, something thatâ€™s usually done statically, at compile time, by the Rust compiler.&lt;/p>
&lt;p>(You may recall that &lt;code>std::cell::RefCell&lt;/code> does the same, except without trying to support multiple threads. &lt;code>Mutex&lt;/code> and &lt;code>RefCell&lt;/code> are both flavors of &lt;strong>interior mutability&lt;/strong>, which we covered .)&lt;/p>
&lt;h4 id="why-mutexes-are-not-always-a-good-idea">Why Mutexes Are Not Always a Good Idea
&lt;/h4>&lt;p>However, threads that use mutexes are subject to some other problems that Rust doesnâ€™t fix for you:&lt;/p>
&lt;ul>
&lt;li>Valid Rust programs canâ€™t have data races, but they can still have other &lt;em>race conditions&lt;/em>â€” situations where a programâ€™s behavior depends on timing among threads and may therefore vary from run to run. Some race conditions are benign. Some manifest as general flakiness and incredibly hard-to-fix bugs. Using mutexes in an unstructured way invites race conditions. Itâ€™s up to you to make sure theyâ€™re benign.&lt;/li>
&lt;li>Shared mutable state also affects program design. Where channels serve as an abstraction boundary in your code, making it easy to separate isolated components for testing, mutexes encourage a â€œjust-add-a-methodâ€ way of working that can lead to a monolithic blob of interrelated code.&lt;/li>
&lt;li>Lastly, mutexes are just not as simple as they seem at first, as the next two sections will show.&lt;/li>
&lt;/ul>
&lt;p>All of these problems are inherent in the tools. Use a more structured approach when you can; use a Mutex when you must.&lt;/p>
&lt;h4 id="deadlock">Deadlock
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">guard1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">waiting_list&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">unwrap&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">guard2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">waiting_list&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">unwrap&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// deadlock
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Suppose the first call to self.waiting_list.lock() succeeds, taking the lock. The second call sees that the lock is held, so it blocks, waiting for it to be released. It will be waiting forever. The waiting thread is the one thatâ€™s holding the lock.&lt;/p>
&lt;p>To put it another way, the lock in a Mutex is not a recursive lock.&lt;/p>
&lt;p>Rustâ€™s borrow system canâ€™t protect you from deadlock. The best protection is to keep critical sections small: get in, do your work, and get out.&lt;/p>
&lt;p>Itâ€™s also possible to get deadlock with channels.&lt;/p>
&lt;h4 id="poisoned-mutexes">Poisoned Mutexes
&lt;/h4>&lt;p>If a thread panics while holding a Mutex, Rust marks the Mutex as &lt;em>poisoned.&lt;/em> Any subsequent attempt to lock the poisoned Mutex will get an error result. Our &lt;code>.unwrap()&lt;/code> call tells Rust to panic if that happens, propagating panic from the other thread to this one.&lt;/p>
&lt;h4 id="multiconsumer-channels-using-mutexes">&lt;strong>Multiconsumer Channels Using Mutexes&lt;/strong>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mod&lt;/span> &lt;span class="nn">shared_channel&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">sync&lt;/span>::&lt;span class="p">{&lt;/span>&lt;span class="n">Arc&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Mutex&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">sync&lt;/span>::&lt;span class="n">mpsc&lt;/span>::&lt;span class="p">{&lt;/span>&lt;span class="n">channel&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Sender&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Receiver&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// A thread-safe wrapper around a `Receiver`.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[derive(Clone)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">SharedReceiver&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Arc&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Mutex&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Receiver&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Iterator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SharedReceiver&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Item&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Get the next item from the wrapped receiver.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">next&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">guard&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mf">0.&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">unwrap&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">guard&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">recv&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">ok&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Create a new channel whose receiver can be shared across threads.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// This returns a sender and a receiver, just like the stdlib&amp;#39;s
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// `channel()`, and sometimes works as a drop-in replacement.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">shared_channel&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="p">(&lt;/span>&lt;span class="n">Sender&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SharedReceiver&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sender&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">receiver&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">channel&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sender&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SharedReceiver&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Arc&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Mutex&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">receiver&lt;/span>&lt;span class="p">))))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220807141745840.png"
loading="lazy"
alt="image-20220807141745840"
>&lt;/p>
&lt;h4 id="readwrite-locksrwlockt">Read/Write Locks(&lt;code>RwLock&amp;lt;T&amp;gt;&lt;/code>)
&lt;/h4>&lt;p>Whereas a mutex has a single lock method, a read/write lock has two locking methods, read and write. The RwLock::write method is like Mutex::lock. It waits for exclusive, mut access to the protected data. The RwLock::read method provides non-mut access, with the advantage that it is less likely to have to wait, because many threads can safely read at once. With a mutex, at any given moment, the protected data has only one reader or writer (or none). With a read/write lock, it can have either one writer or many readers, much like Rust references generally.&lt;/p>
&lt;h4 id="condition-variables-condvar">Condition Variables (Condvar)
&lt;/h4>&lt;p>In Rust, the std::sync::Condvar type implements condition variables. A Condvar has methods .wait() and .notify_all(); .wait() blocks until some other thread calls .notify_all().&lt;/p>
&lt;h4 id="atomics">&lt;strong>Atomics&lt;/strong>
&lt;/h4>&lt;p>The std::sync::atomic module contains atomic types for lock-free concurrent programming. These types are basically the same as Standard C++ atomics, with some extras:&lt;/p>
&lt;p>AtomicIsize and AtomicUsize are shared integer types corresponding to the single- threaded isize and usize types.&lt;/p>
&lt;p>AtomicI8, AtomicI16, AtomicI32, AtomicI64, and their unsigned variants like AtomicU8 are shared integer types that correspond to the single-threaded types i8, i16, etc.&lt;/p>
&lt;p>An AtomicBool is a shared bool value.&lt;/p>
&lt;p>An &lt;code>AtomicPtr&amp;lt;T&amp;gt;&lt;/code> is a shared value of the unsafe pointer type *mut T.&lt;/p>
&lt;h4 id="global-variables">&lt;strong>Global Variables&lt;/strong>
&lt;/h4>&lt;p>The simplest way to support incrementing PACKETS_SERVED, while keeping it thread-safe, is to make it an atomic integer:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">sync&lt;/span>::&lt;span class="n">atomic&lt;/span>::&lt;span class="n">AtomicUsize&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">PACKETS_SERVED&lt;/span>: &lt;span class="nc">AtomicUsize&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">AtomicUsize&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Once this static is declared, incrementing the packet count is straightforward:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">sync&lt;/span>::&lt;span class="n">atomic&lt;/span>::&lt;span class="n">Ordering&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="no">PACKETS_SERVED&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">fetch_add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Ordering&lt;/span>::&lt;span class="n">SeqCst&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Atomic globals are limited to simple integers and Booleans. Still, creating a global variable of any other type amounts to solving two problems.&lt;/p>
&lt;p>First, the variable must be made thread-safe somehow, because otherwise it canâ€™t be global: for safety, static variables must be both Sync and non-mut. Fortunately, weâ€™ve already seen the solution for this problem. Rust has types for safely sharing values that change: Mutex, RwLock, and the atomic types. These types can be modified even when declared as non-mut. Itâ€™s what they do. (See â€œmut and Mutexâ€.)&lt;/p>
&lt;p>Second, static initializers can only call functions specifically marked as const, which the compiler can evaluate during compile time. Put another way, their output is deterministic; it depends only on their arguments, not any other state or I/O. That way, the compiler can embed the results of that computation as a compile-time constant. This is similar to C++ constexpr.&lt;/p>
&lt;p>Rust limits what const functions can do to a small set of operations, which are enough to be useful while still not allowing any nondeterministic results. const functions canâ€™t take types as generic arguments, only lifetimes, and itâ€™s not possible to allocate memory or operate on raw pointers, even in unsafe blocks. We can, however, use arithmetic operations (including wrapping and saturating arithmetic), logical operations that donâ€™t short-circuit, and other const functions. For example, we can create convenience functions to make defining statics and consts easier and reduce code duplication:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">mono_to_rgba&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">level&lt;/span>: &lt;span class="kt">u8&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Color&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Color&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">red&lt;/span>: &lt;span class="nc">level&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">green&lt;/span>: &lt;span class="nc">level&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">blue&lt;/span>: &lt;span class="nc">level&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">alpha&lt;/span>: &lt;span class="mh">0xFF&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">WHITE&lt;/span>: &lt;span class="nc">Color&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mono_to_rgba&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">255&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">BLACK&lt;/span>: &lt;span class="nc">Color&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mono_to_rgba&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Combining these techniques, we might be tempted to write:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">HOSTNAME&lt;/span>: &lt;span class="nc">Mutex&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Mutex&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">String&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// error: calls in statics are limited to
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// constant functions, tuple structs, and
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// tuple variants
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Unfortunately, while AtomicUsize::new() and String::new() are const fn, Mutex::new() is not. In order to get around these limitations, we need to use the lazy_static crate.&lt;/p>
&lt;p>We can declare a global Mutex-controlled HashMap with lazy_static like this:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lazy_static&lt;/span>::&lt;span class="n">lazy_static&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">sync&lt;/span>::&lt;span class="n">Mutex&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">lazy_static!&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">HOSTNAME&lt;/span>: &lt;span class="nc">Mutex&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Mutex&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">String&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Using lazy_static! imposes a tiny performance cost on each access to the static data. The implementation uses std::sync::Once, a low-level synchronization primitive designed for one-time initialization. Behind the scenes, each time a lazy static is accessed, the program executes an atomic load instruction to check that initialization has already occurred. (Once is rather special purpose, so we will not cover it in detail here. It is usually more convenient to use lazy_static! instead. However, it is handy for initializing non-Rust libraries; for an example, see â€œA Safe Interface to libgit2â€.)&lt;/p>
&lt;h3 id="what-hacking-concurrent-code-in-rust-is-like">&lt;strong>What Hacking Concurrent Code in Rust Is Like&lt;/strong>
&lt;/h3>&lt;p>Rust insists on safety, so from the moment you decide to write a multithreaded program, the focus is on building safe, structured communication. Keeping threads mostly isolated is a good way to convince Rust that what youâ€™re doing is safe. It happens that isolation is also a good way to make sure what youâ€™re doing is correct and maintainable. Again, Rust guides you toward good programs.&lt;/p>
&lt;h2 id="chapter-20-asynchronous-programming">&lt;strong>Chapter 20. Asynchronous Programming&lt;/strong>
&lt;/h2>&lt;p>Asynchronous tasks are similar to threads, but are much quicker to create, pass control amongst themselves more efficiently, and have memory overhead an order of magnitude less than that of a thread.&lt;/p>
&lt;h3 id="from-synchronous-to-asynchronous">&lt;strong>From Synchronous to Asynchronous&lt;/strong>
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Programming-Rust/image-20220817164154643.png"
loading="lazy"
alt="image-20220817164154643"
>&lt;/p>
&lt;p>æ–‡ä¸­ä¸¾äº†åŒæ­¥çš„è·å¾—HTTPè¯·æ±‚å†è¿”å›çš„ä¾‹å­ï¼Œå¯ä»¥çœ‹åˆ°å¤§éƒ¨åˆ†æ—¶é—´éƒ½èŠ±åœ¨ç­‰å¾…ä¸Šäº†ã€‚&lt;/p>
&lt;h4 id="futures">&lt;strong>Futures&lt;/strong>
&lt;/h4>&lt;p>&lt;code>std::future::Future&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Future&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">type&lt;/span> &lt;span class="nc">Output&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">poll&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>: &lt;span class="nc">Pin&lt;/span>&lt;span class="o">&amp;lt;&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">Self&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cx&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Context&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nb">&amp;#39;_&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">Poll&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>::&lt;span class="n">Output&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">enum&lt;/span> &lt;span class="nc">Poll&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Represents that a value is immediately ready.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[lang = &lt;/span>&lt;span class="s">&amp;#34;Ready&amp;#34;&lt;/span>&lt;span class="cp">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;futures_api&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.36.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Ready&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;futures_api&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.36.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Represents that a value is not ready yet.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// When a function returns `Pending`, the function *must* also
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ensure that the current task is scheduled to be awoken when
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// progress can be made.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[lang = &lt;/span>&lt;span class="s">&amp;#34;Pending&amp;#34;&lt;/span>&lt;span class="cp">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;futures_api&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.36.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Pending&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>A Future represents an operation that you can test for completion. A futureâ€™s poll method never waits for the operation to finish: it always returns immediately. If the operation is complete, poll returns Poll::Ready(output), where output is its final result. Otherwise, it returns Pending. If and when the future is worth polling again, it promises to let us know by invoking a &lt;em>waker&lt;/em>, a callback function supplied in the Context. We call this the â€œpinÌƒata modelâ€ of asynchronous programming: the only thing you can do with a future is whack it with a poll until a value falls out.&lt;/p>
&lt;h2 id="chapter-21-macros">Chapter 21. Macros
&lt;/h2>&lt;p>åœ¨ç¼–è¯‘æœŸé—´ï¼Œåœ¨ç±»å‹æ£€æŸ¥å’Œæœºå™¨ç ç”Ÿæˆä¹‹å‰ï¼Œå®ä¼šè¿›è¡Œå±•å¼€ã€‚è”ç³»rustç¼–è¯‘è¿‡ç¨‹å›¾ç†è§£ã€‚&lt;/p>
&lt;h3 id="macro-basics">Macro Basics
&lt;/h3>&lt;ul>
&lt;li>ç”¨ &lt;code>macro_rules!&lt;/code> å®šä¹‰çš„å£°æ˜å®ï¼Œé€šè¿‡æ¨¡å¼åŒ¹é…æ¥å·¥ä½œã€‚&lt;/li>
&lt;li>åœ¨ pattern æˆ–è€… template ä¸­ï¼Œå¯ä»¥ç”¨æ–¹æ‹¬å·æˆ–è€…èŠ±æ‹¬å·ä»£æ›¿åœ†æ‹¬å·ã€‚å®ƒä»¬æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gcd&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">gcd&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)];&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">gcd&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ³¨æ„ç»“å°¾è¿™é‡Œåˆ†å·æ˜¯å¯é€‰çš„ï¼Œä¹Ÿå¯ä»¥åŠ ä¸Š
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>å¯¹äºå®çš„è°ƒç”¨ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚æŒ‰ç…§æƒ¯ä¾‹ï¼Œè°ƒç”¨ &lt;code>assert_eq!&lt;/code> ç”¨åœ†æ‹¬å·ï¼Œè°ƒç”¨ &lt;code>vec!&lt;/code> ç”¨æ–¹æ‹¬å·ï¼Œå¯¹äº &lt;code>macro_rules!&lt;/code> ç”¨èŠ±æ‹¬å·ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="basics-of-macro-expansion">Basics of Macro Expansion
&lt;/h4>&lt;ul>
&lt;li>åœ¨ç¼–è¯‘æœŸé—´ï¼ŒRustå±•å¼€å®éå¸¸æ—©ã€‚åœ¨å®å®šä¹‰ä¹‹å‰æ˜¯ä¸èƒ½è°ƒç”¨å®ƒçš„ï¼Œå› ä¸ºRustä¼šå±•å¼€æ¯ä¸€ä¸ªå®è°ƒç”¨ï¼Œè¿™å‘ç”Ÿåœ¨æŸ¥çœ‹ç¨‹åºå‰©ä½™ä»£ç ä¹‹å‰ã€‚&lt;/li>
&lt;li>æ­£åˆ™è¡¨è¾¾å¼æ˜¯åœ¨å­—ç¬¦é›†ä¸Šæ“ä½œï¼Œè€Œ pattern æ˜¯åœ¨ token ä¸Šæ“ä½œã€‚æ­£åˆ™è¡¨è¾¾å¼å’Œå®æ¨¡å¼å¦ä¸€ä¸ªé‡è¦çš„åŒºåˆ«æ˜¯åœ¨Rustä¸­åœ†æ‹¬å·ã€å—æ€»æ˜¯æˆå¯¹å‡ºç°çš„ã€‚åœ¨å®å±•å¼€ä¹‹å‰å°±ä¼šè¿›è¡Œæ£€æŸ¥ã€‚&lt;/li>
&lt;li>æ³¨è§£å’Œç©ºç™½ä¸æ˜¯ token ï¼Œæ‰€ä»¥ä¸ä¼šå½±å“æ¨¡å¼åŒ¹é…ã€‚&lt;/li>
&lt;li>ä¸€èˆ¬å¯èƒ½ä¼šæœ‰ä¸€äº›é”™è¯¯ï¼Œåœ¨å‚æ•°éƒ¨åˆ†ç”¨ &lt;code>$left:expr&lt;/code> è€Œä¸æ˜¯ &lt;code>$left&lt;/code>ã€‚Rustä¸ä¼šç«‹åˆ»å‘ç°è¿™ä¸ªé”™è¯¯ï¼Œå®ƒä¼šå°† &lt;code>$left&lt;/code> å½“ä½œä¸€ä¸ªæ›¿æ¢ï¼Œç›´åˆ°è°ƒç”¨è¿™ä¸ªå®çš„æ—¶å€™ä¼šå‘ç”Ÿé”™è¯¯ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="unintended-consenquences">Unintended Consenquences
&lt;/h4>&lt;p>æ­£ç¡®çš„ &lt;code>assert_eq!&lt;/code> å®çš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ ‡å‡†åº“ä¸­çš„å®šä¹‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">macro_rules&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">assert_eq&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$left&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$right&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$(,&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="cp">$left&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="cp">$right&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// è¿™é‡Œç”¨çš„æ˜¯å¼•ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">left_val&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">right_val&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">left_val&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">right_val&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">kind&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$crate&lt;/span>::&lt;span class="n">panicking&lt;/span>::&lt;span class="n">AssertKind&lt;/span>::&lt;span class="nb">Eq&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// The reborrows below are intentional. Without them, the stack slot for the
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// borrow is initialized even before the values are compared, leading to a
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// noticeable slow down.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$crate&lt;/span>::&lt;span class="n">panicking&lt;/span>::&lt;span class="n">assert_failed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">kind&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;*&lt;/span>&lt;span class="n">left_val&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;*&lt;/span>&lt;span class="n">right_val&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$crate&lt;/span>::&lt;span class="n">option&lt;/span>::&lt;span class="nb">Option&lt;/span>::&lt;span class="nb">None&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸ºä»€ä¹ˆä¸è¿™æ ·å†™å‘¢ï¼Ÿ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$right&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">panic!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;assertion failed: `(left == right)` &lt;/span>&lt;span class="se">\&lt;/span>&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (left: `&lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">`, right: `&lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">`)&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$left&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$right&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚æœ &lt;code>assert_eq!(letters.pop(), Some('z'))&lt;/code> è¿™æ ·è°ƒç”¨ï¼Œç”±äº &lt;code>letters.pop()&lt;/code> ä¼šä»ä¸€ä¸ª vector ä¸­ç§»é™¤ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆå½“ç¬¬äºŒæ¬¡è°ƒç”¨çš„æ—¶å€™å°±ä¼šäº§ç”Ÿä¸€ä¸ªä¸åŒçš„å€¼ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå®é™…å®å½“ä¸­ &lt;code>$left&lt;/code> å’Œ &lt;code>$right&lt;/code> åªä¼šä¿å­˜ä¸€æ¬¡å®ƒä»¬çš„å€¼ã€‚&lt;/p>
&lt;p>é‚£ä¸ºä»€ä¹ˆå®é‡Œé¢è¦ç”¨å¼•ç”¨ï¼Œä¸èƒ½è¿™æ ·å†™å—ï¼Ÿ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="n">macro_rules&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bad_assert_eq&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$left&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$right&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$left&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$right&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// è¿™é‡Œä¸ç”¨å¼•ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">left_val&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">right_val&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">left_val&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">right_val&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">panic!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;assertion failed&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cm">/* ... */&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚æœä¼ å…¥çš„å‚æ•°æ˜¯ &lt;code>String&lt;/code> ï¼Œé‚£ä¹ˆå°±ä¼šç§»åŠ¨æ‰€æœ‰æƒåˆ°å˜é‡é‡Œé¢ã€‚å› æ­¤è¿™é‡Œè¦ä½¿ç”¨å¼•ç”¨ã€‚&lt;/p>
&lt;blockquote>
&lt;p>In short, macros can do surprising things.&lt;/p>
&lt;/blockquote>
&lt;h4 id="repetition">Repetition
&lt;/h4>&lt;p>æ ‡å‡†åº“ä¸­ &lt;code>vec!&lt;/code> å®&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="n">macro_rules&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">vec&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">$crate&lt;/span>::&lt;span class="fm">__rust_force_expr!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$crate&lt;/span>::&lt;span class="n">vec&lt;/span>::&lt;span class="nb">Vec&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$elem&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$n&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">$crate&lt;/span>::&lt;span class="fm">__rust_force_expr!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$crate&lt;/span>::&lt;span class="n">vec&lt;/span>::&lt;span class="n">from_elem&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$elem&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$n&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$($x&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$(,&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">$crate&lt;/span>::&lt;span class="fm">__rust_force_expr!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>::&lt;span class="n">into_vec&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">box&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="cp">$($x&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="p">]))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>$( PATTERN ), *&lt;/code> ç”¨æ¥åŒ¹é…ä»»ä½•ç”¨ &lt;code>,&lt;/code> åˆ†éš”çš„ç«‹æ ‡ï¼Œåœ¨åˆ—è¡¨ä¸­æ¯ä¸ªåŒ¹é…ä¸€ä¸ª &lt;code>PATTERN&lt;/code>ã€‚&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Pattern&lt;/th>
&lt;th>Meaning&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>$( &amp;hellip; )*&lt;/td>
&lt;td>Match 0 or more times with no separator&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>$( &amp;hellip; ),*&lt;/td>
&lt;td>Match 0 or more times, separated by commas&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>$( &amp;hellip; );*&lt;/td>
&lt;td>Match 0 or more times, separated by semicolons&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>$( &amp;hellip; )+&lt;/td>
&lt;td>Match 1 or more times with no separator&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>$( &amp;hellip; ),+&lt;/td>
&lt;td>Match 1 or more times, separated by commas&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>$( &amp;hellip; );+&lt;/td>
&lt;td>Match 1 or more times, separated by semicolons&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>$( &amp;hellip; )?&lt;/td>
&lt;td>Match 0 or 1 times with no separator&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>$( &amp;hellip; ),?&lt;/td>
&lt;td>Match 0 or 1 times, separated by commas&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>$( &amp;hellip; );?&lt;/td>
&lt;td>Match 0 or 1 times, separated by semicolons&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>æ€»ç»“ä¸€ä¸‹å•¦ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>*&lt;/code> åŒ¹é…0æ¬¡æˆ–å¤šæ¬¡&lt;/li>
&lt;li>&lt;code>+&lt;/code> è‡³å°‘åŒ¹é…ä¸€æ¬¡&lt;/li>
&lt;li>&lt;code>?&lt;/code> æœ€å¤šåŒ¹é…ä¸€æ¬¡&lt;/li>
&lt;/ul>
&lt;p>ç†è§£ç†è§£è¿™ä¸ªå¤æ‚çš„é¬¼ä¸œè¥¿&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>::&lt;span class="n">into_vec&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">box&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="cp">$($x&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>åˆ›å»ºä¸€ä¸ª boxed æ•°ç»„ç„¶åç”¨ &lt;code>[T]::into_vec&lt;/code> æ–¹æ³•å°† boxed æ•°ç»„è½¬æ¢æˆä¸€ä¸ª vector ã€‚&lt;/li>
&lt;li>&lt;code>&amp;lt;[_]&amp;gt;&lt;/code> æ˜¯ä¸€ä¸ªéå¸¸è§„çš„å†™æ³•ï¼Œç”¨æ¥è¡¨ç¤ºä¸€äº›ç±»å‹çš„åˆ‡ç‰‡ï¼ˆ&amp;ldquo;slice of something&amp;rdquo;ï¼‰ã€‚åƒ &lt;code>fn()&lt;/code>,&lt;code>&amp;amp;str&lt;/code>,æˆ–è€…&lt;code>[_]&lt;/code>ï¼Œæ²¡æœ‰æ˜ç¡®çš„ç±»å‹ï¼Œå°±å¿…é¡»åŒ…åœ¨å°–æ‹¬å·&lt;code>&amp;lt;&amp;gt;&lt;/code>é‡Œé¢ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="built-in-macros">Built-In Macros
&lt;/h3>&lt;p>ä¸‹é¢çš„è¿™äº›å®æ˜¯å†…ç½®çš„ï¼Œç¡¬ç¼–ç åœ¨ &lt;code>rustc&lt;/code> ä¸­ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>file!()&lt;/code>, &lt;code>line!()&lt;/code>, &lt;code>column!()&lt;/code>&lt;/li>
&lt;li>&lt;code>stringingfy!(...tokens...)&lt;/code>&lt;/li>
&lt;li>&lt;code>concat!(str0, str1, ...)&lt;/code>&lt;/li>
&lt;/ul>
&lt;h2 id="chapter-22-unsafe-code">Chapter 22. Unsafe Code
&lt;/h2></description></item><item><title>Rustå…ƒç¼–ç¨‹</title><link>https://wenjin1997.github.io/2022/07/05/Rust-meta-programming/</link><pubDate>Tue, 05 Jul 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/07/05/Rust-meta-programming/</guid><description>&lt;p>å…ƒç¼–ç¨‹æŠ€æœ¯å¤§æ¦‚åˆ†ä¸ºï¼š&lt;/p>
&lt;ul>
&lt;li>ç®€å•æ–‡æœ¬æ›¿æ¢&lt;/li>
&lt;li>ç±»å‹æ¨¡æ¿&lt;/li>
&lt;li>åå°„&lt;/li>
&lt;li>è¯­æ³•æ‰©å±•&lt;/li>
&lt;li>ä»£ç è‡ªåŠ¨ç”Ÿæˆ&lt;/li>
&lt;/ul>
&lt;p>Rustè¯­è¨€é€šè¿‡åå°„å’ŒASTè¯­æ³•æ‰©å±•ä¸¤ç§æ‰‹æ®µæ¥æ”¯æŒå…ƒç¼–ç¨‹ã€‚&lt;/p>
&lt;h2 id="åå°„">åå°„
&lt;/h2>&lt;p>åå°„æœºåˆ¶ä¸€èˆ¬æ˜¯æŒ‡ç¨‹åºè‡ªæˆ‘è®¿é—®ã€æ£€æµ‹å’Œä¿®æ”¹å…¶è‡ªèº«çŠ¶æ€æˆ–è¡Œä¸ºçš„èƒ½åŠ›ã€‚Rustæ ‡å‡†åº“æä¾›äº†&lt;a class="link" href="https://rustwiki.org/zh-CN/std/any/trait.Any.html" target="_blank" rel="noopener"
>std::any::Any&lt;/a>æ¥æ”¯æŒè¿è¡Œæ—¶åå°„ã€‚å¯ä»¥å…ˆçœ‹ä¸‹ä»£ç ç»“æ„ï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Rust-meta-programming/any-struct.png"
loading="lazy"
alt="any-struct"
>&lt;/p>
&lt;p>&lt;code>Any&lt;/code>å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[cfg_attr(not(test), rustc_diagnostic_item = &lt;/span>&lt;span class="s">&amp;#34;Any&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">trait&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Any&lt;/span>: &lt;span class="nb">&amp;#39;static&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Gets the `TypeId` of `self`.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// # Examples
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// use std::any::{Any, TypeId};
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// fn is_string(s: &amp;amp;dyn Any) -&amp;gt; bool {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// TypeId::of::&amp;lt;String&amp;gt;() == s.type_id()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// assert_eq!(is_string(&amp;amp;0), false);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// assert_eq!(is_string(&amp;amp;&amp;#34;cookie monster&amp;#34;.to_string()), true);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;get_type_id&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.34.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">type_id&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">TypeId&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nb">&amp;#39;static&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="nb">Sized&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Any&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">type_id&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">TypeId&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">TypeId&lt;/span>::&lt;span class="n">of&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>è¯¥ trait åŠ ä¸Šäº†&lt;code>'static&lt;/code> ç”Ÿå‘½å‘¨æœŸé™å®šï¼Œæ„å‘³ç€è¯¥ trait ä¸èƒ½è¢«éé™æ€ç”Ÿå‘½å‘¨æœŸçš„ç±»å‹å®ç°ã€‚ &lt;code>impl&amp;lt;T: 'static + ?Sized&amp;gt; Any for T&lt;/code> è¡¨ç¤º Rust ä¸­æ»¡è¶³ &lt;code>'static&lt;/code> ç”Ÿå‘½å‘¨æœŸçš„ç±»å‹å‡å®ç°äº†å®ƒã€‚&lt;/li>
&lt;li>&lt;code>type_id&lt;/code>æ–¹æ³•è¿”å› &lt;code>TypeId&lt;/code> ç±»å‹ï¼Œä»£è¡¨ Rust ä¸­æŸä¸ªç±»å‹çš„å…¨å±€å”¯ä¸€æ ‡è¯†ï¼Œå®ƒæ˜¯åœ¨ç¼–è¯‘æ—¶ç”Ÿæˆçš„ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#[derive(Clone, Copy, PartialEq, Eq, PartialOrd, Ord, Debug, Hash)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">TypeId&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>: &lt;span class="kt">u64&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypeId&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Returns the `TypeId` of the type this generic function has been
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// instantiated with.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// # Examples
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// use std::any::{Any, TypeId};
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// fn is_string&amp;lt;T: ?Sized + Any&amp;gt;(_s: &amp;amp;T) -&amp;gt; bool {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// TypeId::of::&amp;lt;String&amp;gt;() == TypeId::of::&amp;lt;T&amp;gt;()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// assert_eq!(is_string(&amp;amp;0), false);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// assert_eq!(is_string(&amp;amp;&amp;#34;cookie monster&amp;#34;.to_string()), true);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[must_use]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[rustc_const_unstable(feature = &lt;/span>&lt;span class="s">&amp;#34;const_type_id&amp;#34;&lt;/span>&lt;span class="cp">, issue = &lt;/span>&lt;span class="s">&amp;#34;77125&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">const&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">of&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="o">?&lt;/span>&lt;span class="nb">Sized&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">&amp;#39;static&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">TypeId&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">TypeId&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>: &lt;span class="nc">intrinsics&lt;/span>::&lt;span class="n">type_id&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>æ¯ä¸ª &lt;code>TypeId&lt;/code> éƒ½æ˜¯ä¸€ä¸ªâ€œé»‘ç›’â€ï¼Œä¸èƒ½æ£€æŸ¥å…¶å†…éƒ¨å†…å®¹ï¼Œä½†æ˜¯å…è®¸å¤åˆ¶ã€æ¯”è¾ƒã€æ‰“å°ç­‰æ“ä½œã€‚&lt;code>TypeId&lt;/code> å½“å‰ä»…é€‚ç”¨äºå½’å› äº &lt;code>'static&lt;/code> çš„ç±»å‹ï¼Œä½†æ˜¯å¯ä»¥åœ¨ future ä¸­æ¶ˆé™¤æ­¤é™åˆ¶ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="é€šè¿‡-is-å‡½æ•°åˆ¤æ–­ç±»å‹">é€šè¿‡ is å‡½æ•°åˆ¤æ–­ç±»å‹
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Any&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Returns `true` if the inner type is the same as `T`.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// # Examples
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// use std::any::Any;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// fn is_string(s: &amp;amp;dyn Any) {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// if s.is::&amp;lt;String&amp;gt;() {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// println!(&amp;#34;It&amp;#39;s a string!&amp;#34;);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// } else {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// println!(&amp;#34;Not a string...&amp;#34;);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// is_string(&amp;amp;0);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// is_string(&amp;amp;&amp;#34;cookie monster&amp;#34;.to_string());
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[inline]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">is&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nc">Any&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="kt">bool&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Get `TypeId` of the type this function is instantiated with.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypeId&lt;/span>::&lt;span class="n">of&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Get `TypeId` of the type in the trait object (`self`).
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">concrete&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">type_id&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Compare both `TypeId`s on equality.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">concrete&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>å› ä¸º &lt;code>Any&lt;/code> æ˜¯ä¸€ä¸ª trait ï¼Œæ‰€ä»¥è¿™é‡Œçš„ &lt;code>is&lt;/code>æ–¹æ³•çš„ &lt;code>&amp;amp;self&lt;/code> å¿…ç„¶æ˜¯ä¸€ä¸ª trait å¯¹è±¡ã€‚&lt;/li>
&lt;li>&lt;code>TypeId::of&lt;/code> å‡½æ•°ç”¨æ¥è·å–ç±»å‹ &lt;code>T&lt;/code> çš„å…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦ &lt;code>t&lt;/code> ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="sd">//! ä»£ç æ¸…å• 12-3: Any ä¸­å®ç° is æ–¹æ³•æºç ç¤ºæ„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">//! ã€ŠRustç¼–ç¨‹ä¹‹é“ã€‹P436
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">any&lt;/span>::&lt;span class="p">{&lt;/span>&lt;span class="n">Any&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypeId&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">enum&lt;/span> &lt;span class="nc">E&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">H&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">He&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Li&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">S&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="kt">u8&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>: &lt;span class="kt">u8&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">z&lt;/span>: &lt;span class="kt">u16&lt;/span> &lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[test]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mh">0xc0ffee_&lt;/span>&lt;span class="k">u32&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">E&lt;/span>::&lt;span class="n">He&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">S&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="mh">0xde&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">y&lt;/span>: &lt;span class="mh">0xad&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">z&lt;/span>: &lt;span class="mh">0xbeef&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v4&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;rust&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Any&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">assert!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">is&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u32&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypeId&lt;/span>::&lt;span class="n">of&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">u32&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">v2&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">assert!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">is&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypeId&lt;/span>::&lt;span class="n">of&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">v3&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">assert!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">is&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">S&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypeId&lt;/span>::&lt;span class="n">of&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">S&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">v4&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">assert!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">is&lt;/span>::&lt;span class="o">&amp;lt;&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{:?}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypeId&lt;/span>::&lt;span class="n">of&lt;/span>::&lt;span class="o">&amp;lt;&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¾“å‡ºç»“æœï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">TypeId &lt;span class="o">{&lt;/span> t: &lt;span class="m">18349839772473174998&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TypeId &lt;span class="o">{&lt;/span> t: &lt;span class="m">5500635625788377815&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TypeId &lt;span class="o">{&lt;/span> t: &lt;span class="m">4485408004367722735&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TypeId &lt;span class="o">{&lt;/span> t: &lt;span class="m">13307641874416792075&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>TypeId&lt;/code> æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå…¶å­—æ®µ &lt;code>t&lt;/code> å­˜å‚¨äº†ä¸€ä¸²æ•°å­—ï¼Œè¿™å°±æ˜¯å…¨å±€å”¯ä¸€ç±»å‹æ ‡è¯†ç¬¦ï¼Œå®é™…ä¸Šæ˜¯ u64 ç±»å‹ã€‚ä»£è¡¨å”¯ä¸€æ ‡è¯†ç¬¦çš„è¿™ä¸²æ•°å­—ï¼Œåœ¨ä¸åŒçš„ç¼–è¯‘ç¯å¢ƒä¸­ï¼Œäº§ç”Ÿçš„ç»“æœæ˜¯ä¸åŒçš„ã€‚æ‰€ä»¥åœ¨å®é™…å¼€å‘ä¸­ï¼Œæœ€å¥½ä¸è¦å°† &lt;code>TypeId&lt;/code> æš´éœ²åˆ°å¤–éƒ¨æ¥å£ä¸­è¢«å½“ä½œä¾èµ–ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="è½¬æ¢åˆ°å…·ä½“ç±»å‹">è½¬æ¢åˆ°å…·ä½“ç±»å‹
&lt;/h3>&lt;p>Any æä¾›äº† &lt;code>downcast_ref&lt;/code> å’Œ &lt;code>downcast_mut&lt;/code> ä¸¤ä¸ªæˆå¯¹çš„æ³›å‹æ–¹æ³•ï¼Œç”¨äºå°†æ³›å‹Tå‘ä¸‹è½¬æ¢ä¸ºå…·ä½“çš„ç±»å‹ï¼Œè¿”å›å€¼åˆ†åˆ«æ˜¯ &lt;code>Option&amp;lt;&amp;amp;T&amp;gt;&lt;/code> å’Œ &lt;code>Option&amp;lt;&amp;amp;mut T&amp;gt;&lt;/code> ç±»å‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="k">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Any&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Returns some reference to the inner value if it is of type `T`, or
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// `None` if it isn&amp;#39;t.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// # Examples
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// use std::any::Any;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// fn print_if_string(s: &amp;amp;dyn Any) {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// if let Some(string) = s.downcast_ref::&amp;lt;String&amp;gt;() {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// println!(&amp;#34;It&amp;#39;s a string({}): &amp;#39;{}&amp;#39;&amp;#34;, string.len(), string);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// } else {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// println!(&amp;#34;Not a string...&amp;#34;);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// print_if_string(&amp;amp;0);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// print_if_string(&amp;amp;&amp;#34;cookie monster&amp;#34;.to_string());
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[inline]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">downcast_ref&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nc">Any&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&amp;amp;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">is&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// SAFETY: just checked whether we are pointing to the correct type, and we can rely on
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// that check for memory safety because we have implemented Any for all types; no other
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// impls can exist as they would conflict with our impl.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">unsafe&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">downcast_ref_unchecked&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sd">/// Returns some mutable reference to the inner value if it is of type `T`, or
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// `None` if it isn&amp;#39;t.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// # Examples
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// use std::any::Any;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// fn modify_if_u32(s: &amp;amp;mut dyn Any) {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// if let Some(num) = s.downcast_mut::&amp;lt;u32&amp;gt;() {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// *num = 42;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// let mut x = 10u32;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// let mut s = &amp;#34;starlord&amp;#34;.to_string();
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// modify_if_u32(&amp;amp;mut x);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// modify_if_u32(&amp;amp;mut s);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">///
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// assert_eq!(x, 42);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// assert_eq!(&amp;amp;s, &amp;#34;starlord&amp;#34;);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sd">/// ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">#[stable(feature = &lt;/span>&lt;span class="s">&amp;#34;rust1&amp;#34;&lt;/span>&lt;span class="cp">, since = &lt;/span>&lt;span class="s">&amp;#34;1.0.0&amp;#34;&lt;/span>&lt;span class="cp">)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[inline]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">downcast_mut&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>: &lt;span class="nc">Any&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Option&lt;/span>&lt;span class="o">&amp;lt;&amp;amp;&lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">is&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// SAFETY: just checked whether we are pointing to the correct type, and we can rely on
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// that check for memory safety because we have implemented Any for all types; no other
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// impls can exist as they would conflict with our impl.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">unsafe&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">Some&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">downcast_mut_unchecked&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">None&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="éé™æ€ç”Ÿå‘½å‘¨æœŸç±»å‹">éé™æ€ç”Ÿå‘½å‘¨æœŸç±»å‹
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="sd">//! ä»£ç æ¸…å• 12-9: éé™æ€ç”Ÿå‘½å‘¨æœŸç±»å‹æ²¡æœ‰å®ç° Any
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">any&lt;/span>::&lt;span class="n">Any&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Unstatic&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span> &lt;span class="kt">i32&lt;/span> &lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[test]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">42&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Unstatic&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">any&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Any&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// any = &amp;amp;v; // ç¼–è¯‘é”™è¯¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>å¸¦å¼•ç”¨å­—æ®µçš„ç»“æ„ä½“ &lt;code>Unstatic&amp;lt;'a&amp;gt;&lt;/code> ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸä¸æ˜¯é™æ€çš„ï¼Œç¼–è¯‘ä¼šæŠ¥é”™ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä¿®æ”¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#![allow(unused)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">std&lt;/span>::&lt;span class="n">any&lt;/span>::&lt;span class="n">Any&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">UnStatic&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="na">&amp;#39;a&lt;/span> &lt;span class="kt">i32&lt;/span> &lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="no">ANSWER&lt;/span>: &lt;span class="kt">i32&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">42&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">UnStatic&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">ANSWER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Any&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">assert!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">is&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">UnStatic&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="any-çš„åº”ç”¨">Any çš„åº”ç”¨
&lt;/h3>&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/osohq/oso/blob/main/languages/rust/oso/src/host/class.rs" target="_blank" rel="noopener"
>osoåº“åº”ç”¨&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/bevyengine/bevy/blob/main/crates/bevy_reflect/src/lib.rs" target="_blank" rel="noopener"
>bevy_reflectåº“åº”ç”¨&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="remark">Remark
&lt;/h3>&lt;p>åœ¨2018 Edition ä¸­ï¼Œä»¥ä¸‹è¯­å¥ä¸ä¼šæŠ¥é”™ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Any&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// 2018 Edition Ok
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Any&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// 2018 Edition Ok
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½†æ˜¯åœ¨2021 Editionä¸­ï¼Œå¿…é¡»åŠ ä¸Š &lt;code>dyn&lt;/code> ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">Any&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// 2021 Edition Error: trait objects must include the `dyn` keyword
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">dyn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Any&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// 2021 Edition Ok
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å®ç³»ç»Ÿ">å®ç³»ç»Ÿ
&lt;/h2>&lt;p>Rustç¼–è¯‘è¿‡ç¨‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-07-05-Rust-meta-programming/compile-process.png"
loading="lazy"
alt="compile-process"
>&lt;/p>
&lt;h3 id="å£°æ˜å®">å£°æ˜å®
&lt;/h3>&lt;p>å®å±•å¼€å‘½ä»¤ï¼š cargo rustc â€“ -Z unstable-options â€“pretty=expanded&lt;/p>
&lt;p>ç¤ºä¾‹1:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#![allow(unused)]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">macro_rules&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">unless&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$arg&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$branch&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="cp">$arg&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$branch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">};);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">cmp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>: &lt;span class="kt">i32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>: &lt;span class="kt">i32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">unless!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">println!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s"> &amp;lt; &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">cmp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ”¯æŒtokenç±»å‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">item â€” an item, like a &lt;span class="k">function&lt;/span>, struct, module, etc.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">block â€” a block &lt;span class="o">(&lt;/span>i.e. a block of statements and/or an expression, surrounded by braces&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stmt â€” a statement
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pat â€” a pattern
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">expr â€” an expression
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ty â€” a &lt;span class="nb">type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ident â€” an identifier æ ‡è¯†ç¬¦
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">path â€” a path &lt;span class="o">(&lt;/span>e.g., foo, ::std::mem::replace, transmute::&amp;lt;_, int&amp;gt;, â€¦&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">meta â€” a meta item&lt;span class="p">;&lt;/span> the things that go inside &lt;span class="c1">#[...] and #![...] attributes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tt â€” a single token tree
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vis â€” a possibly empty Visibility qualifier
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lifetime â€” æŒ‡ä»£å£°æ˜å‘¨æœŸå‚æ•°
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>hashmap 1.0&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="n">macro_rules&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hashmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$($key&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$value&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_map&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>::&lt;span class="n">std&lt;/span>::&lt;span class="n">collections&lt;/span>::&lt;span class="n">HashMap&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">$(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">_map&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$key&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$value&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">_map&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[test]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">hashmap!&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;a&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;b&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// &amp;#34;c&amp;#34; =&amp;gt; 3, // ä¼šæŠ¥é”™ï¼Œä¸æ”¯æŒç»“å°¾æœ‰é€—å·
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;a&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>hashmap 2.0ï¼šå¯ä»¥åŒ¹é…ç»“å°¾æœ‰é€—å·&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="n">macro_rules&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hashmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$($key&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$value&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="p">,)&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">hashmap!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$($key&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$value&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$($key&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$value&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_map&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>::&lt;span class="n">std&lt;/span>::&lt;span class="n">collections&lt;/span>::&lt;span class="n">HashMap&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">$(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">_map&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$key&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$value&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">_map&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[test]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">hashmap!&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;a&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;b&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;c&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;a&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>hashmap 3.0&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="n">macro_rules&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hashmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$($key&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$value&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$(,&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_map&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>::&lt;span class="n">std&lt;/span>::&lt;span class="n">collections&lt;/span>::&lt;span class="n">HashMap&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">$(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">_map&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$key&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$value&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">_map&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[test]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">hashmap!&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;a&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;b&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;c&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;a&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>hashmap 4.0 ï¼š èŠ‚çœå­˜å‚¨ç©ºé—´&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="n">macro_rules&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">unit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$($x&lt;/span>:&lt;span class="nc">tt&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">macro_rules&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$($key&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">[()]&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>::&lt;span class="n">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="cp">$(&lt;/span>&lt;span class="fm">unit!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$key&lt;/span>&lt;span class="p">)),&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">]));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">macro_rules&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hashmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$($key&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$value&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$(,&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_cap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">count!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$($key&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_map&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>::&lt;span class="n">std&lt;/span>::&lt;span class="n">collections&lt;/span>::&lt;span class="n">HashMap&lt;/span>::&lt;span class="n">with_capacity&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">_cap&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">$(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">_map&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$key&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$value&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">_map&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[test]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">hashmap!&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;a&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;b&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;c&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;a&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>hashmap 5.0ï¼šå°†å£°æ˜å®æ”¾åœ¨ä¸€èµ·&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="n">macro_rules&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hashmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">unit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$($x&lt;/span>:&lt;span class="nc">tt&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$($rest&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">[()]&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>::&lt;span class="n">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="cp">$(&lt;/span>&lt;span class="fm">hashmap!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">unit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$rest&lt;/span>&lt;span class="p">)),&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">]));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$($key&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$value&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$(,&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_cap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">hashmap!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$($key&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">mut&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_map&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>::&lt;span class="n">std&lt;/span>::&lt;span class="n">collections&lt;/span>::&lt;span class="n">HashMap&lt;/span>::&lt;span class="n">with_capacity&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">_cap&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">$(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">_map&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$key&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">$value&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">_map&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cp">#[test]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">hashmap!&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;a&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;b&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;c&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="fm">assert_eq!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;a&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç¤ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">macro_rules&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cp">$e&lt;/span>:&lt;span class="nc">expr&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">({&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">$e&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">(){&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// error[E0425]: cannot find value `a` in this scope
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">four&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">sum!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>æ³¨æ„è¿™é‡Œä¼šæŠ¥é”™ï¼Œå®é‡Œé¢çš„ &lt;code>a&lt;/code> å˜é‡æ˜¯å±€éƒ¨çš„ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="è¿‡ç¨‹å®">è¿‡ç¨‹å®
&lt;/h3>&lt;p>è¿‡ç¨‹å®ä¸‰ä»¶å¥—ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/dtolnay/syn" target="_blank" rel="noopener"
>syn&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/dtolnay/quote" target="_blank" rel="noopener"
>quote&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/alexcrichton/proc-macro2" target="_blank" rel="noopener"
>proc-macro2&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>ä»‹ç»ï¼š&lt;/p>
&lt;ul>
&lt;li>Syn is a parsing library for parsing a stream of Rust tokens into a syntax tree of Rust source code. å°† token æµè½¬æ¢æˆè¯­æ³•æ ‘ã€‚&lt;/li>
&lt;li>quote: This crate provides the &lt;a class="link" href="https://docs.rs/quote/1.0/quote/macro.quote.html" target="_blank" rel="noopener"
>&lt;code>quote!&lt;/code>&lt;/a> macro for turning Rust syntax tree data structures into tokens of source code. å°†è¯­æ³•æ ‘è½¬æ¢æˆ token æºç ã€‚&lt;/li>
&lt;li>proc-macro2 æ¯” proc-macro æ›´åŠ çš„çµæ´»ã€‚TokenStream APIæ¥å£ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// find_by_or!{ Person -&amp;gt; people::[name:String || company_name:String] }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">super&lt;/span>::&lt;span class="o">*&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">DbOpByOrBy&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">model&lt;/span>: &lt;span class="nc">Type&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">table&lt;/span>: &lt;span class="nc">Ident&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bracket_token&lt;/span>: &lt;span class="nc">token&lt;/span>::&lt;span class="n">Bracket&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">content&lt;/span>: &lt;span class="nc">FieldContentOr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">FieldContentOr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name1&lt;/span>: &lt;span class="nc">Ident&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ty1&lt;/span>: &lt;span class="nc">Type&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name2&lt;/span>: &lt;span class="nc">Ident&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ty2&lt;/span>: &lt;span class="nc">Type&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Parse&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">DbOpByOrBy&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">parse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">input&lt;/span>: &lt;span class="nc">ParseStream&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">model&lt;/span>: &lt;span class="nc">Type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">parse&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">parse&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="fm">Token!&lt;/span>&lt;span class="p">[&lt;/span>-&amp;gt;&lt;span class="p">]&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">table&lt;/span>: &lt;span class="nc">Ident&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">parse&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">parse&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="fm">Token!&lt;/span>&lt;span class="p">[&lt;/span>::&lt;span class="p">]&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bracket_token&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">bracketed!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">parse&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">DbOpByOrBy&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">table&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">bracket_token&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Parse&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">FieldContentOr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">parse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">input&lt;/span>: &lt;span class="nc">ParseStream&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="bp">Self&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name1&lt;/span>: &lt;span class="nc">Ident&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">parse&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">parse&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="fm">Token!&lt;/span>&lt;span class="p">[&lt;/span>:&lt;span class="p">]&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ty1&lt;/span>: &lt;span class="nc">Type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">parse&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">parse&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="fm">Token!&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name2&lt;/span>: &lt;span class="nc">Ident&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">parse&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">parse&lt;/span>::&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="fm">Token!&lt;/span>&lt;span class="p">[&lt;/span>:&lt;span class="p">]&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ty2&lt;/span>: &lt;span class="nc">Type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">parse&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nb">Ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">FieldContentOr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">name1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ty1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">name2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ty2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// in lib.rs
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// find_by_or!{ Person -&amp;gt; people::[name:String || company_name:String] }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cp">#[proc_macro]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> &lt;span class="nf">find_by_or&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">input&lt;/span>: &lt;span class="nc">TokenStream&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">TokenStream&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">DbOpByOrBy&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">table&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">bracket_token&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">parse_macro_input!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">DbOpByOrBy&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">name1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">name2&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ty1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ty2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ty1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ty2&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fn_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">format!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;find_by_&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">_or_&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name2&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fn_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Ident&lt;/span>::&lt;span class="n">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">fn_name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">proc_macro2&lt;/span>::&lt;span class="n">Span&lt;/span>::&lt;span class="n">call_site&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">expanded&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="fm">quote!&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">impl&lt;/span>&lt;span class="w"> &lt;/span>#&lt;span class="n">model&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">pub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">fn&lt;/span> #&lt;span class="n">fn_name&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">conn&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="nc">PgConnection&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>#&lt;span class="n">name1&lt;/span>: #&lt;span class="n">ty1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>#&lt;span class="n">name2&lt;/span>: #&lt;span class="n">ty2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nc">QueryResult&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>#&lt;span class="n">model&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>#&lt;span class="n">table&lt;/span>::&lt;span class="n">table&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">filter&lt;/span>&lt;span class="p">(&lt;/span>#&lt;span class="n">table&lt;/span>::&lt;span class="n">dsl&lt;/span>::#&lt;span class="n">name1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">eq&lt;/span>&lt;span class="p">(&lt;/span>#&lt;span class="n">name1&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">or_filter&lt;/span>&lt;span class="p">(&lt;/span>#&lt;span class="n">table&lt;/span>::&lt;span class="n">dsl&lt;/span>::#&lt;span class="n">name2&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">eq&lt;/span>&lt;span class="p">(&lt;/span>#&lt;span class="n">name2&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">get_result&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">TokenStream&lt;/span>::&lt;span class="n">from&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">expanded&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™
&lt;/h2>&lt;ul>
&lt;li>ã€ŠRustç¼–ç¨‹ä¹‹é“ã€‹&lt;/li>
&lt;/ul></description></item><item><title>ç°ä»£æ“ä½œç³»ç»Ÿç¬”è®°</title><link>https://wenjin1997.github.io/2022/07/01/Operating-System/</link><pubDate>Fri, 01 Jul 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/07/01/Operating-System/</guid><description>&lt;h1 id="ç¬¬1ç« -å¼•è®º">ç¬¬1ç«  å¼•è®º
&lt;/h1>&lt;h2 id="11-ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿ">1.1 ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿ
&lt;/h2>&lt;ol>
&lt;li>&lt;strong>æ“ä½œç³»ç»Ÿï¼ˆOperating Systemï¼Œç®€ç§° OSï¼‰æ˜¯ç®¡ç†è®¡ç®—æœºç¡¬ä»¶ä¸è½¯ä»¶èµ„æºçš„ç¨‹åºï¼Œæ˜¯è®¡ç®—æœºçš„åŸºçŸ³ã€‚&lt;/strong>&lt;/li>
&lt;li>&lt;strong>æ“ä½œç³»ç»Ÿæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨è®¡ç®—æœºä¸Šçš„è½¯ä»¶ç¨‹åº ï¼Œç”¨äºç®¡ç†è®¡ç®—æœºç¡¬ä»¶å’Œè½¯ä»¶èµ„æºã€‚&lt;/strong> ä¸¾ä¾‹ï¼šè¿è¡Œåœ¨ä½ ç”µè„‘ä¸Šçš„æ‰€æœ‰åº”ç”¨ç¨‹åºéƒ½é€šè¿‡æ“ä½œç³»ç»Ÿæ¥è°ƒç”¨ç³»ç»Ÿå†…å­˜ä»¥åŠç£ç›˜ç­‰ç­‰ç¡¬ä»¶ã€‚&lt;/li>
&lt;li>&lt;strong>æ“ä½œç³»ç»Ÿå­˜åœ¨å±è”½äº†ç¡¬ä»¶å±‚çš„å¤æ‚æ€§ã€‚&lt;/strong> æ“ä½œç³»ç»Ÿå°±åƒæ˜¯ç¡¬ä»¶ä½¿ç”¨çš„è´Ÿè´£äººï¼Œç»Ÿç­¹ç€å„ç§ç›¸å…³äº‹é¡¹ã€‚&lt;/li>
&lt;li>&lt;strong>æ“ä½œç³»ç»Ÿçš„å†…æ ¸ï¼ˆKernelï¼‰æ˜¯æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒè´Ÿè´£ç³»ç»Ÿçš„å†…å­˜ç®¡ç†ï¼Œç¡¬ä»¶è®¾å¤‡çš„ç®¡ç†ï¼Œæ–‡ä»¶ç³»ç»Ÿçš„ç®¡ç†ä»¥åŠåº”ç”¨ç¨‹åºçš„ç®¡ç†&lt;/strong>ã€‚ å†…æ ¸æ˜¯è¿æ¥åº”ç”¨ç¨‹åºå’Œç¡¬ä»¶çš„æ¡¥æ¢ï¼Œå†³å®šç€ç³»ç»Ÿçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚&lt;/li>
&lt;/ol>
&lt;h2 id="15-æ“ä½œç³»ç»Ÿæ¦‚å¿µ">1.5 æ“ä½œç³»ç»Ÿæ¦‚å¿µ
&lt;/h2>&lt;h3 id="151-è¿›ç¨‹">1.5.1 è¿›ç¨‹
&lt;/h3>&lt;p>è¿›ç¨‹æœ¬è´¨ä¸Šæ˜¯æ­£åœ¨æ‰§è¡Œçš„ä¸€ä¸ªç¨‹åºã€‚&lt;/p>
&lt;p>åœ°å€ç©ºé—´&lt;/p>
&lt;h1 id="ç¬¬2ç« -è¿›ç¨‹ä¸çº¿ç¨‹">ç¬¬2ç«  è¿›ç¨‹ä¸çº¿ç¨‹
&lt;/h1>&lt;p>è¿›ç¨‹æ˜¯å¯¹æ­£åœ¨è¿è¡Œç¨‹åºçš„ä¸€ä¸ªæŠ½è±¡ã€‚&lt;/p>
&lt;h2 id="21-è¿›ç¨‹">2.1 è¿›ç¨‹
&lt;/h2>&lt;p>ä¸¥æ ¼æ¥è¯´ï¼Œåœ¨æŸä¸€ä¸ªæ—¶åˆ»ï¼ŒCPUåªèƒ½è¿è¡Œä¸€ä¸ªè¿›ç¨‹ã€‚ä½†åœ¨1ç§’é’Ÿå†…ï¼Œå®ƒå¯èƒ½è¿è¡Œå¤šä¸ªè¿›ç¨‹ï¼Œè¿™æ ·å°±äº§ç”Ÿå¹¶è¡Œçš„é”™è§‰ã€‚&lt;/p>
&lt;h3 id="211-è¿›ç¨‹æ¨¡å‹">2.1.1 è¿›ç¨‹æ¨¡å‹
&lt;/h3>&lt;p>ä¸€ä¸ªè¿›ç¨‹å°±æ˜¯ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œç¨‹åºçš„å®ä¾‹ï¼ŒåŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨ã€å¯„å­˜å™¨å’Œå˜é‡çš„å½“å‰å€¼ã€‚&lt;/p>
&lt;p>æ¯ä¸ªè¿›ç¨‹æ‰§è¡Œå…¶è¿ç®—é€Ÿåº¦æ˜¯ä¸ç¡®å®šçš„ï¼Œæ‰€ä»¥ï¼Œåœ¨å¯¹è¿›ç¨‹ç¼–ç¨‹æ—¶å†³ä¸èƒ½å¯¹æ—¶åºä½œä»»ä½•æƒ³å½“ç„¶çš„å‡è®¾ã€‚&lt;/p>
&lt;p>è¿›ç¨‹å’Œç¨‹åºæœ‰å¾®å¦™çš„åŒºåˆ«ã€‚åšè›‹ç³•çš„é£Ÿè°±å°±æ˜¯ç¨‹åºï¼Œè¿›ç¨‹å°±æ˜¯å¨å¸ˆé˜…è¯»é£Ÿè°±ã€å–æ¥å„ç§åŸæ–™ä»¥åŠçƒ˜åˆ¶è›‹ç³•ç­‰ä¸€ç³»åˆ—æ“ä½œçš„æ€»å’Œã€‚&lt;/p>
&lt;p>ä¸€ä¸ªè¿›ç¨‹æ˜¯æŸç§ç±»å‹çš„ä¸€ä¸ªæ´»åŠ¨ï¼Œå®ƒæœ‰ç¨‹åºã€è¾“å…¥ã€è¾“å‡ºä»¥åŠçŠ¶æ€ã€‚å•ä¸ªå¤„ç†å™¨å¯ä»¥è¢«è‹¥å¹²è¿›ç¨‹å…±äº«ï¼Œå®ƒä½¿ç”¨æŸç§è°ƒåº¦ç®—æ³•å†³å®šä½•æ—¶åœæ­¢ä¸€ä¸ªè¿›ç¨‹çš„å·¥ä½œï¼Œå¹¶è½¬è€Œä¸ºå¦ä¸€ä¸ªè¿›ç¨‹æä¾›æœåŠ¡ã€‚&lt;/p>
&lt;h3 id="212-è¿›ç¨‹çš„åˆ›å»º">2.1.2 è¿›ç¨‹çš„åˆ›å»º
&lt;/h3>&lt;ul>
&lt;li>4ç§ä¸»è¦äº‹ä»¶ä¼šå¯¼è‡´è¿›ç¨‹çš„åˆ›å»ºï¼š
&lt;ul>
&lt;li>ç³»ç»Ÿåˆå§‹åŒ–&lt;/li>
&lt;li>æ­£åœ¨è¿è¡Œçš„ç¨‹åºæ‰§è¡Œäº†åˆ›å»ºè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨&lt;/li>
&lt;li>ç”¨æˆ·è¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹&lt;/li>
&lt;li>ä¸€ä¸ªæ‰¹å¤„ç†ä½œä¸šçš„åˆå§‹åŒ–&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å®ˆæŠ¤è¿›ç¨‹ï¼š åœç•™åœ¨åå°å¤„ç†çš„è¿›ç¨‹ã€‚&lt;/li>
&lt;li>æ–°è¿›ç¨‹éƒ½æ˜¯ç”±äºä¸€ä¸ªå·²å­˜åœ¨çš„è¿›ç¨‹æ‰§è¡Œäº†ä¸€ä¸ªç”¨äºåˆ›å»ºè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨è€Œåˆ›å»ºçš„ã€‚&lt;/li>
&lt;li>åœ¨UNIXç³»ç»Ÿä¸­ï¼Œåªæœ‰ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å¯ä»¥ç”¨æ¥åˆ›å»ºæ–°è¿›ç¨‹ï¼šforkã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="213-è¿›ç¨‹çš„ç»ˆæ­¢">2.1.3 è¿›ç¨‹çš„ç»ˆæ­¢
&lt;/h3>&lt;p>é€šå¸¸ç”±ä¸‹åˆ—æ¡ä»¶å¼•èµ·è¿›ç¨‹çš„ç»ˆæ­¢ï¼š&lt;/p>
&lt;ol>
&lt;li>æ­£å¸¸é€€å‡ºï¼ˆè‡ªæ„¿çš„ï¼‰&lt;/li>
&lt;li>å‡ºé”™é€€å‡ºï¼ˆè‡ªæ„¿çš„ï¼‰&lt;/li>
&lt;li>ä¸¥é‡é”™è¯¯ï¼ˆéè‡ªæ„¿ï¼‰&lt;/li>
&lt;li>è¢«å…¶ä»–è¿›ç¨‹æ€æ­»ï¼ˆéè‡ªæ„¿ï¼‰&lt;/li>
&lt;/ol>
&lt;h3 id="214-è¿›ç¨‹çš„å±‚æ¬¡ç»“æ„">2.1.4 è¿›ç¨‹çš„å±‚æ¬¡ç»“æ„
&lt;/h3>&lt;ul>
&lt;li>è¿›ç¨‹åªæœ‰ä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼ˆä½†æ˜¯å¯ä»¥æœ‰é›¶ä¸ªã€ä¸€ä¸ªã€ä¸¤ä¸ªæˆ–å¤šä¸ªå­è¿›ç¨‹ï¼‰ã€‚&lt;/li>
&lt;li>åœ¨UNIXä¸­ï¼Œè¿›ç¨‹å’Œå®ƒçš„æ‰€æœ‰å­è¿›ç¨‹ä»¥åŠåè£”å…±åŒç»„æˆä¸€ä¸ªè¿›ç¨‹ç»„ã€‚&lt;/li>
&lt;li>åœ¨UNIXä¸­ï¼Œæ‰€æœ‰çš„è¿›ç¨‹éƒ½å±äºä»¥ init ä¸ºæ ¹çš„ä¸€æ£µæ ‘ã€‚&lt;/li>
&lt;li>Windowsä¸­æ²¡æœ‰è¿›ç¨‹å±‚æ¬¡çš„æ¦‚å¿µï¼Œæ‰€æœ‰çš„è¿›ç¨‹éƒ½æ˜¯åœ°ä½ç›¸åŒçš„ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="215-è¿›ç¨‹çš„çŠ¶æ€">2.1.5 è¿›ç¨‹çš„çŠ¶æ€
&lt;/h3>&lt;p>å½“ä¸€ä¸ªè¿›ç¨‹åœ¨é€»è¾‘ä¸Šä¸èƒ½ç»§ç»­è¿è¡Œæ—¶ï¼Œå®ƒå°±ä¼šè¢«é˜»å¡ã€‚&lt;/p>
&lt;p>P52 å›¾2-2&lt;/p>
&lt;h3 id="216-è¿›ç¨‹çš„å®ç°">2.1.6 è¿›ç¨‹çš„å®ç°
&lt;/h3>&lt;ul>
&lt;li>ä¸ºäº†å®ç°è¿›ç¨‹æ¨¡å‹ï¼Œæ“ä½œç³»ç»Ÿç»´æŠ¤ç€ä¸€å¼ è¡¨æ ¼ï¼ˆä¸€ä¸ªç»“æ„æ•°ç»„ï¼‰ï¼Œå³è¿›ç¨‹è¡¨ã€‚æ¯ä¸ªè¿›ç¨‹å ç”¨ä¸€ä¸ªè¿›ç¨‹è¡¨é¡¹ã€‚&lt;/li>
&lt;li>ä¸æ¯ä¸€I/Oç±»å…³è”çš„æ˜¯ä¸€ä¸ªç§°ä½œä¸­æ–­å‘é‡çš„ä½ç½®ï¼ˆé è¿‘å†…å­˜åº•éƒ¨çš„å›ºå®šåŒºåŸŸï¼‰ã€‚å®ƒåŒ…å«ç»ˆç«¯æœåŠ¡ç¨‹åºçš„å…¥å£åœ°å€ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="217-å¤šé“ç¨‹åºè®¾è®¡æ¨¡å‹">2.1.7 å¤šé“ç¨‹åºè®¾è®¡æ¨¡å‹
&lt;/h3>&lt;p>é‡‡ç”¨å¤šé“ç¨‹åºè®¾è®¡å¯ä»¥æé«˜CPUçš„åˆ©ç”¨ç‡ï¼Œä¸è¿‡ä¹Ÿè¦è€ƒè™‘è¿›ç¨‹ç­‰å¾…I/Oæ“ä½œçš„æ—¶é—´ã€‚&lt;/p>
&lt;h2 id="22-çº¿ç¨‹">2.2 çº¿ç¨‹
&lt;/h2>&lt;p>åœ¨ä¼ ç»Ÿæ“ä½œç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªåœ°å€ç©ºé—´å’Œä¸€ä¸ªæ§åˆ¶çº¿ç¨‹ã€‚&lt;/p>
&lt;p>ä¸è¿‡ï¼Œç»å¸¸å­˜åœ¨åœ¨åŒä¸€ä¸ªåœ°å€ç©ºé—´ä¸­å‡†å¹¶è¡Œè¿è¡Œå¤šä¸ªæ§åˆ¶çº¿ç¨‹çš„æƒ…å½¢ã€‚&lt;/p>
&lt;h3 id="221-çº¿ç¨‹çš„ä½¿ç”¨">2.2.1 çº¿ç¨‹çš„ä½¿ç”¨
&lt;/h3>&lt;p>å¼•è¿›çº¿ç¨‹çš„åŸå› ï¼š&lt;/p>
&lt;ul>
&lt;li>é€šè¿‡å°†ä¸€äº›åº”ç”¨ç¨‹åºåˆ†è§£æˆå¯ä»¥å‡†å¹¶è¡Œè¿è¡Œçš„å¤šä¸ªé¡ºåºçº¿ç¨‹ï¼Œç¨‹åºè®¾è®¡æ¨¡å‹ä¼šå˜å¾—æ›´ç®€å•ã€‚å¹¶è¡Œå®ä½“æ‹¥æœ‰å…±äº«åŒä¸€ä¸ªåœ°å€ç©ºé—´å’Œæ‰€æœ‰å¯ç”¨æ•°æ®çš„èƒ½åŠ›ã€‚å¯¹äºè¿›ç¨‹æ¥è®²ï¼Œå®ƒä»¬å…·æœ‰çš„æ˜¯ä¸åŒçš„åœ°å€ç©ºé—´ï¼Œå› æ­¤éœ€è¦å¼•å…¥çº¿ç¨‹è¿™æ ·çš„æ¨¡å‹å’Œæ¦‚å¿µã€‚&lt;/li>
&lt;li>çº¿ç¨‹æ¯”è¿›ç¨‹æ›´è½»é‡çº§ï¼Œæ‰€ä»¥å®ƒä»¬æ¯”è¿›ç¨‹æ›´å®¹æ˜“ï¼ˆå³æ›´å¿«ï¼‰åˆ›å»ºï¼Œä¹Ÿæ›´å®¹æ˜“æ’¤é”€ã€‚&lt;/li>
&lt;li>æ€§èƒ½æ–¹é¢ã€‚å¦‚æœå­˜åœ¨ç€å¤§é‡çš„è®¡ç®—å’Œå¤§é‡çš„I/Oå¤„ç†ï¼Œæ‹¥æœ‰å¤šä¸ªçº¿ç¨‹å…è®¸è¿™äº›æ´»åŠ¨å½¼æ­¤é‡å è¿›è¡Œï¼Œä»è€Œä¼šåŠ å¿«åº”ç”¨ç¨‹åºæ‰§è¡Œçš„é€Ÿåº¦ã€‚&lt;/li>
&lt;li>åœ¨å¤šCPUç³»ç»Ÿä¸­ï¼Œå¤šçº¿ç¨‹æ˜¯æœ‰ç›Šçš„ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä¸€äº›å…¸å‹çš„ä¾‹å­æ¥ç†è§£å¼•å…¥çº¿ç¨‹çš„å¥½å¤„ï¼š&lt;/p>
&lt;ul>
&lt;li>å­—å¤„ç†è½¯ä»¶
&lt;ul>
&lt;li>ä¸€ä¸ªçº¿ç¨‹ä¸ç”¨æˆ·äº¤äº’&lt;/li>
&lt;li>ä¸€ä¸ªçº¿ç¨‹åœ¨åå°é‡æ–°è¿›è¡Œæ ¼å¼å¤„ç†&lt;/li>
&lt;li>ç¬¬ä¸‰ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†ç£ç›˜å¤‡ä»½&lt;/li>
&lt;li>è¿™ä¸ªä¾‹å­ç”¨ä¸‰ä¸ªä¸åŒçš„è¿›ç¨‹ä¸èƒ½åšåˆ°ï¼Œå› ä¸ºä¸‰ä¸ªçº¿ç¨‹ä¼šå¯¹åŒä¸€ä¸ªæ–‡ä»¶è¿›è¡Œæ“ä½œï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«å…¬å…±å†…å­˜ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ä¸‡ç»´ç½‘æœåŠ¡å™¨
&lt;ul>
&lt;li>åˆ†æ´¾ç¨‹åº&lt;/li>
&lt;li>å·¥ä½œçº¿ç¨‹&lt;/li>
&lt;li>é«˜é€Ÿç¼“å­˜&lt;/li>
&lt;li>çº¿ç¨‹è¾ƒå¥½åœ°æ”¹å–„äº†WebæœåŠ¡å™¨çš„æ€§èƒ½ï¼Œè€Œä¸”æ¯ä¸ªçº¿ç¨‹æ˜¯æŒ‰é€šå¸¸æ–¹å¼é¡ºåºç¼–ç¨‹çš„ã€‚&lt;/li>
&lt;li>ç¬¬ä¸‰ç§å¯èƒ½çš„è®¾è®¡ï¼šæœ‰é™çŠ¶æ€æœº&lt;/li>
&lt;li>ä¸‰ç§æ–¹æ¡ˆçš„æ¯”è¾ƒï¼Œè§P57 å›¾2-10&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å¿…é¡»å¤„ç†æå¤§é‡æ•°æ®çš„åº”ç”¨
&lt;ul>
&lt;li>ä¸€ä¸ªè¾“å…¥çº¿ç¨‹&lt;/li>
&lt;li>ä¸€ä¸ªå¤„ç†çº¿ç¨‹&lt;/li>
&lt;li>ä¸€ä¸ªè¾“å‡ºçº¿ç¨‹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="222-ç»å…¸çš„çº¿ç¨‹æ¨¡å‹">2.2.2 ç»å…¸çš„çº¿ç¨‹æ¨¡å‹
&lt;/h3>&lt;ul>
&lt;li>è¿›ç¨‹æ¨¡å‹åŸºäºä¸¤ç§ç‹¬ç«‹çš„æ¦‚å¿µï¼šèµ„æºåˆ†ç»„å¤„ç†ä¸æ‰§è¡Œã€‚&lt;/li>
&lt;li>ç†è§£è¿›ç¨‹çš„ä¸€ä¸ªè§’åº¦æ˜¯ï¼šç”¨æŸç§æ–¹æ³•æŠŠç›¸å…³çš„èµ„æºé›†ä¸­åœ¨ä¸€èµ·ã€‚&lt;/li>
&lt;li>è¿›ç¨‹æ‹¥æœ‰ä¸€ä¸ªæ‰§è¡Œçš„çº¿ç¨‹ï¼Œé€šå¸¸ç®€å†™ä¸º&lt;strong>çº¿ç¨‹&lt;/strong>ã€‚&lt;/li>
&lt;li>è¿›ç¨‹ç”¨äºæŠŠèµ„æºé›†ä¸­åˆ°ä¸€èµ·ï¼Œè€Œçº¿ç¨‹åˆ™æ˜¯åœ¨CPUä¸Šè¢«è°ƒåº¦æ‰§è¡Œçš„å®ä½“ã€‚&lt;/li>
&lt;li>çº¿ç¨‹ç»™è¿›ç¨‹æ¨¡å‹å¢åŠ äº†ä¸€é¡¹å†…å®¹ï¼Œå³åœ¨åŒä¸€ä¸ªè¿›ç¨‹ç¯å¢ƒä¸‹ï¼Œå…è®¸å½¼æ­¤ä¹‹é—´æœ‰è¾ƒå¤§ç‹¬ç«‹æ€§çš„å¤šä¸ªçº¿ç¨‹æ‰§è¡Œã€‚&lt;/li>
&lt;li>åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­è¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä¸ªåœ°å€ç©ºé—´å’Œå…¶ä»–èµ„æºï¼Œè€Œåœ¨åŒä¸€ä¸ªè®¡ç®—æœºä¸Šè¿è¡Œå¤šä¸ªè¿›ç¨‹ï¼Œå¤šä¸ªè¿›ç¨‹å…±äº«ç‰©ç†å†…å­˜ã€ç£ç›˜ã€æ‰“å°æœºå’Œå…¶ä»–èµ„æºï¼Œå› æ­¤çº¿ç¨‹ä¹Ÿè¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹ã€‚&lt;/li>
&lt;li>å½“å¤šçº¿ç¨‹è¿›ç¨‹åœ¨å•CPUç³»ç»Ÿä¸­è¿è¡Œæ—¶ï¼Œçº¿ç¨‹è½®æµè¿è¡Œã€‚CPUåœ¨çº¿ç¨‹ä¹‹é—´çš„å¿«é€Ÿåˆ‡æ¢ï¼Œåˆ¶é€ äº†çº¿ç¨‹å¹¶è¡Œè¿è¡Œçš„å‡è±¡ã€‚&lt;/li>
&lt;li>æ‰€æœ‰çš„çº¿ç¨‹éƒ½æœ‰å®Œå…¨ä¸€æ ·çš„åœ°å€ç©ºé—´ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¹Ÿå…±äº«åŒæ ·çš„å…¨å±€å˜é‡ã€‚ç”±äºå„ä¸ªçº¿ç¨‹éƒ½å¯ä»¥è®¿é—®è¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„æ¯ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œæ‰€ä»¥ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¯»ã€å†™æˆ–ç”šè‡³æ¸…æ¥šå¦ä¸€ä¸ªçº¿ç¨‹çš„å †æ ˆã€‚çº¿ç¨‹ä¹‹é—´æ˜¯æ²¡æœ‰ä¿æŠ¤çš„ã€‚&lt;/li>
&lt;li>çº¿ç¨‹æ¦‚å¿µè¯•å›¾å®ç°çš„æ˜¯ï¼Œå…±äº«ä¸€ç»„èµ„æºçš„å¤šä¸ªçº¿ç¨‹çš„æ‰§è¡Œèƒ½åŠ›ï¼Œä»¥ä¾¿è¿™äº›çº¿ç¨‹å¯ä»¥ä¸ºå®ŒæˆæŸä¸€ä»»åŠ¡è€Œå…±åŒå·¥ä½œã€‚&lt;/li>
&lt;li>çº¿ç¨‹å¯ä»¥å¤„äºè‹¥å¹²çŠ¶æ€çš„ä»»ä½•ä¸€ä¸ªï¼šè¿è¡Œã€é˜»å¡ã€å°±ç»ªæˆ–ç»ˆæ­¢ã€‚çº¿ç¨‹çŠ¶æ€ä¹‹é—´çš„è½¬æ¢å’Œè¿›ç¨‹çŠ¶æ€ä¹‹é—´çš„è½¬æ¢ä¼¼ä¹ä¸€æ ·çš„ã€‚&lt;/li>
&lt;li>è®¤è¯†åˆ°æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„å †æ ˆå¾ˆé‡è¦ã€‚æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆæœ‰ä¸€å¸§ï¼Œä¾›å„ä¸ªè¢«è°ƒç”¨ä½†æ˜¯è¿˜æ²¡æœ‰ä»ä¸­è¿”å›çš„è¿‡ç¨‹ä½¿ç”¨ã€‚åœ¨è¯¥æ ˆå¸§ä¸­å­˜æ”¾äº†ç›¸åº”è¿‡ç¨‹çš„å±€éƒ¨å˜é‡ä»¥åŠè¿‡ç¨‹è°ƒç”¨å®Œä¹‹åä½¿ç”¨çš„è¿”å›åœ°å€ã€‚é€šå¸¸æ¯ä¸ªçº¿ç¨‹ä¼šè°ƒç”¨ä¸åŒçš„è¿‡ç¨‹ï¼Œä»è€Œæœ‰ä¸€ä¸ªå„è‡ªä¸åŒçš„æ‰§è¡Œå†å²ã€‚&lt;/li>
&lt;li>è¿›ç¨‹é€šå¸¸ä¼šä»å½“å‰çš„å•ä¸ªçº¿ç¨‹å¼€å§‹ï¼Œè¿™ä¸ªçº¿ç¨‹æœ‰èƒ½åŠ›é€šè¿‡è°ƒç”¨ä¸€ä¸ªåº“å‡½æ•°ï¼ˆå¦‚ thread_create ï¼‰åˆ›å»ºæ–°çš„çº¿ç¨‹ã€‚ä¸è®ºçº¿ç¨‹ä¹‹é—´æœ‰æ— å±‚æ¬¡å…³ç³»ï¼Œåˆ›å»ºçº¿ç¨‹é€šå¸¸éƒ½è¿”å›ä¸€ä¸ªçº¿ç¨‹æ ‡è¯†ç¬¦ï¼Œè¯¥æ ‡è¯†ç¬¦å°±æ˜¯æ–°çº¿ç¨‹çš„åå­—ã€‚&lt;/li>
&lt;li>çº¿ç¨‹é€€å‡ºï¼šthread_exit&lt;/li>
&lt;li>thread_joinï¼šä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç­‰å¾…ä¸€ä¸ªï¼ˆç‰¹å®šï¼‰çº¿ç¨‹é€€å‡ºã€‚&lt;/li>
&lt;li>thread_yieldï¼šå…è®¸çº¿ç¨‹è‡ªåŠ¨æ”¾å¼ƒCPUä»è€Œè®©å¦ä¸€ä¸ªçº¿ç¨‹è¿è¡Œã€‚è¿™æ ·ä¸€ä¸ªè°ƒç”¨æ˜¯å¾ˆé‡è¦çš„ï¼Œå› ä¸ºä¸åŒäºè¿›ç¨‹ï¼Œï¼ˆçº¿ç¨‹åº“ï¼‰æ— æ³•åˆ©ç”¨æ—¶é’Ÿä¸­æ–­å¼ºåˆ¶çº¿ç¨‹è®©å‡ºCPUã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="223-posixçº¿ç¨‹">2.2.3 POSIXçº¿ç¨‹
&lt;/h3>&lt;p>çº¿ç¨‹åŒ… pthreadã€‚&lt;/p>
&lt;ul>
&lt;li>pthread_create&lt;/li>
&lt;li>pthread_exit&lt;/li>
&lt;li>pthread_join&lt;/li>
&lt;li>pthread_yield&lt;/li>
&lt;li>pthread_attr_initï¼šåˆ›å»ºå¹¶åˆå§‹åŒ–ä¸€ä¸ªçº¿ç¨‹çš„å±æ€§ç»“æ„&lt;/li>
&lt;li>pthread_attr_destroyï¼šåˆ é™¤ä¸€ä¸ªçº¿ç¨‹çš„å±æ€§ç»“æ„&lt;/li>
&lt;/ul>
&lt;h3 id="224-åœ¨ç”¨æˆ·ç©ºé—´ä¸­å®ç°çº¿ç¨‹">2.2.4 åœ¨ç”¨æˆ·ç©ºé—´ä¸­å®ç°çº¿ç¨‹
&lt;/h3>&lt;p>&lt;strong>ä¼˜ç‚¹&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>ç”¨æˆ·çº§çº¿ç¨‹å¯ä»¥åœ¨ä¸æ”¯æŒå¤šçº¿ç¨‹çš„æ“ä½œç³»ç»Ÿä¸Šå®ç°ã€‚&lt;/li>
&lt;li>è¿›è¡Œçº¿ç¨‹åˆ‡æ¢æ¯”é™·å…¥å†…æ ¸è¦å¿«ä¸€ä¸ªæ•°é‡çº§ï¼ˆæˆ–è®¸æ›´å¤šï¼‰ã€‚&lt;/li>
&lt;li>ä¿å­˜çº¿ç¨‹çŠ¶æ€çš„è¿‡ç¨‹å’Œè°ƒåº¦ç¨‹åºéƒ½åªæ˜¯æœ¬åœ°è¿‡ç¨‹ï¼Œæ‰€ä»¥å¯åŠ¨å®ƒä»¬æ¯”è¿›è¡Œå†…æ ¸è°ƒç”¨æ•ˆç‡æ›´é«˜ã€‚å¦ä¸€æ–¹é¢ï¼Œä¸éœ€è¦é™·å…¥å†…æ ¸ï¼Œä¸éœ€è¦ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¹Ÿä¸éœ€è¦å¯¹å†…å­˜é«˜é€Ÿç¼“å­˜è¿›è¡Œåˆ·æ–°ï¼Œè¿™å°±ä½¿å¾—çº¿ç¨‹è°ƒåº¦éå¸¸å¿«æ·ã€‚&lt;/li>
&lt;li>å®ƒè¿è¡Œæ¯ä¸ªè¿›ç¨‹æœ‰è‡ªå·±å®šåˆ¶çš„è°ƒåº¦ç®—æ³•ã€‚&lt;/li>
&lt;li>ç”¨æˆ·çº§çº¿ç¨‹è¿˜æœ‰è¾ƒå¥½çš„æ‰©å±•æ€§ï¼Œè¿™æ˜¯å› ä¸ºåœ¨å†…æ ¸ç©ºé—´ä¸­å†…æ ¸çº¿ç¨‹éœ€è¦ä¸€äº›å›ºå®šè¡¨æ ¼ç©ºé—´å’Œå †æ ˆç©ºé—´ï¼Œå¦‚æœå†…æ ¸çº¿ç¨‹çš„æ•°é‡éå¸¸å¤§ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>åœ¨ç”¨æˆ·ç©ºé—´å®ç°å¤šçº¿ç¨‹ï¼Œçº¿ç¨‹åœ¨ä¸€ä¸ªè¿è¡Œæ—¶ç³»ç»Ÿçš„ä¸Šå±‚è¿è¡Œï¼Œè¯¥è¿è¡Œæ—¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªç®¡ç†çº¿ç¨‹çš„è¿‡ç¨‹çš„é›†åˆã€‚&lt;/li>
&lt;li>åœ¨ç”¨æˆ·ç©ºé—´ç®¡ç†çº¿ç¨‹æ—¶ï¼Œæ¯ä¸ªè¿›ç¨‹éœ€è¦æœ‰å…¶ä¸“ç”¨çš„çº¿ç¨‹è¡¨ï¼Œç”¨æ¥è·Ÿè¸ªè¯¥è¿›ç¨‹ä¸­çš„çº¿ç¨‹ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ç”¨æˆ·çº§çº¿ç¨‹å‡ºç°çš„é—®é¢˜&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>å¦‚ä½•å®ç°é˜»å¡ç³»ç»Ÿè°ƒç”¨ã€‚æ›¿ä»£æ–¹æ¡ˆæ˜¯æå‰é€šçŸ¥ã€‚&lt;/li>
&lt;li>å¦‚æœä¸€ä¸ªçº¿ç¨‹å¼€å§‹è¿è¡Œï¼Œé‚£ä¹ˆåœ¨è¯¥è¿›ç¨‹ä¸­çš„å…¶ä»–çº¿ç¨‹å°±ä¸èƒ½è¿è¡Œã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="225-åœ¨å†…æ ¸ä¸­å®ç°çº¿ç¨‹">2.2.5 åœ¨å†…æ ¸ä¸­å®ç°çº¿ç¨‹
&lt;/h3>&lt;ul>
&lt;li>åœ¨å†…æ ¸ä¸­æœ‰ç”¨æ¥è®°å½•ç³»ç»Ÿä¸­æ‰€æœ‰çº¿ç¨‹çš„çº¿ç¨‹è¡¨ã€‚&lt;/li>
&lt;li>å†…æ ¸çš„çº¿ç¨‹è¡¨ä¿å­˜äº†æ¯ä¸ªçº¿ç¨‹çš„å¯„å­˜å™¨ã€çŠ¶æ€å’Œå…¶ä»–ä¿¡æ¯ã€‚&lt;/li>
&lt;li>æ‰€æœ‰èƒ½å¤Ÿé˜»å¡çº¿ç¨‹çš„è°ƒç”¨éƒ½ä»¥ç³»ç»Ÿè°ƒç”¨çš„å½¢å¼å®ç°ï¼Œè¿™ä¸è¿è¡Œæ—¶ç³»ç»Ÿè¿‡ç¨‹ç›¸æ¯”ï¼Œä»£ä»·æ˜¯ç›¸å½“å¯è§‚çš„ã€‚&lt;/li>
&lt;li>ç”±äºåœ¨å†…æ ¸ä¸­åˆ›å»ºå’Œæ’¤é”€çº¿ç¨‹çš„ä»£ä»·æ¯”è¾ƒå¤§ï¼ŒæŸäº›ç³»ç»Ÿé‡‡å–â€œç¯ä¿â€çš„å¤„ç†æ–¹å¼ï¼Œå›æ”¶å…¶çº¿ç¨‹ã€‚&lt;/li>
&lt;li>å†…æ ¸çº¿ç¨‹ä¸éœ€è¦ä»»ä½•æ–°çš„ã€éé˜»å¡ç³»ç»Ÿè°ƒç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="226-æ··åˆå®ç°">2.2.6 æ··åˆå®ç°
&lt;/h3>&lt;ul>
&lt;li>ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨å†…æ ¸çº§çº¿ç¨‹ï¼Œç„¶åå°†ç”¨æˆ·çº§çº¿ç¨‹ä¸æŸäº›æˆ–è€…å…¨éƒ¨å†…æ ¸çº¿ç¨‹å¤šè·¯å¤ç”¨èµ·æ¥ã€‚åœ¨è¿™ç§æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªå†…æ ¸çº§çº¿ç¨‹æœ‰ä¸€ä¸ªå¯ä»¥è½®æµä½¿ç”¨çš„ç”¨æˆ·çº§çº¿ç¨‹é›†åˆã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="227-è°ƒåº¦ç¨‹åºæ¿€æ´»æœºåˆ¶">2.2.7 è°ƒåº¦ç¨‹åºæ¿€æ´»æœºåˆ¶
&lt;/h3>&lt;ul>
&lt;li>è°ƒåº¦ç¨‹åºæ¿€æ´»å·¥ä½œçš„ç›®æ ‡æ˜¯æ¨¡æ‹Ÿå†…æ ¸çº¿ç¨‹çš„åŠŸèƒ½ï¼Œä½†æ˜¯ä¸ºçº¿ç¨‹åŒ…æä¾›é€šå¸¸åœ¨ç”¨æˆ·ç©ºé—´ä¸­æ‰èƒ½å®ç°çš„æ›´å¥½çš„æ€§èƒ½å’Œæ›´å¤§çš„çµæ´»æ€§ã€‚&lt;/li>
&lt;li>ç”±äºé¿å…äº†åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´çš„ä¸å¿…è¦è½¬æ¢ï¼Œä»è€Œæé«˜äº†æ•ˆç‡ã€‚&lt;/li>
&lt;li>å½“ä½¿ç”¨è°ƒåº¦ç¨‹åºæ¿€æ´»æœºåˆ¶æ—¶ï¼Œå†…æ ¸ç»™æ¯ä¸ªè¿›ç¨‹å®‰æ’ä¸€å®šæ•°é‡çš„è™šæ‹Ÿå¤„ç†å™¨ï¼Œå¹¶ä¸”è®©ï¼ˆç”¨æˆ·ç©ºé—´ï¼‰è¿è¡Œæ—¶ç³»ç»Ÿå°†çº¿ç¨‹åˆ†é…åˆ°å¤„ç†å™¨ä¸Šã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="228-å¼¹å‡ºå¼çº¿ç¨‹">2.2.8 å¼¹å‡ºå¼çº¿ç¨‹
&lt;/h3>&lt;p>ä¸€ä¸ªæ¶ˆæ¯çš„åˆ°è¾¾å¯¼è‡´ç³»ç»Ÿåˆ›å»ºä¸€ä¸ªå¤„ç†è¯¥æ¶ˆæ¯çš„çº¿ç¨‹ï¼Œè¿™ç§çº¿ç¨‹ç§°ä¸ºå¼¹å‡ºå¼çº¿ç¨‹ã€‚&lt;/p>
&lt;h3 id="229-ä½¿å•çº¿ç¨‹ä»£ç å¤šçº¿ç¨‹åŒ–">2.2.9 ä½¿å•çº¿ç¨‹ä»£ç å¤šçº¿ç¨‹åŒ–
&lt;/h3>&lt;p>ç•¥&lt;/p>
&lt;h2 id="23-è¿›ç¨‹é—´é€šä¿¡">2.3 è¿›ç¨‹é—´é€šä¿¡
&lt;/h2>&lt;p>è¿›ç¨‹é—´é€šä¿¡ï¼šInter Process Communication, IPCã€‚&lt;/p>
&lt;p>è¿›ç¨‹é—´é€šä¿¡ä¸»è¦è¦è§£å†³ä¸‰ä¸ªé—®é¢˜ï¼š&lt;/p>
&lt;ol>
&lt;li>ä¸€ä¸ªè¿›ç¨‹å¦‚ä½•æŠŠä¿¡æ¯ä¼ é€’ç»™å¦ä¸€ä¸ªã€‚&lt;/li>
&lt;li>ç¡®ä¿ä¸¤ä¸ªæˆ–æ›´å¤šçš„è¿›ç¨‹åœ¨å…³é”®æ´»åŠ¨ä¸­ä¸ä¼šå‡ºç°äº¤å‰ã€‚&lt;/li>
&lt;li>ä¸æ­£ç¡®çš„é¡ºåºæœ‰å…³ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="231-ç«äº‰æ¡ä»¶">2.3.1 ç«äº‰æ¡ä»¶
&lt;/h3>&lt;p>&lt;strong>ç«äº‰æ¡ä»¶&lt;/strong>ï¼šä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹è¯»å†™æŸäº›å…±äº«æ•°æ®ï¼Œè€Œæœ€åçš„ç»“æœå–å†³äºè¿›ç¨‹è¿è¡Œçš„ç²¾ç¡®æ—¶åºã€‚ä¾‹å¦‚ä¹¦ä¸­ä¸¾çš„è„±æœºæ‰“å°çš„ä¾‹å­ã€‚&lt;/p>
&lt;h3 id="232-ä¸´ç•ŒåŒº">2.3.2 ä¸´ç•ŒåŒº
&lt;/h3>&lt;ul>
&lt;li>é¿å…ç«äº‰æ¡ä»¶éœ€è¦&lt;strong>äº’æ–¥&lt;/strong>ï¼Œå³ä»¥æŸç§æ‰‹æ®µç¡®ä¿å½“ä¸€ä¸ªè¿›ç¨‹åœ¨ä½¿ç”¨ä¸€ä¸ªå…±äº«å˜é‡æˆ–æ–‡ä»¶æ—¶ï¼Œå…¶ä»–è¿›ç¨‹ä¸èƒ½åšåŒæ ·çš„æ“ä½œã€‚&lt;/li>
&lt;li>å¯¹å…±äº«å†…å­˜è¿›è¡Œè®¿é—®çš„ç¨‹åºç‰‡æ®µç§°ä½œ&lt;strong>ä¸´ç•ŒåŒºåŸŸ&lt;/strong>æˆ–&lt;strong>ä¸´ç•ŒåŒº&lt;/strong>ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿé€‚å½“åœ°å®‰æ’ï¼Œä½¿å¾—ä¸¤ä¸ªè¿›ç¨‹ä¸å¯èƒ½åŒæ—¶å¤„äºä¸´ç•ŒåŒºä¸­ï¼Œå°±èƒ½é¿å…ç«äº‰æ¡ä»¶ã€‚&lt;/li>
&lt;li>ä¸€ä¸ªå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶ï¼š
&lt;ol>
&lt;li>ä»»ä½•ä¸¤ä¸ªè¿›ç¨‹ä¸èƒ½åŒæ—¶å¤„äºå…¶ä¸´ç•ŒåŒºã€‚&lt;/li>
&lt;li>ä¸åº”å¯¹CPUçš„é€Ÿåº¦å’Œæ•°é‡åšä»»ä½•å‡è®¾ã€‚&lt;/li>
&lt;li>ä¸´ç•ŒåŒºå¤–è¿è¡Œçš„è¿›ç¨‹ä¸å¾—é˜»å¡å…¶ä»–è¿›ç¨‹ã€‚&lt;/li>
&lt;li>ä¸å¾—ä½¿è¿›ç¨‹æ— é™æœŸç­‰å¾…è¿›å…¥ä¸´ç•ŒåŒºã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;h3 id="233-å¿™ç­‰å¾…çš„äº’æ–¥">2.3.3 å¿™ç­‰å¾…çš„äº’æ–¥
&lt;/h3>&lt;h4 id="1å±è”½ä¸­æ–­">1.å±è”½ä¸­æ–­
&lt;/h4>&lt;ul>
&lt;li>åœ¨å•å¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿æ¯ä¸ªè¿›ç¨‹åœ¨åˆšåˆšè¿›å…¥ä¸´ç•ŒåŒºåç«‹å³å±è”½æ‰€æœ‰ä¸­æ–­ï¼Œå¹¶åœ¨å°±è¦ç¦»å¼€ä¹‹å‰å†æ‰“å¼€ä¸­æ–­ã€‚&lt;/li>
&lt;li>è¿™ä¸ªæ–¹æ³•å¹¶ä¸å¥½ã€‚å±è”½ä¸­æ–­å¯¹äºæ“ä½œç³»ç»Ÿæœ¬èº«è€Œè¨€æ˜¯ä¸€é¡¹å¾ˆæœ‰ç”¨çš„æŠ€æœ¯ï¼Œä½†å¯¹äºç”¨æˆ·è¿›ç¨‹åˆ™ä¸æ˜¯ä¸€ç§åˆé€‚çš„é€šç”¨äº’æ–¥æœºåˆ¶ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="2é”å˜é‡">2.é”å˜é‡
&lt;/h4>&lt;ul>
&lt;li>è®¾æƒ³æœ‰ä¸€ä¸ªå…±äº«ï¼ˆé”ï¼‰å˜é‡ï¼Œå…¶åˆå§‹å€¼ä¸º0ã€‚0å°±è¡¨ç¤ºä¸´ç•ŒåŒºå†…æ²¡æœ‰è¿›ç¨‹ï¼Œ1è¡¨ç¤ºå·²ç»æœ‰æŸä¸ªè¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒºã€‚&lt;/li>
&lt;li>ç–æ¼ä¹‹å¤„ï¼šä¸€ä¸ªè¿›ç¨‹è¯»å‡ºé”å˜é‡çš„å€¼ä¸º0ï¼Œåœ¨å°†å®ƒè®¾ä¸º1ä¹‹å‰ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹è¢«è°ƒåº¦è¿è¡Œï¼Œå°†è¯¥é”å˜é‡è®¾ç½®ä¸º1ã€‚ç¬¬ä¸€ä¸ªè¿›ç¨‹å†æ¬¡è¿è¡Œï¼Œå°†é”å˜é‡è®¾ç½®ä¸º1ï¼Œè¿™æ ·å°±æœ‰ä¸¤ä¸ªè¿›ç¨‹åœ¨ä¸´ç•ŒåŒºä¸­ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="3ä¸¥æ ¼è½®æ¢æ³•">3.ä¸¥æ ¼è½®æ¢æ³•
&lt;/h4>&lt;ul>
&lt;li>å¯¹äºç¼–å†™æ“ä½œç³»ç»Ÿè€Œè¨€ï¼ŒCè¯­è¨€æ˜¯å¼ºå¤§ã€æœ‰æ•ˆã€å¯é¢„çŸ¥å’Œæœ‰ç‰¹æ€§çš„è¯­è¨€ã€‚&lt;/li>
&lt;li>è¿ç»­æµ‹è¯•ä¸€ä¸ªå˜é‡ç›´åˆ°æŸä¸ªå€¼å‡ºç°ä¸ºæ­¢ï¼Œç§°ä¸º&lt;strong>å¿™ç­‰å¾…&lt;/strong>ã€‚&lt;/li>
&lt;li>ç”±äºè¿™ç§æ–¹å¼æµªè´¹CPUæ—¶é—´ï¼Œæ‰€ä»¥é€šå¸¸åº”è¯¥é¿å…ã€‚åªæœ‰åœ¨æœ‰ç†ç”±è®¤ä¸º&lt;strong>ç­‰å¾…æ—¶é—´éå¸¸çŸ­&lt;/strong>çš„æƒ…å½¢ä¸‹ï¼Œæ‰ä½¿ç”¨å¿™ç­‰å¾…ã€‚ç”¨äºå¿™ç­‰å¾…çš„é”ï¼Œç§°ä¸º&lt;strong>è‡ªæ—‹é”&lt;/strong>ã€‚&lt;/li>
&lt;li>ç¼ºç‚¹ï¼šåœ¨ä¸€ä¸ªè¿›ç¨‹æ¯”å¦ä¸€ä¸ªæ…¢äº†å¾ˆå¤šçš„æƒ…å†µä¸‹ï¼Œè½®æµè¿›å…¥ä¸´ç•ŒåŒºå¹¶ä¸æ˜¯ä¸€ä¸ªå¥½åŠæ³•ã€‚è¿™ç§æƒ…å†µè¿åäº†å‰é¢å™è¿°çš„æ¡ä»¶3:è¿›ç¨‹0è¢«ä¸€ä¸ªä¸´ç•ŒåŒºä¹‹å¤–çš„è¿›ç¨‹é˜»å¡ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="4petersonè§£æ³•">4.Petersonè§£æ³•
&lt;/h4>&lt;p>ç•¥&lt;/p>
&lt;h4 id="5-tslæŒ‡ä»¤">5. TSLæŒ‡ä»¤
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">TSL RX,LOCK
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™æ¡æŒ‡ä»¤ç§°ä¸º&lt;strong>æµ‹è¯•å¹¶åŠ é”&lt;/strong>ï¼ˆtest and set lockï¼‰ï¼Œå®ƒå°†ä¸€ä¸ªå†…å­˜å­—lockè¯»åˆ°å¯„å­˜å™¨RXä¸­ï¼Œç„¶ååœ¨è¯¥å†…å­˜åœ°å€ä¸Šå­˜ä¸€ä¸ªéé›¶å€¼ã€‚æ‰§è¡ŒTSLæŒ‡ä»¤çš„CPUå°†é”ä½å†…å­˜æ€»çº¿ï¼Œä»¥ç¦æ­¢å…¶ä»–CPUåœ¨æœ¬æŒ‡ä»¤ç»“æŸä¹‹å‰è®¿é—®å†…å­˜ã€‚&lt;/p>
&lt;ul>
&lt;li>é”ä½å­˜å‚¨æ€»çº¿ä¸åŒäºå±è”½ä¸­æ–­ã€‚äº‹å®ä¸Šï¼Œåœ¨å¤„ç†å™¨1ä¸Šå±è”½ä¸­æ–­å¯¹å¤„ç†å™¨2æ ¹æœ¬æ²¡æœ‰ä»»ä½•å½±å“ã€‚è®©å¤„ç†å™¨2è¿œç¦»å†…å­˜ç›´åˆ°å¤„ç†å™¨1å®Œæˆçš„å”¯ä¸€æ–¹æ³•å°±æ˜¯é”ä½æ€»çº¿ï¼Œè¿™éœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„ç¡¬ä»¶è®¾æ–½ã€‚&lt;/li>
&lt;li>ä¸ºäº†ä½¿ç”¨TSLæŒ‡ä»¤ï¼Œè¦ä½¿ç”¨ä¸€ä¸ªå…±äº«å˜é‡lockæ¥åè°ƒå¯¹å…±äº«å†…å­˜çš„è®¿é—®ã€‚&lt;/li>
&lt;li>è¿›ç¨‹åœ¨è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰å…ˆè°ƒç”¨enter_regionï¼Œè¿™å°†å¯¼è‡´å¿™ç­‰å¾…ï¼Œç›´åˆ°é”ç©ºé—²ä¸ºæ­¢ï¼Œéšåå®ƒè·å¾—è¯¥é”å¹¶è¿”å›ã€‚åœ¨è¿›ç¨‹ä»ä¸´ç•ŒåŒºè¿”å›æ—¶å®ƒè°ƒç”¨leave_regionï¼Œè¿™å°†æŠŠlockè®¾ç½®ä¸º0ã€‚è¿›ç¨‹å¿…é¡»åœ¨æ­£ç¡®çš„æ—¶é—´è°ƒç”¨enter_regionå’Œleave_regionï¼Œè§£æ³•æ‰èƒ½å¥æ•ˆã€‚&lt;/li>
&lt;li>ä¸€ä¸ªå¯æ›¿ä»£TSLæŒ‡ä»¤çš„æ˜¯XCHGï¼Œå®ƒåŸå­æ€§åœ°äº¤æ¢äº†ä¸¤ä¸ªä½ç½®çš„å†…å®¹ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="234-ç¡çœ ä¸å”¤é†’">2.3.4 ç¡çœ ä¸å”¤é†’
&lt;/h3>&lt;ul>
&lt;li>Petersonè§£æ³•å’ŒTSLæˆ–XCHGè§£æ³•éƒ½æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯å®ƒä»¬éƒ½æœ‰å¿™ç­‰å¾…çš„ç¼ºç‚¹ã€‚è¿™äº›è§£æ³•çš„æœ¬è´¨ï¼šå½“ä¸€ä¸ªè¿›ç¨‹æƒ³è¿›å…¥ä¸´ç•ŒåŒºï¼Œå…ˆæ£€æŸ¥æ˜¯å¦å…è®¸è¿›å…¥ï¼Œè‹¥ä¸å…è®¸ï¼Œåˆ™è¯¥è¿›ç¨‹å°†åŸåœ°ç­‰å¾…ï¼Œç›´åˆ°å…è®¸ä¸ºæ­¢ã€‚è€ƒè™‘ä¼˜å…ˆçº§åè½¬é—®é¢˜ã€‚&lt;/li>
&lt;li>è¿›ç¨‹é—´é€šä¿¡åŸè¯­ï¼šsleepå’Œwakeupã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜">ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜
&lt;/h4>&lt;ul>
&lt;li>ä¸¤ä¸ªè¿›ç¨‹å…±äº«ä¸€ä¸ªå…¬å…±çš„å›ºå®šå¤§å°çš„ç¼“å†²åŒºã€‚å…¶ä¸­ä¸€ä¸ªæ˜¯ç”Ÿäº§è€…ï¼Œå°†ä¿¡æ¯æ”¾å…¥ç¼“å†²åŒºï¼›å¦ä¸€ä¸ªæ˜¯æ¶ˆè´¹è€…ï¼Œä»ç¼“å†²åŒºä¸­å–å‡ºä¿¡æ¯ã€‚&lt;/li>
&lt;li>é—®é¢˜åœ¨äºå½“ç¼“å†²åŒºå·²æ»¡ï¼Œè€Œæ­¤æ—¶ç”Ÿäº§è€…è¿˜æƒ³å‘å…¶ä¸­æ”¾å…¥ä¸€ä¸ªæ–°çš„æ•°æ®é¡¹çš„æƒ…å†µã€‚å…¶è§£å†³åŠæ³•æ˜¯è®©ç”Ÿäº§è€…ç¡çœ ï¼Œå¾…æ¶ˆè´¹è€…ä»ç¼“å†²åŒºä¸­å–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®é¡¹æ—¶å†å”¤é†’å®ƒã€‚åŒæ ·åœ°ï¼Œå½“æ¶ˆè´¹è€…è¯•å›¾ä»ç¼“å†²åŒºä¸­å–æ•°æ®è€Œå‘ç°ç¼“å†²åŒºä¸ºç©ºæ—¶ï¼Œæ¶ˆè´¹è€…å°±ç¡çœ ï¼Œç›´åˆ°ç”Ÿäº§è€…å‘å…¶ä¸­æ”¾å…¥ä¸€äº›æ•°æ®æ—¶å†å°†å…¶å”¤é†’ã€‚&lt;/li>
&lt;li>è¿™é‡Œæœ‰å¯èƒ½ä¼šå‡ºç°ç«äº‰æ¡ä»¶ï¼Œå…¶åŸå› æ˜¯å¯¹countçš„è®¿é—®æœªåŠ é™åˆ¶ã€‚&lt;/li>
&lt;li>é—®é¢˜çš„å®è´¨åœ¨äºå‘ç»™ä¸€ä¸ªï¼ˆå°šï¼‰æœªç¡çœ è¿›ç¨‹çš„wakeupä¿¡å·ä¸¢å¤±äº†ã€‚å¿«é€Ÿå¼¥è¡¥çš„æ–¹æ³•æ˜¯ä¿®æ”¹è§„åˆ™ï¼ŒåŠ ä¸Šä¸€ä¸ª&lt;strong>å”¤é†’ç­‰å¾…ä½&lt;/strong>ã€‚å”¤é†’ç­‰å¾…ä½å®é™…ä¸Šå°±æ˜¯wakeupä¿¡å·çš„ä¸€ä¸ªå°ä»“åº“ã€‚ä½†åŸåˆ™ä¸Šï¼Œè¿™å¹¶æ²¡æœ‰ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="235-ä¿¡å·é‡">2.3.5 ä¿¡å·é‡
&lt;/h3>&lt;ul>
&lt;li>ä½¿ç”¨ä¸€ä¸ªæ•´å‹å˜é‡æ¥ç´¯è®¡å”¤é†’æ¬¡æ•°ï¼Œä¾›ä»¥åä½¿ç”¨ï¼Œç§°ä½œä¿¡å·é‡ã€‚&lt;/li>
&lt;li>è®¾ç«‹ä¸¤ä¸ªæ“ä½œdown (Pæ“ä½œ) å’Œup (Væ“ä½œ)ï¼ˆåˆ†åˆ«ä¸ºä¸€èˆ¬åŒ–åçš„sleepå’Œwakeupï¼‰ã€‚&lt;/li>
&lt;li>æ£€æŸ¥æ•°å€¼ã€ä¿®æ”¹å˜é‡å€¼ä»¥åŠå¯èƒ½å‘ç”Ÿçš„ç¡çœ æ“ä½œå‡ä½œä¸ºä¸€ä¸ªå•ä¸€çš„ã€ä¸å¯åˆ†å‰²çš„åŸå­æ“ä½œå®Œæˆã€‚&lt;/li>
&lt;li>æ‰€è°“åŸå­æ“ä½œï¼Œæ˜¯æŒ‡ä¸€ç»„ç›¸å…³è”çš„æ“ä½œè¦ä¹ˆä¸é—´æ–­åœ°æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚&lt;/li>
&lt;li>upæ“ä½œå¯¹ä¿¡å·é‡çš„å€¼å¢1ã€‚&lt;/li>
&lt;li>å¦‚æœä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹åœ¨è¯¥ä¿¡å·é‡ä¸Šç¡çœ ï¼Œæ— æ³•å®Œæˆä¸€ä¸ªå…ˆå‰çš„downæ“ä½œï¼Œåˆ™ç”±ç³»ç»Ÿé€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªï¼ˆå¦‚éšæœºæŒ‘é€‰ï¼‰å¹¶å…è®¸è¯¥è¿›ç¨‹å®Œæˆå®ƒçš„downæ“ä½œã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="ç”¨ä¿¡å·é‡è§£å†³ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜">ç”¨ä¿¡å·é‡è§£å†³ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜
&lt;/h4>&lt;ul>
&lt;li>ä¸ºç¡®ä¿ä¿¡å·é‡èƒ½æ­£ç¡®å·¥ä½œï¼Œæœ€é‡è¦çš„æ˜¯è¦é‡‡ç”¨ä¸€ç§ä¸å¯åˆ†å‰²çš„æ–¹å¼æ¥å®ç°å®ƒã€‚&lt;/li>
&lt;li>è¯¥æ–¹æ¡ˆä½¿ç”¨äº†ä¸‰ä¸ªä¿¡å·é‡ï¼š
&lt;ul>
&lt;li>fullï¼šç”¨æ¥è®°å½•å……æ»¡çš„ç¼“å†²æ§½æ•°ç›®ï¼›&lt;/li>
&lt;li>emptyï¼šè®°å½•ç©ºçš„ç¼“å†²æ§½çš„æ•°ç›®ï¼›&lt;/li>
&lt;li>mutexï¼šç”¨æ¥ç¡®ä¿ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸ä¼šåŒæ—¶è®¿é—®ç¼“å†²åŒºã€‚å¦‚æœæ¯ä¸ªè¿›ç¨‹åœ¨è¿›å…¥ä¸´ç•ŒåŒºå‰éƒ½æ‰§è¡Œä¸€ä¸ªdownæ“ä½œï¼Œå¹¶åœ¨åˆšåˆšé€€å‡ºæ—¶æ‰§è¡Œä¸€ä¸ªupæ“ä½œï¼Œå°±èƒ½å¤Ÿå®ç°äº’æ–¥ã€‚è¯¥ä¿¡å·é‡ç”¨æˆ·äº’æ–¥ï¼Œä¿è¯ä»»ä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¿›ç¨‹è¯»å†™ç¼“å†²åŒºå’Œç›¸å…³å˜é‡ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>fullå’Œemptyç”¨æ¥ä¿è¯æŸç§äº‹ä»¶çš„é¡ºåºå‘ç”Ÿæˆ–ä¸å‘ç”Ÿã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="236-äº’æ–¥é‡">2.3.6 äº’æ–¥é‡
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>äº’æ–¥é‡&lt;/strong>ä»…ä»…é€‚ç”¨äºç®¡ç†å…±äº«èµ„æºæˆ–ä¸€å°æ®µä»£ç ã€‚&lt;/li>
&lt;li>äº’æ–¥é‡æ˜¯ä¸€ä¸ªå¯ä»¥å¤„äºä¸¤æ€ä¹‹ä¸€çš„å˜é‡ï¼šè§£é”å’ŒåŠ é”ã€‚&lt;/li>
&lt;li>å¸¸å¸¸ä½¿ç”¨ä¸€ä¸ªæ•´å‹é‡ï¼Œ0è¡¨ç¤ºè§£é”ï¼Œè€Œå…¶ä»–æ‰€æœ‰çš„å€¼åˆ™è¡¨ç¤ºåŠ é”ã€‚&lt;/li>
&lt;li>å½“ä¸€ä¸ªçº¿ç¨‹ï¼ˆæˆ–è¿›ç¨‹ï¼‰éœ€è¦è®¿é—®ä¸´ç•ŒåŒºæ—¶ï¼Œå®ƒè°ƒç”¨mutex_lockã€‚å¦‚æœè¯¥äº’æ–¥é‡å½“å‰æ˜¯è§£é”çš„ï¼ˆå³ä¸´ç•ŒåŒºå¯ç”¨ï¼‰ï¼Œæ­¤è°ƒç”¨æˆåŠŸï¼Œè°ƒç”¨çº¿ç¨‹å¯ä»¥è‡ªç”±è¿›å…¥è¯¥ä¸´ç•ŒåŒºã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœè¯¥äº’æ–¥é‡å·²ç»åŠ é”ï¼Œè°ƒç”¨çº¿ç¨‹è¢«é˜»å¡ï¼Œç›´åˆ°åœ¨ä¸´ç•ŒåŒºä¸­çš„çº¿ç¨‹å®Œæˆå¹¶è°ƒç”¨mutex_unlockã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹è¢«é˜»å¡åœ¨è¯¥äº’æ–¥é‡ä¸Šï¼Œå°†éšæœºé€‰æ‹©ä¸€ä¸ªçº¿ç¨‹å¹¶å…è®¸å®ƒè·å¾—é”ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="237-ç®¡ç¨‹">2.3.7 ç®¡ç¨‹
&lt;/h3>&lt;ul>
&lt;li>åŒæ­¥åŸè¯­ï¼šç®¡ç¨‹ã€‚ä¸€ä¸ªç®¡ç¨‹æ˜¯ä¸€ä¸ªç”±è¿‡ç¨‹ã€å˜é‡ä»¥åŠæ•°æ®ç»“æ„ç­‰ç»„æˆçš„é›†åˆï¼Œå®ƒä»¬ç»„æˆä¸€ä¸ªç‰¹æ®Šçš„æ¨¡å—æˆ–è½¯ä»¶åŒ…ã€‚è¿›ç¨‹å¯åœ¨ä»»ä½•éœ€è¦çš„æ—¶å€™è°ƒç”¨ç®¡ç¨‹ä¸­çš„è¿‡ç¨‹ï¼Œä½†å®ƒä»¬ä¸èƒ½åœ¨ç®¡ç¨‹ä¹‹å¤–å£°æ˜çš„è¿‡ç¨‹ä¸­ç›´æ¥è®¿é—®ç®¡ç¨‹å†…çš„æ•°æ®ç»“æ„ã€‚&lt;/li>
&lt;li>ç®¡ç¨‹æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ€§ï¼Œå³ä»»ä¸€æ—¶åˆ»ç®¡ç¨‹ä¸­åªèƒ½æœ‰ä¸€ä¸ªæ´»è·ƒçš„è¿›ç¨‹ï¼Œè¿™ä¸€ç‰¹æ€§ä½¿ç®¡ç¨‹èƒ½æœ‰æ•ˆåœ°å®Œæˆäº’æ–¥ã€‚&lt;/li>
&lt;li>ç¼–è¯‘å™¨è°ƒç”¨ç®¡ç¨‹æ—¶çš„å…¸å‹å¤„ç†æ–¹æ³•æ˜¯ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹è°ƒç”¨ç®¡ç¨‹è¿‡ç¨‹æ—¶ï¼Œè¯¥è¿‡ç¨‹ä¸­çš„å‰å‡ æ¡æŒ‡ä»¤å°†æ£€æŸ¥åœ¨ç®¡ç¨‹ä¸­æ˜¯å¦æœ‰å…¶ä»–çš„æ´»è·ƒè¿›ç¨‹ã€‚å¦‚æœæœ‰ï¼Œè°ƒç”¨è¿›ç¨‹å°†è¢«æŒ‚èµ·ï¼Œç›´åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ç¦»å¼€ç®¡ç¨‹å°†å…¶å”¤é†’ã€‚å¦‚æœæ²¡æœ‰æ´»è·ƒè¿›ç¨‹åœ¨ä½¿ç”¨ç®¡ç¨‹ï¼Œåˆ™è¯¥è°ƒç”¨è¿›ç¨‹å¯ä»¥è¿›å…¥ã€‚&lt;/li>
&lt;li>è¿›å…¥ç®¡ç¨‹æ—¶çš„äº’æ–¥ç”±ç¼–è¯‘å™¨è´Ÿè´£ï¼Œä½†é€šå¸¸çš„åšæ³•æ˜¯ç”¨ä¸€ä¸ªäº’æ–¥é‡æˆ–äºŒå…ƒä¿¡å·é‡ã€‚&lt;/li>
&lt;li>å®ç°é˜»å¡ï¼Œå¼•å…¥æ¡ä»¶å˜é‡ä»¥åŠç›¸å…³çš„ä¸¤ä¸ªæ“ä½œï¼šwaitå’Œsignalã€‚å½“ä¸€ä¸ªç®¡ç¨‹è¿‡ç¨‹å‘ç°å®ƒæ— æ³•ç»§ç»­è¿è¡Œæ—¶ï¼Œå®ƒä¼šåœ¨æŸä¸ªæ¡ä»¶å˜é‡ä¸Šæ‰§è¡Œwaitæ“ä½œã€‚å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œæ¯”å¦‚æ¶ˆè´¹è€…ï¼Œå¯ä»¥å”¤é†’æ­£åœ¨ç¡çœ çš„ä¼™ä¼´è¿›ç¨‹ï¼Œè¿™å¯ä»¥é€šè¿‡å¯¹å…¶ä¼™ä¼´æ­£åœ¨ç­‰å¾…çš„ä¸€ä¸ªæ¡ä»¶å˜é‡æ‰§è¡Œsignalå®Œæˆã€‚&lt;/li>
&lt;li>Brinch Hansen å»ºè®®æ‰§è¡Œsignalçš„è¿›ç¨‹å¿…é¡»ç«‹å³é€€å‡ºç®¡ç¨‹ï¼Œå³signalè¯­å¥åªå¯èƒ½ä½œä¸ºä¸€ä¸ªç®¡ç¨‹è¿‡ç¨‹çš„æœ€åä¸€ä¸ªè¯­å¥ã€‚&lt;/li>
&lt;li>sleepå’Œwakeupä¹‹æ‰€ä»¥å¤±è´¥æ˜¯å› ä¸ºå½“ä¸€ä¸ªè¿›ç¨‹æƒ³ç¡çœ æ—¶å¦ä¸€ä¸ªè¿›ç¨‹è¯•å›¾å»å”¤é†’å®ƒã€‚ä½¿ç”¨ç®¡ç¨‹åˆ™ä¸ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚å¦‚æœç®¡ç¨‹è¿‡ç¨‹ä¸­çš„ç”Ÿäº§è€…å‘ç°ç¼“å†²åŒºæ»¡ï¼Œå®ƒå°†èƒ½å¤Ÿå®Œæˆwaitæ“ä½œè€Œä¸ç”¨æ‹…å¿ƒè°ƒåº¦ç¨‹åºå¯èƒ½ä¼šåœ¨waitå®Œæˆä¹‹å‰åˆ‡æ¢åˆ°æ¶ˆè´¹è€…ã€‚ç”šè‡³ï¼Œåœ¨waitæ‰§è¡Œå®Œæˆè€Œä¸”æŠŠç”Ÿäº§è€…æ ‡å¿—ä¸ºä¸å¯è¿è¡Œä¹‹å‰ï¼Œæ ¹æœ¬ä¸ä¼šå…è®¸æ¶ˆè´¹è€…è¿›å…¥ç®¡ç¨‹ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä¿¡å·é‡å¤ªä½çº§äº†ï¼Œè€Œç®¡ç¨‹åœ¨å°‘æ•°å‡ ç§ç¼–ç¨‹è¯­è¨€ä¹‹å¤–æ— æ³•ä½¿ç”¨ï¼Œå¹¶ä¸”ï¼Œè¿™äº›åŸè¯­å‡æœªæä¾›æœºå™¨é—´çš„ä¿¡æ¯äº¤æ¢æ–¹æ³•ã€‚æ‰€ä»¥è¿˜éœ€è¦å…¶ä»–çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æ¶ˆæ¯ä¼ é€’ã€‚&lt;/p>
&lt;h3 id="238-æ¶ˆæ¯ä¼ é€’">2.3.8 æ¶ˆæ¯ä¼ é€’
&lt;/h3>&lt;p>æ¶ˆæ¯ä¼ é€’çš„ä¸¤æ¡åŸè¯­sendå’Œreceiveã€‚&lt;/p>
&lt;p>å¦‚æœæ²¡æœ‰æ¶ˆæ¯å¯ç”¨ï¼Œåˆ™æ¥æ”¶è€…å¯èƒ½è¢«é˜»å¡ï¼Œç›´åˆ°ä¸€æ¡æ¶ˆæ¯çš„åˆ°è¾¾ï¼Œæˆ–è€…ï¼Œå¸¦ç€ä¸€ä¸ªé”™è¯¯ç ç«‹å³è¿”å›ã€‚&lt;/p>
&lt;h4 id="1-æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿçš„è®¾è®¡è¦ç‚¹">1. æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿçš„è®¾è®¡è¦ç‚¹
&lt;/h4>&lt;p>ä¸ºäº†é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±ï¼Œä¸€æ—¦æ¥æ”¶åˆ°ä¿¡æ¯ï¼Œæ¥æ”¶æ–¹é©¬ä¸Šå›é€ä¸€æ¡ç‰¹æ®Šçš„ç¡®è®¤æ¶ˆæ¯ã€‚å¦‚æœå‘é€æ–¹åœ¨ä¸€æ®µæ—¶é—´é—´éš”å†…æœªæ”¶åˆ°ç¡®è®¤ï¼Œåˆ™é‡å‘æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>å¯¹äºæ¥æ”¶è€…æ¥è¯´ï¼Œå¦‚ä½•åŒºåˆ†æ–°çš„æ¶ˆæ¯å’Œä¸€æ¡é‡å‘çš„è€æ¶ˆæ¯æ˜¯éå¸¸é‡è¦çš„ã€‚é€šå¸¸é‡‡ç”¨åœ¨æ¯æ¡åŸå§‹æ¶ˆæ¯ä¸­åµŒå…¥ä¸€ä¸ªè¿ç»­çš„åºå·æ¥è§£å†³æ­¤é—®é¢˜ã€‚&lt;/p>
&lt;p>æ¶ˆæ¯ç³»ç»Ÿè¿˜éœ€è¦è§£å†³è¿›ç¨‹å‘½åçš„é—®é¢˜ï¼Œåœ¨sendå’Œreceiveè°ƒç”¨ä¸­æ‰€æŒ‡å®šçš„è¿›ç¨‹å¿…é¡»æ˜¯æ²¡æœ‰äºŒä¹‰æ€§çš„ã€‚èº«ä»½è®¤è¯ä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚è¿˜æœ‰æ€§èƒ½é—®é¢˜ã€‚&lt;/p>
&lt;h4 id="2-ç”¨æ¶ˆæ¯ä¼ é€’è§£å†³ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜">2. ç”¨æ¶ˆæ¯ä¼ é€’è§£å†³ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜
&lt;/h4>&lt;p>åœ¨è¯¥è§£å†³æ–¹æ¡ˆä¸­å…±ä½¿ç”¨Næ¡æ¶ˆæ¯ï¼Œç±»ä¼¼äºä¸€ä¸ªå…±äº«å†…å­˜ç¼“å†²åŒºä¸­çš„Nä¸ªæ§½ã€‚å½“ç”Ÿäº§è€…å‘æ¶ˆè´¹è€…ä¼ é€’ä¸€ä¸ªæ•°æ®é¡¹æ—¶ï¼Œå®ƒå–èµ°ä¸€æ¡ç©ºæ¶ˆæ¯å¹¶é€å›ä¸€æ¡å¡«å……äº†å†…å®¹çš„æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>å¦‚ä½•å¯¹æ¶ˆæ¯è¿›è¡Œç¼–å€ã€‚ä¸€ç§æ–¹æ³•æ˜¯ä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„åœ°å€ï¼Œè®©æ¶ˆæ¯æŒ‰è¿›ç¨‹çš„åœ°å€ç¼–å€ã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯å¼•å…¥ä¿¡ç®±ï¼Œæ˜¯ä¸€ä¸ªç”¨æ¥å¯¹ä¸€å®šæ•°é‡çš„æ¶ˆæ¯è¿›è¡Œç¼“å†²çš„åœ°æ–¹ã€‚&lt;/p>
&lt;h3 id="239-å±éšœ">2.3.9 å±éšœ
&lt;/h3>&lt;p>å±éšœå¯ç”¨äºä¸€ç»„è¿›ç¨‹åŒæ­¥ã€‚æ‰§è¡ŒbarrieråŸè¯­ã€‚&lt;/p>
&lt;h3 id="2310-é¿å…é”è¯»-å¤åˆ¶-æ›´æ–°">2.3.10 é¿å…é”ï¼šè¯»-å¤åˆ¶-æ›´æ–°
&lt;/h3>&lt;p>æœ€å¿«çš„é”æ˜¯æ ¹æœ¬æ²¡æœ‰é”ã€‚&lt;/p>
&lt;p>ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å…è®¸å†™æ“ä½œæ¥æ›´æ–°æ•°æ®ç»“æ„ï¼Œå³ä¾¿è¿˜æœ‰å…¶ä»–çš„è¿›ç¨‹æ­£åœ¨ä½¿ç”¨å®ƒã€‚çªé—¨åœ¨äºç¡®ä¿æ¯ä¸ªè¯»æ“ä½œè¦ä¹ˆè¯»å–æ—§çš„æ•°æ®ç‰ˆæœ¬ï¼Œè¦ä¹ˆè¯»å–æ–°çš„æ•°æ®ç‰ˆæœ¬ï¼Œä½†ç»ä¸èƒ½æ˜¯æ–°æ—§æ•°æ®çš„ä¸€äº›å¥‡æ€ªç»„åˆã€‚&lt;/p>
&lt;p>è¯»-å¤åˆ¶-æ›´æ–°ï¼Œå°†æ›´æ–°è¿‡ç¨‹ä¸­çš„ç§»é™¤å’Œå†åˆ†é…è¿‡ç¨‹åˆ†ç¦»å¼€æ¥ã€‚&lt;/p>
&lt;h2 id="24-è°ƒåº¦">2.4 è°ƒåº¦
&lt;/h2>&lt;h3 id="241-è°ƒåº¦ç®€ä»‹">2.4.1 è°ƒåº¦ç®€ä»‹
&lt;/h3>&lt;h4 id="1-è¿›ç¨‹è¡Œä¸º">1. è¿›ç¨‹è¡Œä¸º
&lt;/h4>&lt;p>å½“ä¸€ä¸ªè¿›ç¨‹ç­‰å¾…å¤–éƒ¨è®¾å¤‡å®Œæˆå·¥ä½œè€Œè¢«é˜»å¡æ—¶ï¼Œæ‰æ˜¯I/Oæ´»åŠ¨ã€‚&lt;/p>
&lt;p>è®¡ç®—å¯†é›†å‹å’ŒI/Oå¯†é›†å‹ã€‚éšç€CPUå˜å¾—è¶Šæ¥è¶Šå¿«ï¼Œæ›´å¤šçš„è¿›ç¨‹å€¾å‘ä¸ºI/Oå¯†é›†å‹ã€‚&lt;/p>
&lt;h4 id="2-ä½•æ—¶è°ƒåº¦">2. ä½•æ—¶è°ƒåº¦
&lt;/h4>&lt;p>ç¬¬ä¸€ï¼Œåœ¨åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ä¹‹åï¼Œéœ€è¦å†³å®šçš„æ˜¯è¿è¡Œçˆ¶è¿›ç¨‹è¿˜æ˜¯è¿è¡Œå­è¿›ç¨‹ã€‚&lt;/p>
&lt;p>ç¬¬äºŒï¼Œåœ¨ä¸€ä¸ªè¿›ç¨‹é€€å‡ºæ—¶å¿…é¡»åšå‡ºè°ƒåº¦å†³ç­–ã€‚&lt;/p>
&lt;p>ç¬¬ä¸‰ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹é˜»å¡åœ¨I/Oå’Œä¿¡å·é‡ä¸Šæˆ–ç”±äºå…¶ä»–åŸå› é˜»å¡æ—¶ï¼Œå¿…é¡»é€‰æ‹©å¦ä¸€ä¸ªè¿›ç¨‹è¿è¡Œã€‚&lt;/p>
&lt;p>ç¬¬å››ï¼Œåœ¨ä¸€ä¸ªI/Oä¸­æ–­å‘ç”Ÿæ—¶ï¼Œå¿…é¡»åšå‡ºè°ƒåº¦å†³ç­–ã€‚&lt;/p>
&lt;p>æ ¹æ®å¦‚ä½•å¤„ç†æ—¶é’Ÿä¸­æ–­ï¼Œå¯ä»¥æŠŠè°ƒåº¦ç®—æ³•åˆ†ä¸ºä¸¤ç±»ï¼š&lt;/p>
&lt;ul>
&lt;li>éæŠ¢å å¼&lt;/li>
&lt;li>æŠ¢å å¼&lt;/li>
&lt;/ul>
&lt;h4 id="3-è°ƒåº¦ç®—æ³•åˆ†ç±»">3. è°ƒåº¦ç®—æ³•åˆ†ç±»
&lt;/h4>&lt;p>ä¸‰ç§ç¯å¢ƒï¼š&lt;/p>
&lt;ul>
&lt;li>æ‰¹å¤„ç†ã€‚éæŠ¢å å¼ç®—æ³•ã€‚&lt;/li>
&lt;li>äº¤äº’å¼ã€‚æŠ¢å æ˜¯å¿…éœ€çš„ï¼ŒæœåŠ¡å™¨ä¹Ÿå½’äºæ­¤ç±»ã€‚&lt;/li>
&lt;li>å®æ—¶ã€‚æŠ¢å æœ‰æ—¶æ˜¯ä¸éœ€è¦çš„ã€‚&lt;/li>
&lt;/ul>
&lt;p>å®æ—¶ç³»ç»Ÿåªè¿è¡Œé‚£äº›ç”¨æ¥æ¨è¿›ç°æœ‰åº”ç”¨çš„ç¨‹åºï¼Œè€Œäº¤äº’å¼ç³»ç»Ÿæ˜¯é€šç”¨çš„ï¼Œå®ƒå¯ä»¥è¿è¡Œä»»æ„çš„éåä½œç”šè‡³æ˜¯æœ‰æ¶æ„çš„ç¨‹åºã€‚&lt;/p>
&lt;h4 id="4-è°ƒåº¦ç®—æ³•çš„ç›®æ ‡">4. è°ƒåº¦ç®—æ³•çš„ç›®æ ‡
&lt;/h4>&lt;p>æ‰€æœ‰ç³»ç»Ÿ&lt;/p>
&lt;ul>
&lt;li>å…¬å¹³â€”â€”ç»™æ¯ä¸ªè¿›ç¨‹å…¬å¹³çš„CPUä»½é¢&lt;/li>
&lt;li>ç­–ç•¥å¼ºåˆ¶æ‰§è¡Œâ€”â€”ä¿è¯è§„å®šçš„ç­–ç•¥è¢«æ‰§è¡Œ&lt;/li>
&lt;li>å¹³è¡¡â€”â€”ä¿æŒç³»ç»Ÿçš„æ‰€æœ‰éƒ¨åˆ†éƒ½å¿™ç¢Œ&lt;/li>
&lt;/ul>
&lt;p>æ‰¹å¤„ç†ç³»ç»Ÿ&lt;/p>
&lt;ul>
&lt;li>ååé‡â€”â€”æ¯å°æ—¶æœ€å¤§ä½œä¸šæ•°&lt;/li>
&lt;li>å‘¨è½¬æ—¶é—´â€”â€”ä»æäº¤åˆ°ç»ˆæ­¢é—´çš„æœ€å°æ—¶é—´&lt;/li>
&lt;li>CPUåˆ©ç”¨ç‡â€”â€”ä¿æŒCPUå§‹ç»ˆå¿™ç¢Œï¼ŒCPUåˆ©ç”¨ç‡å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„åº¦é‡å‚æ•°ã€‚çœŸæ­£æœ‰ä»·å€¼çš„æ˜¯ï¼Œç³»ç»Ÿæ¯å°æ—¶å¯å®Œæˆå¤šå°‘ä½œä¸šï¼ˆååé‡ï¼‰ï¼Œä»¥åŠå®Œæˆä½œä¸šéœ€è¦å¤šé•¿æ—¶é—´ï¼ˆå‘¨è½¬æ—¶é—´ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;p>äº¤äº’å¼ç³»ç»Ÿ&lt;/p>
&lt;ul>
&lt;li>å“åº”æ—¶é—´â€”â€”å¿«é€Ÿå“åº”è¯·æ±‚&lt;/li>
&lt;li>å‡è¡¡æ€§â€”â€”æ»¡è¶³ç”¨æˆ·çš„æœŸæœ›&lt;/li>
&lt;/ul>
&lt;p>å®æ—¶ç³»ç»Ÿ&lt;/p>
&lt;ul>
&lt;li>æ»¡è¶³æˆªæ­¢æ—¶é—´â€”â€”é¿å…ä¸¢å¤±æ•°æ®&lt;/li>
&lt;li>å¯é¢„æµ‹æ€§â€”â€”åœ¨å¤šåª’ä½“ç³»ç»Ÿä¸­é¿å…å“è´¨é™ä½&lt;/li>
&lt;/ul>
&lt;h3 id="242-æ‰¹å¤„ç†ç³»ç»Ÿä¸­çš„è°ƒåº¦">2.4.2 æ‰¹å¤„ç†ç³»ç»Ÿä¸­çš„è°ƒåº¦
&lt;/h3>&lt;h4 id="1-å…ˆæ¥å…ˆæœåŠ¡">1. å…ˆæ¥å…ˆæœåŠ¡
&lt;/h4>&lt;p>æœ€ç®€å•çš„æ˜¯éæŠ¢å å¼çš„å…ˆæ¥å…ˆæœåŠ¡ç®—æ³•ã€‚&lt;/p>
&lt;p>å½“åœ¨è¢«é˜»å¡çš„è¿›ç¨‹å˜ä¸ºå°±ç»ªæ—¶ï¼Œå°±åƒä¸€ä¸ªæ–°æ¥åˆ°çš„ä½œä¸šä¸€æ ·ï¼Œæ’åˆ°å°±ç»ªé˜Ÿåˆ—çš„æœ«å°¾ï¼Œå³æ’åœ¨æ‰€æœ‰è¿›ç¨‹æœ€åã€‚&lt;/p>
&lt;p>ä¸»è¦ä¼˜ç‚¹æ˜¯æ˜“äºç†è§£å¹¶ä¸”ä¾¿äºåœ¨ç¨‹åºä¸­è¿è¡Œã€‚ç¼ºç‚¹å¾ˆæ˜æ˜¾ã€‚ä¾‹å¦‚ä¸€ä¸ªä¸€æ¬¡è¿è¡Œ1ç§’é’Ÿçš„è®¡ç®—å¯†é›†å‹è¿›ç¨‹å’Œå¾ˆå°‘ä½¿ç”¨CPUä½†æ˜¯æ¯ä¸ªéƒ½è¦è¿›è¡Œ1000æ¬¡ç£ç›˜è¯»æ“ä½œæ‰èƒ½å®Œæˆçš„å¤§é‡I/Oå¯†é›†å‹è¿›ç¨‹å­˜åœ¨ã€‚&lt;/p>
&lt;h4 id="2-æœ€çŸ­ä½œä¸šä¼˜å…ˆ">2. æœ€çŸ­ä½œä¸šä¼˜å…ˆ
&lt;/h4>&lt;p>é€‚ç”¨äºè¿è¡Œæ—¶é—´å¯ä»¥é¢„çŸ¥çš„å¦ä¸€ä¸ªéæŠ¢å å¼çš„æ‰¹å¤„ç†è°ƒåº¦ç®—æ³•ã€‚&lt;/p>
&lt;p>åªæœ‰åœ¨æ‰€æœ‰ä½œä¸šéƒ½å¯åŒæ—¶è¿è¡Œçš„æƒ…å½¢ä¸‹ï¼Œæœ€çŸ­ä½œä¸šä¼˜å…ˆç®—æ³•æ‰æ˜¯æœ€ä¼˜çš„ã€‚&lt;/p>
&lt;h4 id="3-æœ€çŸ­å‰©ä½™æ—¶é—´ä¼˜å…ˆ">3. æœ€çŸ­å‰©ä½™æ—¶é—´ä¼˜å…ˆ
&lt;/h4>&lt;p>æœ€çŸ­ä½œä¸šä¼˜å…ˆçš„æŠ¢å å¼ç‰ˆæœ¬æ˜¯æœ€çŸ­å‰©ä½™æ—¶é—´ä¼˜å…ˆç®—æ³•ã€‚&lt;/p>
&lt;p>è°ƒåº¦ç¨‹åºæ€»æ˜¯é€‰æ‹©å‰©ä½™è¿è¡Œæ—¶é—´æœ€çŸ­çš„é‚£ä¸ªè¿›ç¨‹è¿è¡Œã€‚å†æ¬¡æé†’ï¼Œæœ‰å…³çš„è¿è¡Œæ—¶é—´å¿…é¡»æå‰æŒæ¡ã€‚&lt;/p>
&lt;p>è¿™ç§æ–¹å¼å¯ä»¥ä½¿æ–°çš„çŸ­ä½œä¸šè·å¾—è‰¯å¥½çš„æœåŠ¡ã€‚&lt;/p>
&lt;h3 id="243-äº¤äº’å¼ç³»ç»Ÿä¸­çš„è°ƒåº¦">2.4.3 äº¤äº’å¼ç³»ç»Ÿä¸­çš„è°ƒåº¦
&lt;/h3>&lt;h4 id="1-è½®è½¬è°ƒåº¦">1. è½®è½¬è°ƒåº¦
&lt;/h4>&lt;p>ä¸€ç§æœ€å¤è€ã€æœ€ç®€å•ã€æœ€å…¬å¹³ä¸”ä½¿ç”¨æœ€å¹¿çš„ç®—æ³•æ˜¯è½®è½¬è°ƒåº¦ã€‚æ¯ä¸ªè¿›ç¨‹è¢«åˆ†é…ä¸€ä¸ªæ—¶é—´æ®µï¼Œç§°ä¸ºæ—¶é—´ç‰‡ï¼Œå³å…è®¸è¯¥è¿›ç¨‹åœ¨è¯¥æ—¶é—´æ®µä¸­è¿è¡Œã€‚&lt;/p>
&lt;p>æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ä¸­å”¯ä¸€æœ‰è¶£çš„ä¸€ç‚¹æ˜¯æ—¶é—´ç‰‡çš„é•¿åº¦ã€‚æ¶‰åŠåˆ°ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚&lt;/p>
&lt;p>æ—¶é—´ç‰‡è®¾å¾—å¤ªçŸ­ä¼šå¯¼è‡´è¿‡å¤šçš„è¿›ç¨‹åˆ‡æ¢ï¼Œé™ä½äº†CPUæ•ˆç‡ï¼›è€Œè®¾å¾—å¤ªé•¿åˆå¯èƒ½å¼•èµ·å¯¹çŸ­çš„äº¤äº’è¯·æ±‚çš„å“åº”æ—¶é—´å˜é•¿ã€‚å°†æ—¶é—´ç‰‡è®¾ä¸º20msï½50msé€šå¸¸æ˜¯ä¸€ä¸ªæ¯”è¾ƒåˆç†çš„æŠ˜ä¸­ã€‚&lt;/p>
&lt;h4 id="2-ä¼˜å…ˆçº§è°ƒåº¦">2. ä¼˜å…ˆçº§è°ƒåº¦
&lt;/h4>&lt;p>ä¼˜å…ˆçº§è°ƒåº¦çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šæ¯ä¸ªè¿›ç¨‹è¢«èµ‹äºˆä¸€ä¸ªä¼˜å…ˆçº§ï¼Œè¿è¡Œä¼˜å…ˆçº§æœ€é«˜çš„å¯è¿è¡Œè¿›ç¨‹çº¿è¿è¡Œã€‚&lt;/p>
&lt;p>ä¸ºäº†é˜²æ­¢é«˜ä¼˜å…ˆçº§è¿›ç¨‹æ— ä¼‘æ­¢åœ°è¿è¡Œä¸‹å»ï¼Œè°ƒåº¦ç¨‹åºå¯èƒ½åœ¨æ¯ä¸ªæ—¶é’Ÿæ»´ç­”ï¼ˆå³æ¯ä¸ªæ—¶é’Ÿä¸­æ–­ï¼‰é™ä½å½“å‰è¿›ç¨‹çš„ä¼˜å…ˆçº§ã€‚å¦‚æœè¿™ä¸€è¡Œä¸ºå¯¼è‡´è¯¥è¿›ç¨‹çš„ä¼˜å…ˆçº§ä½äºæ¬¡é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹ï¼Œåˆ™è¿›è¡Œè¿›ç¨‹åˆ‡æ¢ã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯ï¼Œç»™æ¯ä¸ªè¿›ç¨‹èµ‹äºˆä¸€ä¸ªå…è®¸è¿è¡Œçš„æœ€å¤§æ—¶é—´ç‰‡ï¼Œå½“ç”¨å®Œè¿™ä¸ªæ—¶é—´ç‰‡æ—¶ï¼Œæ¬¡é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹ä¾¿è·å¾—è¿è¡Œæœºä¼šã€‚&lt;/p>
&lt;p>ä¼˜å…ˆçº§å¯ä»¥é™æ€èµ‹äºˆæˆ–åŠ¨æ€èµ‹äºˆã€‚&lt;/p>
&lt;p>ä¸ºè¾¾åˆ°æŸç§ç›®çš„ï¼Œä¼˜å…ˆçº§å¯ä»¥ç”±ç³»ç»ŸåŠ¨æ€ç¡®å®šã€‚ä½¿I/Oå¯†é›†å‹è¿›ç¨‹è·å¾—è¾ƒå¥½æœåŠ¡çš„ä¸€ç§ç®€å•ç®—æ³•æ˜¯ï¼Œå°†å…¶ä¼˜å…ˆçº§è®¾ä¸º1/fï¼Œfä¸ºè¯¥è¿›ç¨‹åœ¨ä¸Šä¸€æ—¶é—´ç‰‡ä¸­æ‰€å çš„éƒ¨åˆ†ã€‚&lt;/p>
&lt;p>å¦‚æœä¸å¶å°”å¯¹ä¼˜å…ˆçº§è¿›è¡Œè°ƒæ•´ï¼Œåˆ™ä½ä¼˜å…ˆçº§è¿›ç¨‹å¾ˆå¯èƒ½ä¼šäº§ç”Ÿé¥¥é¥¿ç°è±¡ã€‚&lt;/p>
&lt;h4 id="3-å¤šçº§é˜Ÿåˆ—">3. å¤šçº§é˜Ÿåˆ—
&lt;/h4>&lt;p>å±äºæœ€é«˜ä¼˜å…ˆçº§ç±»çš„è¿›ç¨‹è¿è¡Œä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œå±äºæ¬¡é«˜ä¼˜å…ˆçº§ç±»çš„è¿›ç¨‹è¿è¡Œ2ä¸ªæ—¶é—´ç‰‡ï¼Œå†æ¬¡ä¸€çº§è¿è¡Œ4ä¸ªæ—¶é—´ç‰‡ï¼Œä»¥æ­¤ç±»æ¨ã€‚å½“ä¸€ä¸ªè¿›ç¨‹ç”¨å®Œåˆ†é…çš„æ—¶é—´ç‰‡åï¼Œå®ƒè¢«ç§»åŠ¨åˆ°ä¸‹ä¸€ç±»ã€‚&lt;/p>
&lt;p>éšç€è¿›ç¨‹ä¼˜å…ˆçº§çš„ä¸æ–­é™ä½ï¼Œå®ƒçš„è¿è¡Œé¢‘åº¦é€æ¸æ”¾æ…¢ï¼Œä»è€Œä¸ºçŸ­çš„äº¤äº’è¿›ç¨‹è®©å‡ºCPUã€‚&lt;/p>
&lt;p>å¯¹äºé‚£äº›åˆšå¼€å§‹è¿è¡Œä¸€æ®µé•¿æ—¶é—´ï¼Œè€Œåæ¥åˆéœ€è¦äº¤äº’çš„è¿›ç¨‹ï¼Œä¸ºäº†é˜²æ­¢å…¶æ°¸è¿œå¤„äºè¢«æƒ©ç½šçŠ¶æ€ï¼Œå¯ä»¥é‡‡å–ä¸‹é¢çš„ç­–ç•¥ã€‚åªè¦ç»ˆç«¯ä¸Šæœ‰å›è½¦é”®æŒ‰ä¸‹ï¼Œåˆ™å±äºè¯¥ç»ˆç«¯çš„æ‰€æœ‰è¿›ç¨‹å°±éƒ½è¢«ç§»åˆ°æœ€é«˜ä¼˜å…ˆçº§ï¼Œè¿™æ ·åšçš„åŸå› æ˜¯å‡è®¾æ­¤æ—¶è¿›ç¨‹å³å°†éœ€è¦äº¤äº’ã€‚&lt;/p>
&lt;h4 id="4-æœ€çŸ­è¿›ç¨‹ä¼˜å…ˆ">4. æœ€çŸ­è¿›ç¨‹ä¼˜å…ˆ
&lt;/h4>&lt;p>é¦–å…ˆè¿è¡Œæœ€çŸ­çš„ä½œä¸šæ¥ä½¿å“åº”æ—¶é—´æœ€çŸ­ã€‚&lt;/p>
&lt;p>å¦‚ä½•ä»å½“å‰å¯è¿è¡Œè¿›ç¨‹ä¸­æ‰¾å‡ºæœ€çŸ­çš„é‚£ä¸€ä¸ªè¿›ç¨‹ã€‚ä¸€ç§åŠæ³•æ˜¯æ ¹æ®è¿›ç¨‹è¿‡å»çš„è¡Œä¸ºè¿›è¡Œæ¨æµ‹ï¼Œå¹¶æ‰§è¡Œä¼°è®¡è¿è¡Œæ—¶é—´æœ€çŸ­çš„é‚£ä¸€ä¸ªã€‚&lt;/p>
&lt;p>è€åŒ–æŠ€æœ¯ï¼Œå‡è®¾æŸä¸ªç»ˆç«¯ä¸ŠæŸæ¡å‘½ä»¤çš„ä¼°è®¡è¿è¡Œæ—¶é—´ä¸º$T_0$ã€‚ç°åœ¨å‡è®¾æµ‹é‡åˆ°å…¶ä¸‹ä¸€æ¬¡è¿è¡Œæ—¶é—´ä¸º$T_1$ã€‚å¯ä»¥ç”¨è¿™ä¸¤ä¸ªå€¼åŠ æƒå’Œæ¥æ”¹è¿›ä¼°è®¡æ—¶é—´ï¼Œå³$aT_0+(1-a)T_1$ã€‚å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©$a$çš„å€¼ã€‚&lt;/p>
&lt;h4 id="5-ä¿è¯è°ƒåº¦">5. ä¿è¯è°ƒåº¦
&lt;/h4>&lt;p>å‘ç”¨æˆ·ä½œå‡ºæ˜ç¡®çš„æ€§èƒ½ä¿è¯ï¼Œç„¶åå»å®ç°å®ƒã€‚è‹¥ç”¨æˆ·å·¥ä½œæ—¶æœ‰$n$ä¸ªç”¨æˆ·ç™»å½•ï¼Œåˆ™ç”¨æˆ·å°†è·å¾—CPUå¤„ç†èƒ½åŠ›çš„$1/n$ã€‚&lt;/p>
&lt;p>ç³»ç»Ÿå¿…é¡»è·Ÿè¸ªå„ä¸ªè¿›ç¨‹è‡ªåˆ›å»ºä»¥æ¥å·²ä½¿ç”¨äº†å¤šå°‘CPUæ—¶é—´ã€‚ç„¶åå®ƒè®¡ç®—å„ä¸ªè¿›ç¨‹åº”è·å¾—çš„CPUæ—¶é—´ï¼Œå³è‡ªåˆ›å»ºä»¥æ¥çš„æ—¶é—´é™¤ä»¥$n$ã€‚è¯¥ç®—æ³•è½¬å‘æ¯”ç‡æœ€ä½çš„è¿›ç¨‹ã€‚&lt;/p>
&lt;h4 id="6-å½©ç¥¨è°ƒåº¦">6. å½©ç¥¨è°ƒåº¦
&lt;/h4>&lt;p>å…¶åŸºæœ¬æ€æƒ³æ˜¯ä¸ºè¿›ç¨‹æä¾›å„ç§ç³»ç»Ÿèµ„æºï¼ˆå¦‚CPUæ—¶é—´ï¼‰çš„å½©ç¥¨ã€‚ä¸€æ—¦éœ€è¦åšå‡ºä¸€é¡¹è°ƒåº¦å†³ç­–æ—¶ï¼Œå°±éšæœºæŠ½å‡ºä¸€å¼ å½©ç¥¨ï¼Œæ‹¥æœ‰è¯¥å½©ç¥¨çš„è¿›ç¨‹è·å¾—èµ„æºã€‚åœ¨åº”ç”¨åˆ°CPUè°ƒåº¦æ—¶ï¼Œç³»ç»Ÿå¯ä»¥æŒæ¡æ¯ç§’é’Ÿ50æ¬¡çš„ä¸€ç§å½©ç¥¨ï¼Œä½œä¸ºå¥–åŠ±æ¯ä¸ªè·å¥–è€…å¯ä»¥å¾—åˆ°20msçš„CPUæ—¶é—´ã€‚&lt;/p>
&lt;p>æ‰€æœ‰è¿›ç¨‹æ˜¯å¹³ç­‰çš„ï¼Œä½†æ˜¯æŸäº›è¿›ç¨‹æ›´å¹³ç­‰ä¸€äº›ã€‚æ‹¥æœ‰å½©ç¥¨$f$ä»½é¢çš„è¿›ç¨‹å¤§çº¦å¾—åˆ°ç³»ç»Ÿèµ„æºçš„$f$ä»½é¢ã€‚&lt;/p>
&lt;p>å½©ç¥¨è°ƒåº¦æ˜¯ååº”è¿…é€Ÿçš„ã€‚&lt;/p>
&lt;p>å½©ç¥¨è°ƒåº¦å¯ä»¥ç”¨æ¥è§£å†³å…¶ä»–æ–¹æ³•å¾ˆéš¾è§£å†³çš„é—®é¢˜ï¼Œä¾‹å¦‚è§†é¢‘æœåŠ¡å™¨æä¾›è§†é¢‘æµï¼Œæ¯ä¸ªè§†é¢‘æµçš„å¸§é€Ÿç‡éƒ½ä¸ç›¸åŒã€‚&lt;/p>
&lt;h4 id="7-å…¬å¹³åˆ†äº«è°ƒåº¦">7. å…¬å¹³åˆ†äº«è°ƒåº¦
&lt;/h4>&lt;p>è€ƒè™‘è°æ‹¥æœ‰è¿›ç¨‹è¿™ä¸€å› ç´ ã€‚&lt;/p>
&lt;h3 id="244-å®æ—¶ç³»ç»Ÿä¸­çš„è°ƒåº¦">2.4.4 å®æ—¶ç³»ç»Ÿä¸­çš„è°ƒåº¦
&lt;/h3>&lt;p>å®æ—¶ç³»ç»Ÿé€šå¸¸å¯ä»¥åˆ†ä¸ºç¡¬å®æ—¶å’Œè½¯å®æ—¶ã€‚å‰è€…çš„å«ä¹‰æ˜¯å¿…é¡»æ»¡è¶³ç»å¯¹çš„æˆªæ­¢æ—¶é—´ï¼Œåè€…çš„å«ä¹‰æ˜¯è™½ç„¶ä¸å¸Œæœ›å¶å°”é”™å¤±æˆªæ­¢æ—¶é—´ï¼Œä½†æ˜¯å¯ä»¥å®¹å¿ã€‚&lt;/p>
&lt;p>å®æ—¶ç³»ç»Ÿçš„è°ƒåº¦ç®—æ³•å¯ä»¥æ˜¯é™æ€æˆ–åŠ¨æ€çš„ã€‚&lt;/p>
&lt;h3 id="245-ç­–ç•¥å’Œæœºåˆ¶">2.4.5 ç­–ç•¥å’Œæœºåˆ¶
&lt;/h3>&lt;p>è§£å†³é—®é¢˜çš„æ–¹æ³•æ˜¯å°†è°ƒåº¦æœºåˆ¶ä¸è°ƒåº¦ç­–ç•¥åˆ†ç¦»è¿™ä¸ªä¸€è´¯çš„åŸåˆ™ã€‚&lt;/p>
&lt;h3 id="246-çº¿ç¨‹è°ƒåº¦">2.4.6 çº¿ç¨‹è°ƒåº¦
&lt;/h3>&lt;p>ç”¨æˆ·çº§çº¿ç¨‹ï¼šè¿è¡Œæ—¶ç³»ç»Ÿä½¿ç”¨è°ƒåº¦ç®—æ³•å¯ä»¥æ˜¯ä¸Šé¢ä»‹ç»çš„ç®—æ³•ä¸­çš„ä»»æ„ä¸€ç§ï¼Œå¸¸ç”¨è½®è½¬è°ƒåº¦å’Œä¼˜å…ˆçº§è°ƒåº¦ã€‚&lt;/p>
&lt;p>å†…æ ¸çº§çº¿ç¨‹ã€‚&lt;/p>
&lt;p>ç”¨æˆ·çº§çº¿ç¨‹å’Œå†…æ ¸çº§çº¿ç¨‹ä¹‹é—´çš„å·®åˆ«åœ¨äºæ€§èƒ½ã€‚ç”¨æˆ·çº§çº¿ç¨‹çš„çº¿ç¨‹åˆ‡æ¢éœ€è¦å°‘é‡çš„æœºå™¨æŒ‡ä»¤ï¼Œè€Œå†…æ ¸çº§çº¿ç¨‹éœ€è¦å®Œæ•´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¿®æ”¹å†…å­˜æ˜ åƒï¼Œä½¿é«˜é€Ÿç¼“å­˜å¤±æ•ˆï¼Œè¿™å¯¼è‡´äº†è‹¥å¹²æ•°é‡çº§çš„å»¶è¿Ÿã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨ä½¿ç”¨å†…æ ¸çº§çº¿ç¨‹æ—¶ï¼Œä¸€æ—¦çº¿ç¨‹é˜»å¡åœ¨I/Oä¸Šå°±ä¸éœ€è¦åƒåœ¨ç”¨æˆ·çº§çº¿ç¨‹ä¸­é‚£æ ·å°†æ•´ä¸ªè¿›ç¨‹æŒ‚èµ·ã€‚&lt;/p>
&lt;p>ç”¨æˆ·çº§çº¿ç¨‹å¯ä»¥ä½¿ç”¨ä¸“ä¸ºåº”ç”¨ç¨‹åºå®šåˆ¶çš„çº¿ç¨‹è°ƒåº¦ç¨‹åºã€‚è€Œåœ¨å†…æ ¸çº§çº¿ç¨‹ä¸­ï¼Œå†…æ ¸ä»æ¥ä¸äº†è§£æ¯ä¸ªçº¿ç¨‹çš„ä½œç”¨ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œåº”ç”¨å®šåˆ¶çš„çº¿ç¨‹è°ƒåº¦ç¨‹åºèƒ½å¤Ÿæ¯”å†…æ ¸æ›´å¥½åœ°æ»¡è¶³åº”ç”¨çš„éœ€è¦ã€‚&lt;/p>
&lt;h2 id="25-ç»å…¸çš„ipcé—®é¢˜">2.5 ç»å…¸çš„IPCé—®é¢˜
&lt;/h2>&lt;h3 id="251-å“²å­¦å®¶å°±é¤é—®é¢˜">2.5.1 å“²å­¦å®¶å°±é¤é—®é¢˜
&lt;/h3>&lt;p>ä¸€ç§æ²¡æœ‰æ­»é”ï¼Œè€Œä¸”å¯¹äºä»»æ„ä½å“²å­¦å®¶çš„æƒ…å†µéƒ½èƒ½è·å¾—æœ€å¤§çš„å¹¶è¡Œåº¦ã€‚ä½¿ç”¨ä¸€ä¸ªæ•°ç»„stateè·Ÿè¸ªæ¯ä¸€ä¸ªå“²å­¦å®¶æ˜¯åœ¨è¿›é¤ã€æ€è€ƒè¿˜æ˜¯é¥¥é¥¿çŠ¶æ€ï¼ˆæ­£åœ¨è¯•å›¾æ‹¿å‰å­ï¼‰ã€‚ä¸€ä¸ªå“²å­¦å®¶åªæœ‰åœ¨ä¸¤ä¸ªé‚»å±…éƒ½æ²¡æœ‰è¿›é¤æ—¶æ‰å…è®¸è¿›å…¥åˆ°è¿›é¤çŠ¶æ€ã€‚&lt;/p>
&lt;h3 id="252-è¯»è€…-å†™è€…é—®é¢˜">2.5.2 è¯»è€…-å†™è€…é—®é¢˜
&lt;/h3>&lt;p>ä¸ºæ•°æ®åº“è®¿é—®å»ºç«‹äº†ä¸€ä¸ªæ¨¡å‹ã€‚&lt;/p>
&lt;h1 id="ç¬¬3ç« -å†…å­˜ç®¡ç†">ç¬¬3ç«  å†…å­˜ç®¡ç†
&lt;/h1>&lt;ul>
&lt;li>&lt;strong>åˆ†å±‚å­˜å‚¨å™¨ä½“ç³»&lt;/strong>&lt;/li>
&lt;li>æ“ä½œç³»ç»Ÿä¸­ç®¡ç†åˆ†å±‚å­˜å‚¨å™¨ä½“ç³»çš„éƒ¨åˆ†ç§°ä¸º&lt;strong>å­˜å‚¨ç®¡ç†å™¨&lt;/strong>ã€‚å®ƒçš„ä»»åŠ¡æ˜¯æœ‰æ•ˆåœ°ç®¡ç†å†…å­˜ï¼Œå³è®°å½•å“ªäº›å†…å­˜æ˜¯æ­£åœ¨ä½¿ç”¨çš„ï¼Œå“ªäº›å†…å­˜æ˜¯ç©ºé—²çš„ï¼›åœ¨è¿›ç¨‹éœ€è¦æ—¶ä¸ºå…¶åˆ†é…å†…å­˜ï¼Œåœ¨è¿›ç¨‹ä½¿ç”¨å®Œåé‡Šæ”¾å†…å­˜ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="31-æ— å­˜å‚¨å™¨æŠ½è±¡">3.1 æ— å­˜å‚¨å™¨æŠ½è±¡
&lt;/h2>&lt;ul>
&lt;li>æœ€ç®€å•çš„å­˜å‚¨å™¨æŠ½è±¡å°±æ˜¯æ ¹æœ¬æ²¡æœ‰æŠ½è±¡ï¼Œå…¶æ¨¡å‹å°±æ˜¯ç®€å•çš„ç‰©ç†å†…å­˜ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>åœ¨ä¸ä½¿ç”¨å­˜å‚¨å™¨æŠ½è±¡çš„æƒ…å†µä¸‹è¿è¡Œå¤šä¸ªç¨‹åº&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>æ“ä½œç³»ç»Ÿåªéœ€è¦æŠŠå½“å‰å†…å­˜ä¸­æ‰€æœ‰å†…å®¹ä¿å­˜åˆ°ç£ç›˜æ–‡ä»¶ä¸­ï¼Œç„¶åæŠŠä¸‹ä¸€ä¸ªç¨‹åºè¯»å…¥åˆ°å†…å­˜ä¸­å†è¿è¡Œå³å¯ã€‚åªè¦åœ¨æŸä¸€ä¸ªæ—¶é—´å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªç¨‹åºï¼Œé‚£ä¹ˆå°±ä¸ä¼šå‘ç”Ÿå†²çªã€‚&lt;/li>
&lt;li>ç”¨å†…å­˜é”®çš„æ–¹å¼å¹¶å‘åœ°è¿è¡Œå¤šä¸ªç¨‹åºçš„ç¼ºé™·ï¼šä¼šå‡ºç°å¯¹å†…å­˜åœ°å€çš„ä¸æ­£ç¡®è®¿é—®ï¼Œé—®é¢˜çš„å…³é”®æ˜¯ä¸¤ä¸ªç¨‹åºéƒ½å¼•ç”¨äº†ç»å¯¹ç‰©ç†åœ°å€ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="32-ä¸€ç§å­˜å‚¨å™¨æŠ½è±¡åœ°å€ç©ºé—´">3.2 ä¸€ç§å­˜å‚¨å™¨æŠ½è±¡ï¼šåœ°å€ç©ºé—´
&lt;/h2>&lt;p>æŠŠç‰©ç†åœ°å€æš´éœ²ç»™è¿›ç¨‹çš„å‡ ä¸ªé—®é¢˜ï¼š&lt;/p>
&lt;ol>
&lt;li>ç”¨æˆ·ç¨‹åºå¯ä»¥å¾ˆå®¹æ˜“åœ°ç ´åæ“ä½œç³»ç»Ÿï¼Œä»è€Œä½¿ç³»ç»Ÿæ…¢æ…¢åœ°åœæ­¢è¿è¡Œã€‚&lt;/li>
&lt;li>æƒ³è¦åŒæ—¶è¿è¡Œå¤šä¸ªç¨‹åºæ˜¯å¾ˆå›°éš¾çš„ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="321-åœ°å€ç©ºé—´çš„æ¦‚å¿µ">3.2.1 åœ°å€ç©ºé—´çš„æ¦‚å¿µ
&lt;/h3>&lt;ul>
&lt;li>è¦ä½¿å¤šä¸ªåº”ç”¨ç¨‹åºåŒæ—¶å¤„äºå†…å­˜ä¸­å¹¶ä¸”äº’ä¸å½±å“ï¼Œéœ€è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š&lt;strong>ä¿æŠ¤å’Œé‡å®šä½&lt;/strong>ã€‚&lt;/li>
&lt;li>åœ°å€ç©ºé—´ä¸ºç¨‹åºåˆ›é€ äº†ä¸€ç§æŠ½è±¡çš„å†…å­˜ã€‚&lt;strong>åœ°å€ç©ºé—´&lt;/strong>æ˜¯ä¸€ä¸ªè¿›ç¨‹å¯ç”¨äºå¯»å€å†…å­˜çš„ä¸€å¥—åœ°å€é›†åˆã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„åœ°å€ç©ºé—´ï¼Œå¹¶ä¸”è¿™ä¸ªåœ°å€ç©ºé—´ç‹¬ç«‹äºå…¶ä»–è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼ˆé™¤äº†åœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹è¿›ç¨‹éœ€è¦å…±äº«å®ƒä»¬çš„åœ°å€ç©ºé—´å¤–ï¼‰ã€‚&lt;/li>
&lt;li>åœ°å€ç©ºé—´æ¦‚å¿µä¸¾ä¾‹
&lt;ul>
&lt;li>ç”µè¯å·ç çš„åœ°å€ç©ºé—´æ˜¯ä» 0 000 000 åˆ° 9 999 999&lt;/li>
&lt;li>x86çš„I/Oç«¯å£çš„åœ°å€ç©ºé—´ä»0åˆ°16 383&lt;/li>
&lt;li>ä»¥â€œ.comâ€ç»“å°¾çš„ç½‘ç»œåŸŸåçš„é›†åˆä¹Ÿæ˜¯åœ°å€ç©ºé—´&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>åŸºå€å¯„å­˜å™¨ä¸ç•Œé™å¯„å­˜å™¨&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>åŠ¨æ€é‡å®šä½ï¼Œç®€å•åœ°æŠŠæ¯ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´æ˜ å°„åˆ°ç‰©ç†å†…å­˜çš„ä¸åŒéƒ¨åˆ†ã€‚&lt;/li>
&lt;li>å½“ä½¿ç”¨&lt;strong>åŸºå€å¯„å­˜å™¨&lt;/strong>å’Œ&lt;strong>ç•Œé™å¯„å­˜å™¨&lt;/strong>æ—¶ï¼Œç¨‹åºè£…è½½åˆ°å†…å­˜ä¸­è¿ç»­çš„ç©ºé—²ä½ç½®ä¸”è£…è½½æœŸé—´æ— é¡»é‡å®šä½ã€‚å½“ä¸€ä¸ªç¨‹åºè¿è¡Œæ—¶ï¼Œ&lt;strong>ç¨‹åºçš„èµ·å§‹ç‰©ç†åœ°å€&lt;/strong>è£…è½½åˆ°åŸºå€å¯„å­˜å™¨ä¸­ï¼Œ&lt;strong>ç¨‹åºçš„é•¿åº¦&lt;/strong>è£…è½½åˆ°ç•Œé™å¯„å­˜å™¨ä¸­ã€‚&lt;/li>
&lt;li>æ¯æ¬¡ä¸€ä¸ªè¿›ç¨‹è®¿é—®å†…å­˜ï¼Œå–ä¸€æ¡æŒ‡ä»¤ï¼Œè¯»æˆ–å†™ä¸€ä¸ªæ•°æ®å­—ï¼ŒCPUç¡¬ä»¶ä¼šæŠŠåœ°å€å‘é€åˆ°å†…å­˜æ€»çº¿å‰ï¼Œè‡ªåŠ¨æŠŠåŸºå€å€¼åŠ åˆ°è¿›ç¨‹å‘å‡ºçš„åœ°å€å€¼ä¸Šã€‚åŒæ—¶ï¼Œå®ƒæ£€æŸ¥ç¨‹åºæä¾›çš„åœ°å€æ˜¯å¦ç­‰äºæˆ–å¤§äºç•Œé™å¯„å­˜å™¨é‡Œçš„å€¼ï¼Œå¦‚æœè®¿é—®çš„åœ°å€è¶…å‡ºäº†ç•Œé™ï¼Œä¼šäº§ç”Ÿé”™è¯¯å¹¶ä¸­æ­¢è®¿é—®ã€‚&lt;/li>
&lt;li>ä½¿ç”¨åŸºå€å¯„å­˜å™¨å’Œç•Œé™å¯„å­˜å™¨æ˜¯ç»™æ¯ä¸ªè¿›ç¨‹æä¾›ç§æœ‰åœ°å€ç©ºé—´çš„éå¸¸å®¹æ˜“çš„æ–¹æ³•ï¼Œå› ä¸ºæ¯ä¸ªå†…å­˜åœ°å€åœ¨é€åˆ°å†…å­˜ä¹‹å‰ï¼Œéƒ½ä¼šè‡ªåŠ¨å…ˆåŠ ä¸ŠåŸºå€å¯„å­˜å™¨çš„å†…å®¹ã€‚&lt;/li>
&lt;li>ä½¿ç”¨åŸºå€å¯„å­˜å™¨å’Œç•Œé™å¯„å­˜å™¨é‡å®šä½çš„&lt;strong>ç¼ºç‚¹&lt;/strong>æ˜¯ï¼Œæ¯æ¬¡è®¿é—®å†…å­˜éƒ½éœ€è¦è¿›è¡ŒåŠ æ³•å’Œæ¯”è¾ƒè¿ç®—ã€‚æ¯”è¾ƒè¿ç®—å¯ä»¥åšå¾—å¾ˆå¿«ï¼Œä½†æ˜¯åŠ æ³•è¿ç®—ç”±äºè¿›ä½ä¼ é€’æ—¶é—´çš„é—®é¢˜ï¼Œåœ¨æ²¡æœ‰ç‰¹æ®Šç”µè·¯çš„æƒ…å†µä¸‹ä¼šæ˜¾å¾—å¾ˆæ…¢ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="322-äº¤æ¢æŠ€æœ¯">3.2.2 äº¤æ¢æŠ€æœ¯
&lt;/h3>&lt;ul>
&lt;li>æ‰€æœ‰è¿›ç¨‹æ‰€éœ€è¦çš„RAMæ•°é‡æ€»å’Œé€šå¸¸è¦è¿œè¿œè¶…å‡ºå­˜å‚¨å™¨èƒ½å¤Ÿæ”¯æŒçš„èŒƒå›´ã€‚&lt;/li>
&lt;li>æœ‰ä¸¤ç§å¤„ç†å†…å­˜è¶…è½½çš„é€šç”¨æ–¹æ³•
&lt;ul>
&lt;li>&lt;strong>äº¤æ¢&lt;/strong>æŠ€æœ¯ï¼Œå³æŠŠä¸€ä¸ªè¿›ç¨‹å®Œæ•´è°ƒå…¥å†…å­˜ï¼Œä½¿è¯¥è¿›ç¨‹è¿è¡Œä¸€æ®µæ—¶é—´ï¼Œç„¶åæŠŠå®ƒå­˜å›ç£ç›˜ã€‚ç©ºé—²è¿›ç¨‹ä¸»è¦å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œæ‰€ä»¥å½“å®ƒä»¬ä¸è¿è¡Œæ—¶å°±ä¸ä¼šå ç”¨å†…å­˜ã€‚&lt;/li>
&lt;li>&lt;strong>è™šæ‹Ÿå†…å­˜&lt;/strong>ï¼Œè¯¥ç­–ç•¥ç”šè‡³èƒ½ä½¿ç¨‹åºåœ¨åªæœ‰ä¸€éƒ¨åˆ†è¢«è°ƒå…¥å†…å­˜çš„æƒ…å†µä¸‹è¿è¡Œã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>äº¤æ¢åœ¨å†…å­˜ä¸­äº§ç”Ÿäº†å¤šä¸ªç©ºé—²åŒºï¼Œé€šè¿‡æŠŠæ‰€æœ‰æ”¾å…¥è¿›ç¨‹å°½å¯èƒ½å‘ä¸‹ç§»åŠ¨ï¼Œæœ‰å¯èƒ½å°†è¿™äº›å°çš„ç©ºé—²åŒºåˆæˆä¸€å¤§å—ã€‚è¯¥æŠ€æœ¯ç§°ä¸º&lt;strong>å†…å­˜ç´§ç¼©&lt;/strong>ã€‚é€šå¸¸ä¸è¿›è¡Œè¿™ä¸ªæ“ä½œï¼Œå› ä¸ºå®ƒè¦è€—è´¹å¤§é‡çš„CPUæ—¶é—´ã€‚&lt;/li>
&lt;li>å¦‚æœå¤§éƒ¨åˆ†è¿›ç¨‹åœ¨è¿è¡Œæ—¶éƒ½è¦å¢é•¿ï¼Œä¸ºäº†å‡å°‘å› å†…å­˜åŒºåŸŸä¸å¤Ÿè€Œå¼•èµ·çš„è¿›ç¨‹äº¤æ¢å’Œç§»åŠ¨æ‰€äº§ç”Ÿçš„å¼€é”€ï¼Œä¸€ç§å¯ç”¨çš„æ–¹æ³•æ˜¯ï¼Œå½“æ¢å…¥æˆ–ç§»åŠ¨è¿›ç¨‹æ—¶ä¸ºå®ƒåˆ†é…ä¸€äº›é¢å¤–çš„å†…å­˜ã€‚ç„¶è€Œï¼Œå½“è¿›ç¨‹è¢«æ¢å‡ºåˆ°ç£ç›˜ä¸Šæ—¶ï¼Œåº”è¯¥åªäº¤æ¢è¿›ç¨‹å®é™…ä¸Šä½¿ç”¨çš„å†…å­˜ä¸­çš„å†…å®¹ï¼Œå°†é¢å¤–çš„å†…å­˜äº¤æ¢å‡ºå»æ˜¯ä¸€ç§æµªè´¹ã€‚&lt;/li>
&lt;li>å¦‚æœè¿›ç¨‹æœ‰ä¸¤ä¸ªå¯å¢é•¿çš„æ®µï¼Œåœ¨ä¸¤è€…ä¹‹é—´çš„å†…å­˜å¯ä¾›ä¸¤ä¸ªæ®µä½¿ç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="323-ç©ºé—²å†…å­˜ç®¡ç†">3.2.3 ç©ºé—²å†…å­˜ç®¡ç†
&lt;/h3>&lt;p>ä¸€èˆ¬è€Œè¨€ï¼Œæœ‰ä¸¤ç§æ–¹æ³•è·Ÿè¸ªå†…å­˜ä½¿ç”¨æƒ…å†µï¼šä½å›¾å’Œç©ºé—²åŒºé“¾è¡¨ã€‚&lt;/p>
&lt;p>&lt;strong>1. ä½¿ç”¨ä½å›¾çš„å­˜å‚¨ç®¡ç†&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ä½å›¾æ–¹æ³•æ—¶ï¼Œå†…å­˜å¯èƒ½è¢«åˆ’åˆ†æˆå°åˆ°å‡ ä¸ªå­—æˆ–å¤§åˆ°å‡ åƒå­—èŠ‚çš„åˆ†é…å•ä½ã€‚æ¯ä¸ªåˆ†é…å•å…ƒå¯¹åº”äºä½å›¾ä¸­çš„ä¸€ä½ï¼Œ0è¡¨ç¤ºç©ºé—²ï¼Œ1è¡¨ç¤ºå æœ‰ï¼ˆæˆ–è€…ç›¸åï¼‰ï¼Œ&lt;/li>
&lt;li>åˆ†é…å•å…ƒçš„å¤§å°æ˜¯ä¸€ä¸ªé‡è¦çš„è®¾è®¡å› ç´ ã€‚åˆ†é…å•å…ƒè¶Šå°ï¼Œä½å›¾è¶Šå¤§ã€‚è‹¥é€‰æ‹©æ¯”è¾ƒå¤§çš„åˆ†é…å•å…ƒï¼Œåˆ™ä½å›¾æ›´å°ã€‚ä½†è‹¥è¿›ç¨‹çš„å¤§å°ä¸æ˜¯åˆ†é…å•å…ƒçš„æ•´æ•°å€ï¼Œé‚£ä¹ˆåœ¨æœ€åä¸€ä¸ªåˆ†é…å•å…ƒä¸­å°±ä¼šæœ‰ä¸€å®šæ•°é‡çš„å†…å­˜è¢«æµªè´¹äº†ã€‚&lt;/li>
&lt;li>è¿™ç§æ–¹æ³•çš„ä¸»è¦é—®é¢˜æ˜¯ï¼Œåœ¨å†³å®šæŠŠä¸€ä¸ªå kä¸ªåˆ†é…å•å…ƒçš„è¿›ç¨‹æ‰å…¥å†…å­˜æ—¶ï¼Œå­˜å‚¨ç®¡ç†å™¨å¿…é¡»æœç´¢ä½å›¾ï¼Œåœ¨ä½å›¾ä¸­æ‰¾å‡ºæœ‰kä¸ªè¿ç»­0çš„ä¸²ã€‚æŸ¥æ‰¾ä½å›¾ä¸­æŒ‡å®šé•¿åº¦çš„è¿ç»­0ä¸²æ˜¯è€—æ—¶çš„æ“ä½œï¼ˆå› ä¸ºåœ¨ä½å›¾ä¸­è¯¥ä¸²å¯èƒ½è·¨è¶Šå­—çš„è¾¹ç•Œï¼‰ï¼Œè¿™æ˜¯&lt;strong>ä½å›¾çš„ç¼ºç‚¹&lt;/strong>ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>2. ä½¿ç”¨é“¾è¡¨çš„å­˜å‚¨ç®¡ç†&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ç»´æŠ¤ä¸€ä¸ªè®°å½•å·²åˆ†é…å†…å­˜æ®µå’Œç©ºé—²å†…å­˜æ®µçš„é“¾è¡¨ã€‚å…¶ä¸­é“¾è¡¨ä¸­çš„ä¸€ä¸ªç»“ç‚¹æˆ–è€…åŒ…å«ä¸€ä¸ªè¿›ç¨‹ï¼Œæˆ–è€…æ˜¯ä¸¤ä¸ªè¿›ç¨‹é—´çš„ä¸€å—ç©ºé—²åŒºã€‚&lt;/li>
&lt;li>é“¾è¡¨ä¸­çš„æ¯ä¸€ä¸ªç»“ç‚¹éƒ½åŒ…å«ä»¥ä¸‹åŸŸï¼šç©ºé—²åŒºï¼ˆHï¼‰æˆ–è¿›ç¨‹ï¼ˆPï¼‰çš„æŒ‡ç¤ºæ ‡å¿—ã€èµ·å§‹åœ°å€ã€é•¿åº¦å’ŒæŒ‡å‘ä¸‹ä¸€ç»“ç‚¹çš„æŒ‡é’ˆã€‚&lt;/li>
&lt;/ul>
&lt;p>å½“æŒ‰ç…§åœ°å€é¡ºåºåœ¨é“¾è¡¨ä¸­å­˜æ”¾è¿›ç¨‹å’Œç©ºé—²åŒºæ—¶ï¼Œå‡ ç§ç®—æ³•å¯ä»¥ç”¨æ¥ä¸ºåˆ›å»ºçš„è¿›ç¨‹åˆ†é…å†…å­˜ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;strong>é¦–æ¬¡é€‚é…&lt;/strong>ç®—æ³•ã€‚å­˜å‚¨ç®¡ç†å™¨æ²¿ç€æ®µé“¾è¡¨è¿›è¡Œæœç´¢ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç©ºé—²åŒºï¼Œé™¤éç©ºé—²åŒºå¤§å°å’Œåˆ†é…çš„ç©ºé—´å¤§å°æ­£å¥½ä¸€æ ·ï¼Œå¦åˆ™å°†è¯¥ç©ºé—²åŒºåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†ä¾›è¿›ç¨‹ä½¿ç”¨ï¼Œå¦ä¸€éƒ¨åˆ†å½¢æˆæ–°çš„ç©ºé—²åŒºã€‚&lt;/li>
&lt;li>&lt;strong>ä¸‹æ¬¡é€‚é…&lt;/strong>ç®—æ³•ã€‚å®ƒçš„å·¥ä½œæ–¹å¼å’Œé¦–æ¬¡é€‚é…ç®—æ³•ç›¸åŒï¼Œä¸åŒç‚¹æ˜¯æ¯æ¬¡æ‰¾åˆ°åˆé€‚çš„ç©ºé—²åŒºæ—¶éƒ½è®°å½•å½“æ—¶çš„ä½ç½®ï¼Œä»¥ä¾¿åœ¨ä¸‹æ¬¡å¯»æ‰¾ç©ºé—²åŒºæ—¶ä»ä¸Šæ¬¡ç»“æŸçš„åœ°æ–¹å¼€å§‹æœç´¢ï¼Œè€Œä¸æ˜¯åƒé¦–æ¬¡é€‚é…ç®—æ³•é‚£æ ·æ¯æ¬¡éƒ½ä»å¤´å¼€å§‹ã€‚ä»¿çœŸç¨‹åºè¡¨æ˜ä¸‹æ¬¡é€‚é…ç®—æ³•æ€§èƒ½ç•¥ä½äºé¦–æ¬¡é€‚é…ç®—æ³•ã€‚&lt;/li>
&lt;li>&lt;strong>æœ€ä½³é€‚é…&lt;/strong>ç®—æ³•ã€‚æœç´¢æ•´ä¸ªé“¾è¡¨ï¼ˆä»å¼€å§‹åˆ°ç»“æŸï¼‰ï¼Œæ‰¾å‡ºèƒ½å¤Ÿå®¹çº³è¿›ç¨‹çš„æœ€å°çš„ç©ºé—²åŒºã€‚æœ€ä½³é€‚é…ç®—æ³•è¯•å›¾æ‰¾å‡ºæœ€æ¥è¿‘å®é™…éœ€è¦çš„ç©ºé—²åŒºï¼Œä»¥æœ€å¥½åœ°åŒ¹é…è¯·æ±‚å’Œå¯ç”¨ç©ºé—²åŒºï¼Œè€Œä¸æ˜¯æ‹†åˆ†ä¸€ä¸ªä»¥åå¯èƒ½ä¼šç”¨åˆ°çš„å¤§çš„ç©ºé—²åŒºã€‚&lt;/li>
&lt;li>å› ä¸ºæ¯æ¬¡è°ƒç”¨æœ€ä½³é€‚é…ç®—æ³•æ—¶éƒ½è¦æœç´¢æ•´ä¸ªé“¾è¡¨ï¼Œæ‰€ä»¥å®ƒè¦æ¯”é¦–æ¬¡é€‚é…ç®—æ³•æ…¢ã€‚è®©äººæ„Ÿåˆ°æœ‰ç‚¹æ„å¤–çš„æ˜¯ï¼Œå®ƒæ¯”é¦–æ¬¡é€‚é…ç®—æ³•æˆ–ä¸‹æ¬¡é€‚é…ç®—æ³•æµªè´¹æ›´å¤šçš„å†…å­˜ï¼Œå› ä¸ºå®ƒä¼šäº§ç”Ÿå¤§é‡æ— ç”¨çš„å°ç©ºé—²åŒºã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé¦–æ¬¡é€‚é…ç®—æ³•ç”Ÿæˆçš„ç©ºé—²åŒºæ›´å¤§ä¸€äº›ã€‚&lt;/li>
&lt;li>&lt;strong>æœ€å·®é€‚é…&lt;/strong>ç®—æ³•ã€‚æ€»æ˜¯åˆ†é…æœ€å¤§çš„å¯ç”¨ç©ºé—²åŒºï¼Œä½¿æ–°çš„ç©ºé—²åŒºæ¯”è¾ƒå¤§ä»è€Œå¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚ä»¿çœŸç¨‹åºè¡¨æ˜æœ€å·®é€‚é…ç®—æ³•ä¹Ÿä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¦‚æœè¿›ç¨‹å’Œç©ºé—²åŒºä½¿ç”¨ä¸åŒçš„é“¾è¡¨ï¼Œåˆ™å¯ä»¥&lt;strong>æŒ‰ç…§å¤§å°å¯¹ç©ºé—²åŒºé“¾è¡¨æ’åº&lt;/strong>ï¼Œä»¥ä¾¿æé«˜æœ€ä½³é€‚é…ç®—æ³•çš„é€Ÿåº¦ã€‚ç©ºé—²åŒºé“¾è¡¨æŒ‰å¤§å°æ’åºæ—¶ï¼Œé¦–æ¬¡é€‚é…ç®—æ³•ä¸æœ€ä½³é€‚é…ç®—æ³•ä¸€æ ·å¿«ï¼Œè€Œä¸‹æ¬¡é€‚é…ç®—æ³•åœ¨è¿™é‡Œåˆ™æ¯«æ— æ„ä¹‰ã€‚&lt;/p>
&lt;p>&lt;strong>å¿«é€Ÿé€‚é…&lt;/strong>ç®—æ³•ï¼Œå®ƒä¸ºé‚£äº›å¸¸ç”¨å¤§å°çš„ç©ºé—²åŒºç»´æŠ¤å•ç‹¬çš„é“¾è¡¨ã€‚å¿«é€Ÿé€‚é…ç®—æ³•å¯»æ‰¾ä¸€ä¸ªæŒ‡å®šå¤§å°çš„ç©ºé—²åŒºæ˜¯ååˆ†å¿«é€Ÿçš„ï¼Œä½†å®ƒå’Œæ‰€æœ‰å°†ç©ºé—²åŒºæŒ‰å¤§å°æ’åºçš„æ–¹æ¡ˆä¸€æ ·ï¼Œéƒ½æœ‰ä¸€ä¸ªå…±åŒçš„ç¼ºç‚¹ï¼Œå³åœ¨ä¸€ä¸ªè¿›ç¨‹ç»ˆæ­¢æˆ–è¢«æ¢å‡ºæ—¶ï¼Œå¯»æ‰¾å®ƒçš„ç›¸é‚»å—å¹¶æŸ¥çœ‹æ˜¯å¦å¯ä»¥åˆå¹¶çš„è¿‡ç¨‹æ˜¯éå¸¸è€—æ—¶çš„ã€‚å¦‚æœä¸è¿›è¡Œåˆå¹¶ï¼Œå†…å­˜å°†ä¼šå¾ˆå¿«åˆ†è£‚å‡ºå¤§é‡çš„è¿›ç¨‹æ— æ³•åˆ©ç”¨çš„å°ç©ºé—²åŒºã€‚&lt;/p>
&lt;h2 id="33-è™šæ‹Ÿå†…å­˜">3.3 è™šæ‹Ÿå†…å­˜
&lt;/h2>&lt;ul>
&lt;li>è¿˜æœ‰å¦å¤–ä¸€ä¸ªé—®é¢˜éœ€è¦è§£å†³ï¼šç®¡ç†è½¯ä»¶çš„è†¨èƒ€ã€‚&lt;/li>
&lt;li>ç¨‹åºå¤§äºå†…å­˜ï¼Œä¸€ç§è§£å†³æ–¹æ³•æ˜¯æŠŠç¨‹åºåˆ†å‰²æˆè®¸å¤šç‰‡æ®µï¼Œç§°ä¸º&lt;strong>è¦†ç›–&lt;/strong>ã€‚ä½†æ˜¯æŠŠä¸€ä¸ªç¨‹åºåˆ†å‰²æˆå°çš„ã€æ¨¡å—åŒ–çš„ç‰‡æ®µæ˜¯éå¸¸è´¹æ—¶å’Œæ¯ç‡¥çš„ï¼Œå¹¶ä¸”å®¹æ˜“å‡ºé”™ã€‚å¾ˆå°‘ç¨‹åºå‘˜æ“…é•¿ä½¿ç”¨è¦†ç›–æŠ€æœ¯ã€‚&lt;/li>
&lt;li>&lt;strong>è™šæ‹Ÿå†…å­˜&lt;/strong>æŠ€æœ¯ã€‚å…¶åŸºæœ¬æ€æƒ³æ˜¯ï¼šæ¯ä¸ªç¨‹åºæ‹¥æœ‰è‡ªå·±çš„åœ°å€ç©ºé—´ï¼Œè¿™ä¸ªç©ºé—´è¢«åˆ†å‰²æˆå¤šä¸ªå—ï¼Œæ¯ä¸€å—ç§°ä½œä¸€&lt;strong>é¡µ&lt;/strong>æˆ–&lt;strong>é¡µé¢&lt;/strong>ã€‚æ¯ä¸€é¡µæœ‰è¿ç»­çš„åœ°å€èŒƒå›´ã€‚è¿™äº›é¡µè¢«æ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„é¡µéƒ½å¿…é¡»åœ¨å†…å­˜ä¸­æ‰èƒ½è¿è¡Œç¨‹åºã€‚å½“ç¨‹åºå¼•ç”¨åˆ°ä¸€éƒ¨åˆ†åœ¨ç‰©ç†å†…å­˜ä¸­çš„åœ°å€ç©ºé—´æ—¶ï¼Œç”±ç¡¬ä»¶ç«‹å³æ‰§è¡Œå¿…è¦çš„æ˜ å°„ã€‚å½“ç¨‹åºå¼•ç”¨åˆ°ä¸€éƒ¨åˆ†ä¸åœ¨ç‰©ç†å†…å­˜ä¸­çš„åœ°å€ç©ºé—´æ—¶ï¼Œç”±æ“ä½œç³»ç»Ÿè´Ÿè´£å°†ç¼ºå¤±çš„éƒ¨åˆ†è£…å…¥ç‰©ç†å†…å­˜å¹¶é‡æ–°æ‰§è¡Œå¤±è´¥çš„æŒ‡ä»¤ã€‚&lt;/li>
&lt;li>ä»æŸä¸ªè§’åº¦æ¥è®²ï¼Œè™šæ‹Ÿå†…å­˜æ˜¯å¯¹åŸºå€å¯„å­˜å™¨å’Œç•Œé™å¯„å­˜å™¨çš„ä¸€ç§ç»¼åˆã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="331-åˆ†é¡µ">3.3.1 åˆ†é¡µ
&lt;/h3>&lt;ul>
&lt;li>ç”±ç¨‹åºäº§ç”Ÿçš„è¿™äº›åœ°å€ç§°ä¸º&lt;strong>è™šæ‹Ÿåœ°å€&lt;/strong>ï¼Œå®ƒä»¬æ„æˆäº†ä¸€ä¸ª&lt;strong>è™šæ‹Ÿåœ°å€ç©ºé—´&lt;/strong>ã€‚åœ¨ä½¿ç”¨è™šæ‹Ÿå†…å­˜çš„æƒ…å†µä¸‹ï¼Œè™šæ‹Ÿåœ°å€ä¸æ˜¯è¢«ç›´æ¥é€åˆ°å†…å­˜æ€»çº¿ä¸Šï¼Œè€Œæ˜¯è¢«é€åˆ°&lt;strong>å†…å­˜ç®¡ç†å•å…ƒ&lt;/strong>ï¼ˆMemory Management Unit, MMUï¼‰ï¼ŒMMUæŠŠè™šæ‹Ÿåœ°å€æ˜ å°„ä¸ºç‰©ç†å†…å­˜åœ°å€ã€‚&lt;/li>
&lt;li>è™šæ‹Ÿåœ°å€ç©ºé—´æŒ‰ç…§å›ºå®šå¤§å°åˆ’åˆ†æˆè¢«ç§°ä¸ºé¡µé¢çš„è‹¥å¹²å•å…ƒã€‚åœ¨ç‰©ç†å†…å­˜ä¸­å¯¹åº”çš„å•å…ƒç§°ä¸º&lt;strong>é¡µæ¡†&lt;/strong>ã€‚é¡µé¢å’Œé¡µæ¡†çš„å¤§å°é€šå¸¸æ˜¯ä¸€æ ·çš„ã€‚RAMå’Œç£ç›˜ä¹‹é—´çš„äº¤æ¢æ€»æ˜¯ä»¥æ•´ä¸ªé¡µé¢ä¸ºå•å…ƒè¿›è¡Œçš„ã€‚&lt;/li>
&lt;li>é€šè¿‡æ°å½“åœ°è®¾ç½®MMUï¼Œå¯ä»¥æŠŠ16ä¸ªè™šæ‹Ÿé¡µé¢æ˜ å°„åˆ°8ä¸ªé¡µæ¡†ä¸­çš„ä»»ä½•ä¸€ä¸ªã€‚&lt;/li>
&lt;li>MMUæ³¨æ„åˆ°è¯¥é¡µé¢æ²¡æœ‰è¢«æ˜ å°„ï¼Œäºæ˜¯ä½¿CPUé™·å…¥åˆ°æ“ä½œç³»ç»Ÿï¼Œè¿™ä¸ªé™·é˜±ç§°ä¸º&lt;strong>ç¼ºé¡µä¸­æ–­&lt;/strong>æˆ–&lt;strong>ç¼ºé¡µé”™è¯¯&lt;/strong>ã€‚æ“ä½œç³»ç»Ÿæ‰¾åˆ°ä¸€ä¸ªå¾ˆå°‘ä½¿ç”¨çš„é¡µæ¡†ä¸”æŠŠå®ƒçš„å†…å®¹å†™å…¥åˆ°ç£ç›˜ï¼ˆå¦‚æœå®ƒä¸åœ¨ç£ç›˜ä¸Šï¼‰ã€‚éšåæŠŠéœ€è¦è®¿é—®çš„é¡µé¢è¯»åˆ°åˆšæ‰å›æ”¶çš„é¡µæ¡†ä¸­ï¼Œä¿®æ”¹æ˜ å°„å…³ç³»ï¼Œç„¶åé‡æ–°å¯åŠ¨å¼•èµ·é™·é˜±çš„æŒ‡ä»¤ã€‚&lt;/li>
&lt;li>MMUå†…éƒ¨ç»“æ„ï¼Œäº†è§£ä¸ºä»€ä¹ˆæˆ‘ä»¬é€‰ç”¨çš„é¡µé¢å¤§å°éƒ½æ˜¯2çš„æ•´æ•°æ¬¡å¹‚ã€‚è¾“å…¥çš„16ä½è™šæ‹Ÿåœ°å€è¢«åˆ†ä¸º4ä½çš„é¡µå·å’Œ12ä½çš„åç§»é‡ã€‚å¯ç”¨é¡µå·åº§ä½&lt;strong>é¡µè¡¨&lt;/strong>çš„ç´¢å¼•ï¼Œä»¥å¾—å‡ºå¯¹åº”äºè¯¥è™šæ‹Ÿé¡µé¢çš„é¡µæ¡†å·ã€‚å¦‚æœâ€œåœ¨/ä¸åœ¨â€ä½ä¸º1ï¼Œåˆ™å°†åœ¨é¡µè¡¨ä¸­æŸ¥åˆ°çš„é¡µæ¡†å·å¤åˆ¶åˆ°è¾“å‡ºå¯„å­˜å™¨çš„é«˜3ä½ä¸­ï¼Œå†åŠ ä¸Šè¾“å…¥è™šæ‹Ÿåœ°å€ä¸­çš„ä½12ä½åç§»é‡ï¼Œå¦‚æ­¤å°±æ„æˆäº†15ä½çš„ç‰©ç†åœ°å€ã€‚è¾“å‡ºå¯„å­˜å™¨çš„å†…å®¹éšå³å¯è¢«ä½œä¸ºç‰©ç†åœ°å€é€åˆ°å†…å­˜æ€»çº¿ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="332-é¡µè¡¨">3.3.2 é¡µè¡¨
&lt;/h3>&lt;ul>
&lt;li>è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„ä¸€ç§ç®€å•å®ç°å¯ä»¥æ¦‚æ‹¬ä¸ºï¼šè™šæ‹Ÿåœ°å€è¢«åˆ†ä¸ºè™šæ‹Ÿé¡µå·ï¼ˆé«˜ä½éƒ¨åˆ†ï¼‰å’Œåç§»é‡ï¼ˆä½ä½éƒ¨åˆ†ï¼‰ä¸¤éƒ¨åˆ†ã€‚&lt;/li>
&lt;li>è™šæ‹Ÿé¡µå·å¯ç”¨ä½œé¡µè¡¨çš„ç´¢å¼•ï¼Œä»¥æ‰¾åˆ°è¯¥è™šæ‹Ÿé¡µé¢å¯¹åº”çš„é¡µè¡¨é¡¹ã€‚ç”±é¡µè¡¨é¡¹å¯ä»¥æ‰¾åˆ°é¡µæ¡†å·ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚ç„¶åæŠŠé¡µæ¡†å·æ‹¼æ¥åˆ°åç§»é‡çš„é«˜ä½ç«¯ï¼Œä»¥æ›¿æ¢æ‰è™šæ‹Ÿé¡µå·ï¼Œå½¢æˆé€å¾€å†…å­˜çš„ç‰©ç†åœ°å€ã€‚&lt;/li>
&lt;li>é¡µè¡¨çš„ç›®çš„æ˜¯æŠŠè™šæ‹Ÿé¡µé¢æ˜ å°„åˆ°é¡µæ¡†ã€‚ä»æ•°å­¦è§’åº¦è¯´ï¼Œé¡µè¡¨æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒçš„å‚æ•°æ˜¯è™šæ‹Ÿé¡µå·ï¼Œç»“æœæ˜¯ç‰©ç†é¡µæ¡†å·ã€‚é€šè¿‡è¿™ä¸ªå‡½æ•°å¯ä»¥æŠŠè™šæ‹Ÿåœ°å€ä¸­çš„è™šæ‹Ÿé¡µé¢åŸŸæ›¿æ¢æˆé¡µæ¡†åŸŸï¼Œä»è€Œå½¢æˆç‰©ç†åœ°å€ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>é¡µè¡¨é¡¹çš„ç»“æ„&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>é¡µæ¡†å·&lt;/li>
&lt;li>â€œåœ¨/ä¸åœ¨â€ä½&lt;/li>
&lt;li>ä¿æŠ¤ä½æŒ‡å‡ºä¸€ä¸ªé¡µå…è®¸ä»€ä¹ˆç±»å‹çš„è®¿é—®ã€‚&lt;/li>
&lt;li>ä¸ºäº†è®°å½•é¡µé¢çš„ä½¿ç”¨çŠ¶å†µï¼Œå¼•å…¥äº†ä¿®æ”¹ä½å’Œè®¿é—®ä½ã€‚&lt;/li>
&lt;li>ä¸è®ºæ˜¯è¯»è¿˜æ˜¯å†™ï¼Œç³»ç»Ÿéƒ½ä¼šåœ¨è¯¥é¡µé¢è¢«è®¿é—®æ—¶è®¾ç½®è®¿é—®ä½ã€‚å®ƒçš„å€¼è¢«ç”¨æ¥å¸®åŠ©æ“ä½œç³»ç»Ÿåœ¨å‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶é€‰æ‹©è¦è¢«æ·˜æ±°çš„é¡µé¢ã€‚ä¸å†ä½¿ç”¨çš„é¡µé¢è¦æ¯”æ­£åœ¨ä½¿ç”¨çš„é¡µé¢æ›´é€‚åˆæ·˜æ±°ã€‚&lt;/li>
&lt;li>æœ€åä¸€ä½ç”¨äºç¦æ­¢è¯¥é¡µé¢è¢«é«˜é€Ÿç¼“å­˜ã€‚&lt;/li>
&lt;/ul>
&lt;p>åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œè‹¥æŸä¸ªé¡µé¢ä¸åœ¨å†…å­˜ä¸­ï¼Œç”¨äºä¿æŠ¤è¯¥é¡µé¢çš„ç£ç›˜åœ°å€ä¸æ˜¯é¡µè¡¨çš„ç»„æˆéƒ¨åˆ†ã€‚&lt;/p>
&lt;p>&lt;strong>è™šæ‹Ÿå†…å­˜æœ¬è´¨&lt;/strong>ä¸Šæ˜¯ç”¨æ¥åˆ›é€ ä¸€ä¸ªæ–°çš„æŠ½è±¡æ¦‚å¿µâ€”â€”åœ°å€ç©ºé—´ï¼Œè¿™ä¸ªæ¦‚å¿µæ˜¯å¯¹ç‰©ç†å†…å­˜çš„æŠ½è±¡ï¼Œç±»ä¼¼äºè¿›ç¨‹æ˜¯å¯¹ç‰©ç†å¤„ç†å™¨ï¼ˆCPUï¼‰çš„æŠ½è±¡ã€‚è™šæ‹Ÿå†…å­˜çš„å®ç°ï¼Œæ˜¯å°†è™šæ‹Ÿåœ°å€ç©ºé—´åˆ†è§£æˆé¡µï¼Œå¹¶å°†æ¯ä¸€é¡µæ˜ å°„åˆ°ç‰©ç†å†…å­˜çš„æŸä¸ªé¡µæ¡†æˆ–è€…ï¼ˆæš‚æ—¶ï¼‰è§£é™¤æ˜ å°„ã€‚&lt;/p>
&lt;h3 id="333-åŠ é€Ÿåˆ†é¡µè¿‡ç¨‹">3.3.3 åŠ é€Ÿåˆ†é¡µè¿‡ç¨‹
&lt;/h3>&lt;p>åœ¨ä»»ä½•åˆ†é¡µç³»ç»Ÿä¸­ï¼Œéƒ½éœ€è¦è€ƒè™‘ä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼š&lt;/p>
&lt;ol>
&lt;li>è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„å¿…é¡»éå¸¸å¿«ã€‚&lt;/li>
&lt;li>å¦‚æœè™šæ‹Ÿåœ°å€ç©ºé—´å¾ˆå¤§ï¼Œé¡µè¡¨ä¹Ÿä¼šå¾ˆå¤§ã€‚&lt;/li>
&lt;/ol>
&lt;p>ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ç”±äºæ¯æ¬¡è®¿é—®å†…å­˜éƒ½éœ€è¦è¿›è¡Œè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„ï¼Œæ‰€æœ‰çš„æŒ‡ä»¤æœ€ç»ˆéƒ½å¿…é¡»æ¥è‡ªå†…å­˜ï¼Œå¹¶ä¸”å¾ˆå¤šæŒ‡ä»¤ä¹Ÿä¼šè®¿é—®å†…å­˜ä¸­çš„æ“ä½œæ•°ã€‚&lt;/p>
&lt;p>ç¬¬äºŒä¸ªé—®é¢˜æ¥è‡ªç°ä»£è®¡ç®—æœºä½¿ç”¨è‡³å°‘32ä½çš„è™šæ‹Ÿåœ°å€ï¼Œè€Œä¸”64ä½å˜å¾—è¶Šæ¥è¶Šæ™®éã€‚&lt;/p>
&lt;p>å¯¹å¤§è€Œå¿«é€Ÿçš„é¡µæ˜ å°„çš„éœ€æ±‚ç§°ä¸ºæ„å»ºè®¡ç®—æœºçš„é‡è¦çº¦æŸã€‚ä¸€ç§ç®€å•çš„è®¾è®¡æ˜¯ä½¿ç”¨â€œå¿«é€Ÿç¡¬ä»¶å¯„å­˜å™¨â€ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä¼˜åŠ¿æ˜¯ç®€å•å¹¶ä¸”åœ¨æ˜ å°„è¿‡ç¨‹ä¸­ä¸éœ€è¦è®¿é—®å†…å­˜ã€‚è€Œç¼ºç‚¹æ˜¯åœ¨é¡µè¡¨å¾ˆå¤§æ—¶ï¼Œä»£ä»·é«˜æ˜‚ã€‚è€Œä¸”æ¯ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢éƒ½å¿…é¡»è£…è½½æ•´ä¸ªé¡µè¡¨ï¼Œè¿™æ ·ä¼šé™ä½æ€§èƒ½ã€‚å¦ä¸€ç§æç«¯çš„æ–¹æ³•æ˜¯ï¼Œæ•´ä¸ªé¡µè¡¨éƒ½åœ¨å†…å­˜ä¸­ã€‚è¿™ç§åšæ³•çš„ç¼ºé™·æ˜¯åœ¨æ‰§è¡Œæ¯æ¡æŒ‡ä»¤æ—¶ï¼Œéƒ½éœ€è¦ä¸€æ¬¡æˆ–å¤šæ¬¡å†…å­˜è®¿é—®æ¥å®Œæˆé¡µè¡¨é¡¹çš„è¯»å…¥ï¼Œé€Ÿåº¦éå¸¸æ…¢ã€‚&lt;/p>
&lt;p>&lt;strong>1. è½¬æ¢æ£€æµ‹ç¼“å†²åŒº&lt;/strong>&lt;/p>
&lt;p>æœ‰äº†åˆ†é¡µæœºåˆ¶åï¼Œä¼šå› ä¸ºè¦è®¿é—®é¡µè¡¨è€Œå¼•èµ·æ›´å¤šæ¬¡çš„å†…å­˜è®¿é—®ã€‚&lt;/p>
&lt;p>ä¸€ç§è§£å†³æ–¹æ¡ˆçš„å»ºç«‹åŸºäºè¿™æ ·ä¸€ç§è§‚å¯Ÿï¼šå¤§å¤šæ•°ç¨‹åºæ€»æ˜¯å¯¹å°‘é‡çš„é¡µé¢è¿›è¡Œå¤šæ¬¡çš„è®¿é—®ï¼Œè€Œä¸æ˜¯ç›¸åã€‚å› æ­¤ï¼Œåªæœ‰å¾ˆå°‘çš„é¡µè¡¨é¡¹ä¼šè¢«åå¤è¯»å–ï¼Œè€Œå…¶ä»–çš„é¡µè¡¨é¡¹å¾ˆå°‘è¢«è®¿é—®ã€‚&lt;/p>
&lt;p>ä¸ºè®¡ç®—æœºè®¾ç½®ä¸€ä¸ªå°å‹çš„ç¡¬ä»¶è®¾å¤‡ï¼Œå°†è™šæ‹Ÿåœ°å€ç›´æ¥æ˜ å°„åˆ°ç‰©ç†åœ°å€ï¼Œè€Œä¸å¿…å†è®¿é—®é¡µè¡¨ã€‚è¿™ç§è®¾å¤‡ç§°ä¸º&lt;strong>è½¬æ¢æ£€æµ‹ç¼“å†²åŒº&lt;/strong>ï¼ˆTranslation Lookaside Buffer, &lt;strong>TLB&lt;/strong>ï¼‰ï¼Œæœ‰æ—¶åˆç§°ä¸º&lt;strong>ç›¸è”å­˜å‚¨å™¨&lt;/strong>æˆ–&lt;strong>å¿«è¡¨&lt;/strong>ã€‚å®ƒé€šå¸¸åœ¨MMUä¸­ï¼Œæ¯ä¸ªè¡¨é¡¹è®°å½•äº†ä¸€ä¸ªé¡µé¢çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬è™šæ‹Ÿé¡µå·ã€é¡µé¢çš„ä¿®æ”¹ä½ã€ä¿æŠ¤ç ï¼ˆè¯»/å†™/æ‰§è¡Œæƒé™ï¼‰å’Œè¯¥é¡µæ‰€å¯¹åº”çš„ç‰©ç†é¡µæ¡†ã€‚&lt;/p>
&lt;p>å¦‚æœå‘ç°äº†ä¸€ä¸ªæœ‰æ•ˆçš„åŒ¹é…å¹¶ä¸”è¦è¿›è¡Œçš„è®¿é—®æ“ä½œå¹¶ä¸è¿åä¿æŠ¤ä½ï¼Œåˆ™å°†é¡µæ¡†å·ç›´æ¥ä»TLBä¸­å–å‡ºè€Œä¸å¿…å†è®¿é—®é¡µè¡¨ã€‚å¦‚æœè™šæ‹Ÿé¡µå·ç¡®å®æ˜¯åœ¨TLBä¸­ï¼Œä½†æŒ‡ä»¤è¯•å›¾åœ¨ä¸€ä¸ªåªè¯»é¡µé¢ä¸Šè¿›è¡Œå†™æ“ä½œï¼Œåˆ™ä¼šäº§ç”Ÿä¸€ä¸ªä¿æŠ¤é”™è¯¯ï¼Œå°±åƒå¯¹é¡µè¡¨è¿›è¡Œéæ³•è®¿é—®ä¸€æ ·ã€‚å¦‚æœMMUæ£€æµ‹åˆ°æ²¡æœ‰æœ‰æ•ˆçš„åŒ¹é…é¡¹ï¼Œå°±ä¼šè¿›è¡Œæ­£å¸¸çš„é¡µè¡¨æŸ¥è¯¢ã€‚æ¥ç€ä»TLBä¸­æ·˜æ±°ä¸€ä¸ªè¡¨é¡¹ï¼Œç„¶åç”¨æ–°æ‰¾åˆ°çš„é¡µè¡¨é¡¹ä»£æ›¿å®ƒã€‚å½“ä¸€ä¸ªè¡¨é¡¹è¢«æ¸…é™¤å‡ºTLBæ—¶ï¼Œå°†ä¿®æ”¹ä½å¤åˆ¶åˆ°å†…å­˜ä¸­çš„é¡µè¡¨é¡¹ï¼Œè€Œé™¤äº†è®¿é—®ä½ï¼Œå…¶ä»–çš„å€¼ä¸å˜ã€‚å½“é¡µè¡¨é¡¹ä»é¡µè¡¨è£…å…¥TLBä¸­æ—¶ï¼Œæ‰€æœ‰çš„å€¼éƒ½æ¥è‡ªå†…å­˜ã€‚&lt;/p>
&lt;p>&lt;strong>2. è½¯ä»¶TLBç®¡ç†&lt;/strong>&lt;/p>
&lt;p>è®¸å¤šç°ä»£çš„RISCæœºå™¨ï¼Œå‡ ä¹æ‰€æœ‰çš„é¡µé¢ç®¡ç†éƒ½æ˜¯åœ¨è½¯ä»¶ä¸­å®ç°çš„ã€‚å½“å‘ç”ŸTLBè®¿é—®å¤±æ•ˆæ—¶ï¼Œä¸å†ç”±MMUåˆ°é¡µè¡¨ä¸­æŸ¥æ‰¾å¹¶å–å‡ºéœ€è¦çš„é¡µè¡¨é¡¹ï¼Œè€Œæ˜¯ç”Ÿæˆä¸€ä¸ªTLBå¤±æ•ˆå¹¶å°†é—®é¢˜äº¤ç»™æ“ä½œç³»ç»Ÿè§£å†³ã€‚&lt;/p>
&lt;p>å¦‚æœTLBå¤§åˆ°ï¼ˆå¦‚64ä¸ªè¡¨é¡¹ï¼‰å¯ä»¥å‡å°‘å¤±æ•ˆç‡æ—¶ï¼ŒTLBçš„è½¯ä»¶ç®¡ç†å°±ä¼šå˜å¾—è¶³å¤Ÿæœ‰æ•ˆã€‚&lt;/p>
&lt;p>æ— è®ºæ˜¯ç”¨ç¡¬ä»¶è¿˜æ˜¯è½¯ä»¶æ¥å¤„ç†TLBå¤±æ•ˆï¼Œå¸¸è§æ–¹æ³•éƒ½æ˜¯æ‰¾åˆ°é¡µè¡¨å¹¶æ‰§è¡Œç´¢å¼•æ“ä½œä»¥å®šä½å°†è¦è®¿é—®çš„é¡µé¢ã€‚å¯ä»¥é€šè¿‡åœ¨å†…å­˜ä¸­çš„å›ºå®šä½ç½®ç»´æŠ¤ä¸€ä¸ªå¤§çš„ï¼ˆå¦‚4KBï¼‰TLBè¡¨é¡¹çš„è½¯ä»¶é«˜é€Ÿç¼“å­˜æ¥å‡å°‘TLBå¤±æ•ˆã€‚&lt;/p>
&lt;p>å½“ä¸€ä¸ªé¡µé¢è®¿é—®åœ¨å†…å­˜ä¸­è€Œä¸åœ¨TLBä¸­æ—¶ï¼Œå°†äº§ç”Ÿ&lt;strong>è½¯å¤±æ•ˆ&lt;/strong>ã€‚å½“é¡µé¢æœ¬èº«ä¸åœ¨å†…å­˜ä¸­ï¼ˆå½“ç„¶ä¹Ÿä¸åœ¨TLBä¸­ï¼‰æ—¶ï¼Œå°†äº§ç”Ÿ&lt;strong>ç¡¬å¤±æ•ˆ&lt;/strong>ã€‚&lt;/p>
&lt;p>å¼•å‘ç¼ºé¡µé”™è¯¯çš„å‡ ç§æƒ…å†µï¼š&lt;/p>
&lt;ul>
&lt;li>æ¬¡è¦ç¼ºé¡µé”™è¯¯&lt;/li>
&lt;li>ä¸¥é‡ç¼ºé¡µé”™è¯¯&lt;/li>
&lt;li>æ®µé”™è¯¯&lt;/li>
&lt;/ul>
&lt;h3 id="334-é’ˆå¯¹å¤§å†…å­˜çš„é¡µè¡¨">3.3.4 é’ˆå¯¹å¤§å†…å­˜çš„é¡µè¡¨
&lt;/h3>&lt;p>&lt;strong>1. å¤šçº§é¡µè¡¨&lt;/strong>&lt;/p>
&lt;p>å¼•å…¥å¤šçº§é¡µè¡¨çš„åŸå› æ˜¯é¿å…æŠŠå…¨éƒ¨é¡µè¡¨ä¸€ç›´ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚ç‰¹åˆ«æ˜¯é‚£äº›ä»ä¸éœ€è¦çš„é¡µè¡¨å°±ä¸åº”è¯¥ä¿ç•™ã€‚&lt;/p>
&lt;p>å¤šç†è§£ä¹¦ä¸­çš„ä¾‹å­ã€‚&lt;/p>
&lt;p>&lt;strong>2. å€’æ’é¡µè¡¨&lt;/strong>&lt;/p>
&lt;p>åœ¨è¿™ç§è®¾è®¡ä¸­ï¼Œå®é™…å†…å­˜ä¸­çš„æ¯ä¸ªé¡µæ¡†å¯¹åº”ä¸€ä¸ªè¡¨é¡¹ï¼Œè€Œä¸æ˜¯æ¯ä¸ªè™šæ‹Ÿé¡µé¢å¯¹åº”ä¸€ä¸ªè¡¨é¡¹ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸¥é‡çš„ä¸è¶³ï¼šä»è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢ä¼šå˜å¾—å¾ˆå›°éš¾ã€‚&lt;/p>
&lt;p>å¯ä»¥ä½¿ç”¨TLBã€‚å®ç°æœç´¢çš„ä¸€ä¸ªå¯è¡Œçš„æ–¹æ³•æ˜¯å»ºç«‹ä¸€å¼ æ•£åˆ—è¡¨ï¼Œç”¨è™šæ‹Ÿåœ°å€æ¥æ•£åˆ—ã€‚å¦‚æœæ•£åˆ—è¡¨ä¸­çš„æ§½æ•°ä¸æœºå™¨ä¸­ç‰©ç†é¡µé¢æ•°ä¸€æ ·å¤šï¼Œé‚£ä¹ˆæ•£åˆ—è¡¨çš„å†²çªé“¾çš„å¹³å‡é•¿åº¦ä¼šæ˜¯ä¸€ä¸ªè¡¨é¡¹çš„é•¿åº¦ï¼Œè¿™å°†ä¼šå¤§å¤§æé«˜æ˜ å°„é€Ÿåº¦ã€‚ä¸€æ—¦é¡µæ¡†å·è¢«æ‰¾åˆ°ï¼Œæ–°çš„ï¼ˆè™šæ‹Ÿé¡µå·ï¼Œç‰©ç†é¡µæ¡†å·ï¼‰å¯¹å°±ä¼šè¢«è£…è½½åˆ°TLBä¸­ã€‚&lt;/p>
&lt;p>å€’æ’é¡µè¡¨åœ¨64ä½æœºå™¨ä¸­å¾ˆå¸¸è§ã€‚&lt;/p>
&lt;h2 id="34-é¡µé¢ç½®æ¢ç®—æ³•">3.4 é¡µé¢ç½®æ¢ç®—æ³•
&lt;/h2>&lt;p>å½“å‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»åœ¨å†…å­˜ä¸­é€‰æ‹©ä¸€ä¸ªé¡µé¢å°†å…¶æ¢å‡ºå†…å­˜ï¼Œä»¥ä¾¿ä¸ºå³å°†è°ƒå…¥çš„é¡µé¢è…¾å‡ºç©ºé—´ã€‚å¦‚æœè¦æ¢å‡ºçš„é¡µé¢åœ¨å†…å­˜é©»ç•™æœŸé—´å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œå°±å¿…é¡»æŠŠå®ƒå†™å›ç£ç›˜ä»¥æ›´æ–°è¯¥é¡µé¢åœ¨ç£ç›˜ä¸Šçš„å‰¯æœ¬ï¼›å¦‚æœè¯¥é¡µé¢æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ï¼ˆå¦‚ä¸€ä¸ªåŒ…å«ç¨‹åºæ­£æ–‡çš„é¡µé¢ï¼‰ï¼Œé‚£ä¹ˆå®ƒåœ¨ç£ç›˜ä¸Šçš„å‰¯æœ¬å·²ç»æ˜¯æœ€æ–°çš„ï¼Œä¸éœ€è¦å›å†™ã€‚ç›´æ¥ç”¨è°ƒå…¥çš„é¡µé¢è¦†ç›–è¢«æ·˜æ±°çš„é¡µé¢å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;p>å½“éœ€è¦ä»å†…å­˜ä¸­æ¢å‡ºæŸä¸ªé¡µé¢æ—¶ï¼Œå®ƒæ˜¯å¦åªèƒ½æ˜¯ç¼ºé¡µè¿›ç¨‹è‡ªå·±çš„é¡µé¢ï¼Ÿè¿™ä¸ªè¦æ¢å‡ºçš„é¡µé¢æ˜¯å¦å¯ä»¥å±äºå¦å¤–ä¸€ä¸ªè¿›ç¨‹ï¼Ÿåœ¨å‰ä¸€ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æœ‰æ•ˆåœ°å°†æ¯ä¸€ä¸ªè¿›ç¨‹é™å®šåœ¨å›ºå®šçš„é¡µé¢æ•°ç›®å†…ï¼›åä¸€ç§æƒ…å†µåˆ™ä¸èƒ½ã€‚&lt;/p>
&lt;h3 id="341-æœ€ä¼˜é¡µé¢ç½®æ¢ç®—æ³•">3.4.1 æœ€ä¼˜é¡µé¢ç½®æ¢ç®—æ³•
&lt;/h3>&lt;p>&lt;strong>ç®—æ³•å·¥ä½œåŸç†&lt;/strong>ï¼šåœ¨ç¼ºé¡µä¸­æ–­å‘ç”Ÿæ—¶ï¼Œæœ‰äº›é¡µé¢åœ¨å†…å­˜ä¸­ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªé¡µé¢ï¼ˆåŒ…å«ç´§æ¥ç€çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„é‚£ä¸ªé¡µé¢ï¼‰å°†å¾ˆå¿«è¢«è®¿é—®ï¼Œå…¶ä»–é¡µé¢åˆ™å¯èƒ½è¦åˆ°10ã€100æˆ–1000æ¡æŒ‡ä»¤åæ‰ä¼šè¢«è®¿é—®ï¼Œæ¯ä¸ªé¡µé¢éƒ½å¯ä»¥ç”¨åœ¨è¯¥é¡µé¢é¦–æ¬¡è¢«è®¿é—®å‰æ‰€è¦æ‰§è¡Œçš„æŒ‡ä»¤æ•°ä½œä¸ºæ ‡è®°ã€‚&lt;/p>
&lt;p>æœ€ä¼˜é¡µé¢ç½®æ¢ç®—æ³•è§„å®šåº”è¯¥ç½®æ¢æ ‡è®°æœ€å¤§çš„é¡µé¢ã€‚&lt;/p>
&lt;p>è¿™ä¸ªç®—æ³•å”¯ä¸€çš„é—®é¢˜å°±æ˜¯å®ƒæ˜¯æ— æ³•å®ç°çš„ã€‚å½“ç¼ºé¡µä¸­æ–­å‘ç”Ÿæ—¶ï¼Œæ“ä½œç³»ç»Ÿæ— æ³•çŸ¥é“å„ä¸ªé¡µé¢ä¸‹ä¸€æ¬¡å°†åœ¨ä»€ä¹ˆæ—¶å€™è¢«è®¿é—®ã€‚ç”¨è¿™ç§æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡æœ€ä¼˜é¡µé¢ç½®æ¢ç®—æ³•å¯¹å…¶ä»–å¯å®ç°ç®—æ³•çš„æ€§èƒ½è¿›è¡Œæ¯”è¾ƒã€‚&lt;/p>
&lt;p>ä¸ºäº†é¿å…æ··æ·†ï¼Œå¿…é¡»æ¸…æ¥šä»¥ä¸Šé¡µé¢è®¿é—®æƒ…å†µçš„è®°å½•åªé’ˆå¯¹åˆšåˆšè¢«æµ‹è¯•è¿‡çš„ç¨‹åºå’Œå®ƒçš„ä¸€ä¸ªç‰¹å®šçš„è¾“å…¥ã€‚&lt;/p>
&lt;h3 id="342-æœ€è¿‘æœªä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•">3.4.2 æœ€è¿‘æœªä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•
&lt;/h3>&lt;p>ç³»ç»Ÿä¸ºæ¯ä¸€é¡µé¢è®¾ç½®äº†ä¸¤ä¸ªçŠ¶æ€ä½ã€‚å½“é¡µé¢è¢«è®¿é—®ï¼ˆè¯»æˆ–å†™ï¼‰æ—¶è®¾ç½®Rä½ï¼›å½“é¡µé¢è¢«å†™å…¥ï¼ˆå³ä¿®æ”¹ï¼‰æ—¶è®¾ç½®Mä½ã€‚ä¸€æ—¦è®¾ç½®æŸä½ä¸º1ï¼Œå®ƒå°±ä¸€ç›´ä¿æŒ1ç›´åˆ°æ“ä½œç³»ç»Ÿå°†å®ƒå¤ä½ã€‚&lt;/p>
&lt;p>å¦‚æœç¡¬ä»¶æ²¡æœ‰è¿™äº›ä½ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„ç¼ºé¡µä¸­æ–­å’Œæ—¶é’Ÿä¸­æ–­æœºåˆ¶è¿›è¡Œæ¨¡æ‹Ÿã€‚&lt;/p>
&lt;p>å¯ä»¥ç”¨Rä½å’ŒMä½æ¥æ„é€ ä¸€ä¸ªç®€å•çš„é¡µé¢ç½®æ¢ç®—æ³•ï¼šå½“å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œå®ƒçš„æ‰€æœ‰é¡µé¢çš„ä¸¤ä¸ªä½éƒ½ç”±æ“ä½œç³»ç»Ÿè®¾ç½®ä¸º0ï¼ŒRä½è¢«å®šæœŸåœ°ï¼ˆæ¯”å¦‚åœ¨æ¯æ¬¡æ—¶é’Ÿä¸­æ–­æ—¶ï¼‰æ¸…é›¶ï¼Œä»¥åŒºåˆ«æœ€è¿‘æ²¡æœ‰è¢«è®¿é—®çš„é¡µé¢å’Œè¢«è®¿é—®çš„é¡µé¢ã€‚&lt;/p>
&lt;p>4ç±»ï¼š&lt;/p>
&lt;ul>
&lt;li>ç¬¬0ç±»ï¼šæ²¡æœ‰è¢«è®¿é—®ï¼Œæ²¡æœ‰è¢«ä¿®æ”¹ã€‚&lt;/li>
&lt;li>ç¬¬1ç±»ï¼šæ²¡æœ‰è¢«è®¿é—®ï¼Œå·²è¢«ä¿®æ”¹ã€‚&lt;/li>
&lt;li>ç¬¬2ç±»ï¼šå·²è¢«è®¿é—®ï¼Œæ²¡æœ‰è¢«ä¿®æ”¹ã€‚&lt;/li>
&lt;li>ç¬¬3ç±»ï¼šå·²è¢«è®¿é—®ï¼Œå·²è¢«ä¿®æ”¹ã€‚&lt;/li>
&lt;/ul>
&lt;p>NRUç®—æ³•éšå³åœ°ä»ç±»ç¼–å·æœ€å°çš„éç©ºç±»ä¸­æŒ‘é€‰ä¸€ä¸ªé¡µé¢æ·˜æ±°ã€‚NRUç®—æ³•çš„ä¸»è¦ä¼˜ç‚¹æ˜¯æ˜“äºç†è§£å’Œèƒ½å¤Ÿæœ‰æ•ˆåœ°è¢«å®ç°ï¼Œè™½ç„¶å®ƒçš„æ€§èƒ½ä¸æ˜¯æœ€å¥½çš„ï¼Œä½†æ˜¯å·²ç»å¤Ÿç”¨äº†ã€‚&lt;/p>
&lt;h3 id="343-å…ˆè¿›å…ˆå‡ºé¡µé¢ç½®æ¢ç®—æ³•">3.4.3 å…ˆè¿›å…ˆå‡ºé¡µé¢ç½®æ¢ç®—æ³•
&lt;/h3>&lt;p>ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ä¸€ä¸ªæ‰€æœ‰å½“å‰åœ¨å†…å­˜ä¸­çš„é¡µé¢çš„é“¾è¡¨ï¼Œæœ€æ–°è¿›å…¥çš„é¡µé¢æ”¾åœ¨è¡¨å°¾ï¼Œæœ€æ—©è¿›å…¥çš„é¡µé¢æ”¾åœ¨è¡¨å¤´ã€‚å½“å‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶ï¼Œæ·˜æ±°è¡¨å¤´çš„é¡µé¢å¹¶æŠŠæ–°è°ƒå…¥çš„é¡µé¢åŠ å…¥åˆ°è¡¨å°¾ã€‚&lt;/p>
&lt;h3 id="344-ç¬¬äºŒæ¬¡æœºä¼šé¡µé¢ç½®æ¢ç®—æ³•">3.4.4 ç¬¬äºŒæ¬¡æœºä¼šé¡µé¢ç½®æ¢ç®—æ³•
&lt;/h3>&lt;p>ç¬¬äºŒæ¬¡æœºä¼šç®—æ³•å¯¹å…ˆè¿›å…ˆå‡ºé¡µé¢ç½®æ¢ç®—æ³•åšäº†ä¸€ä¸ªç®€å•çš„ä¿®æ”¹ï¼šæ£€æŸ¥æœ€è€é¡µé¢çš„Rä½ã€‚å¦‚æœRä½ä¸º0ï¼Œé‚£ä¹ˆè¿™ä¸ªé¡µé¢æ—¢è€åˆæ²¡æœ‰è¢«ä½¿ç”¨ï¼Œå¯ä»¥ç«‹åˆ»è¢«ç½®æ¢æ‰ï¼›å¦‚æœæ˜¯1ï¼Œå°±å°†Rä½æ¸…0ï¼Œå¹¶æŠŠè¯¥é¡µé¢æ”¾åˆ°é“¾è¡¨çš„å°¾ç«¯ï¼Œä¿®æ”¹å®ƒçš„è£…å…¥æ—¶é—´ä½¿å®ƒåƒåˆšè£…å…¥çš„ä¸€æ ·ï¼Œç„¶åç»§ç»­æœç´¢ã€‚&lt;/p>
&lt;p>ç¬¬äºŒæ¬¡æœºä¼šç®—æ³•å°±æ˜¯å¯»æ‰¾ä¸€ä¸ªåœ¨æœ€è¿‘çš„æ—¶é’Ÿé—´éš”å†…æ²¡æœ‰è¢«è®¿é—®è¿‡çš„é¡µé¢ã€‚&lt;/p>
&lt;h3 id="345-æ—¶é’Ÿé¡µé¢ç½®æ¢ç®—æ³•">3.4.5 æ—¶é’Ÿé¡µé¢ç½®æ¢ç®—æ³•
&lt;/h3>&lt;p>ç¬¬äºŒæ¬¡æœºä¼šç®—æ³•ç»å¸¸è¦åœ¨é“¾è¡¨ä¸­ç§»åŠ¨é¡µé¢ï¼Œæ—¢é™ä½äº†æ•ˆç‡åˆä¸æ˜¯å¾ˆæœ‰å¿…è¦ã€‚ä¸€ä¸ªæ›´å¥½çš„åŠæ³•æ˜¯æŠŠæ‰€æœ‰çš„é¡µé¢éƒ½ä¿å­˜åœ¨ä¸€ä¸ªç±»ä¼¼é’Ÿé¢çš„ç¯å½¢é“¾è¡¨ä¸­ï¼Œä¸€ä¸ªè¡¨é’ˆæŒ‡å‘æœ€è€çš„é¡µé¢ã€‚&lt;/p>
&lt;h3 id="346-æœ€è¿‘æœ€å°‘ä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•">3.4.6 æœ€è¿‘æœ€å°‘ä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•
&lt;/h3>&lt;p>å¯¹æœ€ä¼˜ç®—æ³•çš„ä¸€ä¸ªå¾ˆå¥½çš„è¿‘ä¼¼æ˜¯åŸºäºè¿™æ ·çš„è§‚å¯Ÿï¼šåœ¨å‰é¢å‡ æ¡æŒ‡ä»¤ä¸­é¢‘ç¹ä½¿ç”¨çš„é¡µé¢å¾ˆå¯èƒ½åœ¨åé¢çš„å‡ æ¡æŒ‡ä»¤ä¸­è¢«ä½¿ç”¨ã€‚&lt;/p>
&lt;p>åœ¨ç¼ºé¡µä¸­æ–­å‘ç”Ÿæ—¶ï¼Œç½®æ¢æœªä½¿ç”¨æ—¶é—´æœ€é•¿çš„é¡µé¢ã€‚è¿™ä¸ªç­–ç•¥ç§°ä¸ºLRUï¼ˆLeast Recently Used, æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰é¡µé¢ç½®æ¢ç®—æ³•ã€‚&lt;/p>
&lt;h3 id="347-ç”¨è½¯ä»¶æ¨¡æ‹Ÿlru">3.4.7 ç”¨è½¯ä»¶æ¨¡æ‹ŸLRU
&lt;/h3>&lt;p>&lt;strong>NFU&lt;/strong>ï¼ˆNot Frequently Usedï¼Œæœ€ä¸å¸¸ç”¨ï¼‰ç®—æ³•ã€‚è¯¥ç®—æ³•å°†æ¯ä¸ªé¡µé¢ä¸ä¸€ä¸ªè½¯ä»¶è®¡æ•°å™¨ç›¸å…³è”ï¼Œè®¡æ•°å™¨çš„åˆå€¼ä¸º0ã€‚æ¯æ¬¡æ—¶é’Ÿä¸­æ–­æ—¶ï¼Œç”±æ“ä½œç³»ç»Ÿæ‰«æå†…å­˜ä¸­æ‰€æœ‰çš„é¡µé¢ï¼Œå°†æ¯ä¸ªé¡µé¢çš„Rä½ï¼ˆå®ƒçš„å€¼æ˜¯0æˆ–1ï¼‰åŠ åˆ°å®ƒçš„è®¡ç®—å™¨ä¸Šã€‚è¿™ä¸ªè®¡ç®—å™¨å¤§ä½“ä¸Šè·Ÿè¸ªäº†å„ä¸ªé¡µé¢è¢«è®¿é—®çš„é¢‘ç¹ç¨‹åº¦ã€‚å‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶ï¼Œåˆ™ç½®æ¢è®¡æ•°å™¨å€¼æœ€å°çš„é¡µé¢ã€‚è¿™ä¸ªç®—æ³•çš„é—®é¢˜æ˜¯å®ƒä»æ¥ä¸å¿˜è®°ä»»ä½•äº‹æƒ…ã€‚&lt;/p>
&lt;p>&lt;strong>è€åŒ–&lt;/strong>ç®—æ³•ï¼šé¦–å…ˆï¼Œåœ¨Rä½è¢«åŠ è¿›ä¹‹å‰å…ˆå°†è®¡æ•°å™¨å³ç§»ä¸€ä½ï¼›å…¶æ¬¡ï¼Œå°†Rä½åŠ åˆ°è®¡æ•°å™¨æœ€å·¦ç«¯çš„ä½è€Œä¸æ˜¯æœ€å³ç«¯çš„ä½ã€‚&lt;/p>
&lt;h3 id="348-å·¥ä½œé›†é¡µé¢ç½®æ¢ç®—æ³•">3.4.8 å·¥ä½œé›†é¡µé¢ç½®æ¢ç®—æ³•
&lt;/h3>&lt;p>&lt;strong>è¯·æ±‚è°ƒé¡µ&lt;/strong>ï¼Œå› ä¸ºé¡µé¢æ˜¯åœ¨éœ€è¦æ—¶è¢«è°ƒå…¥çš„ï¼Œè€Œä¸æ˜¯é¢„å…ˆè£…å…¥ã€‚&lt;/p>
&lt;p>&lt;strong>å±€éƒ¨æ€§è®¿é—®&lt;/strong>è¡Œä¸ºï¼Œå³åœ¨è¿›ç¨‹è¿è¡Œçš„ä»»ä½•é˜¶æ®µï¼Œå®ƒéƒ½åªè®¿é—®è¾ƒå°‘çš„ä¸€éƒ¨åˆ†é¡µé¢ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªè¿›ç¨‹å½“å‰æ­£åœ¨ä½¿ç”¨çš„é¡µé¢çš„é›†åˆç§°ä¸ºå®ƒçš„&lt;strong>å·¥ä½œé›†&lt;/strong>ã€‚è‹¥æ¯æ‰§è¡Œå‡ æ¡æŒ‡ä»¤ç¨‹åºå°±å‘ç”Ÿä¸€æ¬¡ç¼ºé¡µä¸­æ–­ï¼Œé‚£ä¹ˆå°±ç§°è¿™ä¸ªç¨‹åºå‘ç”Ÿäº†&lt;strong>é¢ ç°¸&lt;/strong>ã€‚&lt;/p>
&lt;p>ä¸å°‘åˆ†é¡µç³»ç»Ÿéƒ½ä¼šè®¾æ³•è·Ÿè¸ªè¿›ç¨‹çš„å·¥ä½œé›†ï¼Œä»¥ç¡®ä¿åœ¨è®©è¿›ç¨‹è¿è¡Œä¹‹å‰ï¼Œå®ƒçš„å·¥ä½œé›†å°±å·²åœ¨å†…å­˜ä¸­äº†ã€‚è¯¥æ–¹æ³•ç§°ä¸º&lt;strong>å·¥ä½œé›†æ¨¡å‹&lt;/strong>ï¼Œå…¶ç›®çš„åœ¨äºå¤§å¤§å‡å°‘ç¼ºé¡µä¸­æ–­ç‡ã€‚åœ¨è¿›ç¨‹è¿è¡Œå‰é¢„å…ˆè£…å…¥å…¶å·¥ä½œé›†é¡µé¢ä¹Ÿç§°ä¸º&lt;strong>é¢„å…ˆè°ƒé¡µ&lt;/strong>ã€‚&lt;/p>
&lt;p>åœ¨ä»»ä¸€æ—¶åˆ»tï¼Œéƒ½å­˜åœ¨ä¸€ä¸ªé›†åˆï¼Œå®ƒåŒ…å«æ‰€æœ‰æœ€è¿‘kæ¬¡å†…å­˜è®¿é—®æ‰€è®¿é—®è¿‡çš„é¡µé¢ã€‚è¿™ä¸ªé›†åˆw(k,t)å°±æ˜¯å·¥ä½œé›†ã€‚&lt;/p>
&lt;p>äº‹å®ä¸Šå¤§å¤šæ•°ç¨‹åºä¼šä»»æ„è®¿é—®ä¸€å°éƒ¨åˆ†é¡µé¢ï¼Œä½†æ˜¯è¿™ä¸ªé›†åˆä¼šéšç€æ—¶é—´è€Œç¼“æ…¢å˜åŒ–ï¼Œè¿™ä¸ªäº‹å®ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆä¸€å¼€å§‹æ›²çº¿å¿«é€Ÿåœ°ä¸Šå‡è€Œkè¾ƒå¤§æ—¶ä¸Šå‡ä¼šå˜æ…¢ã€‚é¢„å…ˆè°ƒé¡µå°±æ˜¯åœ¨ç¨‹åºç»§ç»­è¿è¡Œä¹‹å‰é¢„å…ˆè£…å…¥æ¨æµ‹å‡ºçš„å·¥ä½œé›†çš„é¡µé¢ã€‚&lt;/p>
&lt;p>é¡µé¢ç½®æ¢ç®—æ³•ï¼šå½“å‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶ï¼Œæ·˜æ±°ä¸€ä¸ªä¸åœ¨å·¥ä½œé›†çš„é¡µé¢ã€‚æ ¹æ®å®šä¹‰ï¼Œå·¥ä½œé›†å°±æ˜¯æœ€è¿‘kæ¬¡å†…å­˜è®¿é—®æ‰€ä½¿ç”¨è¿‡çš„é¡µé¢çš„é›†åˆã€‚&lt;/p>
&lt;p>ä½œä¸ºæ›¿ä»£ï¼Œä¸€ç§èƒ½å¤Ÿå¸¸è§çš„è¿‘ä¼¼æ–¹æ³•å°±æ˜¯ï¼Œä¸æ˜¯å‘åæ‰¾æœ€è¿‘kæ¬¡çš„å†…å­˜è®¿é—®ï¼Œè€Œæ˜¯è€ƒè™‘å…¶æ‰§è¡Œæ—¶é—´ã€‚ä¸€ä¸ªè¿›ç¨‹ä»å®ƒå¼€å§‹æ‰§è¡Œåˆ°å½“å‰å®é™…ä½¿ç”¨çš„CPUæ—¶é—´æ€»æ•°é€šå¸¸ç§°ä½œ&lt;strong>å½“å‰å®é™…è¿è¡Œæ—¶é—´&lt;/strong>ã€‚é€šè¿‡è¿™ä¸ªè¿‘ä¼¼çš„æ–¹æ³•ï¼Œè¿›ç¨‹çš„å·¥ä½œé›†å¯ä»¥è¢«ç§°ä¸ºè¿‡å»çš„$\tau$ç§’å®é™…è¿è¡Œæ—¶é—´ä¸­å®ƒæ‰€è®¿é—®è¿‡çš„é¡µé¢çš„é›†åˆã€‚&lt;/p>
&lt;p>æ‰«ææ‰€æœ‰é¡µé¢æ£€æŸ¥Rä½ï¼š&lt;/p>
&lt;ul>
&lt;li>è‹¥ (R==1)ï¼šè®¾ç½®ä¸Šæ¬¡ä½¿ç”¨æ—¶é—´ä¸ºå½“å‰å®é™…æ—¶é—´&lt;/li>
&lt;li>è‹¥(R == 0 ä¸”ç”Ÿå­˜æ—¶é—´ &amp;gt; $\tau$) ï¼šç§»å‡ºè¿™ä¸ªé¡µé¢&lt;/li>
&lt;li>è‹¥(R == 0 ä¸”ç”Ÿå­˜æ—¶é—´ &amp;lt;= $\tau$) ï¼šè®°ä½æœ€å°æ—¶é—´&lt;/li>
&lt;/ul>
&lt;h3 id="349-å·¥ä½œé›†æ—¶é’Ÿé¡µé¢ç½®æ¢ç®—æ³•">3.4.9 å·¥ä½œé›†æ—¶é’Ÿé¡µé¢ç½®æ¢ç®—æ³•
&lt;/h3>&lt;p>ä¸æ—¶é’Ÿç®—æ³•ä¸€æ ·ï¼Œæ‰€éœ€çš„æ•°æ®ç»“æ„æ˜¯ä¸€ä¸ªä»¥é¡µæ¡†ä¸ºå…ƒç´ çš„å¾ªç¯è¡¨ã€‚&lt;/p>
&lt;p>å¦‚æœRä½è¢«ç½®ä¸º1ï¼Œè¯¥é¡µé¢åœ¨å½“å‰æ—¶é’Ÿæ»´ç­”ä¸­å°±è¢«ä½¿ç”¨è¿‡ï¼Œé‚£ä¹ˆè¯¥é¡µé¢å°±ä¸é€‚åˆæ·˜æ±°ã€‚ç„¶åæŠŠè¯¥é¡µé¢çš„Rä½ç½®ä¸º0ï¼ŒæŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªé¡µé¢ï¼Œå¹¶é‡å¤è¯¥ç®—æ³•ã€‚&lt;/p>
&lt;p>å¦‚æœRä½è¢«ç½®ä¸º0ã€‚å¦‚æœé¡µé¢çš„ç”Ÿå­˜æ—¶é—´å¤§äº$\tau$å¹¶ä¸”è¯¥é¡µé¢æ˜¯å¹²å‡€çš„ï¼Œç”³è¯·æ­¤é¡µæ¡†ï¼Œå¹¶æŠŠæ–°é¡µé¢æ”¾åœ¨å…¶ä¸­ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæ­¤é¡µé¢è¢«ä¿®æ”¹è¿‡ï¼Œå°±ä¸èƒ½ç«‹å³ç”³è¯·é¡µæ¡†ï¼ŒæŒ‡é’ˆç»§ç»­å‘å‰èµ°ã€‚&lt;/p>
&lt;p>åŸåˆ™ä¸Šï¼Œæ‰€æœ‰çš„é¡µé¢éƒ½æœ‰å¯èƒ½å› ä¸ºç£ç›˜I/Oåœ¨æŸä¸ªæ—¶é’Ÿå‘¨æœŸè¢«è°ƒåº¦ã€‚ä¸ºäº†é™ä½ç£ç›˜é˜»å¡ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸ªé™åˆ¶ï¼Œå³æœ€å¤§åªå…è®¸å†™å›nä¸ªé¡µé¢ã€‚ä¸€æ—¦è¾¾åˆ°è¯¥é™åˆ¶ï¼Œå°±ä¸å…è®¸è°ƒåº¦æ–°çš„å†™æ“ä½œã€‚&lt;/p>
&lt;h3 id="3410-é¡µé¢ç½®æ¢ç®—æ³•å°ç»“">3.4.10 é¡µé¢ç½®æ¢ç®—æ³•å°ç»“
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>ç®—æ³•&lt;/th>
&lt;th>æ³¨é‡Š&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>æœ€ä¼˜ç®—æ³•&lt;/td>
&lt;td>ä¸å¯å®ç°ï¼Œä½†å¯ç”¨ä½œåŸºå‡†&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>NRUï¼ˆæœ€è¿‘æœªä½¿ç”¨ï¼‰ç®—æ³•&lt;/td>
&lt;td>LRUçš„å¾ˆç²—ç³™çš„è¿‘ä¼¼&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ç®—æ³•&lt;/td>
&lt;td>å¯èƒ½æŠ›å¼ƒé‡è¦é¡µé¢&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ç¬¬äºŒæ¬¡æœºä¼šç®—æ³•&lt;/td>
&lt;td>æ¯”FIFOæœ‰è¾ƒå¤§çš„æ”¹å–„&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æ—¶é’Ÿç®—æ³•&lt;/td>
&lt;td>ç°å®çš„&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç®—æ³•&lt;/td>
&lt;td>å¾ˆä¼˜ç§€ï¼Œä½†å¾ˆéš¾å®ç°&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>NFUï¼ˆæœ€ä¸ç»å¸¸ä½¿ç”¨ï¼‰ç®—æ³•&lt;/td>
&lt;td>LRUçš„ç›¸å¯¹ç²—ç•¥çš„è¿‘ä¼¼&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>è€åŒ–ç®—æ³•&lt;/strong>&lt;/td>
&lt;td>éå¸¸è¿‘ä¼¼LRUçš„æœ‰æ•ˆç®—æ³•&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>å·¥ä½œé›†ç®—æ³•&lt;/td>
&lt;td>å®ç°èµ·æ¥å¼€é”€å¾ˆå¤§&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>å·¥ä½œé›†æ—¶é’Ÿç®—æ³•&lt;/strong>&lt;/td>
&lt;td>å¥½çš„æœ‰æ•ˆç®—æ³•&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="37-åˆ†æ®µ">3.7 åˆ†æ®µ
&lt;/h2>&lt;p>ç¼–è¯‘å™¨çš„ä¾‹å­ã€‚ä¸€ä¸ªç›´è§‚å¹¶ä¸”é€šç”¨çš„æ–¹æ³•æ˜¯åœ¨æœºå™¨ä¸Šæä¾›å¤šä¸ªäº’ç›¸ç‹¬ç«‹çš„ç§°ä¸º&lt;strong>æ®µ&lt;/strong>çš„åœ°å€ç©ºé—´ã€‚æ¯ä¸ªæ®µç”±ä¸€ä¸ªä»0åˆ°æœ€å¤§çš„çº¿æ€§åœ°å€åºåˆ—æ„æˆã€‚å„ä¸ªæ®µçš„é•¿åº¦å¯ä»¥æ˜¯0åˆ°æŸä¸ªå…è®¸çš„æœ€å¤§å€¼ä¹‹é—´çš„ä»»ä½•ä¸€ä¸ªå€¼ã€‚ä¸åŒæ®µçš„é•¿åº¦å¯ä»¥ä¸åŒï¼Œå¹¶ä¸”é€šå¸¸æƒ…å†µä¸‹ä¹Ÿéƒ½ä¸ç›¸åŒã€‚æ®µçš„é•¿åº¦åœ¨è¿è¡ŒæœŸé—´å¯ä»¥åŠ¨æ€æ”¹å˜ã€‚&lt;/p>
&lt;p>æ®µå½“ç„¶æœ‰å¯èƒ½ä¼šè¢«è£…æ»¡ï¼Œä½†é€šå¸¸æƒ…å†µä¸‹æ®µéƒ½å¾ˆå¤§ï¼Œå› æ­¤è¿™ç§æƒ…å†µå‘ç”Ÿçš„å¯èƒ½æ€§å¾ˆå°ã€‚ç¨‹åºå¿…é¡»æä¾›ä¸¤éƒ¨åˆ†åœ°å€ï¼Œä¸€ä¸ªæ®µå·å’Œä¸€ä¸ªæ®µå†…åœ°å€ã€‚&lt;/p>
&lt;p>æ®µæ˜¯ä¸€ä¸ªé€»è¾‘å®ä½“ã€‚ä¸€ä¸ªæ®µå¯èƒ½åŒ…æ‹¬ä¸€ä¸ªè¿‡ç¨‹ã€ä¸€ä¸ªæ•°ç»„ã€ä¸€ä¸ªå †æ ˆã€ä¸€ç»„æ•°ç»„å˜é‡ï¼Œä½†ä¸€èˆ¬å®ƒä¸ä¼šåŒæ—¶åŒ…å«å¤šç§ä¸åŒç±»å‹çš„å†…å®¹ã€‚&lt;/p>
&lt;p>å¦‚æœæ¯ä¸ªè¿‡ç¨‹éƒ½ä½äºä¸€ä¸ªç‹¬ç«‹çš„æ®µä¸­å¹¶ä¸”èµ·å§‹åœ°å€æ˜¯0ï¼Œé‚£ä¹ˆæŠŠå•ç‹¬ç¼–è¯‘å¥½çš„è¿‡ç¨‹é“¾æ¥èµ·æ¥çš„æ“ä½œå°±å¯ä»¥å¾—åˆ°å¾ˆå¤§çš„ç®€åŒ–ã€‚&lt;/p>
&lt;p>åˆ†æ®µä¹Ÿæœ‰åŠ©äºåœ¨å‡ ä¸ªè¿›ç¨‹ä¹‹é—´å…±äº«è¿‡ç¨‹å’Œæ•°æ®ã€‚&lt;/p>
&lt;p>å› ä¸ºæ¯ä¸ªæ®µæ˜¯ä¸€ä¸ªä¸ºç¨‹åºå‘˜æ‰€çŸ¥é“çš„é€»è¾‘å®ä½“ï¼Œæ¯”å¦‚ä¸€ä¸ªè¿‡ç¨‹æˆ–ä¸€ä¸ªæ•°ç»„ï¼Œæ•…ä¸åŒçš„æ®µå¯ä»¥æœ‰ä¸åŒç§ç±»çš„ä¿æŠ¤ã€‚&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>è€ƒæŸ¥ç‚¹&lt;/th>
&lt;th>åˆ†é¡µ&lt;/th>
&lt;th>åˆ†æ®µ&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>éœ€è¦ç¨‹åºå‘˜äº†è§£æ­£åœ¨ä½¿ç”¨çš„è¿™ç§æŠ€æœ¯å—ï¼Ÿ&lt;/td>
&lt;td>å¦&lt;/td>
&lt;td>æ˜¯&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>å­˜åœ¨å¤šå°‘çº¿æ€§åœ°å€ç©ºé—´ï¼Ÿ&lt;/td>
&lt;td>1&lt;/td>
&lt;td>è®¸å¤š&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æ•´ä¸ªåœ°å€ç©ºé—´å¯ä»¥è¶…å‡ºç‰©ç†å­˜å‚¨å™¨çš„å¤§å°å—ï¼Ÿ&lt;/td>
&lt;td>æ˜¯&lt;/td>
&lt;td>æ˜¯&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>è¿‡ç¨‹å’Œæ•°æ®å¯ä»¥è¢«åŒºåˆ†å¹¶åˆ†åˆ«è¢«ä¿æŠ¤å—ï¼Ÿ&lt;/td>
&lt;td>å¦&lt;/td>
&lt;td>æ˜¯&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>å…¶å¤§å°æµ®åŠ¨çš„è¡¨å¯ä»¥å¾ˆå®¹æ˜“æä¾›å—ï¼Ÿ&lt;/td>
&lt;td>å¦&lt;/td>
&lt;td>æ˜¯&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ç”¨æˆ·è¿‡ç¨‹çš„å…±äº«æ–¹ä¾¿å—ï¼Ÿ&lt;/td>
&lt;td>å¦&lt;/td>
&lt;td>æ˜¯&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ä¸ºä»€ä¹ˆå‘æ˜è¿™ç§æŠ€æœ¯ï¼Ÿ&lt;/td>
&lt;td>ä¸ºäº†å¾—åˆ°å¤§çš„çº¿æ€§åœ°å€ç©ºé—´è€Œä¸å¿…è´­ä¹°æ›´å¤§çš„ç‰©ç†å­˜å‚¨å™¨&lt;/td>
&lt;td>ä¸ºäº†ä½¿ç¨‹åºå’Œæ•°æ®å¯ä»¥è¢«åˆ’åˆ†ä¸ºé€»è¾‘ä¸Šç‹¬ç«‹çš„åœ°å€ç©ºé—´å¹¶ä¸”æœ‰åŠ©äºå…±äº«å’Œä¿æŠ¤&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="371-çº¯åˆ†æ®µçš„å®ç°">3.7.1 çº¯åˆ†æ®µçš„å®ç°
&lt;/h3>&lt;p>åˆ†æ®µå’Œåˆ†é¡µçš„å®ç°æœ¬è´¨ä¸Šæ˜¯ä¸åŒçš„ï¼šé¡µé¢æ˜¯å®šé•¿çš„è€Œæ®µä¸æ˜¯ã€‚&lt;/p>
&lt;p>åœ¨ç³»ç»Ÿè¿è¡Œä¸€æ®µæ—¶é—´åå†…å­˜è¢«åˆ’åˆ†ä¸ºè®¸å¤šå—ï¼Œä¸€äº›å—åŒ…å«ç€æ®µï¼Œä¸€äº›åˆ™æˆäº†ç©ºé—²åŒºï¼Œè¿™ç§ç°è±¡ç§°ä¸º&lt;strong>æ£‹ç›˜å½¢ç¢ç‰‡&lt;/strong>æˆ–&lt;strong>å¤–éƒ¨ç¢ç‰‡&lt;/strong>ã€‚ç©ºé—²åŒºçš„å­˜åœ¨ä½¿å†…å­˜è¢«æµªè´¹äº†ï¼Œè€Œè¿™å¯ä»¥é€šè¿‡å†…å­˜ç´§ç¼©æ¥è§£å†³ã€‚&lt;/p>
&lt;h3 id="372-åˆ†æ®µå’Œåˆ†é¡µç»“åˆmultics">3.7.2 åˆ†æ®µå’Œåˆ†é¡µç»“åˆï¼šMULTICS
&lt;/h3>&lt;p>å¦‚æœä¸€ä¸ªæ®µæ¯”è¾ƒå¤§ï¼ŒæŠŠå®ƒæ•´ä¸ªä¿å­˜åœ¨å†…å­˜ä¸­å¯èƒ½å¾ˆä¸æ–¹ä¾¿ç”šè‡³æ˜¯ä¸å¯èƒ½çš„ï¼Œå› æ­¤äº§ç”Ÿäº†å¯¹å®ƒè¿›è¡Œåˆ†é¡µçš„æƒ³æ³•ã€‚è¿™æ ·ï¼Œåªæœ‰é‚£äº›çœŸæ­£éœ€è¦çš„é¡µé¢æ‰ä¼šè¢«è°ƒå…¥å†…å­˜ã€‚&lt;/p>
&lt;p>MULTICSçš„è®¾è®¡è€…å†³å®šæŠŠæ¯ä¸ªæ®µéƒ½çœ‹ä½œä¸€ä¸ªè™šæ‹Ÿå†…å­˜å¹¶å¯¹å®ƒè¿›è¡Œåˆ†é¡µï¼Œä»¥ç»“åˆåˆ†é¡µçš„ä¼˜ç‚¹ï¼ˆç»Ÿä¸€çš„é¡µé¢å¤§å°å’Œåªåœ¨ä½¿ç”¨æ®µçš„ä¸€éƒ¨åˆ†æ—¶ä¸ç”¨æŠŠå®ƒå…¨éƒ¨è°ƒå…¥å†…å­˜ï¼‰å’Œåˆ†æ®µçš„ä¼˜ç‚¹ï¼ˆæ˜“äºç¼–ç¨‹ã€æ¨¡å—åŒ–ã€ä¿æŠ¤å’Œå…±äº«ï¼‰ã€‚&lt;/p>
&lt;p>æ¯ä¸ªMULTICSç¨‹åºéƒ½æœ‰ä¸€ä¸ªæ®µè¡¨ï¼Œæ¯ä¸ªæ®µå¯¹åº”ä¸€ä¸ªæè¿°ç¬¦ã€‚æ®µè¡¨æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ®µå¹¶è¢«åˆ†é¡µã€‚ä¸€ä¸ªæ®µæè¿°ç¬¦åŒ…å«äº†ä¸€ä¸ªæ®µæ˜¯å¦åœ¨å†…å­˜ä¸­çš„æ ‡è®°ï¼Œåªè¦ä¸€ä¸ªæ®µçš„ä»»ä½•ä¸€éƒ¨åˆ†åœ¨å†…å­˜ä¸­è¿™ä¸ªæ®µå°±è¢«è®¤ä¸ºæ˜¯åœ¨å†…å­˜ä¸­ï¼Œå¹¶ä¸”å®ƒçš„é¡µè¡¨ä¹Ÿä¼šåœ¨å†…å­˜ä¸­ã€‚&lt;/p>
&lt;p>æ¯ä¸ªæ®µéƒ½æ˜¯ä¸€ä¸ªæ™®é€šçš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚&lt;/p>
&lt;p>MULTICSä¸­çš„ä¸€ä¸ªåœ°å€ç”±ä¸¤éƒ¨åˆ†æ„æˆï¼šæ®µå·å’Œæ®µå†…åœ°å€ã€‚æ®µå†…åœ°å€åˆè¿›ä¸€æ­¥åˆ†ä¸ºé¡µå·å’Œé¡µå†…çš„å­—ã€‚ç®—æ³•å¦‚ä¸‹ï¼š&lt;/p>
&lt;ol>
&lt;li>æ ¹æ®æ®µå·æ‰¾åˆ°æ®µæè¿°ç¬¦ã€‚&lt;/li>
&lt;li>æ£€æŸ¥è¯¥æ®µçš„é¡µè¡¨æ˜¯å¦åœ¨å†…å­˜ä¸­ã€‚å¦‚æœåœ¨ï¼Œåˆ™æ‰¾åˆ°å®ƒçš„ä½ç½®ï¼›å¦‚æœä¸åœ¨ï¼Œåˆ™äº§ç”Ÿä¸€ä¸ªæ®µé”™è¯¯ã€‚å¦‚æœè®¿é—®è¿åäº†æ®µçš„ä¿æŠ¤è¦æ±‚å°±å‘å‡ºä¸€ä¸ªè¶Šç•Œé”™è¯¯ï¼ˆé™·é˜±ï¼‰ã€‚&lt;/li>
&lt;li>æ£€æŸ¥æ‰€è¯·æ±‚çš„è™šæ‹Ÿé¡µé¢çš„é¡µè¡¨é¡¹ï¼Œå¦‚æœè¯¥é¡µé¢ä¸åœ¨å†…å­˜ä¸­åˆ™äº§ç”Ÿä¸€ä¸ªç¼ºé¡µä¸­æ–­ï¼Œå¦‚æœåœ¨å†…å­˜å°±ä»é¡µè¡¨é¡¹ä¸­å–å‡ºè¿™ä¸ªé¡µé¢åœ¨å†…å­˜ä¸­çš„èµ·å§‹åœ°å€ã€‚&lt;/li>
&lt;li>æŠŠåç§»é‡åŠ åˆ°é¡µé¢çš„èµ·å§‹åœ°å€ä¸Šï¼Œå¾—åˆ°è¦è®¿é—®çš„å­—åœ¨å†…å­˜ä¸­çš„åœ°å€ã€‚&lt;/li>
&lt;li>æœ€åè¿›è¡Œè¯»æˆ–å†™æ“ä½œã€‚&lt;/li>
&lt;/ol>
&lt;p>å®é™…ä¸Šï¼ŒMULTICSç¡¬ä»¶åŒ…å«äº†16ä¸ªå­—çš„é«˜é€ŸTLBã€‚&lt;/p>
&lt;h3 id="373-åˆ†æ®µå’Œåˆ†é¡µç»“åˆintel-x86">3.7.3 åˆ†æ®µå’Œåˆ†é¡µç»“åˆï¼šIntel x86
&lt;/h3>&lt;p>x86å¤„ç†å™¨ä¸­è™šæ‹Ÿå†…å­˜çš„æ ¸å¿ƒæ˜¯ä¸¤å¼ è¡¨ï¼Œå³LDTï¼ˆå±€éƒ¨æè¿°ç¬¦è¡¨ï¼‰å’ŒGDTï¼ˆå…¨å±€æè¿°ç¬¦è¡¨ï¼‰ã€‚LDTæè¿°å±€éƒ¨äºæ¯ä¸ªç¨‹åºçš„æ®µï¼ŒåŒ…æ‹¬å…¶ä»£ç ã€æ•°æ®ã€å †æ ˆç­‰ï¼›GDTæè¿°ç³»ç»Ÿæ®µï¼ŒåŒ…æ‹¬æ“ä½œç³»ç»Ÿæœ¬èº«ã€‚&lt;/p>
&lt;p>ä¸ºäº†è®¿é—®ä¸€ä¸ªæ®µï¼Œä¸€ä¸ªx86ç¨‹åºå¿…é¡»æŠŠè¿™ä¸ªæ®µçš„é€‰æ‹©å­è£…å…¥æœºå™¨çš„6ä¸ªæ®µå¯„å­˜å™¨çš„æŸä¸€ä¸ªä¸­ã€‚&lt;/p>
&lt;p>åœ¨é€‰æ‹©å­è¢«è£…å…¥æ®µå¯„å­˜å™¨æ—¶ï¼Œå¯¹åº”çš„æè¿°ç¬¦è¢«ä»LDTæˆ–GDTä¸­å–å‡ºè£…å…¥å¾®ç¨‹åºå¯„å­˜å™¨ä¸­ï¼Œä»¥ä¾¿å¿«é€Ÿåœ°è®¿é—®ã€‚ä¸€ä¸ªæè¿°ç¬¦ç”±8ä¸ªå­—èŠ‚æ„æˆï¼ŒåŒ…æ‹¬æ®µçš„åŸºå€ã€å¤§å°å’Œå…¶ä»–ä¿¡æ¯ã€‚&lt;/p>
&lt;p>å‡è®¾æ®µåœ¨å†…å­˜ä¸­å¹¶ä¸”åç§»é‡ä¹Ÿåœ¨èŒƒå›´å†…ï¼Œx86å¤„ç†å™¨æ¥ç€æŠŠæè¿°ç¬¦ä¸­32ä½çš„åŸºå€å’Œåç§»é‡ç›¸åŠ å½¢æˆçº¿æ€§åœ°å€ã€‚&lt;/p>
&lt;p>çº¿æ€§åœ°å€è¢«åˆ†ä¸ºä¸‰ä¸ªåŸŸï¼šç›®å½•ã€é¡µé¢å’Œåç§»é‡ã€‚&lt;/p>
&lt;p>x86å¤„ç†å™¨å’ŒMULTICSä¸€æ ·ï¼Œä¹Ÿæœ‰ä¸€ä¸ªå°çš„TLBæŠŠæœ€è¿‘ä½¿ç”¨è¿‡çš„â€œç›®å½•-é¡µé¢â€äºŒå…ƒç»„æ˜ å°„ä¸ºé¡µæ¡†çš„ç‰©ç†åœ°å€ã€‚&lt;/p>
&lt;h1 id="ç¬¬6ç« -æ­»é”">ç¬¬6ç«  æ­»é”
&lt;/h1>&lt;p>è½¯ç¡¬ä»¶èµ„æºéƒ½æœ‰å¯èƒ½å‡ºç°æ­»é”ã€‚&lt;/p>
&lt;h2 id="61-èµ„æº">6.1 èµ„æº
&lt;/h2>&lt;p>éœ€è¦æ’ä»–æ€§ä½¿ç”¨çš„å¯¹è±¡ç§°ä¸ºèµ„æºã€‚&lt;/p>
&lt;h3 id="611-å¯æŠ¢å èµ„æºå’Œä¸å¯æŠ¢å èµ„æº">6.1.1 å¯æŠ¢å èµ„æºå’Œä¸å¯æŠ¢å èµ„æº
&lt;/h3>&lt;p>èµ„æºåˆ†ä¸ºä¸¤ç±»ï¼šå¯æŠ¢å çš„å’Œä¸å¯æŠ¢å çš„ã€‚&lt;/p>
&lt;p>å¯æŠ¢å èµ„æºå¯ä»¥ä»æ‹¥æœ‰å®ƒçš„è¿›ç¨‹ä¸­æŠ¢å è€Œä¸ä¼šäº§ç”Ÿä»»ä½•å‰¯ä½œç”¨ï¼Œå­˜å‚¨å™¨å°±æ˜¯ä¸€ç±»å¯æŠ¢å çš„èµ„æºã€‚&lt;/p>
&lt;p>ä¸å¯æŠ¢å èµ„æºæ˜¯æŒ‡åœ¨ä¸å¼•èµ·ç›¸å…³çš„è®¡ç®—å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œæ— æ³•æŠŠå®ƒä»å æœ‰å®ƒçš„è¿›ç¨‹æŠ¢å è¿‡æ¥ã€‚&lt;/p>
&lt;p>æŸä¸ªèµ„æºæ˜¯å¦å¯æŠ¢å å–å†³äºä¸Šä¸‹æ–‡ç¯å¢ƒã€‚&lt;/p>
&lt;p>æ€»çš„æ¥è¯´ï¼Œæ­»é”ä¸ä¸å¯æŠ¢å èµ„æºæœ‰å…³ï¼Œæœ‰å…³å¯æŠ¢å èµ„æºçš„æ½œåœ¨æ­»é”é€šå¸¸å¯ä»¥é€šè¿‡åœ¨è¿›ç¨‹ä¹‹é—´é‡æ–°åˆ†é…èµ„æºè€ŒåŒ–è§£ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ä¸€ä¸ªèµ„æºæ‰€éœ€è¦çš„äº‹ä»¶é¡ºåºå¯ä»¥ç”¨æŠ½è±¡çš„å½¢å¼è¡¨ç¤ºå¦‚ä¸‹ï¼š&lt;/p>
&lt;ol>
&lt;li>è¯·æ±‚èµ„æº&lt;/li>
&lt;li>ä½¿ç”¨èµ„æº&lt;/li>
&lt;li>é‡Šæ”¾èµ„æº&lt;/li>
&lt;/ol>
&lt;p>åœ¨åé¢çš„è®¨è®ºä¸­ï¼Œæˆ‘ä»¬å‡è®¾ï¼šå¦‚æœæŸä¸ªè¿›ç¨‹è¯·æ±‚èµ„æºå¤±è´¥ï¼Œé‚£ä¹ˆå®ƒå°±è¿›å…¥ä¼‘çœ çŠ¶æ€ã€‚&lt;/p>
&lt;h3 id="612-èµ„æºè·å–">6.1.2 èµ„æºè·å–
&lt;/h3>&lt;p>æ­»é”æ˜¯éå¸¸å®¹æ˜“å‘ç”Ÿçš„ã€‚&lt;/p></description></item><item><title>å‘ç°è´Ÿé¢æ–°é—»</title><link>https://wenjin1997.github.io/2022/05/08/liangbo-negative-news/</link><pubDate>Sun, 08 May 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/05/08/liangbo-negative-news/</guid><description>&lt;h2 id="ä»»åŠ¡">ä»»åŠ¡
&lt;/h2>&lt;p>è¿™æ˜¯æ¢åšäº‘å®ä¹ çš„ç¬¬ä¸€ä¸ªé¡¹ç›®ï¼Œå‘ç°è´Ÿé¢æ–°é—»ã€‚&lt;/p>
&lt;p>å®ä¹ ç›®æ ‡&lt;/p>
&lt;ol>
&lt;li>å­¦ä¹ å’ŒæŒæ¡jsonä»£ç çš„è§£æå’Œç”Ÿæˆ&lt;/li>
&lt;li>å­¦ä¹ ä¸€ç§httpæœåŠ¡çš„æ–¹å¼&lt;/li>
&lt;li>å­¦ä¹ å¦‚ä½•ä½¿ç”¨å¼€æ”¾API&lt;/li>
&lt;/ol>
&lt;p>ç¬¬ä¸€æ­¥ã€å­¦ä¹ å’Œåˆ©ç”¨ç°æœ‰ä¸€ä¸ªæƒ…æ„Ÿè®¡ç®—API
&lt;a class="link" href="http://www.pullword.com/baobian/" target="_blank" rel="noopener"
>http://www.pullword.com/baobian/&lt;/a>&lt;/p>
&lt;p>è°ƒç”¨æ ·ä¾‹ï¼šLinuxå‘½ä»¤è¡Œä¸‹æ‰§è¡Œ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">curl -X POST &amp;#39;http://baobianapi.pullword.com:9091/get.php&amp;#39; -d&amp;#39;åä¸€æœˆå†è§ï¼ŒåäºŒæœˆä½ å¥½ï¼Œ2021å¹´æœ€åä¸€ä¸ªæœˆæ€»ä¼šæœ‰ä¸æœŸè€Œé‡çš„æ¸©æš–ï¼Œå’Œç”Ÿç”Ÿä¸æ¯çš„å¸Œæœ›&amp;#39; â€“compressed
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿”å›çš„jsonç»“æœè¦èƒ½è§£æï¼Œå¤§äº0.5è¡¨ç¤ºæ­£é¢æƒ…æ„Ÿï¼Œå°äº-0.5è¡¨æ˜è´Ÿé¢æƒ…æ„Ÿã€‚æˆ–è€…ä½¿ç”¨å…¶ä»–è‡ªå·±ç†Ÿæ‚‰çš„APIä¹Ÿå¯ä»¥ã€‚æ¨èä½¿ç”¨æ¢åšå…¬å¼€çš„æœåŠ¡ã€‚&lt;/p>
&lt;p>ç¬¬äºŒæ­¥ï¼Œå­¦ä¹ æä¾›httpæœåŠ¡çš„å·¥å…·&lt;/p>
&lt;p>Cè¯­è¨€é€‰æ‰‹å¯ä»¥é€šè¿‡æœç‹—å·¥ä½œæµå¼€æºå·¥å…·å®ç°ã€‚ä¸ä¼šCå’ŒC++çš„åŒå­¦å¯ä»¥ç”¨phpä»£ç æˆ–è€…å…¶ä»–è‡ªå·±ç†Ÿæ‚‰çš„è¯­è¨€å®ç°ã€‚&lt;/p>
&lt;p>ç¬¬ä¸‰æ­¥ï¼Œå­¦ä¹ å’Œäº†è§£æ•°æ®æº
&lt;a class="link" href="http://news.baidu.com/" target="_blank" rel="noopener"
>http://news.baidu.com/&lt;/a>&lt;/p>
&lt;p>ä»ç™¾åº¦æ–°é—»é¦–é¡µè·å¾—å½“å¤©çƒ­é—¨æ–°é—»ï¼Œç”¨curlæˆ–è€…wgetå‘½ä»¤é‡‡é›†é¦–é¡µã€‚ç„¶åæå–å…¶ä¸­çš„æ–°é—»æ ‡é¢˜å’ŒURL&lt;/p>
&lt;p>ç¬¬å››æ­¥ï¼Œå°†ä»Šæ—¥æ–°é—»æ ‡é¢˜è°ƒç”¨æƒ…æ„Ÿè®¡ç®—APIå¾—åˆ°æ­£è´Ÿé¢è¯„ä»·ï¼Œæå–è´Ÿé¢ç»“æœçš„æ–°é—»æ ‡é¢˜å’ŒURLï¼Œé€šè¿‡ç¬¬äºŒæ­¥æŒæ¡çš„httpæœåŠ¡å·¥å…·ä»¥jsonæ ¼å¼å¯¹å¤–å±•ç¤ºã€‚å±•ç¤ºçš„å†…å®¹åŒ…æ‹¬æ ‡é¢˜å’ŒURLçš„åˆ—è¡¨ã€‚åœ¨è‡ªå·±çš„linuxæœºå™¨ä¸Šèƒ½è®¿é—®å³å¯ï¼Œæœ‰å…¬ç½‘æœåŠ¡å™¨çš„å¯ä»¥å¼€æ”¾å…¬ç½‘URLä¾›æˆ‘ä»¬æ£€æŸ¥ï¼Œæ²¡æœ‰å…¬ç½‘æœåŠ¡å™¨çš„æˆªå›¾å³å¯ã€‚&lt;/p>
&lt;h2 id="çˆ¬å–ç™¾åº¦æ–°é—»">çˆ¬å–ç™¾åº¦æ–°é—»
&lt;/h2>&lt;p>æ‰“å¼€&lt;a class="link" href="http://news.baidu.com/" target="_blank" rel="noopener"
>ç™¾åº¦æ–°é—»&lt;/a>ï¼ŒF12æŸ¥çœ‹é¡µé¢æºç ï¼Œå¯ä»¥çœ‹åˆ°çƒ­ç‚¹æ–°é—»çš„&lt;code>class=mod-tab-pane active&lt;/code>ã€‚
&lt;img src="https://wenjin1997.github.io/img/2022-05-08-liangbo-negative-news/baidunews.png"
loading="lazy"
alt="baidu-news"
>
ç”¨å¦‚ä¸‹æ–¹æ³•å¾—åˆ°æ–°é—»æ ‡é¢˜å’Œé“¾æ¥ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è·å–çƒ­ç‚¹æ–°é—»HTMLä»£ç &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Elements&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hotNews&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">doc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">select&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;[class=mod-tab-pane active]&amp;#34;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">select&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;a&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// è·å–æ–°é—»æ ‡é¢˜åŠé“¾æ¥&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hotNews&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">news&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hotNews&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">text&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hotNews&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">attr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;href&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç¨‹åºçš„å®Œæ•´é€»è¾‘æ˜¯å…ˆå¾—åˆ°ç™¾åº¦æ–°é—»çš„HTMLæ–‡ä»¶ï¼Œå†ä»&lt;code>class&lt;/code>ç­›é€‰å¾—åˆ°ç›¸åº”çš„æ ‡é¢˜å’Œé“¾æ¥ï¼Œè¿™é‡Œ&lt;code>Elements&lt;/code>ç±»æ˜¯å®ç°äº†&lt;code>List&amp;lt;Element&amp;gt;&lt;/code>æ¥å£ï¼Œå› æ­¤æ˜¯å¯ä»¥éå†çš„ï¼Œåœ¨éå†æ—¶åŠ å…¥å­˜æ”¾æ–°é—»çš„æ ‡é¢˜å’Œé“¾æ¥çš„å“ˆå¸Œè¡¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.jinjin.news.controller&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">org.jsoup.Jsoup&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">org.jsoup.nodes.Document&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">org.jsoup.select.Elements&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">java.io.IOException&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">java.util.HashMap&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @author æ–‡è¿›
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @version 1.0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">News&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @param url è®¿é—®è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @return
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Document&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getDocument&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="p">){&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//5000æ˜¯è®¾ç½®è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Jsoup&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">connect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">timeout&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">5000&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">IOException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @param url è®¿é—®ç½‘ç«™çš„url
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @return è¿”å›çƒ­ç‚¹æ–°é—»çš„æ ‡é¢˜å’Œé“¾æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getNews&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Document&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">doc&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getDocument&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">news&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// è·å–çƒ­ç‚¹æ–°é—»HTMLä»£ç &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Elements&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hotNews&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">doc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">select&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;[class=mod-tab-pane active]&amp;#34;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">select&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;a&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// è·å–æ–°é—»æ ‡é¢˜åŠé“¾æ¥&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hotNews&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">news&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hotNews&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">text&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hotNews&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">attr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;href&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// System.out.println(hotNews.get(i).text() + &amp;#34; &amp;#34; + hotNews.get(i).attr(&amp;#34;href&amp;#34;));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">news&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å‚è€ƒèµ„æ–™ï¼š&lt;a class="link" href="https://blog.csdn.net/sinat_35626559/article/details/78285007" target="_blank" rel="noopener"
>Javaçˆ¬å–ç½‘é¡µå†…å®¹çš„ç®€å•ä¾‹å­&lt;/a>&lt;/p>
&lt;h2 id="ä½¿ç”¨æƒ…æ„Ÿè®¡ç®—api">ä½¿ç”¨æƒ…æ„Ÿè®¡ç®—API
&lt;/h2>&lt;p>æƒ…æ„Ÿè®¡ç®—APIé“¾æ¥æ˜¯ï¼šhttp://www.pullword.com/baobian/&lt;/p>
&lt;p>æˆ‘ä»¬è¦åšçš„æ˜¯å°†çˆ¬å–åˆ°çš„æ–°é—»æ ‡é¢˜ç”¨POSTæ–¹æ³•å‘ä¸Šè¿°é“¾æ¥å‘è¯·æ±‚ï¼Œæœ€åå¾—åˆ°ä¸€ä¸ªjsonç»“æœï¼Œæå–å…¶ä¸­çš„æƒ…æ„Ÿæ•°å€¼ï¼Œå°†è´Ÿçš„æƒ…æ„Ÿå€¼å¯¹åº”çš„æ–°é—»æ ‡é¢˜ä¿å­˜ä¸‹æ¥ï¼Œç”±äºä¹‹å‰å­˜å–çš„æ–°é—»æ˜¯HashMapï¼Œå› æ­¤å¾—åˆ°è´Ÿé¢æ–°é—»çš„URLä¹Ÿä¸æ˜¯éš¾äº‹äº†ã€‚&lt;/p>
&lt;p>å‚è€ƒ&lt;a class="link" href="https://blog.csdn.net/qq_34706514/article/details/82658380" target="_blank" rel="noopener"
>javaå‘æŒ‡å®šURLå‘é€GETæˆ–POSTè¯·æ±‚&lt;/a>ï¼Œæˆ‘ä»¬ç”¨åˆ°äº†UrlUtilså·¥å…·ç±»ï¼Œæˆ‘ä»¬éœ€è¦ç”¨çš„æ˜¯&lt;code>public static String sendPost(String url, String param){}&lt;/code>è¿™ä¸ªå¸¦å‚æ•°çš„å‘é€POSTè¯·æ±‚çš„æ–¹æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;span class="lnt">176
&lt;/span>&lt;span class="lnt">177
&lt;/span>&lt;span class="lnt">178
&lt;/span>&lt;span class="lnt">179
&lt;/span>&lt;span class="lnt">180
&lt;/span>&lt;span class="lnt">181
&lt;/span>&lt;span class="lnt">182
&lt;/span>&lt;span class="lnt">183
&lt;/span>&lt;span class="lnt">184
&lt;/span>&lt;span class="lnt">185
&lt;/span>&lt;span class="lnt">186
&lt;/span>&lt;span class="lnt">187
&lt;/span>&lt;span class="lnt">188
&lt;/span>&lt;span class="lnt">189
&lt;/span>&lt;span class="lnt">190
&lt;/span>&lt;span class="lnt">191
&lt;/span>&lt;span class="lnt">192
&lt;/span>&lt;span class="lnt">193
&lt;/span>&lt;span class="lnt">194
&lt;/span>&lt;span class="lnt">195
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.jinjin.news.controller&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.sun.org.slf4j.internal.Logger&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.sun.org.slf4j.internal.LoggerFactory&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">java.io.*&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">java.net.URL&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">java.net.URLConnection&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">java.util.Iterator&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">java.util.List&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">java.util.Map&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @author æ–‡è¿›
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @version 1.0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">UrlUtils&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Logger&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LoggerFactory&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getLogger&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">UrlUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * å‘æŒ‡å®šURLå‘é€GETæ–¹æ³•çš„è¯·æ±‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @param url å‘é€è¯·æ±‚çš„URL
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @param param è¯·æ±‚å‚æ•°ï¼Œè¯·æ±‚å‚æ•°åº”è¯¥æ˜¯ name1=value1&amp;amp;name2=value2 çš„å½¢å¼ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @return URL æ‰€ä»£è¡¨è¿œç¨‹èµ„æºçš„å“åº”ç»“æœ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">sendGet&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">param&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">BufferedReader&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">urlNameString&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;?&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">param&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">URL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">realUrl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">URL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">urlNameString&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ‰“å¼€å’ŒURLä¹‹é—´çš„è¿æ¥&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">URLConnection&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">connection&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">realUrl&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">openConnection&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// è®¾ç½®é€šç”¨çš„è¯·æ±‚å±æ€§&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">connection&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setRequestProperty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;accept&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;*/*&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">connection&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setRequestProperty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;connection&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Keep-Alive&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">connection&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setRequestProperty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;user-agent&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å»ºç«‹å®é™…çš„è¿æ¥&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">connection&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">connect&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// è·å–æ‰€æœ‰å“åº”å¤´å­—æ®µ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">connection&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getHeaderFields&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// éå†æ‰€æœ‰çš„å“åº”å¤´å­—æ®µ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// for (String key : map.keySet()) {&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// System.out.println(key + &amp;#34;---&amp;gt;&amp;#34; + map.get(key));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// }&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å®šä¹‰ BufferedReaderè¾“å…¥æµæ¥è¯»å–URLçš„å“åº”&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BufferedReader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">InputStreamReader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">connection&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getInputStream&lt;/span>&lt;span class="p">()));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">in&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">readLine&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Exception&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;å‘é€GETè¯·æ±‚å‡ºç°å¼‚å¸¸ï¼&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ä½¿ç”¨finallyå—æ¥å…³é—­è¾“å…¥æµ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">finally&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">in&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">close&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Exception&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">e2&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * å‘æŒ‡å®š URL å‘é€POSTæ–¹æ³•çš„è¯·æ±‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @param url å‘é€è¯·æ±‚çš„ URL
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @param paramMap è¯·æ±‚å‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @return æ‰€ä»£è¡¨è¿œç¨‹èµ„æºçš„å“åº”ç»“æœ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">sendPost&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">paramMap&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">PrintWriter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">BufferedReader&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">param&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">it&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">paramMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">keySet&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">iterator&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">it&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">it&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">param&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;=&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">paramMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;amp;&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">URL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">realUrl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">URL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ‰“å¼€å’ŒURLä¹‹é—´çš„è¿æ¥&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">URLConnection&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">realUrl&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">openConnection&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// è®¾ç½®é€šç”¨çš„è¯·æ±‚å±æ€§&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setRequestProperty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;accept&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;*/*&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setRequestProperty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;connection&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Keep-Alive&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setRequestProperty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Accept-Charset&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;utf-8&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setRequestProperty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;user-agent&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å‘é€POSTè¯·æ±‚å¿…é¡»è®¾ç½®å¦‚ä¸‹ä¸¤è¡Œ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setDoOutput&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setDoInput&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// è·å–URLConnectionå¯¹è±¡å¯¹åº”çš„è¾“å‡ºæµ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PrintWriter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getOutputStream&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å‘é€è¯·æ±‚å‚æ•°&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">param&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// flushè¾“å‡ºæµçš„ç¼“å†²&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">flush&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å®šä¹‰BufferedReaderè¾“å…¥æµæ¥è¯»å–URLçš„å“åº”&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BufferedReader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">InputStreamReader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getInputStream&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;UTF-8&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">in&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">readLine&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Exception&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getMessage&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ä½¿ç”¨finallyå—æ¥å…³é—­è¾“å‡ºæµã€è¾“å…¥æµ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">finally&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">close&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">in&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">close&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">IOException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ex&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ex&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * å‘é€postè¯·æ±‚ jsonæ ¼å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @param url
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @param param jsonå­—ç¬¦ä¸²
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @return
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">sendPost&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">param&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">PrintWriter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">BufferedReader&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">StringBuilder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StringBuilder&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">URL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">realUrl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">URL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// // å¿½ç•¥httpsåŠŸèƒ½ï¼Œæ™®é€šä½¿ç”¨å¯ä»¥åˆ é™¤&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// if (&amp;#34;https&amp;#34;.equalsIgnoreCase(realUrl.getProtocol())) {&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">//&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// SslUtils.ignoreSsl();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// }&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ‰“å¼€å’ŒURLä¹‹é—´çš„è¿æ¥&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">URLConnection&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">realUrl&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">openConnection&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// è®¾ç½®é€šç”¨çš„è¯·æ±‚å±æ€§&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setRequestProperty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;accept&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;*/*&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setRequestProperty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;connection&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Keep-Alive&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setRequestProperty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Accept-Charset&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;utf-8&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setRequestProperty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;user-agent&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å‘é€POSTè¯·æ±‚å¿…é¡»è®¾ç½®å¦‚ä¸‹ä¸¤è¡Œ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setDoOutput&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setDoInput&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// è·å–URLConnectionå¯¹è±¡å¯¹åº”çš„è¾“å‡ºæµ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//out = new PrintWriter(conn.getOutputStream());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PrintWriter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">OutputStreamWriter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getOutputStream&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;UTF-8&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å‘é€è¯·æ±‚å‚æ•°&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">param&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// flushè¾“å‡ºæµçš„ç¼“å†²&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">flush&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å®šä¹‰BufferedReaderè¾“å…¥æµæ¥è¯»å–URLçš„å“åº”&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BufferedReader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">InputStreamReader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getInputStream&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;UTF-8&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">in&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">readLine&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//result += line;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Exception&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;å‘é€ POST è¯·æ±‚å‡ºç°å¼‚å¸¸!&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ä½¿ç”¨finallyå—æ¥å…³é—­è¾“å‡ºæµã€è¾“å…¥æµ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">finally&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">close&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">in&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">close&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">IOException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ex&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ex&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//log.info(&amp;#34;urlè¿”å›: &amp;#34; +result);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åˆ›å»ºspring-booté¡¹ç›®">åˆ›å»ºSpring Booté¡¹ç›®
&lt;/h2>&lt;p>ä¸Šè¿°æ¨¡å—éƒ½æµ‹è¯•å¥½ä¹‹åï¼Œæœ€åå°±æ˜¯è¿”å›JSONæ•°æ®æ ¼å¼ï¼Œå‚è€ƒ&lt;a class="link" href="https://juejin.cn/post/6873288147820609550" target="_blank" rel="noopener"
>&amp;lt;åç«¯åˆå­¦è€…&amp;gt;Spring Boot è¿”å› JSON æ•°æ®åŠæ•°æ®å°è£…&lt;/a>ï¼Œæœ‰å¤šç§æ–¹æ³•ï¼Œå…¶ä¸­ä¸€ç§ç”¨Spring Bootä¸­çš„&lt;code>@RestController&lt;/code>æ³¨è§£æ¥è¿”å›JSONæ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªSpring Booté¡¹ç›®ï¼Œå†æŠŠä¸Šè¿°æ¨¡å—çš„ä»£ç è¿ç§»è¿‡æ¥å°±å¥½å•¦ã€‚&lt;/p>
&lt;p>åˆ›å»ºSpring Booté¡¹ç›®çš„æ­¥éª¤å‚è€ƒ&lt;a class="link" href="https://blog.csdn.net/lxyoucan/article/details/111128415" target="_blank" rel="noopener"
>2020å…¥é—¨æ•™ç¨‹macOS ä½¿ç”¨Intellj IDEA åˆ›å»ºspring booté¡¹ç›®&lt;/a>ã€‚&lt;/p>
&lt;h2 id="è¿”å›jsonæ•°æ®æ ¼å¼">è¿”å›JSONæ•°æ®æ ¼å¼
&lt;/h2>&lt;p>é¦–å…ˆä¸ºäº†æ–¹ä¾¿è¿”å›JSONæ•°æ®æ ¼å¼ï¼Œæˆ‘ä»¬å…ˆå°†&lt;code>NegativeNews&lt;/code>å°è£…æˆä¸€ä¸ªç±»ï¼Œå…¶ä¸»è¦çš„å±æ€§å°±ä¸¤ä¸ªï¼šæ–°é—»çš„æ ‡é¢˜&lt;code>title&lt;/code>å’Œå¯¹åº”çš„&lt;code>url&lt;/code>ã€‚å‰©ä¸‹çš„å°±æ˜¯å¸¸è§çš„æ„é€ å™¨ä»¥åŠgetã€setæ–¹æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.jinjin.news.controller&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @author æ–‡è¿›
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @version 1.0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">NegativeNews&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">title&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">NegativeNews&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">title&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">title&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">title&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">url&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getTitle&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">title&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">setTitle&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">title&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">title&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">title&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getUrl&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">setUrl&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">url&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿”å›JSONæ•°æ®æ ¼å¼å¯ä»¥é€‰æ‹©å¤šç§å½¢å¼ï¼Œè¿™é‡Œç”±äºè¦è¿”å›çš„æ–°é—»æœ‰å¤šæ¡ï¼Œå› æ­¤æˆ‘ä»¬è¿”å›ä¸€ä¸ª&lt;code>List&amp;lt;NegativeNews&amp;gt;&lt;/code>ã€‚&lt;/p>
&lt;p>åœ¨è¿”å›JSONæ•°æ®æ ¼å¼æ–¹æ³•çš„å‰é¢åŠ ä¸Šæ³¨è§£&lt;code>@RequestMapping(&amp;quot;/negativeNews&amp;quot;)&lt;/code>ï¼Œåœ¨è¯·æ±‚è¯¥é¡µé¢æ—¶ï¼Œå°±ä¼šæ‰§è¡Œå…¶ä¸­çš„ä»£ç ï¼Œå› æ­¤æˆ‘ä»¬å°†ä¸Šè¿°çˆ¬å–ç™¾åº¦æ–°é—»æ ‡é¢˜ï¼Œå‘æƒ…æ„Ÿè®¡ç®—APIå‘é€POSTè¯·æ±‚ï¼Œå¾—åˆ°è´Ÿé¢æ–°é—»ï¼Œç»¼åˆåˆ°è¯¥æ–¹æ³•ä¸­ä¸€èµ·æ‰§è¡Œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.jinjin.news.controller&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.sun.net.httpserver.HttpServer&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">org.springframework.web.bind.annotation.RequestMapping&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">org.springframework.web.bind.annotation.RestController&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">java.io.IOException&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">java.net.InetSocketAddress&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">java.util.ArrayList&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">java.util.HashMap&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">java.util.List&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">java.util.Map&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @author æ–‡è¿›
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @version 1.0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@RestController&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">HttpServers&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@RequestMapping&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/negativeNews&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">NegativeNews&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">returnJson&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// è·å–ç™¾åº¦æ–°é—»ä¸­çƒ­ç‚¹æ–°é—»çš„æ ‡é¢˜å’Œé“¾æ¥&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">news&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">News&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">getNews&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;http://news.baidu.com/&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// è´Ÿé¢æ–°é—»&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">negativeNews&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// é€šè¿‡æ–°é—»æ ‡é¢˜å¾—åˆ°çš„æƒ…æ„Ÿå€¼ï¼Œå°†è´Ÿé¢æ–°é—»æ·»åŠ åˆ° negativeNews ä¸­&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">Entry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">news&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¾—åˆ°æƒ…æ„ŸAPIè¿”å›çš„ç»“æœï¼Œä¾‹å¦‚ data = {&amp;#34;result&amp;#34;:0.739306}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">UrlUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">sendPost&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;http://baobianapi.pullword.com:9091/get.php&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getKey&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æå–ç»“æœä¸­çš„åˆ†æ•°å€¼ data = {&amp;#34;result&amp;#34;: score}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">score&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">substring&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">10&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°†åˆ†æ•°å€¼ score è½¬æ¢æˆdoubleæ•°å€¼ï¼Œæ–¹ä¾¿æ‰¾åˆ°è´Ÿé¢æƒ…ç»ªçš„æ–°é—»&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">double&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emotion&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Double&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">parseDouble&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">score&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°†è´Ÿé¢æ–°é—»æ·»åŠ åˆ° negativeNews ä¸­&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">emotion&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">5&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">negativeNews&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getKey&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// è¿”å› JSON æ•°æ®æ ¼å¼&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">NegativeNews&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">negativeNewsList&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ArrayList&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">Entry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">negativeNews&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">NegativeNews&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nNews&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">NegativeNews&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getKey&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">negativeNewsList&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nNews&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">negativeNewsList&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="éƒ¨ç½²åˆ°æœåŠ¡å™¨">éƒ¨ç½²åˆ°æœåŠ¡å™¨
&lt;/h2>&lt;p>éƒ¨ç½²åˆ°æœåŠ¡å™¨æœ‰ä¸¤ç§æ–¹å¼ï¼Œå‚è€ƒï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://blog.csdn.net/qq_22638399/article/details/81506448" target="_blank" rel="noopener"
>spring boot é¡¹ç›®éƒ¨ç½²åˆ°æœåŠ¡å™¨ ä¸¤ç§æ–¹å¼&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://blog.csdn.net/CSDN2497242041/article/details/106911182" target="_blank" rel="noopener"
>SpringBoot é¡¹ç›®éƒ¨ç½²åˆ°æœåŠ¡å™¨çš„ä¸¤ç§æ–¹å¼&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="mavené¡¹ç›®æ‰“åŒ…">mavené¡¹ç›®æ‰“åŒ…
&lt;/h3>&lt;p>æˆ‘ä»¬é€‰æ‹©æ‰“åŒ…æˆjaråŒ…ï¼Œå…¶ä¸­ï¼Œæœ‰å¯èƒ½é‡åˆ°å‘ç”Ÿä¸€äº›ç±»æ‰¾ä¸åˆ°çš„é”™è¯¯ï¼Œéœ€è¦å°†æœ¬åœ°jaråŒ…æ‰“åŒ…è¿›å»ï¼Œå‚è€ƒ&lt;a class="link" href="https://cloud.tencent.com/developer/article/1746822" target="_blank" rel="noopener"
>mavené¡¹ç›®å¼•å…¥æœ¬åœ°jaråŒ…å²ä¸Šæœ€è¯¦ç»†å®è·µæ–¹æ³•&lt;/a>ã€‚&lt;/p>
&lt;p>è§£å†³å¦‚ä¸‹ç±»æ‰¾ä¸åˆ°çš„æƒ…å†µï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.sun.org.slf4j.internal.Logger&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.sun.org.slf4j.internal.LoggerFactory&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç»è¿‡è·Ÿè¸ªï¼Œè¿™ä¸¤ä¸ªéƒ½åœ¨&lt;code>rt.jar&lt;/code>ç±»ä¸­ï¼Œç”¨å¼•å…¥æœ¬åœ°jaråŒ…çš„æ–¹æ³•è¿˜æ˜¯ä¸æˆåŠŸï¼Œæœ€ç»ˆå‚è€ƒ&lt;a class="link" href="https://blog.csdn.net/qq_33666602/article/details/103438713" target="_blank" rel="noopener"
>Ideaæœ¬åœ°mavenæ‰“åŒ…ï¼Œç¨‹åºåŒ…ä¸å­˜åœ¨&lt;/a>è§£å†³äº†ï¼Œå°†&lt;code>rt.jar&lt;/code>å¤åˆ¶åˆ°&lt;code>jdk/jre/lib/ext&lt;/code>ä¸­ã€‚&lt;/p>
&lt;p>å¼•å…¥&lt;code>org.json&lt;/code>ï¼Œä»ä¸­è·å–ç›¸åº”ç‰ˆæœ¬çš„ä¾èµ–ä»£ç ï¼Œæ·»åŠ åˆ°pom.xmlé…ç½®æ–‡ä»¶ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">dependency&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;!--&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jsoup&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HTML&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parser&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">library&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="c1">//jsoup.org/ --&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">groupId&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">jsoup&lt;/span>&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">groupId&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">artifactId&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">jsoup&lt;/span>&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">artifactId&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">version&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">6&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">1&lt;/span>&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">version&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">dependency&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ·»åŠ åï¼Œåœ¨mavenä¸­æŒ‰åˆ·æ–°æŒ‰é’®ï¼Œå¦‚ä¸‹å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-05-08-liangbo-negative-news/maven.png"
loading="lazy"
alt="maven"
>&lt;/p>
&lt;p>æ‰“åŒ…å¥½åç°åœ¨æœ¬åœ°æµ‹è¯•ä¸€ä¸‹ï¼Œç»ˆç«¯è¿›å…¥åˆ°jaræ‰€åœ¨çš„è·¯å¾„ï¼Œè¿è¡Œå¦‚ä¸‹ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">java -jar åŒ…å.jar
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="linuxä¸Šè¿è¡Œ">Linuxä¸Šè¿è¡Œ
&lt;/h3>&lt;p>å‚è€ƒ&lt;a class="link" href="https://blog.csdn.net/CSDg166/article/details/109386959" target="_blank" rel="noopener"
>åœ¨Linuxä¸Šè¿è¡Œspringbooté¡¹ç›®&lt;/a>ã€‚&lt;/p>
&lt;p>ä¸ºäº†è®©æœåŠ¡ç«¯å…³é—­SSHè¿æ¥åä¾ç„¶è¿è¡Œï¼Œè¿è¡Œæ—¶æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nohup java -jar åŒ…å.jar &amp;amp;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ€æ‰è¿è¡Œä¸­çš„è¿›ç¨‹ï¼Œé¦–å…ˆæŸ¥çœ‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ps aux|grep getCimiss-surf.jar
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¥ç€æ€æ‰è¿›ç¨‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">kill -9 30768
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>MacOSä¸ŠæŸ¥çœ‹å¯¹åº”ç«¯å£çš„è¿›ç¨‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">lsof -i tcp:ç«¯å£å·
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ€æ‰å¯¹åº”è¿›ç¨‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">kill -9 PIDå·
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ä»£ç åŠå…¬ç½‘åœ°å€">ä»£ç åŠå…¬ç½‘åœ°å€
&lt;/h2>&lt;p>è‡³æ­¤æ•´ä¸ªè¿‡ç¨‹å°±å®Œæˆäº†:)&lt;/p>
&lt;ul>
&lt;li>ä»£ç ï¼š&lt;a class="link" href="https://github.com/wenjin1997/liangbo-internship/tree/main/negativeNews" target="_blank" rel="noopener"
>negativeNews&lt;/a>&lt;/li>
&lt;li>å…¬ç½‘åœ°å€ï¼š&lt;a class="link" href="http://139.155.0.15/negativeNews" target="_blank" rel="noopener"
>http://139.155.0.15/negativeNews&lt;/a>&lt;/li>
&lt;li>å…¬ç½‘è¯·æ±‚è´Ÿé¢æ–°é—»æˆªå›¾ï¼š
&lt;img src="https://wenjin1997.github.io/img/2022-05-08-liangbo-negative-news/negativeNews.png"
loading="lazy"
alt="negativeNews"
>&lt;/li>
&lt;/ul></description></item><item><title>æ»‘åŠ¨çª—å£ç›¸å…³ç®—æ³•</title><link>https://wenjin1997.github.io/2022/05/07/Algorithms-sliding-window/</link><pubDate>Sat, 07 May 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/05/07/Algorithms-sliding-window/</guid><description>&lt;h2 id="æ»‘åŠ¨çª—å£">æ»‘åŠ¨çª—å£
&lt;/h2>&lt;p>æ»‘åŠ¨çª—å£æ¨¡æ¿ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¢å¤§çª—å£&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">window&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">needs&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">shrink&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ç¼©å°çª—å£&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="209é•¿åº¦æœ€å°çš„å­æ•°ç»„httpsleetcode-cncomproblemsminimum-size-subarray-sum">&lt;a class="link" href="https://leetcode-cn.com/problems/minimum-size-subarray-sum/" target="_blank" rel="noopener"
>209.é•¿åº¦æœ€å°çš„å­æ•°ç»„&lt;/a>
&lt;/h2>&lt;p>è¿™é“é¢˜HotStarä¸€é¢è€ƒåˆ°äº†ï¼Œç”¨æ»‘åŠ¨çª—å£è§£å†³ã€‚è¿™é‡Œå†™çš„æ˜¯å‰ç¼€å’Œæ•°ç»„å’Œæ»‘åŠ¨çª—å£æ¥è§£å†³ï¼Œ
å…¶å®ä¹Ÿå¯ä»¥é™ä½ç©ºé—´å¤æ‚åº¦ï¼Œç›´æ¥ç”¨æ»‘åŠ¨çª—å£è§£å†³ï¼Œä¸€ä¸ªå˜é‡æ¥è®°å­æ•°ç»„çš„å’Œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">Solution&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å‰ç¼€å’Œæ•°ç»„ + æ»‘åŠ¨çª—å£&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">minSubArrayLen&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">preSum&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">preSum&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">length&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">MAX_VALUE&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">preSum&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">preSum&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">length&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Math&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">min&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">length&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">length&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">preSum&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">length&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="3æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²httpsleetcode-cncomproblemslongest-substring-without-repeating-charactersdescription">&lt;a class="link" href="https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/description/" target="_blank" rel="noopener"
>3.æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²&lt;/a>
&lt;/h2>&lt;p>ç›´æ¥ä¸Šä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">Solution&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ»‘åŠ¨çª—å£&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">lengthOfLongestSubstring&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">length&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Character&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">set&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashSet&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">set&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">contains&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">charAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="p">)))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">set&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">charAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// System.out.println(&amp;#34;left &amp;#34; + left + &amp;#34; right &amp;#34; + right);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">length&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Math&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">max&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">length&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">set&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">charAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">length&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™é‡Œå’Œæ¨¡æ¿æœ‰æ‰€åŒºåˆ«ï¼Œä¸è¿‡æ€è·¯éƒ½æ˜¯ä¸€æ ·çš„ã€‚è¿™é‡Œæ˜¯ä¸åœçš„åœ¨ç§»åŠ¨å³æŒ‡é’ˆï¼Œä¸€æ—¦ä¸æ»¡è¶³æ¡ä»¶ï¼Œå°±è°ƒèŠ‚å·¦æŒ‡é’ˆã€‚&lt;/p>
&lt;h2 id="76æœ€å°è¦†ç›–å­ä¸²httpsleetcode-cncomproblemsminimum-window-substring">&lt;a class="link" href="https://leetcode-cn.com/problems/minimum-window-substring/" target="_blank" rel="noopener"
>76.æœ€å°è¦†ç›–å­ä¸²&lt;/a>
&lt;/h2>&lt;p>è¿™é“é¢˜éœ€è¦å¥½å¥½æƒ³ä¸€ä¸‹ï¼Œä»€ä¹ˆæ—¶å€™æ”¶ç¼©çª—å£ï¼Œæˆ‘ä»¬çŸ¥é“è‚¯å®šæ˜¯çª—å£ä¸­å·²ç»åŒ…å«äº†æ•´ä¸ªå­—ç¬¦ä¸²&lt;code>t&lt;/code>ä¸­çš„æ‰€æœ‰å­—ç¬¦ï¼Œä½†æ˜¯è¿™ä¸ªé€»è¾‘å¦‚ä½•å»å®ç°å‘¢ï¼Ÿä¸‹é¢å‡è®¾&lt;code>String s = &amp;quot;ADOBECODEBANC&amp;quot;&lt;/code>ï¼Œ&lt;code>String t = &amp;quot;ABC&amp;quot;&lt;/code>ã€‚&lt;/p>
&lt;ul>
&lt;li>é¦–å…ˆæ ¹æ®å­—ç¬¦ä¸²&lt;code>t&lt;/code>æ„é€ ä¸€ä¸ªå“ˆå¸Œè¡¨&lt;code>subStringMap&lt;/code>ã€‚&lt;/li>
&lt;li>æ»‘åŠ¨çª—å£å†…çš„å“ˆå¸Œè¡¨è®°ä¸º&lt;code>curMap&lt;/code>ï¼Œä½†æ˜¯è¿™ä¸ªå“ˆå¸Œè¡¨ä¸å­˜å‚¨æ»‘åŠ¨çª—å£å†…æ‰€æœ‰çš„å­—ç¬¦å’Œç›¸åº”å‡ºç°çš„æ¬¡æ•°ï¼Œæˆ‘ä»¬åªå…³å¿ƒé‚£äº›åœ¨&lt;code>subStringMap&lt;/code>ä¸­åŒ…å«çš„å­—ç¬¦ã€‚&lt;/li>
&lt;li>è®¾ç½®ä¸€ä¸ªå˜é‡&lt;code>valid&lt;/code>ï¼Œè®°å½•çª—å£å†…çš„æœ‰æ•ˆå­—ç¬¦çš„ä¸ªæ•°ã€‚å¦‚æœå½“å‰çª—å£ä¸­&lt;code>A&lt;/code>å‡ºç°çš„æ¬¡æ•°è¾¾åˆ°äº†&lt;code>subStringMap&lt;/code>ä¸­&lt;code>A&lt;/code>å‡ºç°çš„æ¬¡æ•°ï¼Œ&lt;code>valid++&lt;/code>ï¼Œä¹Ÿå°±æ˜¯æ»‘åŠ¨çª—å£å†…è¦†ç›–äº†å­—ç¬¦&lt;code>A&lt;/code>ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºäº†åé¢å¥½åˆ¤æ–­çª—å£æ”¶ç¼©æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯&lt;code>valid == subStringMap.size()&lt;/code>ï¼Œæ»¡è¶³è¿™ä¸ªæ¡ä»¶è¯´æ˜æ»‘åŠ¨çª—å£å†…åˆšå¥½è¦†ç›–äº†å­ä¸²ã€‚è¿™ä¸€æ­¥æ€è·¯æœ€ä¸ºå…³é”®ã€‚&lt;/li>
&lt;li>çª—å£æ”¶ç¼©åï¼Œæ›´æ–°ç›¸åº”å˜é‡çš„å€¼ï¼Œ&lt;code>curMap&lt;/code>è¦å˜ï¼Œ&lt;code>valid&lt;/code>ä¹Ÿéœ€è¦æ›´æ–°ã€‚&lt;/li>
&lt;li>æœ€åä¸ºäº†è¿”å›æœ€å°çš„è¦†ç›–å­ä¸²ï¼Œç”¨&lt;code>len&lt;/code>å’Œ&lt;code>start&lt;/code>ä¸¤ä¸ªå˜é‡æ¥è®°å½•ç»“æœã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">Solution&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ»‘åŠ¨çª—å£&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">minWindow&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Character&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">subStringMap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">subStringMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">charAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">subStringMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getOrDefault&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">charAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Character&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">curMap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">valid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">start&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">MAX_VALUE&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">char&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">charAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">subStringMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">containsKey&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">curMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">curMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getOrDefault&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">curMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">subStringMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">)))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">valid&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">valid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">subStringMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ›´æ–°æœ€å°å­—ç¬¦ä¸²&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">start&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">char&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">charAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">subStringMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">containsKey&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">subStringMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">curMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="p">)))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">valid&lt;/span>&lt;span class="o">--&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">curMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">curMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getOrDefault&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">MAX_VALUE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">substring&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">start&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">start&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://labuladong.github.io/algo/2/18/25/" target="_blank" rel="noopener"
>æˆ‘å†™äº†é¦–è¯—ï¼ŒæŠŠæ»‘åŠ¨çª—å£ç®—æ³•ç®—æ³•å˜æˆäº†é»˜å†™é¢˜&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>ConcurrentHashMapæºç åˆ†æ</title><link>https://wenjin1997.github.io/2022/05/06/ConcurrentHashMap/</link><pubDate>Fri, 06 May 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/05/06/ConcurrentHashMap/</guid><description>&lt;h2 id="jdk-17">JDK 1.7
&lt;/h2>&lt;h3 id="æ„é€ æ–¹æ³•">æ„é€ æ–¹æ³•
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">ConcurrentHashMap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">initialCapacity&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">float&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">loadFactor&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">concurrencyLevel&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ£€æŸ¥è¾“å…¥å‚æ•°çš„åˆæ³•æ€§&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">loadFactor&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">initialCapacity&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">concurrencyLevel&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">IllegalArgumentException&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">concurrencyLevel&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">MAX_SEGMENTS&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">concurrencyLevel&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">MAX_SEGMENTS&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// MAX_SEGMENTS = 1 &amp;lt;&amp;lt; 16, å³ 2 ^ 16&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Find power-of-two sizes best matching arguments&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// sshift æ˜¯ ssize ä» 1 å‘å·¦ç§»ä½çš„æ¬¡æ•°&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sshift&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// segments çš„é•¿åº¦ï¼Œæ˜¯ 2 çš„ N æ¬¡æ–¹&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ssize&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// è®¡ç®—å‡ºä¸€ä¸ªå¤§äºç­‰äº concurrencyLevel çš„æœ€å°çš„ 2 çš„ N æ¬¡æ–¹çš„å€¼ä½œä¸º segments çš„é•¿åº¦&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ssize&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">concurrencyLevel&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="n">sshift&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ssize&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// segmentShift ç”¨äºå®šä½å‚ä¸æ•£åˆ—è¿ç®—çš„ä½æ•°&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">segmentShift&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">32&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sshift&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ•£åˆ—è¿ç®—çš„æ©ç &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">segmentMask&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ssize&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">initialCapacity&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">MAXIMUM_CAPACITY&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">initialCapacity&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">MAXIMUM_CAPACITY&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> cap æ˜¯ segment é‡Œ HashEntry æ•°ç»„çš„é•¿åº¦ï¼Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> cap ç­‰äº initialCapacity é™¤ä»¥ sszie çš„å€æ•° c ï¼Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> å¦‚æœ c å¤§äº 2ï¼Œå°±ä¼šå–å¤§äºç­‰äº c çš„ 2 çš„ N æ¬¡æ–¹å€¼ï¼Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> æ‰€ä»¥ cap ä¸æ˜¯ 2ï¼Œå°±æ˜¯ 2 çš„ N æ¬¡æ–¹ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">initialCapacity&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ssize&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ssize&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">initialCapacity&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">MIN_SEGMENT_TABLE_CAPACITY&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// MIN_SEGMENT_TABLE_CAPACITY = 2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">cap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// create segments and segments[0]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Segment&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Segment&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">loadFactor&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">)(&lt;/span>&lt;span class="n">cap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">loadFactor&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">HashEntry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;[]&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashEntry&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">cap&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Segment&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ss&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Segment&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;[]&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Segment&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">ssize&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æŠŠ s0 å­˜åˆ° Segment æ•°ç»„ä¸­ï¼Œä»…ä»…åˆ›å»ºäº†ä¸€ä¸ª Segment ç”¨æ¥ä½œåŸå‹å¯¹è±¡ã€‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">UNSAFE&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">putOrderedObject&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ss&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SBASE&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s0&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// ordered write of segments[0]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">segments&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ss&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="putæ–¹æ³•">&lt;code>put()&lt;/code>æ–¹æ³•
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Map çš„ put æ–¹æ³•&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Segment&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// value ä¸èƒ½ä¸ºç©º&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">NullPointerException&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// è®¡ç®— hash å€¼&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hash&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hash&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> j ä¸º Segment ä¸­çš„ä¸‹æ ‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> é»˜è®¤æƒ…å†µä¸‹ segmentShift ä¸º 28ï¼ŒsegmentMask ä¸º 15
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> hash &amp;gt;&amp;gt;&amp;gt; segmentShift å‘å³æ— ç¬¦å·ç§»åŠ¨ 28 ä½ï¼Œæ„æ€æ˜¯è®©é«˜ 4 ä½å‚ä¸åˆ°æ•£åˆ—è¿ç®—ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> ç„¶åå’Œæ©ç  segmentMask åšä¸è¿ç®—ï¼Œå¾—åˆ°çš„å€¼ä¸€å®šæ˜¯ 0000 ï½ 1111 èŒƒå›´å†…çš„å€¼ï¼Œå³ 0 ï½ 15
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hash&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">segmentShift&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">segmentMask&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Segment&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">UNSAFE&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// nonvolatile; recheck&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">segments&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SSHIFT&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SBASE&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// in ensureSegment&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ensureSegment&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hash&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¡¥å……ä¸Šè¿°æºç ä¸­çš„å³ç§»ä¸æ— ç¬¦å·å³ç§»çš„åŒºåˆ«ï¼š&lt;/p>
&lt;ul>
&lt;li>å³ç§»&amp;raquo; ï¼šè¯¥æ•°å¯¹åº”çš„äºŒè¿›åˆ¶ç æ•´ä½“å³ç§»ï¼Œå·¦è¾¹çš„ç”¨åŸæœ‰æ ‡å¿—ä½è¡¥å……ï¼Œå³è¾¹è¶…å‡ºçš„éƒ¨åˆ†èˆå¼ƒã€‚&lt;/li>
&lt;li>æ— ç¬¦å·å³ç§»&amp;raquo;&amp;gt; ï¼šä¸ç®¡æ­£è´Ÿæ ‡å¿—ä½ä¸º0è¿˜æ˜¯1ï¼Œå°†è¯¥æ•°çš„äºŒè¿›åˆ¶ç æ•´ä½“å³ç§»ï¼Œå·¦è¾¹éƒ¨åˆ†æ€»æ˜¯ä»¥0å¡«å……ï¼Œå³è¾¹éƒ¨åˆ†èˆå¼ƒã€‚&lt;/li>
&lt;/ul>
&lt;p>åœ¨ä¸Šè¿°&lt;code>put()&lt;/code>æ–¹æ³•ä¸­ï¼Œhashæ–¹æ³•ä¸ºï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">hash&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> A randomizing value associated with this instance that is applied to
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> hash code of keys to make hash collisions harder to find.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> private transient final int hashSeed = randomHashSeed(this);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hashSeed&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">instanceof&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sun&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">misc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">Hashing&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">stringHash32&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">^=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">hashCode&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Spread bits to regularize both segment and index locations,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// using variant of single-word Wang/Jenkins hash.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">15&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">^&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0xffffcd7d&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">^=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">10&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">3&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">^=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">6&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">14&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">^&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">16&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å†æ•£åˆ—çš„ç›®çš„æ˜¯å‡å°‘æ•£åˆ—å†²çªï¼Œä½¿å…ƒç´ èƒ½å¤Ÿå‡åŒ€åœ°åˆ†å¸ƒåœ¨ä¸åŒçš„Segmentä¸­ï¼Œä»è€Œæé«˜å®¹å™¨çš„å­˜å–æ•ˆç‡ã€‚&lt;/p>
&lt;p>Segmentä¸­çš„&lt;code>put&lt;/code>æ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Segment ä¸­çš„ put æ–¹æ³•&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hash&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">onlyIfAbsent&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">HashEntry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tryLock&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">scanAndLockForPut&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hash&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">oldValue&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">HashEntry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tab&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">table&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tab&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hash&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">HashEntry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">entryAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tab&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">HashEntry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first&lt;/span>&lt;span class="p">;;)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">key&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">hash&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hash&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">)))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">oldValue&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">value&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">onlyIfAbsent&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">value&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="n">modCount&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setNext&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">first&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashEntry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hash&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">threshold&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tab&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">MAXIMUM_CAPACITY&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">rehash&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">setEntryAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tab&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="n">modCount&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">oldValue&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">finally&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">unlock&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">oldValue&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s/My4P_BBXDnAGX1gh630ZKw" target="_blank" rel="noopener"
>æˆ‘å°±çŸ¥é“é¢è¯•å®˜æ¥ä¸‹æ¥è¦é—®æˆ‘ ConcurrentHashMap åº•å±‚åŸç†äº†&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://blog.csdn.net/cobbwho/article/details/54907203" target="_blank" rel="noopener"
>javaä¸­å³ç§»è¿ç®—ç¬¦&amp;raquo;å’Œæ— ç¬¦å·å³ç§»è¿ç®—ç¬¦&amp;raquo;&amp;gt;çš„åŒºåˆ«&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Hotstarä¸€é¢</title><link>https://wenjin1997.github.io/2022/05/06/interview-hotstar1/</link><pubDate>Fri, 06 May 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/05/06/interview-hotstar1/</guid><description>&lt;p>é¢è¯•é—®é¢˜ï¼š&lt;/p>
&lt;ol>
&lt;li>è‡ªæˆ‘ä»‹ç»&lt;/li>
&lt;li>æ•°å­¦ä¸“ä¸šä¸ºä»€ä¹ˆè½¬è®¡ç®—æœºï¼Ÿ&lt;/li>
&lt;li>æœ¬ç§‘ä¸“ä¸šæ˜¯åº”ç”¨æ•°å­¦ï¼Œä¸ºä»€ä¹ˆæœ‰è®¡ç®—æœºç›¸å…³è¯¾ç¨‹ã€‚&lt;/li>
&lt;li>ç”¨è¿‡MySQLå—ï¼Ÿç†Ÿæ‚‰äº‹åŠ¡å—ï¼Ÿ
è¿™ä¸ªæˆ‘æ²¡ç­”ä¸Šæ¥ï¼Œä¸å¤ªä¼šã€‚&lt;/li>
&lt;li>å¯¹SpringBootäº†è§£å—ï¼Ÿ
å‘œå‘œå‘œï¼Œè¿˜æ²¡å­¦åˆ°é‚£é‡Œã€‚&lt;/li>
&lt;li>è®²ä¸‹HashMapã€‚&lt;/li>
&lt;li>å¯¹è®¡ç®—æœºç½‘ç»œçš„äº†è§£ã€‚&lt;/li>
&lt;li>TCPå’ŒUDPçš„åŒºåˆ«ã€‚&lt;/li>
&lt;/ol>
&lt;p>ä¸‹é¢å°±æ˜¯å‘ä¸ªé“¾æ¥å¼€å§‹å†™ä»£ç ï¼Œé¢˜ç›®æ˜¯&lt;a class="link" href="https://leetcode-cn.com/problems/minimum-size-subarray-sum/" target="_blank" rel="noopener"
>209.é•¿åº¦æœ€å°çš„å­æ•°ç»„&lt;/a>ã€‚&lt;/p>
&lt;p>æˆ‘å¼€å§‹æƒ³åˆ°å­æ•°ç»„æ±‚å’Œï¼Œå°±è¦ç”¨åˆ°å‰ç¼€å’Œæ•°ç»„ï¼Œç„¶åç”¨åŒæŒ‡é’ˆæ¥éå†ï¼Œä½†æ˜¯åŒæŒ‡é’ˆéå†é€»è¾‘æœ‰é—®é¢˜ã€‚é¢è¯•å®˜æé†’äº†ç”¨æ»‘åŠ¨çª—å£ï¼Œè®²äº†ä¸‹å®ç°çš„é€»è¾‘ï¼Œç„¶åè®©æˆ‘å®ç°ï¼Œå®ç°çš„æ—¶å€™è¿˜å‡ºé”™äº†ï¼ŒæŠ¥ä¸‹æ ‡è¶Šç•Œé”™è¯¯ï¼Œæ˜¯åˆ¤æ–­ä½ç½®åŠ é”™äº†ã€‚æœ€ååŠ äº†ä¸€ä¸ªç‰¹åˆ¤ï¼Œå°±ç»“æŸäº†ã€‚å†™å®Œåé—®äº†å¤æ‚åº¦ã€‚&lt;/p>
&lt;p>å†™ä»£ç è¿™å—å¤§æ¦‚èŠ±äº†ä¸€ä¸ªå¤šå°æ—¶ï¼Œæ˜¯æˆ‘å¤ªèœäº†ã€‚ä¸‹é¢å°±æ˜¯åé—®ç¯èŠ‚ã€‚&lt;/p>
&lt;p>æˆ‘é—®äº†åœ¨ç¼–ç¨‹ä¸­ä¼šç”¨åˆ°å“ªäº›æ•°å­¦çŸ¥è¯†å—ï¼Ÿé¢è¯•å®˜è¯´è¿™è¾¹æ ¸å¿ƒä»£ç åŸºæœ¬å¼€å‘å®Œäº†ï¼Œå¦‚æœåé¢æƒ³è¦æ·±å…¥äº†è§£ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå¯¹ä»£ç ç†è§£è¿˜æ˜¯æœ‰å¸®åŠ©çš„ã€‚&lt;/p>
&lt;p>é—®äº†å¯¹Hotstarçš„äº†è§£ï¼Œå“ˆå“ˆï¼Œæˆ‘äº†è§£çš„ä¸å¤šã€‚é¢è¯•å®˜å°±ä»‹ç»äº†ä¸‹ã€‚&lt;/p>
&lt;p>é¢è¯•ä½“éªŒè¶…æ£’ï¼Œé¢è¯•å®˜é—®é—®é¢˜æ„Ÿè§‰å¾ˆæ¸©æŸ”ï¼Œç®—æ³•é¢˜ä¹Ÿä¼šå¼•å¯¼ã€‚&lt;/p>
&lt;p>å‘œå‘œå‘œï¼Œæ”¶åˆ°äº†æ„Ÿè°¢ä¿¡:(&lt;/p>
&lt;p>é©å‘½å°šæœªæˆåŠŸï¼ŒåŒå¿—ä»éœ€åŠªåŠ›ï¼&lt;/p></description></item><item><title>å›¾ç›¸å…³ç®—æ³•</title><link>https://wenjin1997.github.io/2022/05/06/Algorithms-graph/</link><pubDate>Fri, 06 May 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/05/06/Algorithms-graph/</guid><description>&lt;h2 id="å›¾çš„éå†">å›¾çš„éå†
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è®°å½•è¢«éå†è¿‡çš„èŠ‚ç‚¹&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">visited&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// è®°å½•ä»èµ·ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„è·¯å¾„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">onPath&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cm">/* å›¾éå†æ¡†æ¶ */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">traverse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Graph&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">visited&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ç»è¿‡èŠ‚ç‚¹ sï¼Œæ ‡è®°ä¸ºå·²éå†&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">visited&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// åšé€‰æ‹©ï¼šæ ‡è®°èŠ‚ç‚¹ s åœ¨è·¯å¾„ä¸Š&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">onPath&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">neighbor&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">neighbors&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">traverse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">neighbor&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ’¤é”€é€‰æ‹©ï¼šèŠ‚ç‚¹ s ç¦»å¼€è·¯å¾„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">onPath&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å›¾ä¸­åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç¯">å›¾ä¸­åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç¯
&lt;/h2>&lt;h3 id="207è¯¾ç¨‹è¡¨httpsleetcode-cncomproblemscourse-schedule">&lt;a class="link" href="https://leetcode-cn.com/problems/course-schedule/" target="_blank" rel="noopener"
>207.è¯¾ç¨‹è¡¨&lt;/a>
&lt;/h3>&lt;p>é¦–å…ˆå°†è¯¾ç¨‹è¡¨çš„ä¾èµ–å…³ç³»è½¬æ¢ä¸ºå›¾ï¼Œæ¥ç€å¦‚æœå›¾ä¸­å­˜åœ¨ç¯ï¼Œå°±è¿”å›falseï¼Œå¦åˆ™è¿”å›trueã€‚&lt;/p>
&lt;p>æ·±åº¦ä¼˜å…ˆæœç´¢æ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">Solution&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">canFinish&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[][]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">prerequisites&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">onPath&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">visited&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">buildGraph&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">prerequisites&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">traverse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">hasCycle&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">onPath&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// è®°å½•è·¯å¾„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">visited&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// è®°å½•è®¿é—®çš„èŠ‚ç‚¹&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hasCycle&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å›¾ä¸­æ˜¯å¦æœ‰ç¯&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å›æº¯ï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">traverse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">onPath&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">hasCycle&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hasCycle&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">visited&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å·²ç»æ‰¾åˆ°ç¯æˆ–è€…å·²ç»éå†è¿‡äº†&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å‰åºä»£ç ä½ç½®&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">onPath&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">visited&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">traverse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ååºä»£ç ä½ç½®&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">onPath&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å»ºå›¾&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">buildGraph&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[][]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">prerequisites&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LinkedList&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">edge&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">prerequisites&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">edge&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">edge&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ä¿®å®Œ edge[1] è¯¾ç¨‹åæ‰èƒ½ä¿® edge[0]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">from&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ—¶é—´å¤æ‚åº¦ï¼š$O(n+m)$ï¼Œ$n$ä¸ºè¯¾ç¨‹æ•°ï¼Œ$m$ä¸ºå…ˆä¿®è¯¾ç¨‹çš„è¦æ±‚æ•°ã€‚&lt;/p>
&lt;p>ç©ºé—´å¤æ‚åº¦ï¼š$O(n+m)$ã€‚&lt;/p>
&lt;p>å¹¿åº¦ä¼˜å…ˆæœç´¢æ–¹æ³•ï¼Œé¦–å…ˆè¦å»ºç«‹ä¸€ä¸ªå…¥åº¦çš„æ•°ç»„ï¼Œå¦‚æœå…¥åº¦ä¸º0å°±åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œæ¥ç€å¹¿åº¦æœç´¢æœ‰ä¾èµ–çš„èŠ‚ç‚¹ï¼Œå¹¶å°†è¿™äº›èŠ‚ç‚¹çš„å…¥åº¦å‡ä¸€ï¼Œå¦‚æœæœ€åéå†çš„èŠ‚ç‚¹ä¸ªæ•°ä¸numCoursesç›¸åŒï¼Œåˆ™è¯´æ˜æ²¡æœ‰å½¢æˆç¯ã€‚å› ä¸ºå¦‚æœå½¢æˆç¯çš„è¯ï¼Œç¯ä¸­çš„èŠ‚ç‚¹çš„å…¥åº¦ä¸ä¼šå‡å°‘åˆ°0ï¼Œè‚¯å®šä¸ä¼šåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œä¹Ÿå°±ä¸ä¼šéå†åˆ°ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ–¹æ³•äºŒï¼šå¹¿åº¦ä¼˜å…ˆæœç´¢&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">canFinish&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[][]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">prerequisites&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å»ºå›¾&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">buildGraph&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">prerequisites&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ„å»ºå…¥åº¦æ•°ç»„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">indegree&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">edge&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">prerequisites&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">edge&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">edge&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// èŠ‚ç‚¹ to çš„å…¥åº¦åŠ ä¸€&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">indegree&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">]++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ ¹æ®å…¥åº¦åˆå§‹åŒ–é˜Ÿåˆ—&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Queue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">q&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LinkedList&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">indegree&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¦‚æœå…¥åº¦ä¸º0ï¼Œåˆ™åŠ å…¥é˜Ÿåˆ—&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">q&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">offer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// è®°å½•éå†çš„èŠ‚ç‚¹çš„ä¸ªæ•°&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">q&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¼¹å‡ºèŠ‚ç‚¹å¹¶å°†å®ƒæŒ‡å‘çš„èŠ‚ç‚¹çš„å…¥åº¦å‡ä¸€&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cur&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">q&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">poll&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">cur&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">indegree&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="o">]--&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¦‚æœå…¥åº¦ä¸º0ï¼Œåˆ™åŠ å…¥é˜Ÿåˆ—ä¸­&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">indegree&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">q&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">offer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¦‚æœæ‰€æœ‰èŠ‚ç‚¹éƒ½éå†è¿‡ï¼Œåˆ™è¯´æ˜æ²¡æœ‰å½¢æˆç¯&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ‹“æ‰‘æ’åº">æ‹“æ‰‘æ’åº
&lt;/h2>&lt;h3 id="210è¯¾ç¨‹è¡¨iihttpsleetcode-cncomproblemscourse-schedule-ii">&lt;a class="link" href="https://leetcode-cn.com/problems/course-schedule-ii/" target="_blank" rel="noopener"
>210.è¯¾ç¨‹è¡¨II&lt;/a>
&lt;/h3>&lt;p>æ‹“æ‰‘æ’åºå°±æ˜¯åè½¬ååºéå†çš„ç»“æœã€‚æ³¨æ„è¿™é‡Œçš„ä¾èµ–å…³ç³»ä¾ç„¶æ˜¯å…ˆä¿®å®Œedge[1]è¯¾ç¨‹å†ä¿®edge[0]è¯¾ç¨‹ï¼Œå›¾ä¸­edge[1] -&amp;gt; edge[0]ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">Solution&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">findOrder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[][]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">prerequisites&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">onPath&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">visited&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">buildGraph&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">prerequisites&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">traverse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hasCycle&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¦‚æœå­˜åœ¨ç¯&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="p">{};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// é€†ååºéå†çš„ç»“æœå°±æ˜¯æ‹“æ‰‘æ’åºçš„ç»“æœ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Collections&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">reverse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">postorder&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// è¿™é‡Œç›´æ¥è°ƒç”¨Collectionsçš„æ¥å£&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">postorder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">onPath&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">visited&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hasCycle&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">postorder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ArrayList&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">traverse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">onPath&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">hasCycle&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">visited&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hasCycle&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å‰åºéå†ä½ç½®&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">visited&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">onPath&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">traverse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ååºéå†ä½ç½®&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">postorder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">onPath&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å»ºå›¾å‡½æ•°&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">buildGraph&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[][]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">prerequisites&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LinkedList&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LinkedList&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">edge&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">prerequisites&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">edge&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">edge&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å…ˆä¿® edge[1] å†ä¿® edge[0]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">from&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¹¿åº¦ä¼˜å…ˆæœç´¢æ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ–¹æ³•äºŒï¼šå¹¿åº¦ä¼˜å…ˆæœç´¢&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">findOrder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[][]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">prerequisites&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">buildGraph&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">prerequisites&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">indegree&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">edge&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">prerequisites&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">edge&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">edge&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">indegree&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">]++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ ¹æ®å…¥åº¦æ•°ç»„åˆå§‹åŒ–é˜Ÿåˆ—&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Queue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">q&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LinkedList&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">indegree&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">q&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">offer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¹¿åº¦ä¼˜å…ˆæœç´¢&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// è®°å½•éå†çš„æ¬¡æ•°&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// è®°å½•ç»“æœ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">q&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cur&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">q&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">poll&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cur&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">cur&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">indegree&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="o">]--&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">indegree&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">q&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">offer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¦‚æœå­˜åœ¨ç¯å°±è¿”å›ç©ºæ•°ç»„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">numCourses&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="p">{};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å‰‘æŒ‡-offer-ii-115-é‡å»ºåºåˆ—httpsleetcode-cncomproblemsur2n8p">&lt;a class="link" href="https://leetcode-cn.com/problems/ur2n8P/" target="_blank" rel="noopener"
>å‰‘æŒ‡ Offer II 115. é‡å»ºåºåˆ—&lt;/a>
&lt;/h3>&lt;p>è¿™é“é¢˜çš„å…³é”®ç‚¹æ˜¯å¦‚ä½•ä¿è¯é‡å»ºåºåˆ—çš„å”¯ä¸€æ€§ï¼Œå…¶å®å°±æ˜¯åˆ¤æ–­&lt;code>q.size() == 1&lt;/code>ï¼Œä¹Ÿå°±æ˜¯é˜Ÿåˆ—çš„å¤§å°æ˜¯å¦ä¸º1ã€‚&lt;/p>
&lt;p>è¿˜æœ‰ä¸€ç‚¹ç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œé‚£å°±æ˜¯å…ˆè¦ä¿è¯é‡å»ºåºåˆ—é›†ä¸­çš„å…ƒç´ ä¸º&lt;code>{1,...,n}&lt;/code>ï¼Œè¿™é‡Œç”¨Seté›†åˆæ¥åˆ¤æ–­ã€‚&lt;/p>
&lt;p>å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">Solution&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">sequenceReconstruction&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">seqs&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ä¿è¯é‡å»ºåºåˆ—é›†çš„å®Œæ•´æ€§ï¼Œå³é‡å»ºåºåˆ—ä¸­å…ƒç´ èƒ½æ˜¯ {1,...,n}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">set&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashSet&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">list&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">seqs&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">list&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">set&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¦‚æœsetä¸­å…ƒç´ ä¸å¤Ÿï¼Œè¿”å› false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">set&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¦‚æœå…ƒç´ ä¸åŒ¹é…ï¼Œè¿”å› false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">set&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">contains&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">buildGraph&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">seqs&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// åˆå§‹åŒ–é˜Ÿåˆ—&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Queue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">q&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LinkedList&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">indegree&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">indegree&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">q&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">offer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">q&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ä¿è¯å”¯ä¸€æ€§&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">q&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cur&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">q&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">poll&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cur&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// è®°å½•æ‹“æ‰‘æ’åºç»“æœ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nextCount&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">cur&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">indegree&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="o">]--&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">indegree&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">q&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">offer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å‡ºç°ç¯çš„æƒ…å†µ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ¯”è¾ƒæ¯ä¸€ä¸ªå…ƒç´ &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å»ºå›¾&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">indegree&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å…¥åº¦æ•°ç»„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">buildGraph&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">seqs&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LinkedList&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">indegree&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LinkedList&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">seqs&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">continue&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">from&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">indegree&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">]++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">graph&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://labuladong.github.io/algo/" target="_blank" rel="noopener"
>labuladongçš„ç®—æ³•å°æŠ„&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>å•è°ƒæ ˆç›¸å…³é¢˜ç›®</title><link>https://wenjin1997.github.io/2022/05/01/monotonic-stack/</link><pubDate>Sun, 01 May 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/05/01/monotonic-stack/</guid><description>&lt;h2 id="ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ">ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ 
&lt;/h2>&lt;p>å•è°ƒæ ˆçš„ä¸€ä¸ªåº”ç”¨æ˜¯æ±‚ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ ã€‚å…¶ä¸­ç”¨åˆ°çš„è¾ƒå¤šçš„æ˜¯æ¥å£&lt;code>Deque&lt;/code>ï¼Œç±»å›¾ç»“æ„å¦‚ä¸‹ï¼š
&lt;img src="https://wenjin1997.github.io/img/2022-05-01-monotonic-stack/Deque.png"
loading="lazy"
alt="Deque"
>&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://leetcode-cn.com/problems/next-greater-element-i/" target="_blank" rel="noopener"
>496.ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ I&lt;/a>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">Solution&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å•è°ƒæ ˆ + å“ˆå¸Œè¡¨&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">nextGreaterElement&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ–¹ä¾¿è¿”å›ç­”æ¡ˆ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Deque æ˜¯åŒç«¯é˜Ÿåˆ—&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Deque&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ArrayDeque&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// é€†åºéå†æ•°ç»„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums2&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">--&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¦‚æœæ ˆä¸ä¸ºç©ºï¼Œå¹¶ä¸”å½“å‰çš„å€¼æ¯”æ ˆé¡¶å…ƒç´ å¤§ï¼Œåˆ™æŠ›å‡ºæ ˆé¡¶å…ƒç´ ï¼Œå› ä¸ºä¸å¯èƒ½æ˜¯ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ç›´åˆ°æ ˆä¸ºç©ºæˆ–è€…æ‰¾åˆ°ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums2&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">peek&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">pop&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å­˜å‚¨å½“å‰æ•°çš„ä¸‹ä¸€ä¸ªæœ€å¤§å…ƒç´ ï¼Œæ•°ç»„ä¸­æ²¡æœ‰é‡å¤å…ƒç´ ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨HashMap&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nums2&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">peek&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å‘æ ˆä¸­æ·»åŠ å½“å‰å…ƒç´ &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nums2&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ans&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">nums1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ans&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nums1&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ans&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;a class="link" href="https://leetcode-cn.com/problems/next-greater-element-ii/" target="_blank" rel="noopener"
>503.ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ II&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œè¦æ±‚çš„æ˜¯å¾ªç¯æ•°ç»„ï¼Œå¯ä»¥è½¬æ¢ä¸ºä¸Šä¸€é¢˜ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º 2 * n çš„æ•°ç»„ç”¨ä¸Šä¸€é¢˜çš„æ–¹æ³•ï¼Œå®é™…ä¸Šå¯ä»¥é€šè¿‡æŒ‡æ ‡å–æ¨¡æ¥è¾¾åˆ°è¿™ä¸ªæ•ˆæœã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">Solution&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å•è°ƒæ ˆ + å¾ªç¯æ•°ç»„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">nextGreaterElements&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Deque&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LinkedList&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ç”¨æŒ‡æ ‡å–æ¨¡æ¥æ¨¡æ‹Ÿæœ‰ 2 * n é•¿åº¦çš„æ•°ç»„[0, ... , n - 1, 0, ... , n - 1]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">--&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">%&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">peek&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">pop&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">%&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">peek&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">%&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;a class="link" href="https://leetcode-cn.com/problems/daily-temperatures/" target="_blank" rel="noopener"
>739.æ¯æ—¥æ¸©åº¦&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>è¿™é“é¢˜ä¾ç„¶æ˜¯ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ çš„å˜å½¢ï¼Œæ¢æ±¤ä¸æ¢è¯ï¼Œæ ˆä¸­å­˜æ”¾çš„æ˜¯æ•°ç»„çš„ä¸‹æ ‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">Solution&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å•è°ƒæ ˆ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">dailyTemperatures&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">temperatures&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ans&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">temperatures&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ä¸ºäº†è¿”å›å¤©æ•°ï¼Œæ ˆä¸­å­˜æ”¾çš„æ˜¯æ•°ç»„çš„ä¸‹æ ‡&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Deque&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LinkedList&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">temperatures&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">--&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">temperatures&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">temperatures&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">peek&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">pop&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ans&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">peek&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ans&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;a class="link" href="https://leetcode-cn.com/problems/trapping-rain-water/" target="_blank" rel="noopener"
>42.æ¥é›¨æ°´&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>æ€è·¯æ˜¯ï¼šåˆ©ç”¨å•è°ƒæ ˆï¼Œæ ˆä¸­çš„å…ƒç´ æŒ‰é«˜åº¦é€’å‡ï¼Œå¦‚æœæ ˆä¸­è‡³å°‘æœ‰ä¸¤ä¸ªå…ƒç´ ï¼Œè¯´æ˜é«˜åº¦åœ¨ä¸‹é™ï¼Œè€Œå¦‚æœå½“å‰å…ƒç´ çš„é«˜åº¦æ¯”è¾ƒé«˜ï¼Œé‚£ä¹ˆå°±å¯ä»¥å½¢æˆä¸€ä¸ªæ´¼åœ°ï¼Œèƒ½å¤Ÿæ¥é›¨æ°´ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">Solution&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å•è°ƒæ ˆ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">trap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">height&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ans&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Deque&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LinkedList&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">height&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">height&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">height&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">peek&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">top&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">pop&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¦‚æœæ ˆä¸­å­˜åœ¨è‡³å°‘ä¸¤ä¸ªå…ƒç´ ï¼Œå½“å‰çš„å€¼æ¯”è¾ƒé«˜ï¼Œé‚£ä¹ˆå¯ä»¥å½¢æˆä¸€ä¸ªæ´¼åœ°ï¼Œå¯ä»¥æ¥é›¨æ°´&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">peek&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">currWidth&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">currHeight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Math&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">min&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">height&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">height&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">top&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">height&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">height&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">top&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ans&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">currWidth&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">currHeight&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ans&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>æ’åºç®—æ³•</title><link>https://wenjin1997.github.io/2022/04/30/sortAlgorithms/</link><pubDate>Sat, 30 Apr 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/04/30/sortAlgorithms/</guid><description>&lt;p>å‚è€ƒ&lt;a class="link" href="https://www.runoob.com/w3cnote/ten-sorting-algorithm.html" target="_blank" rel="noopener"
>åå¤§ç»å…¸æ’åºç®—æ³•&lt;/a>ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-04-30-sortAlgorithms/sort.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-04-30-sortAlgorithms/sort-2.png"
loading="lazy"
>&lt;/p>
&lt;h2 id="å†’æ³¡æ’åº">å†’æ³¡æ’åº
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">BubbleSort&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sourceArray&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¯¹ arr è¿›è¡Œæ‹·è´ï¼Œä¸æ”¹å˜å‚æ•°å†…å®¹&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">arr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Arrays&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">copyOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sourceArray&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sourceArray&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">arr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// è®¾å®šä¸€ä¸ªæ ‡è®°ï¼Œè‹¥ä¸º trueï¼Œåˆ™è¡¨ç¤ºæ­¤æ¬¡å¾ªç¯æ²¡æœ‰è¿›è¡Œäº¤æ¢ï¼Œä¹Ÿå°±æ˜¯å¾…æ’åºåˆ—å·²ç»æœ‰åºï¼Œæ’åºå·²ç»å®Œæˆ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">flag&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">arr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">arr&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">arr&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">temp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">arr&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">arr&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">arr&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">arr&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">temp&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">flag&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">flag&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">arr&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="é€‰æ‹©æ’åº">é€‰æ‹©æ’åº
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">Selection&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Comparable&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°† a[] æŒ‰å‡åºæ’åˆ—&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">N&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">N&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°† a[i] å’Œ a[i + 1 ... N] ä¸­æœ€å°çš„å…ƒç´ äº¤æ¢&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">min&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// æœ€å°å…ƒç´ çš„ç´¢å¼•&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">N&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">less&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">min&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">min&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ‰¾åˆ°a[i+1,...,N]ä¸­æœ€å°çš„å…ƒç´ &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">exch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">min&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ’å…¥æ’åº">æ’å…¥æ’åº
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">Insertion&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Comparable&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°† a[] æŒ‰å‡åºæ’åˆ—&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">N&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">N&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°† a[i] æ’å…¥åˆ° a[i - 1]ã€a[i - 2]ã€a[i - 3]...ä¹‹ä¸­&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// less(a[j], a[j - 1])ï¼Œæ˜¯å¦‚æœ a[j] æ¯” a[j - 1] å°&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">less&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="o">--&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">exch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å¸Œå°”æ’åº">å¸Œå°”æ’åº
&lt;/h2>&lt;p>å¸Œå°”æ’åºçš„æ€æƒ³æ˜¯ä½¿æ•°ç»„ä¸­ä»»æ„é—´éš” h çš„å…ƒç´ éƒ½æ˜¯æœ‰åºçš„ã€‚å¸Œå°”æ’åºæ›´é«˜æ•ˆçš„åŸå› æ˜¯å®ƒæƒè¡¡äº†å­æ•°ç»„çš„è§„æ¨¡å’Œæœ‰åºæ€§ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">Shell&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Comparable&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°† a[] æŒ‰å‡åºæ’åˆ—&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">N&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">N&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">3&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// 1, 4, 13, 40, 121, 364, 1093, ...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°†æ•°ç»„å˜ä¸º h æœ‰åº&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">N&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°† a[i] æ’å…¥åˆ° a[i - h], a[i - 2 * h], a[i - 3 * h]...ä¹‹ä¸­&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">less&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">exch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">3&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å½’å¹¶æ’åº">å½’å¹¶æ’åº
&lt;/h2>&lt;p>å½’å¹¶æ’åºå°†æ•°ç»„åˆ†æˆä¸¤ä¸ªå­æ•°ç»„åˆ†åˆ«è¿›è¡Œæ’åºï¼Œå¹¶å°†æœ‰åºçš„å­æ•°ç»„å½’å¹¶ä»¥å°†æ•´ä¸ªæ•°ç»„æ’åºï¼Œé€’å½’è°ƒç”¨å‘ç”Ÿåœ¨å¤„ç†æ•´ä¸ªæ•°ç»„ä¹‹å‰ã€‚&lt;/p>
&lt;p>åŸåœ°å½’å¹¶çš„æŠ½è±¡æ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">merge&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Comparable&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mid&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hi&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°†a[lo,...,mid]å’Œa[mid + 1,...,hi]å½’å¹¶&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hi&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°†a[lo,...,hi]å¤åˆ¶åˆ°aux[lo,...,hi]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">aux&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hi&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å½’å¹¶å›åˆ°a[lo,...,hi]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mid&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">aux&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="o">++]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hi&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">aux&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">less&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">aux&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">aux&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">aux&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="o">++]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">aux&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è‡ªé¡¶å‘ä¸‹çš„å½’å¹¶æ’åºï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">Merge&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Comparable&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">aux&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å½’å¹¶æ‰€éœ€çš„è¾…åŠ©æ•°ç»„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Comparable&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">aux&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Comparable&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// ä¸€æ¬¡æ€§åˆ†é…ç©ºé—´&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Comparable&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hi&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°†æ•°ç»„a[lo,...,hi]æ’åº&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hi&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hi&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mid&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°†å·¦åŠè¾¹æ’åº&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hi&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°†å³åŠè¾¹æ’åº&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">merge&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mid&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hi&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å½’å¹¶ç»“æœ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å¿«é€Ÿæ’åº">å¿«é€Ÿæ’åº
&lt;/h2>&lt;p>å¿«é€Ÿæ’åºå°†æ•°ç»„æ’åºçš„æ–¹å¼æ˜¯å½“ä¸¤ä¸ªå­æ•°ç»„éƒ½æœ‰åºæ—¶æ•´ä¸ªæ•°ç»„ä¹Ÿå°±è‡ªç„¶æœ‰åºäº†ï¼Œé€’å½’è°ƒç”¨å‘ç”Ÿåœ¨å¤„ç†æ•´ä¸ªæ•°ç»„ä¹‹åã€‚&lt;/p>
&lt;p>é¦–å…ˆæ˜¯åˆ‡åˆ†ç®—æ³•ï¼Œä½¿å¾— &lt;code>a[lo...j-1] &amp;lt;= a[j] &amp;lt;= a[j+1...hi]&lt;/code>ï¼Œè¿”å›æŒ‡æ ‡&lt;code>j&lt;/code>ã€‚å®ç°åˆ‡åˆ†ç®—æ³•çš„æ€è·¯æ˜¯å…ˆéšæœºåœ°å–&lt;code>a[lo]&lt;/code>ä½œä¸ºåˆ‡åˆ†å…ƒç´ ï¼Œç„¶åæˆ‘ä»¬ä»æ•°ç»„çš„å·¦ç«¯å¼€å§‹å‘å³æ‰«æç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªå¤§äºç­‰äºå®ƒçš„å…ƒç´ ï¼Œå†ä»æ•°ç»„çš„å³ç«¯å¼€å§‹å‘å·¦æ‰«æç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªå°äºç­‰äºå®ƒçš„å…ƒç´ ï¼Œäº¤æ¢å®ƒä»¬çš„ä½ç½®ã€‚å¦‚æ­¤ç»§ç»­ï¼Œæˆ‘ä»¬ä¿è¯å·¦æŒ‡é’ˆ&lt;code>i&lt;/code>çš„å·¦ä¾§å…ƒç´ éƒ½ä¸å¤§äºåˆ‡åˆ†å…ƒç´ ï¼Œå³æŒ‡é’ˆ&lt;code>j&lt;/code>çš„å³ä¾§å…ƒç´ éƒ½ä¸å°äºåˆ‡åˆ†å…ƒç´ ã€‚å½“ä¸¤ä¸ªæŒ‡é’ˆç›¸é‡æ—¶ï¼Œå°†åˆ‡åˆ†å…ƒç´ &lt;code>a[lo]&lt;/code>å’Œå·¦å­æ•°ç»„æœ€å³ä¾§çš„å…ƒç´ &lt;code>a[j]&lt;/code>äº¤æ¢åè¿”å›&lt;code>j&lt;/code>å³å¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">partition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Comparable&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hi&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°†æ•°ç»„åˆ‡åˆ†ä¸º a[lo,...,i - 1], a[i], a[i + 1,...,hi]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hi&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å·¦å³æ‰«ææŒ‡é’ˆ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Comparable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// åˆ‡åˆ†å…ƒç´ &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ‰«æå·¦å³ï¼Œæ£€æŸ¥æ‰«ææ˜¯å¦ç»“æŸå¹¶äº¤æ¢å…ƒç´ &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">less&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">[++&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hi&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">less&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">[--&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">exch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">exch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°† v = a[j] æ”¾å…¥æ­£ç¡®çš„ä½ç½®&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¿«é€Ÿæ’åºç®—æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">Quick&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Comparable&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">StdRandom&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">shuffle&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ¶ˆé™¤å¯¹è¾“å…¥çš„ä¾èµ–&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Comparable&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hi&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hi&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">partition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hi&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å³åˆ‡åˆ†ç®—æ³•&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°†å·¦åŠéƒ¨åˆ† a[lo,...,j - 1]æ’åº&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hi&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°†å³åŠéƒ¨åˆ† a[j + 1,...,hi]æ’åº&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¿«é€Ÿæ’åºä¸­é‡è¦çš„å°±æ˜¯åˆ‡åˆ†ç®—æ³•ï¼Œåˆ‡åˆ†ç®—æ³•è¿˜æœ‰ä¸‰å‘åˆ‡åˆ†ã€‚ç»´æŠ¤ä¸€ä¸ªæŒ‡é’ˆ&lt;code>lt&lt;/code>ä½¿å¾—&lt;code>a[lo,...,lt-1]&lt;/code>ä¸­çš„å…ƒç´ éƒ½å°äº&lt;code>v&lt;/code>ï¼Œä¸€ä¸ªæŒ‡é’ˆ&lt;code>gt&lt;/code>ä½¿å¾—&lt;code>a[gt+1,..,hi]&lt;/code>ä¸­çš„å…ƒç´ éƒ½å¤§äº&lt;code>v&lt;/code>ï¼Œä¸€ä¸ªæŒ‡é’ˆ&lt;code>i&lt;/code>ä½¿å¾—&lt;code>a[lt,...,i-1]&lt;/code>ä¸­çš„å…ƒç´ éƒ½ç­‰äº&lt;code>v&lt;/code>ã€‚&lt;/p>
&lt;p>ä¸‰å‘åˆ‡åˆ†çš„å¿«é€Ÿæ’åº:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">Quick3way&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Comparable&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hi&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hi&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lt&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gt&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hi&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Comparable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gt&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cmp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">compareTo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cmp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">exch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lt&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cmp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">exch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gt&lt;/span>&lt;span class="o">--&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// ç°åœ¨ a[lo,...,lt-1] &amp;lt; v = a[lt,...,gt] &amp;lt; a[gt+1,...,hi] æˆç«‹&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lo&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lt&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gt&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hi&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸‰å‘åˆ‡åˆ†ç›¸å…³LeetCodeé¢˜ç›®ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://leetcode-cn.com/problems/sort-colors/" target="_blank" rel="noopener"
>75.é¢œè‰²åˆ†ç±»&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="leetcodeæ’åºç»ƒä¹ ">LeetCodeæ’åºç»ƒä¹ 
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://leetcode-cn.com/problems/sort-an-array/" target="_blank" rel="noopener"
>912.æ’åºæ•°ç»„&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>ç½‘æ˜“å®ä¹ ç¬”è¯•é¢˜</title><link>https://wenjin1997.github.io/2022/04/19/intern-wangyi/</link><pubDate>Tue, 19 Apr 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/04/19/intern-wangyi/</guid><description>&lt;h2 id="æ‰“å°å­—æ¯o">æ‰“å°å­—æ¯â€œOâ€
&lt;/h2>&lt;p>ç»™ä¸€ä¸ªæ•°nï¼Œæ‰“å°4nè¡Œå­—ç¬¦ä¸²ï¼Œæ˜¯ä¸€ä¸ªå¤§â€œOâ€çš„å½¢çŠ¶ã€‚&lt;/p>
&lt;p>ä¾‹1: &lt;code>n = 1&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">.**.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*..*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*..*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.**.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¾‹2: &lt;code>n = 2&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">..****..
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.******.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">**....**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">**....**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">**....**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">**....**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.******.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">..****..
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¾‹3: &lt;code>n = 3&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">...******...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">..********..
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.**********.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">***......***
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">***......***
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">***......***
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">***......***
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">***......***
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">***......***
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.**********.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">..********..
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...******...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ€è·¯">æ€è·¯
&lt;/h3>&lt;p>å°†æ‰“å°æ¯ä¸€è¡ŒæŠ½è±¡æˆä¸€ä¸ªå‡½æ•°ï¼Œä¾‹å¦‚ç¬¬ä¸€è¡Œï¼Œå…ˆæ‰“å°å­—ç¬¦&lt;code>ch1&lt;/code>ï¼Œé‡å¤&lt;code>times1&lt;/code>éï¼Œå†æ‰“å°&lt;code>ch2&lt;/code>æœ‰&lt;code>times2&lt;/code>éï¼Œæœ€åæ‰“å°&lt;code>ch1&lt;/code> æœ‰&lt;code>times1&lt;/code>éã€‚&lt;/p>
&lt;h3 id="ä»£ç ">ä»£ç 
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">java.util.Scanner&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @author æ–‡è¿›
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @version 1.0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">N1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Scanner&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sc&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scanner&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">in&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">nextInt&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">StringBuilder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StringBuilder&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">4&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// [0, ..., n - 1]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">printStr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">&amp;#39;.&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">&amp;#39;*&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">4&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// [3n, ..., 4n - 1]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">printStr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">&amp;#39;.&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">&amp;#39;*&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">4&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">)));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// [n, ..., 3n - 1]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">printStr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">&amp;#39;*&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">&amp;#39;.&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;\n&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// // æˆ–è€…åˆ†å¼€å†™ï¼Œåˆ†åˆ«æ‰“å°ä¸‰å¤§æ®µ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// for (int i = n; i &amp;gt; 0; i--) {&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// sb.append(printStr(&amp;#39;.&amp;#39;, i, &amp;#39;*&amp;#39;, 4 * n - 2 * i));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// sb.append(&amp;#34;\n&amp;#34;);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// }&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// for (int i = 0; i &amp;lt; 2 * n; i++) {&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// sb.append(printStr(&amp;#39;*&amp;#39;, n, &amp;#39;.&amp;#39;, 2 * n));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// sb.append(&amp;#34;\n&amp;#34;);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// }&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// for (int i = 1; i &amp;lt;= n; i++) {&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// sb.append(printStr(&amp;#39;.&amp;#39;, i, &amp;#39;*&amp;#39;, 4 * n - 2 * i));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// sb.append(&amp;#34;\n&amp;#34;);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// }&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ch1 * times1 + ch2 * times2 + ch1 * times1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StringBuilder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">printStr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">char&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ch1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">times1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">char&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ch2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">times2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">StringBuilder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StringBuilder&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">times1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ch1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">times2&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ch2&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">times1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ch1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="næ•°ä¹‹å’Œ">næ•°ä¹‹å’Œ
&lt;/h2>&lt;p>è¦æ„é€ ä¸€ä¸ªé•¿åº¦ä¸ºnçš„æ•°ç»„ï¼Œè¾“å…¥ä¸‰ä¸ªå‚æ•°nï¼Œkï¼Œxã€‚nè¡¨ç¤ºæ•°ç»„çš„é•¿åº¦ï¼Œæ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ ä¸ç›¸ç­‰ä¸”ä¸è¶…è¿‡kï¼Œnä¸ªæ•°çš„å’Œä¸ºkã€‚æœ€åè¾“å‡ºä¸€ä¸ªä»»æ„ä¸€ä¸ªç»“æœå°±å¯ä»¥ï¼Œå¦‚æœæ‰¾ä¸åˆ°è¿™æ ·çš„æ•°ç»„ï¼Œå°±è¿”å›-1ã€‚&lt;/p>
&lt;p>ä¾‹1
è¾“å…¥&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">4 6 15
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¾“å‡ºï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">1 5 6 3
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¾‹2
è¾“å…¥&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">2 3 4
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¾“å‡º&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">-1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ€è·¯-1">æ€è·¯
&lt;/h3>&lt;p>è¿™ä¸ªé¢˜æ˜¯næ•°ä¹‹å’Œçš„é—®é¢˜ï¼Œè”æƒ³åˆ°åœ¨ä¸€ä¸ªæ•°ç»„ä¸­æ±‚å’Œä¸ºtargetçš„nä¸ªæ•°ã€‚å¦‚æœn=2ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸¤æ•°ä¹‹å’Œï¼Œå¯ä»¥å…ˆå¯¹æ•°ç»„æ’åºï¼Œç”¨åŒæŒ‡é’ˆæ±‚ä¸¤æ•°ä¹‹å’Œã€‚å½“æ±‚nä¸ªæ•°ä¹‹å’Œä¸ºtargetæ—¶ï¼Œå¯ä»¥å…ˆå›ºå®šä¸€ä¸ªæ•°nums[i]ï¼Œå†æ±‚n-1ä¸ªæ•°çš„å’Œä¸ºtarget-nums[i]ã€‚&lt;/p>
&lt;p>è¿™é“é¢˜åªéœ€è¿”å›ä¸€ä¸ªå¯è¡Œç»“æœï¼Œé‚£ä¹ˆå½“æ‰¾åˆ°ä¸€ä¸ªè§£æ—¶å°±ç«‹åˆ»è¿”å›ï¼Œå¯ä»¥é¿å…ä¸å¿…è¦çš„é€’å½’è°ƒç”¨ã€‚&lt;/p>
&lt;p>åŒæ—¶é¢˜ç›®ä¸­å‘Šè¯‰æˆ‘ä»¬è¿”å›çš„æ•°ä¸è¶…è¿‡kå¹¶ä¸”å„ä¸ç›¸åŒï¼Œé‚£ä¹ˆæå‰æ„é€ çš„æ•°ç»„å¯ä»¥æ˜¯&lt;code>nums = [1,2,3,...,k]&lt;/code>ï¼Œä¸”&lt;code>nums&lt;/code>æ•°ç»„ä¸éœ€è¦å†æ’åºäº†ã€‚&lt;/p>
&lt;p>ç±»ä¼¼çš„LeetCodeé¢˜ç›®ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://leetcode-cn.com/problems/two-sum/" target="_blank" rel="noopener"
>1.ä¸¤æ•°ä¹‹å’Œ&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://leetcode-cn.com/problems/3sum/" target="_blank" rel="noopener"
>15.ä¸‰æ•°ä¹‹å’Œ&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://leetcode-cn.com/problems/4sum/" target="_blank" rel="noopener"
>18.å››æ•°ä¹‹å’Œ&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://leetcode-cn.com/problems/4sum-ii/" target="_blank" rel="noopener"
>454.å››æ•°ç›¸åŠ II&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="ä»£ç -1">ä»£ç 
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">java.util.LinkedList&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">java.util.List&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">java.util.Scanner&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @author æ–‡è¿›
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @version 1.0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">N2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Scanner&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">scanner&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scanner&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">in&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">scanner&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">nextInt&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">scanner&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">nextInt&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">scanner&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">nextInt&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nSum&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">StringBuilder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StringBuilder&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34; &amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> n æ•°ä¹‹å’Œï¼Œnums[] æå‰æ’å¥½åºäº†ï¼Œå¹¶ä¸”å„ä¸ç›¸åŒ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> åŒæŒ‡é’ˆæ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">nSum&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">start&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LinkedList&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">start&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="o">--&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">right&lt;/span>&lt;span class="o">--&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">start&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">list&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nSum&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">list&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">list&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Javaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ç¬”è®°</title><link>https://wenjin1997.github.io/2022/03/28/The-Art-of-Java-Concurrency-Programming/</link><pubDate>Mon, 28 Mar 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/03/28/The-Art-of-Java-Concurrency-Programming/</guid><description>&lt;img src="https://wenjin1997.github.io/img/2022-03-28-The-Art-of-Java-Concurrency-Programming/background.jpg" alt="Featured image of post Javaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ç¬”è®°" />&lt;h1 id="ç¬¬2ç« -javaå¹¶å‘æœºåˆ¶çš„åº•å±‚å®ç°åŸç†">ç¬¬2ç«  Javaå¹¶å‘æœºåˆ¶çš„åº•å±‚å®ç°åŸç†
&lt;/h1>&lt;h2 id="21-volatileçš„åº”ç”¨">2.1 volatileçš„åº”ç”¨
&lt;/h2>&lt;p>volatileçš„ä¸¤æ¡å®ç°åŸåˆ™ï¼š&lt;/p>
&lt;ul>
&lt;li>Lockå‰ç¼€æŒ‡ä»¤ä¼šå¼•èµ·å¤„ç†å™¨ç¼“å­˜å›å†™åˆ°å†…å­˜ã€‚&lt;/li>
&lt;li>ä¸€ä¸ªå¤„ç†å™¨çš„ç¼“å­˜å›å†™åˆ°å†…å­˜ä¼šå¯¼è‡´å…¶ä»–å¤„ç†å™¨çš„ç¼“å­˜æ— æ•ˆã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="22-synchronizedçš„å®ç°åŸç†ä¸åº”ç”¨">2.2 synchronizedçš„å®ç°åŸç†ä¸åº”ç”¨
&lt;/h2>&lt;p>synchronizedå®ç°åŒæ­¥çš„åŸºç¡€ï¼šJavaä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºé”ã€‚å…·ä½“è¡¨ç°ä¸ºä»¥ä¸‹3ç§å½¢å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>å¯¹äºæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ã€‚&lt;/li>
&lt;li>å¯¹äºé™æ€åŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰ç±»çš„Classå¯¹è±¡ã€‚&lt;/li>
&lt;li>å¯¹äºåŒæ­¥æ–¹æ³•å—ï¼Œé”æ˜¯Synchonizedæ‹¬å·é‡Œé…ç½®çš„å¯¹è±¡ã€‚&lt;/li>
&lt;/ul>
&lt;p>Synchonizedåœ¨JVMé‡Œçš„å®ç°ï¼ŒJVMåŸºäºè¿›å…¥å’Œé€€å‡ºMonitorå¯¹è±¡æ¥å®ç°æ–¹æ³•åŒæ­¥å’Œä»£ç å—åŒæ­¥ã€‚ä»£ç å—åŒæ­¥æ˜¯ä½¿ç”¨monitorenterå’ŒmonitorexitæŒ‡ä»¤å®ç°çš„ã€‚&lt;/p>
&lt;p>monitorenteræŒ‡ä»¤åœ¨ç¼–è¯‘åæ’å…¥åˆ°åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼Œè€Œmonitorexitæ˜¯æ’å…¥åˆ°æ–¹æ³•ç»“æŸå¤„å’Œå¼‚å¸¸å¤„ï¼ŒJVMä¿è¯æ¯ä¸ªmonitorenterå¿…é¡»æœ‰å¯¹åº”çš„monitorexitä¸ä¹‹é…å¯¹ã€‚&lt;/p>
&lt;h3 id="221-javaå¯¹è±¡å¤´">2.2.1 Javaå¯¹è±¡å¤´
&lt;/h3>&lt;h1 id="ç¬¬3ç« -javaå†…å­˜æ¨¡å‹">ç¬¬3ç«  Javaå†…å­˜æ¨¡å‹
&lt;/h1>&lt;h2 id="31-javaå†…å­˜æ¨¡å‹çš„åŸºç¡€">3.1 Javaå†…å­˜æ¨¡å‹çš„åŸºç¡€
&lt;/h2>&lt;h3 id="311-å¹¶å‘ç¼–ç¨‹æ¨¡å‹çš„ä¸¤ä¸ªå…³é”®é—®é¢˜">3.1.1 å¹¶å‘ç¼–ç¨‹æ¨¡å‹çš„ä¸¤ä¸ªå…³é”®é—®é¢˜
&lt;/h3>&lt;ul>
&lt;li>çº¿ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡&lt;/li>
&lt;li>çº¿ç¨‹ä¹‹é—´å¦‚ä½•åŒæ­¥ï¼ŒåŒæ­¥æ˜¯æŒ‡ç¨‹åºä¸­ç”¨äºæ§åˆ¶ä¸åŒçº¿ç¨‹é—´æ“ä½œå‘ç”Ÿç›¸å¯¹é¡ºåºçš„æœºåˆ¶ã€‚&lt;/li>
&lt;/ul>
&lt;p>çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æœºåˆ¶ï¼šå…±äº«å†…å­˜å’Œæ¶ˆæ¯ä¼ é€’ã€‚&lt;/p>
&lt;p>&lt;strong>Javaçš„å¹¶å‘é‡‡ç”¨çš„æ˜¯å…±äº«å†…å­˜æ¨¡å‹&lt;/strong>ï¼ŒJavaçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æ€»æ˜¯éšå¼è¿›è¡Œï¼Œæ•´ä¸ªé€šä¿¡è¿‡ç¨‹å¯¹ç¨‹åºå‘˜å®Œå…¨é€æ˜ã€‚&lt;/p>
&lt;h3 id="312-javaå†…å­˜æ¨¡å‹çš„æŠ½è±¡ç»“æ„">3.1.2 Javaå†…å­˜æ¨¡å‹çš„æŠ½è±¡ç»“æ„
&lt;/h3>&lt;p>åœ¨Javaä¸­ï¼Œæ‰€æœ‰å®ä¾‹åŸŸã€é™æ€åŸŸå’Œæ•°ç»„å…ƒç´ éƒ½å­˜å‚¨åœ¨å †å†…å­˜ä¸­ï¼Œå †å†…å­˜åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«ã€‚&lt;/p>
&lt;p>JMMå®šä¹‰äº†çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„æŠ½è±¡å…³ç³»ï¼š&lt;strong>çº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„æœ¬åœ°å†…å­˜ï¼Œæœ¬åœ°å†…å­˜ä¸­å­˜å‚¨äº†è¯¥çº¿ç¨‹ä»¥è¯»/å†™å…±äº«å˜é‡çš„å‰¯æœ¬ã€‚&lt;/strong>&lt;/p>
&lt;h3 id="313-ä»æºä»£ç åˆ°æŒ‡ä»¤åºåˆ—çš„é‡æ’åº">3.1.3 ä»æºä»£ç åˆ°æŒ‡ä»¤åºåˆ—çš„é‡æ’åº
&lt;/h3>&lt;p>é‡æ’åºåˆ†ä¸º3ç§ï¼š&lt;/p>
&lt;ol>
&lt;li>ç¼–è¯‘å™¨ä¼˜åŒ–çš„é‡æ’åº&lt;/li>
&lt;li>æŒ‡ä»¤çº§å¹¶è¡Œçš„é‡æ’åº&lt;/li>
&lt;li>å†…å­˜ç³»ç»Ÿçš„é‡æ’åº&lt;/li>
&lt;/ol>
&lt;h3 id="314-å¹¶å‘ç¼–ç¨‹æ¨¡å‹çš„åˆ†ç±»">3.1.4 å¹¶å‘ç¼–ç¨‹æ¨¡å‹çš„åˆ†ç±»
&lt;/h3>&lt;p>ç”±äºå†™ç¼“å†²åŒºä»…å¯¹è‡ªå·±çš„å¤„ç†å™¨å¯è§ï¼Œå®ƒä¼šå¯¼è‡´å¤„ç†å™¨æ‰§è¡Œå†…å­˜æ“ä½œçš„é¡ºåºå¯èƒ½ä¼šä¸å†…å­˜å®é™…çš„æ“ä½œæ‰§è¡Œé¡ºåºä¸ä¸€è‡´ã€‚&lt;/p>
&lt;p>å¸¸è§çš„å¤„ç†å™¨éƒ½å…è®¸Store-Loadé‡æ’åºï¼Œå¸¸è§çš„å¤„ç†å™¨éƒ½ä¸å…è®¸å¯¹å­˜åœ¨æ•°æ®ä¾èµ–çš„æ“ä½œåšé‡æ’åºã€‚&lt;/p>
&lt;h3 id="315-happens-beforeç®€ä»‹">3.1.5 happens-beforeç®€ä»‹
&lt;/h3>&lt;p>happens-beforeä»…ä»…è¦æ±‚å‰ä¸€ä¸ªæ“ä½œï¼ˆæ‰§è¡Œçš„ç»“æœï¼‰å¯¹åä¸€ä¸ªæ“ä½œå¯è§ï¼Œä¸”å‰ä¸€ä¸ªæ“ä½œæŒ‰é¡ºåºæ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªhappens-beforeè§„åˆ™å¯¹åº”äºä¸€ä¸ªæˆ–å¤šä¸ªç¼–è¯‘å™¨å’Œå¤„ç†å™¨é‡æ’åºè§„åˆ™ã€‚&lt;/p>
&lt;h2 id="32-é‡æ’åº">3.2 é‡æ’åº
&lt;/h2>&lt;h3 id="321-æ•°æ®ä¾èµ–æ€§">3.2.1 æ•°æ®ä¾èµ–æ€§
&lt;/h3>&lt;p>å¦‚æœä¸¤ä¸ªæ“ä½œè®¿é—®åŒä¸€ä¸ªå˜é‡ï¼Œä¸”è¿™ä¸¤ä¸ªæ“ä½œä¸­æœ‰ä¸€ä¸ªä¸ºå†™æ“ä½œï¼Œæ­¤æ—¶è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å°±å­˜åœ¨æ•°æ®ä¾èµ–æ€§ã€‚&lt;/p>
&lt;p>ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ä¼šæ”¹å˜å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„ä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºã€‚&lt;/p>
&lt;h3 id="322-as-if-serialè¯­ä¹‰">3.2.2 as-if-serialè¯­ä¹‰
&lt;/h3>&lt;p>as-if-serialè¯­ä¹‰ï¼šä¸ç®¡æ€ä¹ˆé‡æ’åºï¼ˆç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†æé«˜å¹¶è¡Œåº¦ï¼‰ï¼Œï¼ˆå•çº¿ç¨‹ï¼‰ç¨‹åºçš„æ‰§è¡Œç»“æœä¸èƒ½è¢«æ”¹å˜ã€‚&lt;/p>
&lt;h3 id="323-ç¨‹åºé¡ºåºè§„åˆ™">3.2.3 ç¨‹åºé¡ºåºè§„åˆ™
&lt;/h3>&lt;p>A happens-before Bï¼Œå½“å®é™…æ‰§è¡Œæ—¶Bå´å¯ä»¥æ’åœ¨Aä¹‹å‰æ‰§è¡Œã€‚
è½¯ä»¶æŠ€æœ¯å’Œç¡¬ä»¶æŠ€æœ¯çš„å…±åŒç›®æ ‡ï¼šåœ¨ä¸æ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„å‰æä¸‹ï¼Œå°½å¯èƒ½æé«˜å¹¶è¡Œåº¦ã€‚&lt;/p>
&lt;h3 id="324-é‡æ’åºå¯¹å¤šçº¿ç¨‹çš„å½±å“">3.2.4 é‡æ’åºå¯¹å¤šçº¿ç¨‹çš„å½±å“
&lt;/h3>&lt;p>å½“ä»£ç ä¸­å­˜åœ¨æ§åˆ¶ä¾èµ–æ—¶ï¼Œä¼šå½±å“æŒ‡ä»¤åºåˆ—æ‰§è¡Œçš„å¹¶è¡Œåº¦ã€‚ä¸ºæ­¤ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¼šé‡‡ç”¨çŒœæµ‹æ‰§è¡Œæ¥æ§åˆ¶ç›¸å…³æ€§å¯¹å¹¶è¡Œåº¦çš„å½±å“ã€‚&lt;/p>
&lt;p>åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œå¯¹å­˜åœ¨æ§åˆ¶ä¾èµ–çš„æ“ä½œé‡æ’åºï¼Œå¯èƒ½ä¼šæ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æœã€‚&lt;/p>
&lt;h2 id="33-é¡ºåºä¸€è‡´æ€§">3.3 é¡ºåºä¸€è‡´æ€§
&lt;/h2>&lt;h3 id="331-æ•°æ®ç«äº‰ä¸é¡ºåºä¸€è‡´æ€§">3.3.1 æ•°æ®ç«äº‰ä¸é¡ºåºä¸€è‡´æ€§
&lt;/h3>&lt;p>å¦‚æœç¨‹åºæ˜¯æ­£ç¡®åŒæ­¥çš„ï¼Œç¨‹åºçš„æ‰§è¡Œå°†å…·æœ‰é¡ºåºä¸€è‡´æ€§ã€‚&lt;/p>
&lt;h3 id="332-é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹">3.3.2 é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹
&lt;/h3>&lt;p>é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹æœ‰ä¸¤å¤§ç‰¹æ€§ï¼š&lt;/p>
&lt;ol>
&lt;li>ä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ‰€æœ‰æ“ä½œå¿…é¡»æŒ‰ç…§ç¨‹åºçš„é¡ºåºæ¥æ‰§è¡Œã€‚&lt;/li>
&lt;li>ï¼ˆä¸ç®¡ç¨‹åºæ˜¯å¦åŒæ­¥ï¼‰æ‰€æœ‰çº¿ç¨‹éƒ½åªèƒ½çœ‹åˆ°ä¸€ä¸ªå•ä¸€çš„æ“ä½œæ‰§è¡Œé¡ºåºã€‚åœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªæ“ä½œéƒ½å¿…é¡»åŸå­æ‰§è¡Œä¸”ç«‹åˆ»å¯¹æ‰€æœ‰çº¿ç¨‹å¯è§ã€‚&lt;/li>
&lt;/ol>
&lt;p>æœªåŒæ­¥ç¨‹åºåœ¨JMMä¸­ä¸ä½†æ•´ä½“çš„æ‰§è¡Œé¡ºåºæ˜¯æ— åºçš„ï¼Œè€Œä¸”æ‰€æœ‰çº¿ç¨‹çœ‹åˆ°çš„æ“ä½œæ‰§è¡Œé¡ºåºä¹Ÿå¯èƒ½ä¸ä¸€è‡´ã€‚&lt;/p>
&lt;h3 id="333-åŒæ­¥ç¨‹åºçš„é¡ºåºä¸€è‡´æ€§ç»“æœ">3.3.3 åŒæ­¥ç¨‹åºçš„é¡ºåºä¸€è‡´æ€§ç»“æœ
&lt;/h3>&lt;p>åœ¨JMMä¸­ï¼Œä¸´ç•ŒåŒºå†…çš„ä»£ç å¯ä»¥é‡æ’åºï¼ˆä½†JMMä¸å…è®¸ä¸´ç•ŒåŒºå†…çš„ä»£ç â€œé€¸å‡ºâ€åˆ°ä¸´ç•ŒåŒºä¹‹å¤–ï¼Œé‚£æ ·ä¼šç ´åç›‘è§†å™¨çš„è¯­ä¹‰ï¼‰ã€‚&lt;/p>
&lt;h3 id="334-æœªåŒæ­¥ç¨‹åºçš„æ‰§è¡Œç‰¹æ€§">3.3.4 æœªåŒæ­¥ç¨‹åºçš„æ‰§è¡Œç‰¹æ€§
&lt;/h3>&lt;p>å¯¹äºæœªåŒæ­¥æˆ–æœªæ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºï¼ŒJMMåªæä¾›æœ€å°å®‰å…¨æ€§ï¼šçº¿ç¨‹æ‰§è¡Œæ—¶è¯»å–åˆ°çš„å€¼ï¼Œè¦ä¹ˆæ˜¯ä¹‹å‰æŸä¸ªçº¿ç¨‹å†™å…¥çš„å€¼ï¼Œè¦ä¹ˆæ˜¯é»˜è®¤å€¼ï¼ˆ0ï¼ŒNullï¼ŒFalseï¼‰ï¼ŒJMMä¿è¯çº¿ç¨‹è¯»æ“ä½œè¯»å–åˆ°çš„å€¼ä¸ä¼šæ— ä¸­ç”Ÿæœ‰çš„å†’å‡ºæ¥ã€‚&lt;/p>
&lt;p>JMMä¸ä¿è¯å¯¹64ä½çš„longå‹å’Œdoubleå‹å˜é‡çš„å†™æ“ä½œå…·æœ‰åŸå­æ€§ï¼Œè€Œé¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¿è¯å¯¹æ‰€æœ‰çš„å†…å­˜è¯»/å†™æ“ä½œéƒ½å…·æœ‰åŸå­æ€§ã€‚&lt;/p>
&lt;p>ä»JSR-133å†…å­˜æ¨¡å‹å¼€å§‹ï¼ˆå³ä»JDK5å¼€å§‹ï¼‰ï¼Œä»…ä»…åªå…è®¸æŠŠä¸€ä¸ª64ä½long/doubleå‹å˜é‡çš„å†™æ“ä½œæ‹†åˆ†ä¸ºä¸¤ä¸ª32ä½çš„å†™æ“ä½œæ¥æ‰§è¡Œï¼Œä»»æ„çš„è¯»æ“ä½œåœ¨JSR-133ä¸­éƒ½å¿…é¡»å…·æœ‰åŸå­æ€§ï¼ˆå³ä»»æ„è¯»æ“ä½œå¿…é¡»è¦åœ¨å•ä¸ªè¯»äº‹åŠ¡ä¸­æ‰§è¡Œï¼‰ã€‚&lt;/p>
&lt;h2 id="34-volatileçš„å†…å­˜è¯­ä¹‰">3.4 volatileçš„å†…å­˜è¯­ä¹‰
&lt;/h2>&lt;h3 id="341-volatileçš„ç‰¹æ€§">3.4.1 volatileçš„ç‰¹æ€§
&lt;/h3>&lt;p>æŠŠå¯¹volatileå˜é‡çš„å•ä¸ªè¯»/å†™ï¼Œçœ‹æˆæ˜¯ä½¿ç”¨åŒä¸€ä¸ªé”å¯¹è¿™äº›å•ä¸ªè¯»/å†™æ“ä½œåšäº†åŒæ­¥ã€‚&lt;/p>
&lt;ul>
&lt;li>å¯è§æ€§ã€‚å¯¹ä¸€ä¸ªvolatileå˜é‡çš„è¯»ï¼Œæ€»æ˜¯èƒ½çœ‹åˆ°ï¼ˆä»»æ„çº¿ç¨‹ï¼‰å¯¹è¿™ä¸ªvolatileå˜é‡æœ€åçš„å†™å…¥ã€‚&lt;/li>
&lt;li>åŸå­æ€§ï¼šå¯¹ä»»æ„å•ä¸ªvolatileå˜é‡çš„è¯»/å†™å…·æœ‰åŸå­æ€§ï¼Œä½†ç±»ä¼¼äºvolatile++è¿™ç§å¤åˆæ“ä½œä¸å…·æœ‰åŸå­æ€§ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="342-volatileå†™-è¯»å»ºç«‹çš„happens-beforeå…³ç³»">3.4.2 volatileå†™-è¯»å»ºç«‹çš„happens-beforeå…³ç³»
&lt;/h3>&lt;p>volatileå†™å’Œé”çš„é‡Šæ”¾æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰ï¼›volatileè¯»ä¸é”çš„è·å–æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰ã€‚&lt;/p>
&lt;h3 id="343-volatileå†™-è¯»çš„å†…å­˜è¯­ä¹‰">3.4.3 volatileå†™-è¯»çš„å†…å­˜è¯­ä¹‰
&lt;/h3>&lt;p>å½“å†™ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ã€‚
å½“è¯»ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ç½®ä¸ºæ— æ•ˆã€‚çº¿ç¨‹æ¥ä¸‹æ¥å°†ä»ä¸»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡ã€‚&lt;/p>
&lt;p>å¯ä»¥çœ‹ä½œæ˜¯åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´åœ¨è¿›è¡Œæ¶ˆæ¯ä¼ é€’ã€‚&lt;/p>
&lt;h3 id="344-volatileå†…å­˜è¯­ä¹‰çš„å®ç°">3.4.4 volatileå†…å­˜è¯­ä¹‰çš„å®ç°
&lt;/h3>&lt;ul>
&lt;li>å½“ç¬¬äºŒä¸ªæ“ä½œæ˜¯volatileå†™æ—¶ï¼Œä¸ç®¡ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºã€‚&lt;/li>
&lt;li>å½“ç¬¬ä¸€ä¸ªæ“ä½œæ—¶volatileè¯»æ—¶ï¼Œä¸ç®¡ç¬¬äºŒä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºã€‚&lt;/li>
&lt;li>å½“ç¬¬ä¸€ä¸ªæ“ä½œæ—¶volatileå†™ï¼Œç¬¬äºŒä¸ªæ“ä½œæ˜¯volatileè¯»æ—¶ï¼Œä¸èƒ½é‡æ’åºã€‚&lt;/li>
&lt;/ul>
&lt;p>åŸºäºä¿å®ˆç­–ç•¥çš„JMMå†…å­˜å±éšœæ’å…¥ç­–ç•¥ï¼š&lt;/p>
&lt;ul>
&lt;li>åœ¨æ¯ä¸ªvolatileå†™æ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ªStoreStoreå±éšœã€‚&lt;/li>
&lt;li>åœ¨æ¯ä¸ªvolatileå†™æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ªStoreLoadå±éšœã€‚&lt;/li>
&lt;li>åœ¨æ¯ä¸ªvolatileè¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ªLoadLoadå±éšœã€‚&lt;/li>
&lt;li>åœ¨æ¯ä¸ªvolatileè¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ªLoadStoreå±éšœã€‚&lt;/li>
&lt;/ul>
&lt;p>å› ä¸ºx86ä»…ä¼šå¯¹å†™-è¯»æ“ä½œåšé‡æ’åºï¼Œå› æ­¤JMMä»…éœ€åœ¨volatileå†™æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ªStoreLoadå±éšœã€‚&lt;/p>
&lt;h3 id="345-jsr-133ä¸ºä»€ä¹ˆè¦å¢å¼ºvolatileçš„å†…å­˜è¯­ä¹‰">3.4.5 JSR-133ä¸ºä»€ä¹ˆè¦å¢å¼ºvolatileçš„å†…å­˜è¯­ä¹‰
&lt;/h3>&lt;p>ä¸¥æ ¼é™åˆ¶ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯¹volatileå˜é‡ä¸æ™®é€šå˜é‡çš„é‡æ’åºï¼Œç¡®ä¿volatileçš„å†™-è¯»å’Œé”çš„é‡Šæ”¾-è·å–å…·æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰ã€‚&lt;/p>
&lt;p>åœ¨åŠŸèƒ½ä¸Šï¼Œé”æ¯”volatileæ›´å¼ºå¤§ï¼›åœ¨å¯ä¼¸ç¼©æ€§å’Œæ‰§è¡Œæ€§èƒ½ä¸Šï¼Œvolatileæ›´æœ‰ä¼˜åŠ¿ã€‚&lt;/p>
&lt;h2 id="35-é”çš„å†…å­˜è¯­ä¹‰">3.5 é”çš„å†…å­˜è¯­ä¹‰
&lt;/h2>&lt;h3 id="351-é”çš„é‡Šæ”¾-è·å–å»ºç«‹çš„happens-beforeå…³ç³»">3.5.1 é”çš„é‡Šæ”¾-è·å–å»ºç«‹çš„happens-beforeå…³ç³»
&lt;/h3>&lt;p>é”é™¤äº†è®©ä¸´ç•ŒåŒºäº’æ–¥æ‰§è¡Œå¤–ï¼Œè¿˜å¯ä»¥è®©é‡Šæ”¾é”çš„çº¿ç¨‹å‘è·å–åŒä¸€ä¸ªé”çš„çº¿ç¨‹å‘é€æ¶ˆæ¯ã€‚&lt;/p>
&lt;h3 id="352-é”çš„é‡Šæ”¾å’Œè·å–çš„å†…å­˜è¯­ä¹‰">3.5.2 é”çš„é‡Šæ”¾å’Œè·å–çš„å†…å­˜è¯­ä¹‰
&lt;/h3>&lt;p>çœ‹ä½œæ˜¯ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´é€šè¿‡ä¸»å†…å­˜å‘é€æ¶ˆæ¯ã€‚&lt;/p>
&lt;h3 id="353-é”å†…å­˜è¯­ä¹‰çš„å®ç°">3.5.3 é”å†…å­˜è¯­ä¹‰çš„å®ç°
&lt;/h3>&lt;p>ReentrantLockçš„å®ç°ä¾èµ–äºJavaåŒæ­¥æ¡†æ¶AbstractQueuedSynchronizerï¼ˆç®€ç§°AQSï¼‰ã€‚AQSä½¿ç”¨ä¸€ä¸ªæ•´å‹çš„volatileå˜é‡ï¼ˆå‘½åä¸ºstateï¼‰æ¥ç»´æŒåŒæ­¥çŠ¶æ€ã€‚&lt;/p>
&lt;p>ReentrantLockåˆ†ä¸ºå…¬å¹³é”å’Œéå…¬å¹³é”ã€‚&lt;/p>
&lt;p>ä½¿ç”¨å…¬å¹³é”æ—¶ï¼ŒåŠ é”æ–¹æ³•lockè°ƒç”¨è½¨è¿¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;ol>
&lt;li>ReentrantLock:lock()&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">ReentrantLock&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sync&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">NonfairSync&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// é»˜è®¤æ„é€ å™¨ä¸ºéå…¬å¹³é”&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">ReentrantLock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fair&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sync&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fair&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">FairSync&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">NonfairSync&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">//true ä¸ºå…¬å¹³é”ï¼Œ false ä¸ºéå…¬å¹³é”&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">lock&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sync&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¦‚æœä¸ºå…¬å¹³é”å°±è°ƒç”¨FairSyncçš„lock()ï¼Œåä¹‹å°±è°ƒç”¨NonfairSync.lock()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>FairSync:lock() (ReentrantLockçš„å†…éƒ¨ç±»)&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">lock&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">acquire&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>AbstractQueuedSynchronizer:acquire(int arg)&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">acquire&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">arg&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">tryAcquire&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">arg&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">acquireQueued&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">addWaiter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Node&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">EXCLUSIVE&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">arg&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">selfInterrupt&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="4">
&lt;li>ReentrantLock:tryAcquire(int acquires)&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">FairSync&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Sync&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">serialVersionUID&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">3000897897090466540L&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">lock&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">acquire&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * Fair version of tryAcquire. Don&amp;#39;t grant access unless
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * recursive call or no waiters or is first.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">protected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">tryAcquire&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acquires&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">current&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> åœ¨AQSä¸­æœ‰å¦‚ä¸‹çš„å˜é‡ state ä»¥åŠ getSatate()æ–¹æ³•ï¼š
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> private volatile int state;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> protected final int getState() {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> return state;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getState&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// è·å–é”çš„å¼€å§‹ï¼Œé¦–å…ˆè¯» volatile å˜é‡ state&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">hasQueuedPredecessors&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">compareAndSetState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acquires&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">setExclusiveOwnerThread&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">current&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">current&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getExclusiveOwnerThread&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nextc&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acquires&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nextc&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Maximum lock count exceeded&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">setState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nextc&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½¿ç”¨å…¬å¹³é”æ—¶ï¼Œè§£é”æ–¹æ³•unlock()è°ƒç”¨è½¨è¿¹ï¼š&lt;/p>
&lt;ol>
&lt;li>ReentrantLock:unlock()&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">unlock&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sync&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">release&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>AbstractQueuedSynchronizer:release(int arg)&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">release&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">arg&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tryRelease&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">arg&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Node&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">head&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">waitStatus&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">unparkSuccessor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>Sync:tryRelase(int releases)&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">protected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">tryRelease&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">releases&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getState&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">releases&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getExclusiveOwnerThread&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">IllegalMonitorStateException&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">free&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">free&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">setExclusiveOwnerThread&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> AQSä¸­çš„setStateæ–¹æ³•ï¼š
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> protected final void setState(int newState) {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> state = newState;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">setState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// é‡Šæ”¾é”çš„æœ€åï¼Œå†™ volatileå˜é‡state&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">free&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å…¬å¹³é”åœ¨é‡Šæ”¾é”çš„æœ€åå†™volatileå˜é‡stateï¼Œåœ¨è·å–é”æ—¶é¦–å…ˆè¯»è¿™ä¸ªvolatileå˜é‡ã€‚å› æ­¤ï¼Œé‡Šæ”¾é”çš„çº¿ç¨‹åœ¨å†™volatileå˜é‡ä¹‹å‰å¯è§çš„å…±äº«å˜é‡ï¼Œåœ¨è·å–é”çš„çº¿ç¨‹è¯»å–åŒä¸€ä¸ªvolatileå˜é‡åå°†ç«‹å³å˜å¾—å¯¹è·å–é”çš„çº¿ç¨‹å¯è§ã€‚&lt;/p>
&lt;p>éå…¬å¹³é”è·å–é”çš„æ–¹å¼å’Œå…¬å¹³é”ç›¸åŒã€‚éå…¬å¹³é”çš„åŠ é”æ–¹æ³•lock()è°ƒç”¨è½¨è¿¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;ol>
&lt;li>ReentrantLock:lock()&lt;/li>
&lt;li>NonfairSync:lock()&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">lock&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">compareAndSetState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">setExclusiveOwnerThread&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">acquire&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>AbstractQueuedSynchronizer:compareAndSetState(int expect, int update)&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">protected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">compareAndSetState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">expect&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">update&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// See below for intrinsics setup to support this&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">unsafe&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">compareAndSwapInt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stateOffset&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">expect&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">update&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¯¥æ–¹æ³•ä»¥åŸå­æ“ä½œçš„æ–¹å¼æ›´æ–°stateå˜é‡ã€‚compareAndSetState()ç®€ç§°CASæ–¹æ³•ã€‚å¦‚æœå½“å‰çŠ¶æ€å€¼ç­‰äºé¢„æœŸå€¼ï¼Œåˆ™ä»¥åŸå­çš„æ–¹å¼å°†åŒæ­¥çŠ¶æ€è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚æ­¤æ“ä½œå…·æœ‰volatileè¯»å’Œå†™çš„å†…å­˜è¯­ä¹‰ã€‚&lt;/p>
&lt;p>sun.misc.Unsafeç±»çš„compareAndSwapInt()æ–¹æ³•çš„æºä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">native&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">compareAndSwapInt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var4&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var5&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™æ˜¯ä¸€ä¸ªæœ¬åœ°è°ƒç”¨æ–¹æ³•ï¼Œä¼šè°ƒç”¨ç›¸åº”çš„C++ä»£ç ï¼Œé‡è¦çš„æ˜¯æºä»£ç ä¸­å«æœ‰&lt;code>cmpxchg&lt;/code>ï¼Œç¨‹åºä¼šæ ¹æ®å½“å‰å¤„ç†å™¨çš„ç±»å‹æ¥å†³å®šæ˜¯å¦ä¸ºcmpxchgæŒ‡ä»¤æ·»åŠ lockå‰ç¼€ã€‚å¦‚æœæ˜¯å½“å¤„ç†å™¨ï¼Œå°±çœç•¥lockæŒ‡ä»¤ï¼Œå¦‚æœæ˜¯å¤šå¤„ç†å™¨å°±åŠ ä¸Šlockå‰ç¼€ã€‚&lt;/p>
&lt;p>intelæ‰‹å†Œå¯¹lockå‰ç¼€çš„è¯´æ˜ï¼š&lt;/p>
&lt;ol>
&lt;li>ç¡®ä¿å¯¹å†…å­˜çš„è¯»-æ”¹-å†™æ“ä½œçš„åŸå­æ‰§è¡Œã€‚Intelä½¿ç”¨ç¼“å­˜é”å®šæ¥ä¿è¯æŒ‡ä»¤æ‰§è¡Œçš„åŸå­æ€§ã€‚ç¼“å­˜é”å®šå°†å¤§å¤§é™ä½lockå‰ç¼€æŒ‡ä»¤çš„æ‰§è¡Œå¼€é”€ã€‚&lt;/li>
&lt;li>ç¦æ­¢è¯¥æŒ‡ä»¤ï¼Œä¸ä¹‹å‰å’Œä¹‹åçš„è¯»å’Œå†™æŒ‡ä»¤é‡æ’åºã€‚&lt;/li>
&lt;li>æŠŠå†™ç¼“å†²åŒºä¸­çš„æ‰€æœ‰æ•°æ®åˆ·æ–°åˆ°å†…å­˜ä¸­ã€‚&lt;/li>
&lt;/ol>
&lt;p>å…¬å¹³é”å’Œéå…¬å¹³é”çš„å†…å­˜è¯­ä¹‰ï¼š&lt;/p>
&lt;ul>
&lt;li>å…¬å¹³é”å’Œéå…¬å¹³é”é‡Šæ”¾æ—¶ï¼Œæœ€åéƒ½è¦å†™ä¸€ä¸ªvolatileå˜é‡stateã€‚&lt;/li>
&lt;li>å…¬å¹³é”è·å–æ—¶ï¼Œé¦–å…ˆä¼šå»è¯»volatileå˜é‡ã€‚&lt;/li>
&lt;li>éå…¬å¹³é”è·å–æ—¶ï¼Œé¦–å…ˆä¼šç”¨CASæ›´æ–°volatileå˜é‡ï¼Œè¿™ä¸ªæ“ä½œåŒæ—¶å…·æœ‰volatileè¯»å’Œvolatileå†™çš„å†…å­˜è¯­ä¹‰ã€‚&lt;/li>
&lt;/ul>
&lt;p>é”é‡Šæ”¾-è·å–çš„å†…å­˜è¯­ä¹‰çš„å®ç°è‡³å°‘æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>åˆ©ç”¨volatileå˜é‡çš„å†™-è¯»æ‰€å…·æœ‰çš„å†…å­˜è¯­ä¹‰ã€‚&lt;/li>
&lt;li>åˆ©ç”¨CASæ‰€é™„å¸¦çš„volatileè¯»å’Œvolatileå†™çš„å†…å­˜è¯­ä¹‰ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="354-concurrentåŒ…çš„å®ç°">3.5.4 concurrentåŒ…çš„å®ç°
&lt;/h3>&lt;p>ä¸€ä¸ªé€šç”¨åŒ–çš„å®ç°æ¨¡å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>é¦–å…ˆï¼Œå£°æ˜å…±äº«å˜é‡volatile.&lt;/li>
&lt;li>ç„¶åï¼Œä½¿ç”¨CASçš„åŸå­æ¡ä»¶æ›´æ–°æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ã€‚&lt;/li>
&lt;li>åŒæ—¶ï¼Œé…åˆä»¥vilatileçš„è¯»/å†™å’ŒCASæ‰€å…·æœ‰çš„volatileè¯»å’Œå†™çš„å†…å­˜è¯­ä¹‰æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="36-finalåŸŸçš„å†…å­˜è¯­ä¹‰">3.6 finalåŸŸçš„å†…å­˜è¯­ä¹‰
&lt;/h2>&lt;h3 id="361-finalåŸŸçš„é‡æ’åºè§„åˆ™">3.6.1 finalåŸŸçš„é‡æ’åºè§„åˆ™
&lt;/h3>&lt;ol>
&lt;li>åœ¨æ„é€ å‡½æ•°å†…å¯¹ä¸€ä¸ªfinalåŸŸçš„å†™å…¥ï¼Œä¸éšåæŠŠè¿™ä¸ªè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¸èƒ½é‡æ’åºã€‚&lt;/li>
&lt;li>åˆæ¬¡è¯»ä¸€ä¸ªåŒ…å«finalåŸŸçš„å¯¹è±¡çš„å¼•ç”¨ï¼Œä¸éšååˆæ¬¡è¯»è¿™ä¸ªfinalåŸŸï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸èƒ½é‡æ’åºã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="362-å†™finalåŸŸçš„é‡æ’åºè§„åˆ™">3.6.2 å†™finalåŸŸçš„é‡æ’åºè§„åˆ™
&lt;/h3>&lt;p>å†™finalåŸŸçš„é‡æ’åºè§„åˆ™ç¦æ­¢æŠŠfinalåŸŸçš„å†™é‡æ’åºåˆ°æ„é€ å‡½æ•°ä¹‹å¤–ï¼Œå…·ä½“å®ç°ï¼š&lt;/p>
&lt;ol>
&lt;li>JMMç¦æ­¢ç¼–è¯‘å™¨æŠŠfinalåŸŸçš„å†™é‡æ’åºåˆ°æ„é€ å‡½æ•°ä¹‹å¤–ã€‚&lt;/li>
&lt;li>ç¼–è¯‘å™¨ä¼šåœ¨finalåŸŸçš„å†™ä¹‹åï¼Œæ„é€ å‡½æ•°returnä¹‹å‰ï¼Œ&lt;strong>æ’å…¥ä¸€ä¸ªStoreStoreå±éšœ&lt;/strong>ã€‚è¿™ä¸ªå±éšœç¦æ­¢å¤„ç†å™¨æŠŠfinalåŸŸçš„å†™é‡æ’åºåˆ°æ„é€ å‡½æ•°ä¹‹å¤–ã€‚&lt;/li>
&lt;/ol>
&lt;p>å†™finalåŸŸçš„é‡æ’åºå¯ä»¥ä¿è¯ï¼šåœ¨å¯¹è±¡å¼•ç”¨ä¸ºä»»æ„çº¿ç¨‹å¯è§ä¹‹å‰ï¼Œå¯¹è±¡çš„finalåŸŸå·²ç»è¢«æ­£ç¡®åˆå§‹åŒ–è¿‡äº†ï¼Œè€Œæ™®é€šåŸŸä¸å…·æœ‰è¿™ä¸ªä¿éšœã€‚&lt;/p>
&lt;h3 id="363-è¯»finalåŸŸçš„é‡æ’åºè§„åˆ™">3.6.3 è¯»finalåŸŸçš„é‡æ’åºè§„åˆ™
&lt;/h3>&lt;p>åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œåˆæ¬¡è¯»å¯¹è±¡å¼•ç”¨ä¸åˆæ¬¡è¯»è¯¥å¯¹è±¡åŒ…å«çš„finalåŸŸï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸èƒ½é‡æ’åºã€‚å®ç°ï¼š&lt;/p>
&lt;ol>
&lt;li>JMMç¦æ­¢å¤„ç†å™¨é‡æ’åºè¿™ä¸¤ä¸ªæ“ä½œã€‚&lt;/li>
&lt;li>ç¼–è¯‘å™¨ä¼šåœ¨è¯»finalåŸŸæ“ä½œçš„å‰é¢&lt;strong>æ’å…¥ä¸€ä¸ªLoadLoadå±éšœ&lt;/strong>ã€‚&lt;/li>
&lt;/ol>
&lt;p>è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å­˜åœ¨é—´æ¥ä¾èµ–å…³ç³»ã€‚&lt;/p>
&lt;p>è¯»finalåŸŸçš„é‡æ’åºè§„åˆ™å¯ä»¥ç¡®ä¿ï¼šåœ¨è¯»ä¸€ä¸ªå¯¹è±¡çš„finalåŸŸä¹‹å‰ï¼Œä¸€å®šä¼šå…ˆè¯»åŒ…å«è¿™ä¸ªfinalåŸŸçš„å¯¹è±¡çš„å¼•ç”¨ã€‚&lt;/p>
&lt;h3 id="364-finalåŸŸä¸ºå¼•ç”¨ç±»å‹">3.6.4 finalåŸŸä¸ºå¼•ç”¨ç±»å‹
&lt;/h3>&lt;p>å¯¹äºå¼•ç”¨ç±»å‹ï¼Œå†™finalåŸŸçš„é‡æ’åºè§„åˆ™å¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¢åŠ äº†å¦‚ä¸‹çº¦æŸï¼šåœ¨æ„é€ å‡½æ•°å†…å¯¹ä¸€ä¸ªfinalå¼•ç”¨çš„å¯¹è±¡çš„æˆå‘˜åŸŸçš„å†™å…¥ï¼Œä¸éšååœ¨æ„é€ å‡½æ•°å¤–æŠŠè¿™ä¸ªè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸èƒ½é‡æ’åºã€‚&lt;/p>
&lt;h3 id="365-ä¸ºä»€ä¹ˆfinalå¼•ç”¨ä¸èƒ½ä»æ„é€ å‡½æ•°å†…æº¢å‡º">3.6.5 ä¸ºä»€ä¹ˆfinalå¼•ç”¨ä¸èƒ½ä»æ„é€ å‡½æ•°å†…â€œæº¢å‡ºâ€
&lt;/h3>&lt;p>åœ¨æ„é€ å‡½æ•°è¿”å›å‰ï¼Œè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨ä¸èƒ½ä¸ºå…¶ä»–çº¿ç¨‹æ‰€è§ï¼Œå› ä¸ºæ­¤æ—¶çš„finalåŸŸå¯èƒ½è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ã€‚åœ¨æ„é€ å‡½æ•°è¿”å›åï¼Œä»»æ„çº¿ç¨‹éƒ½å°†ä¿è¯èƒ½çœ‹åˆ°finalåŸŸæ­£ç¡®åˆå§‹åŒ–ä¹‹åçš„å€¼ã€‚&lt;/p>
&lt;h3 id="366-finalè¯­ä¹‰åœ¨å¤„ç†å™¨ä¸­çš„å®ç°">3.6.6 finalè¯­ä¹‰åœ¨å¤„ç†å™¨ä¸­çš„å®ç°
&lt;/h3>&lt;p>X86å¤„ç†å™¨ï¼Œåªä¼šå¯¹Store-Loadè¿›è¡Œé‡æ’åºã€‚æ ¹æ®finalåŸŸé‡æ’åºè§„åˆ™ï¼Œä»¥åŠX86å¤„ç†å™¨ä¸ä¼šå¯¹å­˜åœ¨é—´æ¥ä¾èµ–å…³ç³»çš„æ“ä½œè¿›è¡Œé‡æ’åºï¼Œå› æ­¤åœ¨X86å¤„ç†å™¨ä¸­ï¼ŒfinalåŸŸçš„è¯»/å†™ä¸ä¼šæ’å…¥ä»»ä½•å†…å­˜å±éšœï¼&lt;/p>
&lt;h3 id="367-jsr-133ä¸ºä»€ä¹ˆè¦å¢å¼ºfinalçš„è¯­ä¹‰">3.6.7 JSR-133ä¸ºä»€ä¹ˆè¦å¢å¼ºfinalçš„è¯­ä¹‰
&lt;/h3>&lt;p>é€šè¿‡ä¸ºfinalåŸŸå¢åŠ å†™å’Œè¯»é‡æ’åºè§„åˆ™ï¼Œå¯ä»¥ä¸ºJavaç¨‹åºå‘˜æä¾›åˆå§‹åŒ–çš„å®‰å…¨ä¿è¯ï¼šåªè¦å¯¹è±¡æ˜¯æ­£ç¡®æ„é€ çš„ï¼ˆè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨åœ¨æ„é€ å‡½æ•°ä¸­æ²¡æœ‰â€œæº¢å‡ºâ€ï¼‰ï¼Œé‚£ä¹ˆä¸éœ€è¦ä½¿ç”¨åŒæ­¥ï¼ˆæŒ‡lockå’Œvolatileçš„ä½¿ç”¨ï¼‰å°±å¯ä»¥ä¿è¯ä»»æ„çº¿ç¨‹éƒ½èƒ½çœ‹åˆ°è¿™ä¸ªfinalåŸŸåœ¨æ„é€ å‡½æ•°ä¸­è¢«åˆå§‹åŒ–ä¹‹åçš„å€¼ã€‚&lt;/p>
&lt;h2 id="37-happens-before">3.7 happens-before
&lt;/h2>&lt;h3 id="371-jmmçš„è®¾è®¡">3.7.1 JMMçš„è®¾è®¡
&lt;/h3>&lt;p>JSR-133ä¸“å®¶ç»„åœ¨è®¾è®¡JMMæ—¶çš„æ ¸å¿ƒç›®æ ‡æ˜¯æ‰¾åˆ°ä¸€ä¸ªå¥½çš„å¹³è¡¡ç‚¹ï¼šä¸€æ–¹é¢ï¼Œè¦ä¸ºç¨‹åºå‘˜æä¾›è¶³å¤Ÿå¼ºçš„å†…å­˜å¯è§æ€§ä¿è¯ï¼›å¦ä¸€æ–¹é¢ï¼Œå¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„é™åˆ¶å°½å¯èƒ½åœ°æ”¾æ¾ã€‚&lt;/p>
&lt;p>JMMå¯¹ä¸åŒæ€§è´¨çš„é‡æ’åºï¼Œé‡‡å–ä¸åŒçš„ç­–ç•¥ï¼š&lt;/p>
&lt;ul>
&lt;li>å¯¹äºä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„é‡æ’åºï¼ŒJMMè¦æ±‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¿…é¡»ç¦æ­¢è¿™ç§é‡æ’åºã€‚&lt;/li>
&lt;li>å¯¹äºä¸ä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„é‡æ’åºï¼ŒJMMå¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸åšè¦æ±‚ï¼ˆJMMè¿è¡Œè¿™ç§é‡æ’åºï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="372-happens-beforeçš„å®šä¹‰">3.7.2 happens-beforeçš„å®šä¹‰
&lt;/h3>&lt;p>happens-beforeå…³ç³»æœ¬è´¨ä¸Šå’Œas-if-serialè¯­ä¹‰æ˜¯ä¸€å›äº‹ï¼Œéƒ½æ˜¯ä¸ºäº†åœ¨ä¸æ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„å‰æä¸‹ï¼Œå°½å¯èƒ½åœ°æé«˜ç¨‹åºæ‰§è¡Œçš„å¹¶è¡Œåº¦ã€‚&lt;/p>
&lt;h3 id="373-happens-beforeè§„åˆ™">3.7.3 happens-beforeè§„åˆ™
&lt;/h3>&lt;ol>
&lt;li>ç¨‹åºé¡ºåºè§„åˆ™&lt;/li>
&lt;li>ç›‘è§†å™¨é”è§„åˆ™&lt;/li>
&lt;li>volatileå˜é‡è§„åˆ™&lt;/li>
&lt;li>ä¼ é€’æ€§&lt;/li>
&lt;li>start()è§„åˆ™ï¼šå¦‚æœçº¿ç¨‹Aæ‰§è¡Œæ“ä½œ&lt;code>ThreadB.start()&lt;/code>ï¼ˆå¯åŠ¨çº¿ç¨‹Bï¼‰ï¼Œé‚£ä¹ˆAçº¿ç¨‹çš„&lt;code>ThreadB.start()&lt;/code>æ“ä½œhappens-beforeäºçº¿ç¨‹Bä¸­çš„ä»»æ„æ“ä½œã€‚&lt;/li>
&lt;li>join()è§„åˆ™ï¼šå¦‚æœçº¿ç¨‹Aæ‰§è¡Œæ“ä½œ&lt;code>ThreadB.join()&lt;/code>å¹¶æˆåŠŸè¿”å›ï¼Œé‚£ä¹ˆBçº¿ç¨‹ä¸­çš„ä»»æ„æ“ä½œhappens-beforeäºçº¿ç¨‹Aä»&lt;code>ThreadB.join()&lt;/code>æ“ä½œæˆåŠŸè¿”å›ã€‚&lt;/li>
&lt;/ol>
&lt;h2 id="38-åŒé‡æ£€æŸ¥é”å®šä¸å»¶è¿Ÿåˆå§‹åŒ–">3.8 åŒé‡æ£€æŸ¥é”å®šä¸å»¶è¿Ÿåˆå§‹åŒ–
&lt;/h2>&lt;h3 id="381-åŒé‡æ£€æŸ¥é”å®šçš„ç”±æ¥">3.8.1 åŒé‡æ£€æŸ¥é”å®šçš„ç”±æ¥
&lt;/h3>&lt;p>å¸Œæœ›é€šè¿‡åŒé‡æ£€æŸ¥é”å®šæ¥é™ä½åŒæ­¥çš„å¼€é”€ã€‚&lt;/p>
&lt;h3 id="382-é—®é¢˜çš„æ ¹æº">3.8.2 é—®é¢˜çš„æ ¹æº
&lt;/h3>&lt;p>åˆ›å»ºå¯¹è±¡&lt;code>instance = new Instance();&lt;/code>å¯ä»¥åˆ†è§£ä¸ºå¦‚ä¸‹3è¡Œä¼ªä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">memory = allocate(); // 1:åˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ctorInstance(memory); // 2:åˆå§‹åŒ–å¯¹è±¡
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">instance = memory; // 3:è®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>2å’Œ3ä¹‹é—´ï¼Œå¯èƒ½è¢«é‡æ’åºï¼Œè¿™ä¼šå¯¼è‡´é—®é¢˜çš„å‘ç”Ÿã€‚&lt;/p>
&lt;p>ä¸¤ä¸ªåŠæ³•å®ç°çº¿ç¨‹å®‰å…¨çš„å»¶è¿Ÿåˆå§‹åŒ–ï¼š&lt;/p>
&lt;ol>
&lt;li>ä¸å…è®¸2å’Œ3é‡æ’åºã€‚&lt;/li>
&lt;li>å…è®¸2å’Œ3é‡æ’åºï¼Œä½†ä¸å…è®¸å…¶ä»–çº¿ç¨‹â€œçœ‹åˆ°â€è¿™ä¸ªé‡æ’åºã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="383-åŸºäºvolatileçš„è§£å†³æ–¹æ¡ˆ">3.8.3 åŸºäºvolatileçš„è§£å†³æ–¹æ¡ˆ
&lt;/h3>&lt;p>åœ¨åŒé‡æ£€æŸ¥é”å®šæ–¹æ³•çš„åŸºç¡€ä¸Šå°†instanceå£°æ˜ä¸ºvolatileå‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">volatile&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Instance&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>2å’Œ3ä¹‹é—´çš„é‡æ’åºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä¼šè¢«ç¦æ­¢ã€‚&lt;/p>
&lt;h3 id="384-åŸºäºç±»åˆå§‹åŒ–çš„è§£å†³æ–¹æ¡ˆ">3.8.4 åŸºäºç±»åˆå§‹åŒ–çš„è§£å†³æ–¹æ¡ˆ
&lt;/h3>&lt;p>å¾…è¯»ã€‚&lt;/p>
&lt;h2 id="39-javaå†…å­˜æ¨¡å‹ç»¼è¿°">3.9 Javaå†…å­˜æ¨¡å‹ç»¼è¿°
&lt;/h2>&lt;h3 id="391-å¤„ç†å™¨çš„å†…å­˜æ¨¡å‹">3.9.1 å¤„ç†å™¨çš„å†…å­˜æ¨¡å‹
&lt;/h3>&lt;p>ç”±äºå¸¸è§çš„å¤„ç†å™¨å†…å­˜æ¨¡å‹æ¯”JMMè¦å¼±ï¼ŒJavaç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼šåœ¨æ‰§è¡ŒæŒ‡ä»¤åºåˆ—çš„é€‚å½“ä½ç½®æ’å…¥å†…å­˜å±éšœæ¥é™åˆ¶å¤„ç†å™¨çš„é‡æ’åºã€‚JMMåœ¨ä¸åŒçš„å¤„ç†å™¨ä¸­éœ€è¦æ’å…¥çš„å†…å­˜å±éšœçš„æ•°é‡å’Œç§ç±»ä¹Ÿä¸ç›¸åŒã€‚&lt;/p>
&lt;h3 id="392-å„ç§å†…å­˜æ¨¡å‹ä¹‹é—´çš„å…³ç³»">3.9.2 å„ç§å†…å­˜æ¨¡å‹ä¹‹é—´çš„å…³ç³»
&lt;/h3>&lt;p>JMMæ˜¯ä¸€ä¸ªè¯­è¨€çº§çš„å†…å­˜æ¨¡å‹ï¼Œå¤„ç†å™¨å†…å­˜æ¨¡å‹æ˜¯ç¡¬ä»¶çº§çš„å†…å­˜æ¨¡å‹ï¼Œé¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹æ˜¯ä¸€ä¸ªç†è®ºå‚è€ƒæ¨¡å‹ã€‚&lt;/p>
&lt;h3 id="393-jmmçš„å†…å­˜å¯è§æ€§ä¿è¯">3.9.3 JMMçš„å†…å­˜å¯è§æ€§ä¿è¯
&lt;/h3>&lt;p>ä¸‰ç±»ï¼š&lt;/p>
&lt;ul>
&lt;li>å•çº¿ç¨‹ç¨‹åºã€‚&lt;/li>
&lt;li>æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºã€‚&lt;/li>
&lt;li>æœªåŒæ­¥/æœªæ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºã€‚æä¾›æœ€å°å®‰å…¨ä¿éšœï¼šçº¿ç¨‹æ‰§è¡Œæ—¶è¯»å–åˆ°çš„å€¼ï¼Œè¦ä¹ˆæ˜¯ä¹‹å‰æŸä¸ªçº¿ç¨‹å†™å…¥çš„å€¼ï¼Œè¦ä¹ˆæ˜¯é»˜è®¤å€¼ï¼ˆ0ã€nullã€falseï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;p>æœ€å°å®‰å…¨ä¿éšœä¸64ä½æ•°æ®çš„éåŸå­æ€§å†™å¹¶ä¸çŸ›ç›¾ã€‚æœ€å°å®‰å…¨æ€§å¹¶ä¸ä¿è¯çº¿ç¨‹è¯»å–åˆ°çš„å€¼ï¼Œä¸€å®šæ˜¯æŸä¸ªçº¿ç¨‹å†™å®Œåçš„å€¼ã€‚æœ€å°å®‰å…¨æ€§ä¿è¯çº¿ç¨‹è¯»å–åˆ°çš„å€¼ä¸ä¼šæ˜¯æ— ä¸­ç”Ÿæœ‰çš„å†’å‡ºæ¥ï¼Œä½†å¹¶ä¸ä¿è¯çº¿ç¨‹è¯»å–åˆ°çš„å€¼ä¸€å®šæ˜¯æ­£ç¡®çš„ã€‚&lt;/p>
&lt;h3 id="394-jsr-133å¯¹æ—§å†…å­˜æ¨¡å‹çš„ä¿®è¡¥">3.9.4 JSR-133å¯¹æ—§å†…å­˜æ¨¡å‹çš„ä¿®è¡¥
&lt;/h3>&lt;p>ä¸»è¦æœ‰ä¸¤ä¸ªï¼š&lt;/p>
&lt;ul>
&lt;li>å¢å¼ºvolatileçš„å†…å­˜è¯­ä¹‰ã€‚&lt;/li>
&lt;li>å¢å¼ºfinalçš„å†…å­˜è¯­ä¹‰ã€‚&lt;/li>
&lt;/ul>
&lt;h1 id="ç¬¬4ç« -javaå¹¶å‘ç¼–ç¨‹åŸºç¡€">ç¬¬4ç«  Javaå¹¶å‘ç¼–ç¨‹åŸºç¡€
&lt;/h1>&lt;h2 id="41-çº¿ç¨‹ç®€ä»‹">4.1 çº¿ç¨‹ç®€ä»‹
&lt;/h2>&lt;h3 id="411-ä»€ä¹ˆæ˜¯çº¿ç¨‹">4.1.1 ä»€ä¹ˆæ˜¯çº¿ç¨‹
&lt;/h3>&lt;p>ç°ä»£æ“ä½œç³»ç»Ÿè°ƒåº¦çš„æœ€å°å•å…ƒæ˜¯çº¿ç¨‹ï¼Œä¹Ÿå«è½»é‡çº§è¿›ç¨‹ï¼Œåœ¨ä¸€ä¸ªè¿›ç¨‹é‡Œå¯ä»¥åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹éƒ½æ‹¥æœ‰å„è‡ªçš„è®¡æ•°å™¨ã€å †æ ˆå’Œå±€éƒ¨å˜é‡ç­‰å±æ€§ï¼Œå¹¶ä¸”èƒ½å¤Ÿè®¿é—®å…±äº«çš„å†…å­˜å˜é‡ã€‚&lt;/p>
&lt;p>Javaç¨‹åºå¤©ç”Ÿå°±æ˜¯å¤šçº¿ç¨‹ç¨‹åºï¼Œå› ä¸ºæ‰§è¡Œmain()æ–¹æ³•çš„æ˜¯ä¸€ä¸ªåç§°ä¸ºmainçš„çº¿ç¨‹ã€‚&lt;/p>
&lt;h3 id="412-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹">4.1.2 ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹
&lt;/h3>&lt;ul>
&lt;li>æ›´å¤šçš„å¤„ç†å™¨æ ¸å¿ƒ&lt;/li>
&lt;li>æ›´å¿«çš„å“åº”æ—¶é—´&lt;/li>
&lt;li>æ›´å¥½çš„ç¼–ç¨‹æ¨¡å‹&lt;/li>
&lt;/ul>
&lt;h3 id="413-çº¿ç¨‹ä¼˜å…ˆçº§">4.1.3 çº¿ç¨‹ä¼˜å…ˆçº§
&lt;/h3>&lt;p>åœ¨Javaçº¿ç¨‹ä¸­ï¼Œé€šè¿‡ä¸€ä¸ªæ•´å‹æˆå‘˜å˜é‡priorityæ¥æ§åˆ¶ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§çš„èŒƒå›´ä»1ï½10ï¼Œåœ¨çº¿ç¨‹æ„å»ºçš„æ—¶å€™å¯ä»¥é€šè¿‡&lt;code>setPriority(int)&lt;/code>æ–¹æ³•æ¥ä¿®æ”¹ä¼˜å…ˆçº§ï¼Œé»˜è®¤ä¼˜å…ˆçº§æ˜¯5ï¼Œä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹åˆ†é…æ—¶é—´ç‰‡çš„æ•°é‡è¦å¤šäºä¼˜å…ˆçº§ä½çš„çº¿ç¨‹ã€‚&lt;/p>
&lt;p>ç¨‹åºæ­£ç¡®æ€§ä¸èƒ½ä¾èµ–çº¿ç¨‹çš„ä¼˜å…ˆçº§é«˜ä½ï¼Œæœ‰äº›æ“ä½œç³»ç»Ÿä¼šå¿½ç•¥å¯¹çº¿ç¨‹ä¼˜å…ˆçº§çš„è®¾å®šã€‚&lt;/p>
&lt;h3 id="414-çº¿ç¨‹çš„çŠ¶æ€">4.1.4 çº¿ç¨‹çš„çŠ¶æ€
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-28-The-Art-of-Java-Concurrency-Programming/LICENSE.png"
loading="lazy"
alt="LICENSE"
>&lt;/p>
&lt;p>çº¿ç¨‹åœ¨æ‰§è¡ŒRunnableçš„&lt;code>run()&lt;/code>æ–¹æ³•ä¹‹åå°†ä¼šè¿›å…¥ç»ˆæ­¢çŠ¶æ€ã€‚&lt;/p>
&lt;h3 id="415-daemonçº¿ç¨‹">4.1.5 Daemonçº¿ç¨‹
&lt;/h3>&lt;p>Daemonçº¿ç¨‹æ˜¯ä¸€ç§æ”¯æŒå‹çº¿ç¨‹ï¼Œå› ä¸ºå®ƒä¸»è¦è¢«ç”¨åšç¨‹åºä¸­åå°è°ƒåº¦åŠæ”¯æŒæ€§å·¥ä½œï¼Œä¹Ÿå°±æ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚å½“ä¸€ä¸ªJavaè™šæ‹Ÿæœºä¸­ä¸å­˜åœ¨éDaemonçº¿ç¨‹çš„æ—¶å€™ï¼ŒJavaè™šæ‹Ÿæœºå°†ä¼šé€€å‡ºã€‚&lt;/p>
&lt;p>è°ƒç”¨&lt;code>Thread.setDaemon(true)&lt;/code>å°†çº¿ç¨‹è®¾ç½®ä¸ºDaemonçº¿ç¨‹ã€‚&lt;/p>
&lt;p>åœ¨Javaè™šæ‹Ÿæœºé€€å‡ºæ—¶Daemonçº¿ç¨‹ä¸­çš„finallyå—ä¸ä¸€å®šä¼šæ‰§è¡Œã€‚&lt;/p>
&lt;h2 id="42-å¯åŠ¨å’Œç»ˆæ­¢çº¿ç¨‹">4.2 å¯åŠ¨å’Œç»ˆæ­¢çº¿ç¨‹
&lt;/h2>&lt;h3 id="421-æ„é€ çº¿ç¨‹">4.2.1 æ„é€ çº¿ç¨‹
&lt;/h3>&lt;p>æ„é€ ä¸€ä¸ªçº¿ç¨‹ï¼Œä¼šè°ƒç”¨Thread.javaä¸­çš„æ„é€ å™¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">Thread&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">init&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¥ç€è°ƒç”¨initæ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">init&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ThreadGroup&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">g&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stackSize&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">init&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">g&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stackSize&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è°ƒç”¨ä¸‹é¢çš„initæ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">init&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ThreadGroup&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">g&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stackSize&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">AccessControlContext&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acc&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">inheritThreadLocals&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">NullPointerException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;name cannot be null&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å½“å‰çº¿ç¨‹å°±æ˜¯è¯¥çº¿ç¨‹çš„çˆ¶çº¿ç¨‹&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parent&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">currentThread&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">SecurityManager&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getSecurityManager&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">g&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/* Determine if it&amp;#39;s an applet or not */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/* If there is a security manager, ask the security manager
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> what to do. */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">g&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getThreadGroup&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/* If the security doesn&amp;#39;t have a strong opinion of the matter
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> use the parent thread group. */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">g&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">g&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parent&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getThreadGroup&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/* checkAccess regardless of whether or not threadgroup is
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> explicitly passed in. */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">g&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">checkAccess&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * Do we have the required permissions?
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">isCCLOverridden&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">getClass&lt;/span>&lt;span class="p">()))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">checkPermission&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">SUBCLASS_IMPLEMENTATION_PERMISSION&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">g&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">addUnstarted&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">group&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">g&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°† daemonã€priorityå±æ€§è®¾ç½®ä¸ºçˆ¶çº¿ç¨‹çš„å¯¹åº”å±æ€§&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">daemon&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parent&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isDaemon&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">priority&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parent&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getPriority&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">isCCLOverridden&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">parent&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getClass&lt;/span>&lt;span class="p">()))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">contextClassLoader&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parent&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getContextClassLoader&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">contextClassLoader&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parent&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">contextClassLoader&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">inheritedAccessControlContext&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">acc&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acc&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">AccessController&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getContext&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">target&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">setPriority&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">priority&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°†çˆ¶çº¿ç¨‹çš„ inheritThreadLocal å¤åˆ¶è¿‡æ¥&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">inheritThreadLocals&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parent&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">inheritableThreadLocals&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">inheritableThreadLocals&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ThreadLocal&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">createInheritedMap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">parent&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">inheritableThreadLocals&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/* Stash the specified stack size in case the VM cares */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">stackSize&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stackSize&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/* Set thread ID */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nextThreadID&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// åˆ†é…ä¸€ä¸ªçº¿ç¨‹ID&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸€ä¸ªæ–°æ„é€ çš„çº¿ç¨‹å¯¹è±¡æ˜¯ç”±å…¶parentçº¿ç¨‹æ¥è¿›è¡Œç©ºé—´åˆ†é…çš„ï¼Œè€Œchildçº¿ç¨‹ç»§æ‰¿äº†parentæ˜¯å¦ä¸ºDaemonã€ä¼˜å…ˆçº§å’ŒåŠ è½½èµ„æºçš„contextClassLoaderä»¥åŠå¯ç»§æ‰¿çš„ThreadLocalï¼ŒåŒæ—¶è¿˜ä¼šåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„IDæ¥æ ‡è¯†è¿™ä¸ªchildçº¿ç¨‹ã€‚&lt;/p>
&lt;h3 id="422-å¯åŠ¨çº¿ç¨‹">4.2.2 å¯åŠ¨çº¿ç¨‹
&lt;/h3>&lt;p>çº¿ç¨‹strart()æ–¹æ³•çš„å«ä¹‰ï¼šå½“å‰çº¿ç¨‹ï¼ˆå³parentçº¿ç¨‹ï¼‰åŒæ­¥å‘ŠçŸ¥Javaè™šæ‹Ÿæœºï¼Œåªè¦çº¿ç¨‹è§„åˆ’å™¨ç©ºé—²ï¼Œåº”ç«‹å³å¯åŠ¨è°ƒç”¨start()æ–¹æ³•çš„çº¿ç¨‹ã€‚&lt;/p>
&lt;h3 id="423-ç†è§£ä¸­æ–­">4.2.3 ç†è§£ä¸­æ–­
&lt;/h3>&lt;p>ä¸­æ–­å¯ä»¥ç†è§£ä¸ºçº¿ç¨‹çš„ä¸€ä¸ªæ ‡è¯†ä½å±æ€§ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªè¿è¡Œä¸­çš„çº¿ç¨‹æ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹è¿›è¡Œäº†ä¸­æ–­æ“ä½œã€‚&lt;/p>
&lt;p>çº¿ç¨‹é€šè¿‡æ£€æŸ¥è‡ªèº«æ˜¯å¦è¢«ä¸­æ–­æ¥è¿›è¡Œå“åº”ï¼Œçº¿ç¨‹é€šè¿‡æ–¹æ³•&lt;code>isInterrupted()&lt;/code>æ¥è¿›è¡Œåˆ¤æ–­æ˜¯å¦è¢«ä¸­æ–­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">isInterrupted&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">isInterrupted&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">native&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">isInterrupted&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ClearInterrupted&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æˆ–è€…è°ƒç”¨é™æ€æ–¹æ³•&lt;code>Thread.interrupted()&lt;/code>å¯¹å½“å‰çº¿ç¨‹çš„ä¸­æ–­æ ‡è¯†ä½è¿›è¡Œå¤ä½ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">interrupted&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">currentThread&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">isInterrupted&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚æœè¯¥çº¿ç¨‹å·²ç»å¤„äºç»ˆç»“çŠ¶æ€ï¼Œå³ä½¿è¯¥çº¿ç¨‹è¢«ä¸­æ–­è¿‡ï¼Œåœ¨è°ƒç”¨è¯¥çº¿ç¨‹å¯¹è±¡çš„&lt;code>isInterrupted()&lt;/code>æ—¶ä¾æ—§ä¼šè¿”å›falseã€‚&lt;/p>
&lt;p>è®¸å¤šæ–¹æ³•åœ¨æŠ›å‡ºInterruptedExceptionä¹‹å‰ï¼ŒJavaè™šæ‹Ÿæœºä¼šå…ˆå°†è¯¥çº¿ç¨‹çš„ä¸­æ–­æ ‡è¯†ä½æ¸…é™¤ï¼Œç„¶åæŠ›å‡ºInterruptedExceptionï¼Œæ­¤æ—¶è°ƒç”¨isInterrupted()æ–¹æ³•å°†ä¼šè¿”å›falseã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @throws InterruptedException
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * if any thread has interrupted the current thread. The
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * &amp;lt;i&amp;gt;interrupted status&amp;lt;/i&amp;gt; of the current thread is
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * cleared when this exception is thrown.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">native&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">sleep&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">millis&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">InterruptedException&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="424-è¿‡æœŸçš„suspendresumeå’Œstop">4.2.4 è¿‡æœŸçš„suspend()ã€resume()å’Œstop()
&lt;/h3>&lt;p>suspend()ã€resume()å’Œstop()ç±»ä¼¼CDæœºæ’­æ”¾éŸ³ä¹æ—¶çš„æš‚åœã€æ¢å¤å’Œåœæ­¢æ“ä½œã€‚&lt;/p>
&lt;h3 id="425-å®‰å…¨åœ°ç»ˆæ­¢çº¿ç¨‹">4.2.5 å®‰å…¨åœ°ç»ˆæ­¢çº¿ç¨‹
&lt;/h3>&lt;ul>
&lt;li>ä¸­æ–­æ“ä½œ&lt;/li>
&lt;li>åˆ©ç”¨ä¸€ä¸ªbooleanå˜é‡æ¥æ§åˆ¶æ˜¯å¦éœ€è¦åœæ­¢ä»»åŠ¡å¹¶ç»ˆæ­¢è¯¥çº¿ç¨‹ã€‚&lt;/li>
&lt;/ul>
&lt;p>è¿™ä¸¤ç§æ–¹æ³•å¯ä»¥ä½¿çº¿ç¨‹åœ¨ç»ˆæ­¢æ—¶æœ‰æœºä¼šå»æ¸…ç†èµ„æºã€‚&lt;/p>
&lt;h2 id="43-çº¿ç¨‹é—´é€šä¿¡">4.3 çº¿ç¨‹é—´é€šä¿¡
&lt;/h2>&lt;h3 id="431-volatileå’Œsynchronizedå…³é”®å­—">4.3.1 volatileå’Œsynchronizedå…³é”®å­—
&lt;/h3>&lt;ul>
&lt;li>Javaæ”¯æŒå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªå¯¹è±¡æˆ–è€…å¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œç”±äºæ¯ä¸ªçº¿ç¨‹å¯ä»¥æ‹¥æœ‰è¿™ä¸ªå˜é‡çš„æ‹·è´ï¼Œæ‰€ä»¥ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹çœ‹åˆ°çš„å˜é‡ä¸ä¸€å®šæ˜¯æœ€æ–°çš„ã€‚&lt;/li>
&lt;li>å…³é”®å­—volatileå¯ä»¥ç”¨æ¥ä¿®é¥°å­—æ®µï¼ˆæˆå‘˜å˜é‡ï¼‰ã€‚&lt;/li>
&lt;li>å…³é”®å­—synchronizedå¯ä»¥ä¿®é¥°æ–¹æ³•æˆ–è€…ä»¥åŒæ­¥å—çš„å½¢å¼æ¥è¿›è¡Œä½¿ç”¨ã€‚&lt;/li>
&lt;li>é€šè¿‡classä¿¡æ¯ï¼Œå¯¹äºåŒæ­¥å—çš„å®ç°ä½¿ç”¨äº†monitorenterå’ŒmonitorexitæŒ‡ä»¤ï¼Œè€ŒåŒæ­¥æ–¹æ³•åˆ™æ˜¯ä¾é æ–¹æ³•ä¿®é¥°ç¬¦ä¸Šçš„ACC_SYNCHRONIZEDæ¥å®Œæˆã€‚&lt;/li>
&lt;li>æ— è®ºé‡‡ç”¨å“ªç§æ–¹å¼ï¼Œå…¶æœ¬è´¨æ˜¯å¯¹ä¸€ä¸ªå¯¹è±¡çš„ç›‘è§†å™¨è¿›è¡Œè·å–ï¼Œè€Œè¿™ä¸ªè·å–è¿‡ç¨‹æ˜¯æ’ä»–çš„ï¼Œä¹Ÿå°±æ˜¯åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°ç”±synchronizedæ‰€ä¿æŠ¤å¯¹è±¡çš„ç›‘è§†å™¨ã€‚&lt;/li>
&lt;li>ä»»æ„ä¸€ä¸ªå¯¹è±¡éƒ½æ‹¥æœ‰è‡ªå·±çš„ç›‘è§†å™¨ã€‚&lt;/li>
&lt;li>å¯¹è±¡ã€ç›‘è§†å™¨ã€åŒæ­¥é˜Ÿåˆ—å’Œæ‰§è¡Œçº¿ç¨‹ä¹‹é—´çš„å…³ç³»å›¾&lt;/li>
&lt;/ul>
&lt;h3 id="432-ç­‰å¾…é€šçŸ¥æœºåˆ¶">4.3.2 ç­‰å¾…/é€šçŸ¥æœºåˆ¶
&lt;/h3>&lt;ul>
&lt;li>ç­‰å¾…/é€šçŸ¥çš„ç›¸å…³æ–¹æ³•æ˜¯ä»»æ„Javaå¯¹è±¡éƒ½å…·å¤‡çš„ï¼Œè¢«å®šä¹‰åœ¨è¶…ç±»java.lang.Objectä¸Šã€‚&lt;/li>
&lt;li>ç­‰å¾…/é€šçŸ¥æœºåˆ¶ï¼Œæ˜¯æŒ‡ä¸€ä¸ªçº¿ç¨‹Aè°ƒç”¨äº†å¯¹è±¡Oçš„wait()æ–¹æ³•è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹Bè°ƒç”¨äº†å¯¹è±¡Oçš„notify()æˆ–è€…notifyAll()æ–¹æ³•ï¼Œçº¿ç¨‹Aæ”¶åˆ°é€šçŸ¥åä»å¯¹è±¡Oçš„wait()æ–¹æ³•è¿”å›ï¼Œè¿›è€Œæ‰§è¡Œåç»­æ“ä½œã€‚&lt;/li>
&lt;/ul>
&lt;p>ç»†èŠ‚ï¼š&lt;/p>
&lt;ol>
&lt;li>ä½¿ç”¨wait()ã€notify()å’ŒnotifyAll()æ—¶éœ€è¦å…ˆå¯¹è°ƒç”¨å¯¹è±¡åŠ é”ã€‚&lt;/li>
&lt;li>è°ƒç”¨wait()æ–¹æ³•åï¼Œçº¿ç¨‹çŠ¶æ€ç”±RUNNINGå˜ä¸ºWAITINGï¼Œå¹¶å°†å½“å‰çº¿ç¨‹æ”¾ç½®åˆ°å¯¹è±¡çš„ç­‰å¾…é˜Ÿåˆ—ã€‚&lt;/li>
&lt;li>notify()æˆ–notifyAll()æ–¹æ³•è°ƒç”¨åï¼Œç­‰å¾…çº¿ç¨‹ä¾æ—§ä¸ä¼šä»wait()è¿”å›ï¼Œéœ€è¦è°ƒç”¨notify()æˆ–notifyAll()çš„çº¿ç¨‹é‡Šæ”¾é”ä¹‹åï¼Œç­‰å¾…çº¿ç¨‹æ‰æœ‰æœºä¼šä»wait()è¿”å›ã€‚&lt;/li>
&lt;li>notify()æ–¹æ³•å°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ä»ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œè€ŒnotifyAll()æ–¹æ³•åˆ™æ˜¯å°†ç­‰å¾…é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„çº¿ç¨‹å…¨éƒ¨ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ï¼Œè¢«ç§»åŠ¨çš„çº¿ç¨‹çŠ¶æ€ç”±WAITINGå˜ä¸ºBLOCKEDã€‚&lt;/li>
&lt;li>ä»wait()æ–¹æ³•è¿”å›çš„å‰ææ˜¯è·å¾—äº†è°ƒç”¨å¯¹è±¡çš„é”ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="433-ç­‰å¾…é€šçŸ¥çš„ç»å…¸èŒƒå¼">4.3.3 ç­‰å¾…/é€šçŸ¥çš„ç»å…¸èŒƒå¼
&lt;/h3>&lt;p>ç­‰å¾…æ–¹éµå¾ªå¦‚ä¸‹åŸåˆ™ï¼š&lt;/p>
&lt;ol>
&lt;li>è·å–å¯¹è±¡çš„é”ã€‚&lt;/li>
&lt;li>å¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼Œé‚£ä¹ˆè°ƒç”¨å¯¹è±¡çš„wait()æ–¹æ³•ï¼Œè¢«é€šçŸ¥åä»è¦æ£€æŸ¥æ¡ä»¶ã€‚&lt;/li>
&lt;li>æ¡ä»¶æ»¡è¶³åˆ™æ‰§è¡Œå¯¹åº”çš„é€»è¾‘ã€‚&lt;/li>
&lt;/ol>
&lt;p>é€šçŸ¥æ–¹éµå¾ªå¦‚ä¸‹åŸåˆ™ï¼š&lt;/p>
&lt;ol>
&lt;li>è·å¾—å¯¹è±¡çš„é”ã€‚&lt;/li>
&lt;li>æ”¹å˜æ¡ä»¶ã€‚&lt;/li>
&lt;li>é€šçŸ¥æ‰€æœ‰ç­‰å¾…åœ¨å¯¹è±¡ä¸Šçš„çº¿ç¨‹ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="434-ç®¡é“è¾“å…¥è¾“å‡ºæµ">4.3.4 ç®¡é“è¾“å…¥/è¾“å‡ºæµ
&lt;/h3>&lt;ul>
&lt;li>ç®¡é“è¾“å…¥/è¾“å‡ºæµä¸»è¦ç”¨äºçº¿ç¨‹ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œè€Œä¼ è¾“çš„åª’ä»‹ä¸ºå†…å­˜ã€‚&lt;/li>
&lt;li>4ç§å…·ä½“å®ç°ï¼šPipedOutputStreamã€PipedOutputStreamã€PipedReaderå’ŒPipedWriterï¼Œå‰ä¸¤ç§é¢å‘å­—èŠ‚ï¼Œåä¸¤ç§é¢å‘å­—ç¬¦ã€‚&lt;/li>
&lt;li>å¯¹äºPipedç±»å‹çš„æµï¼Œå¿…é¡»å…ˆè¦è¿›è¡Œç»‘å®šï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨connect()æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰å°†è¾“å…¥/è¾“å‡ºæµç»‘å®šèµ·æ¥ï¼Œå¯¹äºè¯¥æµçš„è®¿é—®å°†ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="435-threadjoinçš„ä½¿ç”¨">4.3.5 Thread.join()çš„ä½¿ç”¨
&lt;/h3>&lt;ul>
&lt;li>å¦‚æœä¸€ä¸ªçº¿ç¨‹Aæ‰§è¡Œäº†thread.join()è¯­å¥ï¼Œå…¶å«ä¹‰æ˜¯ï¼šå½“çº¿ç¨‹Aç­‰å¾…threadçº¿ç¨‹ç»ˆæ­¢ä¹‹åæ‰ä»thread.join()è¿”å›ã€‚&lt;/li>
&lt;li>æ¯ä¸ªçº¿ç¨‹ç»ˆæ­¢çš„å‰ææ˜¯å‰é©±çº¿ç¨‹ç»ˆæ­¢ï¼Œæ¯ä¸ªçº¿ç¨‹ç­‰å¾…å‰é©±çº¿ç¨‹ç»ˆæ­¢åï¼Œæ‰ä»join()æ–¹æ³•è¿”å›ï¼Œè¿™é‡Œæ¶‰åŠäº†ç­‰å¾…/é€šçŸ¥æœºåˆ¶ã€‚&lt;/li>
&lt;li>å½“çº¿ç¨‹ç»ˆæ­¢æ—¶ï¼Œä¼šè°ƒç”¨çº¿ç¨‹è‡ªèº«çš„notifyAll()æ–¹æ³•ï¼Œä¼šé€šçŸ¥æ‰€æœ‰ç­‰å¾…åœ¨è¯¥çº¿ç¨‹å¯¹è±¡ä¸Šçš„çº¿ç¨‹ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="436-threadlocalçš„ä½¿ç”¨">4.3.6 ThreadLocalçš„ä½¿ç”¨
&lt;/h3>&lt;ul>
&lt;li>ThreadLocalï¼Œå³çº¿ç¨‹å˜é‡ï¼Œæ˜¯ä¸€ä¸ªä»¥ThreadLocalå¯¹è±¡ä¸ºé”®ã€ä»»æ„å¯¹è±¡ä¸ºå€¼çš„å­˜å‚¨ç»“æ„ï¼Œè¿™ä¸ªç»“æ„è¢«é™„å¸¦åœ¨çº¿ç¨‹ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ ¹æ®ä¸€ä¸ªThreadLocalå¯¹è±¡æŸ¥è¯¢åˆ°ç»‘å®šåœ¨è¿™ä¸ªçº¿ç¨‹ä¸Šçš„ä¸€ä¸ªå€¼ã€‚&lt;/li>
&lt;li>å¯ä»¥é€šè¿‡set(T)æ–¹æ³•æ¥è®¾ç½®ä¸€ä¸ªå€¼ï¼Œåœ¨å½“å‰çº¿ç¨‹ä¸‹å†é€šè¿‡get()æ–¹æ³•è·å–åˆ°åŸå…ˆè®¾ç½®çš„å€¼ã€‚&lt;/li>
&lt;/ul></description></item><item><title>Ubuntuä¸‹åˆ›å»ºå¿«æ·æ–¹å¼</title><link>https://wenjin1997.github.io/2022/03/23/Ubuntu/</link><pubDate>Wed, 23 Mar 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/03/23/Ubuntu/</guid><description>&lt;h1 id="åˆ›å»ºmatlabå¿«æ·æ–¹å¼">åˆ›å»ºMatlabå¿«æ·æ–¹å¼
&lt;/h1>&lt;ol>
&lt;li>åœ¨å‘½ä»¤çª—å£æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå‚è€ƒ&lt;a class="link" href="https://blog.csdn.net/flyfrommath/article/details/53148455" target="_blank" rel="noopener"
>Linuxä¸‹å®‰è£…matlabåŠåˆ›å»ºå¿«æ·æ–¹å¼&lt;/a>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo gedit /usr/share/applications/matlab.desktop
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>åœ¨æ–‡ä»¶ä¸­è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Desktop Entry&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Encoding&lt;/span>&lt;span class="o">=&lt;/span>UTF-8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Name&lt;/span>&lt;span class="o">=&lt;/span>matlab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Comment&lt;/span>&lt;span class="o">=&lt;/span>MATLAB R2014b
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Exec&lt;/span>&lt;span class="o">=&lt;/span>/usr/local/MATLAB/R2014b/bin/matlab -desktop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Icon&lt;/span>&lt;span class="o">=&lt;/span>/usr/local/MATLAB/R2014b/bin/matlab_logo.png
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Terminal&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">StartupNotify&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Type&lt;/span>&lt;span class="o">=&lt;/span>Application
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Categories&lt;/span>&lt;span class="o">=&lt;/span>Application&lt;span class="p">;&lt;/span>Development&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸»è¦æ˜¯Execå’ŒIconè·¯å¾„å†™å¯¹ã€‚
3. ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æ‰“å¼€åº”ç”¨åˆ—è¡¨ç›®å½•ï¼Œå‚è€ƒ&lt;a class="link" href="https://www.jb51.net/os/Ubuntu/626896.html" target="_blank" rel="noopener"
>ubuntuåˆ é™¤å›¾æ ‡&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo nautilus /usr/share/applications
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="åˆ›å»ºanacondaå¿«æ·æ–¹å¼">åˆ›å»ºAnacondaå¿«æ·æ–¹å¼
&lt;/h1>&lt;p>ä¸ä¸Šè¿°è¿‡ç¨‹ç±»ä¼¼ï¼ŒAnaconda.desktopæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo gedit /usr/share/applications/Anaconda.desktop
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Desktop Entry&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Version&lt;/span>&lt;span class="o">=&lt;/span>1.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Name&lt;/span>&lt;span class="o">=&lt;/span>Anaconda
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Type&lt;/span>&lt;span class="o">=&lt;/span>Application
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">GenericName&lt;/span>&lt;span class="o">=&lt;/span>Anaconda
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Comment&lt;/span>&lt;span class="o">=&lt;/span>Scientific Python Development Environment - Python3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Exec&lt;/span>&lt;span class="o">=&lt;/span>sh /home/ä½ çš„anaconda3æ‰€åœ¨æ–‡ä»¶å¤¹å/anaconda3/bin/anaconda-navigator
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Categories&lt;/span>&lt;span class="o">=&lt;/span>Development&lt;span class="p">;&lt;/span>Science&lt;span class="p">;&lt;/span>IDE&lt;span class="p">;&lt;/span>Qt&lt;span class="p">;&lt;/span>Education&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Icon&lt;/span>&lt;span class="o">=&lt;/span>/home/ä½ çš„anaconda3æ‰€åœ¨æ–‡ä»¶å¤¹å/anaconda3/lib/python3.7/site-packages/anaconda_navigator/static/images/anaconda-icon-256x256.png
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Terminal&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">StartupNotify&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">MimeType&lt;/span>&lt;span class="o">=&lt;/span>text/x-python&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>è®¡ç®—æœºç½‘ç»œçŸ¥è¯†æ€»ç»“</title><link>https://wenjin1997.github.io/2022/03/23/internet/</link><pubDate>Wed, 23 Mar 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/03/23/internet/</guid><description>&lt;h1 id="è¯¾ç¨‹ä»‹ç»">è¯¾ç¨‹ä»‹ç»
&lt;/h1>&lt;p>å­¦ä¹ è®¡ç®—æœºç½‘ç»œæ—¶æ‰¾åˆ°äº†è¿™å¥—è¯¾ç¨‹ï¼Œä½œä¸ºå…¥é—¨è¿˜æ˜¯ä¸é”™çš„ï¼Œè€å¸ˆçš„PPTéƒ½å¾ˆé€šä¿—æ˜“æ‡‚ã€‚å¯ä»¥åœ¨MOOC&lt;a class="link" href="https://www.icourse163.org/course/HNKJ-1461816178?tid=1465255482" target="_blank" rel="noopener"
>è®¡ç®—æœºç½‘ç»œ&lt;/a>ä¸Šä¸‹è½½è¯¾ç¨‹PPTï¼ŒBç«™ä¸Š&lt;a class="link" href="https://www.bilibili.com/video/BV1c4411d7jb/?spm_id_from=333.999.0.0&amp;amp;vd_source=d6d5daa7e5c1f2e2ffc186195640b61d" target="_blank" rel="noopener"
>è®¡ç®—æœºç½‘ç»œå¾®è¯¾å ‚ï¼ˆæœ‰å­—å¹•æ— èƒŒæ™¯éŸ³ä¹ç‰ˆï¼‰&lt;/a>ä¹Ÿæœ‰è¯¾ç¨‹è§†é¢‘ã€‚&lt;/p>
&lt;h1 id="ç¬¬1ç« -æ¦‚è¿°">ç¬¬1ç«  æ¦‚è¿°
&lt;/h1>&lt;h2 id="11-è®¡ç®—æœºç½‘ç»œåœ¨ä¿¡æ¯æ—¶ä»£çš„ä½œç”¨">1.1 è®¡ç®—æœºç½‘ç»œåœ¨ä¿¡æ¯æ—¶ä»£çš„ä½œç”¨
&lt;/h2>&lt;p>ç•¥ã€‚&lt;/p>
&lt;h2 id="12-å› ç‰¹ç½‘æ¦‚è¿°">1.2 å› ç‰¹ç½‘æ¦‚è¿°
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>ç½‘ç»œæ˜¯ç”±è‹¥å¹²ç»“ç‚¹å’Œè¿æ¥è¿™äº›ç»“ç‚¹çš„é“¾è·¯ç»„æˆã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¤šä¸ªç½‘ç»œå¯ä»¥é€šè¿‡è·¯ç”±å™¨äº’è¿èµ·æ¥ï¼Œè¿™æ ·å°±æ„æˆäº†ä¸€ä¸ªè¦†ç›–èŒƒå›´æ›´å¤§çš„ç½‘ç»œï¼Œå³äº’è”ç½‘ã€‚å› æ­¤ï¼Œäº’è”ç½‘å°±æ˜¯â€œç½‘ç»œçš„ç½‘ç»œâ€ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å› ç‰¹ç½‘æ˜¯ä¸–ç•Œä¸Šæœ€å¤§çš„äº’è¿ç½‘ç»œã€‚å®ƒæ˜¯ä¸€ä¸ªä¸“ç”¨åè¯ï¼Œé‡‡ç”¨TCP/IPåè®®æ—ä½œä¸ºé€šä¿¡çš„è§„åˆ™ï¼Œå…¶å‰èº«æ˜¯ç¾å›½çš„ARPANETã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>ISP(Internet Service Provider)ï¼šå› ç‰¹ç½‘æœåŠ¡æä¾›è€…ã€‚ä¾‹å¦‚å›½å†…çš„ä¸­å›½ç”µä¿¡ã€ä¸­å›½è”é€šå’Œä¸­å›½ç§»åŠ¨ã€‚&lt;/p>
&lt;p>å› ç‰¹ç½‘çš„ç»„æˆï¼šè¾¹ç¼˜éƒ¨åˆ†+æ ¸å¿ƒéƒ¨åˆ†&lt;/p>
&lt;h2 id="13-ç”µè·¯äº¤æ¢åˆ†ç»„äº¤æ¢æŠ¥æ–‡äº¤æ¢">1.3 ç”µè·¯äº¤æ¢ã€åˆ†ç»„äº¤æ¢ã€æŠ¥æ–‡äº¤æ¢
&lt;/h2>&lt;p>åˆ†ç»„äº¤æ¢ï¼š&lt;/p>
&lt;ul>
&lt;li>å‘é€æ–¹ï¼šæ„é€ åˆ†ç»„ã€å‘é€åˆ†ç»„&lt;/li>
&lt;li>è·¯ç”±å™¨ï¼šå­˜å‚¨è½¬å‘åˆ†ç»„&lt;/li>
&lt;li>æ¥æ”¶æ–¹ï¼šæ¥æ”¶åˆ†ç»„ã€è¿˜åŸæŠ¥æ–‡&lt;/li>
&lt;/ul>
&lt;p>åˆ†ç»„äº¤æ¢çš„ä¼˜ç¼ºç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¼˜ç‚¹
&lt;ul>
&lt;li>æ— éœ€å»ºç«‹è¿æ¥&lt;/li>
&lt;li>çº¿è·¯åˆ©ç”¨ç‡é«˜&lt;/li>
&lt;li>ç®€åŒ–äº†å­˜å‚¨ç®¡ç†&lt;/li>
&lt;li>åŠ é€Ÿä¼ è¾“&lt;/li>
&lt;li>å‡å°‘å‡ºé”™æ¦‚ç‡å’Œé‡å‘æ•°æ®é‡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ç¼ºç‚¹
&lt;ul>
&lt;li>å¼•å‘äº†è½¬å‘æ—¶å»¶&lt;/li>
&lt;li>éœ€è¦é¢å¤–çš„ä¿¡æ¯é‡&lt;/li>
&lt;li>å¯¹äºæ•°æ®æŠ¥æœåŠ¡ï¼Œå­˜åœ¨å¤±åºã€ä¸¢å¤±å’Œé‡å¤åˆ†ç»„çš„é—®é¢˜ï¼›å¯¹äºè™šç”µè·¯æœåŠ¡ï¼Œå­˜åœ¨å‘¼å«å»ºç«‹ã€æ•°æ®ä¼ è¾“å’Œè™šç”µè·¯é‡Šæ”¾ä¸‰ä¸ªè¿‡ç¨‹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="14-è®¡ç®—æœºç½‘ç»œçš„å®šä¹‰ä¸åˆ†ç±»">1.4 è®¡ç®—æœºç½‘ç»œçš„å®šä¹‰ä¸åˆ†ç±»
&lt;/h2>&lt;p>è®¡ç®—æœºç½‘ç»œï¼šä¸€äº›äº’ç›¸è¿æ¥çš„ã€è‡ªæ²»çš„è®¡ç®—æœºçš„é›†åˆã€‚&lt;/p>
&lt;h2 id="15-è®¡ç®—æœºç½‘ç»œçš„æ€§èƒ½æŒ‡æ ‡">1.5 è®¡ç®—æœºç½‘ç»œçš„æ€§èƒ½æŒ‡æ ‡
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220306165419446.png"
loading="lazy"
alt="image1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220306165610117.png"
loading="lazy"
alt="image2"
>&lt;/p>
&lt;h2 id="16-è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„">ğŸš©1.6 è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220306165831945.png"
loading="lazy"
alt="image-20220306165831945"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220306165900996.png"
loading="lazy"
alt="image-20220306165900996"
>&lt;/p>
&lt;p>&lt;strong>åº”ç”¨å±‚&lt;/strong> :è§£å†³é€šè¿‡åº”ç”¨è¿›ç¨‹çš„äº¤äº’æ¥å®ç°ç‰¹å®šç½‘ç»œåº”ç”¨çš„é—®é¢˜ã€‚ä¸ºç‰¹å®šåº”ç”¨ç¨‹åºæä¾›æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œä¾‹å¦‚ HTTPã€DNS ç­‰åè®®ã€‚æ•°æ®å•ä½ä¸ºæŠ¥æ–‡ã€‚&lt;/p>
&lt;p>&lt;strong>è¡¨ç¤ºå±‚&lt;/strong> :æ•°æ®å¤„ç†ï¼ˆç¼–è§£ç ã€åŠ å¯†è§£å¯†ã€å‹ç¼©è§£å‹ç¼©ï¼‰ã€‚&lt;/p>
&lt;p>&lt;strong>ä¼šè¯å±‚&lt;/strong> :ç®¡ç†ï¼ˆå»ºç«‹ã€ç»´æŠ¤ã€é‡è¿ï¼‰åº”ç”¨ç¨‹åºä¹‹é—´çš„å¯¹è¯ã€‚&lt;/p>
&lt;p>&lt;strong>ä¼ è¾“å±‚&lt;/strong> :è§£å†³è¿›ç¨‹ä¹‹é—´åŸºäºç½‘ç»œçš„é€šä¿¡é—®é¢˜ã€‚ä¸ºè¿›ç¨‹æä¾›é€šç”¨æ•°æ®ä¼ è¾“æœåŠ¡ã€‚ç”±äºåº”ç”¨å±‚åè®®å¾ˆå¤šï¼Œå®šä¹‰é€šç”¨çš„ä¼ è¾“å±‚åè®®å°±å¯ä»¥æ”¯æŒä¸æ–­å¢å¤šçš„åº”ç”¨å±‚åè®®ã€‚è¿è¾“å±‚åŒ…æ‹¬ä¸¤ç§åè®®:ä¼ è¾“æ§åˆ¶åè®® TCPï¼Œæä¾›é¢å‘è¿æ¥ã€å¯é çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œæ•°æ®å•ä½ä¸ºæŠ¥æ–‡æ®µ;ç”¨æˆ·æ•°æ®æŠ¥åè®® UDPï¼Œæä¾› æ— è¿æ¥ã€å°½æœ€å¤§åŠªåŠ›çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œæ•°æ®å•ä½ä¸ºç”¨æˆ·æ•°æ®æŠ¥ã€‚TCP ä¸»è¦æä¾›å®Œæ•´æ€§æœåŠ¡ï¼ŒUDP ä¸»è¦æä¾›åŠæ—¶æ€§æœåŠ¡ã€‚&lt;/p>
&lt;p>&lt;strong>ç½‘ç»œå±‚&lt;/strong> :è§£å†³åˆ†ç»„åœ¨å¤šä¸ªç½‘ç»œä¸Šä¼ è¾“ï¼ˆè·¯ç”±ï¼‰çš„é—®é¢˜ã€‚ä¸ºä¸»æœºæä¾›æ•°æ®ä¼ è¾“æœåŠ¡ã€‚è€Œä¼ è¾“å±‚åè®®æ˜¯ä¸ºä¸»æœºä¸­çš„è¿›ç¨‹æä¾›æ•°æ®ä¼ è¾“æœåŠ¡ã€‚ç½‘ç»œå±‚æŠŠä¼ è¾“å±‚ä¼ é€’ä¸‹æ¥çš„æŠ¥æ–‡æ®µæˆ–è€…ç”¨æˆ·æ•°æ®æŠ¥å°è£…æˆåˆ†ç»„ã€‚&lt;/p>
&lt;p>&lt;strong>æ•°æ®é“¾è·¯å±‚&lt;/strong> :è§£å†³åˆ†ç»„åœ¨ä¸€ä¸ªç½‘ç»œï¼ˆæˆ–ä¸€æ®µé“¾è·¯ï¼‰ä¸Šä¼ è¾“çš„é—®é¢˜ã€‚ç½‘ç»œå±‚é’ˆå¯¹çš„è¿˜æ˜¯ä¸»æœºä¹‹é—´çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œè€Œä¸»æœºä¹‹é—´å¯ä»¥æœ‰å¾ˆå¤šé“¾è·¯ï¼Œé“¾è·¯å±‚åè®®å°±æ˜¯ä¸ºåŒä¸€é“¾è·¯çš„ä¸»æœºæä¾›æ•°æ®ä¼ è¾“æœåŠ¡ã€‚æ•°æ®é“¾è·¯å±‚æŠŠç½‘ç»œå±‚ä¼ ä¸‹æ¥çš„åˆ†ç»„å°è£…æˆå¸§ã€‚&lt;/p>
&lt;p>&lt;strong>ç‰©ç†å±‚&lt;/strong> :è§£å†³ä½¿ç”¨ä½•ç§ä¿¡å·æ¥ä¼ è¾“æ¯”ç‰¹çš„é—®é¢˜ã€‚è€ƒè™‘çš„æ˜¯æ€æ ·åœ¨ä¼ è¾“åª’ä½“ä¸Šä¼ è¾“æ•°æ®æ¯”ç‰¹æµï¼Œè€Œä¸æ˜¯æŒ‡å…·ä½“çš„ä¼ è¾“åª’ä½“ã€‚ç‰©ç†å±‚çš„ä½œç”¨æ˜¯å°½å¯èƒ½å±è”½ä¼ è¾“åª’ä½“å’Œé€šä¿¡æ‰‹æ®µçš„å·®å¼‚ï¼Œä½¿æ•°æ®é“¾è·¯å±‚æ„Ÿè§‰ä¸åˆ°è¿™äº›å·®å¼‚ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220306171201560.png"
loading="lazy"
alt="image-20220306171201560"
>&lt;/p>
&lt;h1 id="ç¬¬2ç« -ç‰©ç†å±‚">ç¬¬2ç«  ç‰©ç†å±‚
&lt;/h1>&lt;h2 id="21-ç‰©ç†å±‚çš„åŸºæœ¬æ¦‚å¿µ">2.1 ç‰©ç†å±‚çš„åŸºæœ¬æ¦‚å¿µ
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/%e5%9b%be%e7%89%87%201.png"
loading="lazy"
alt="image-1"
>&lt;/p>
&lt;h2 id="22-ç‰©ç†å±‚ä¸‹é¢çš„ä¼ è¾“åª’ä½“">2.2 ç‰©ç†å±‚ä¸‹é¢çš„ä¼ è¾“åª’ä½“
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/%e5%9b%be%e7%89%87%202.png"
loading="lazy"
alt="image-2"
>&lt;/p>
&lt;h2 id="23-ä¼ è¾“æ–¹å¼">2.3 ä¼ è¾“æ–¹å¼
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/%e4%bc%a0%e8%be%93%e6%96%b9%e5%bc%8f.png"
loading="lazy"
alt="ä¼ è¾“æ–¹å¼"
>&lt;/p>
&lt;h2 id="24-ç¼–ç ä¸è°ƒåˆ¶">2.4 ç¼–ç ä¸è°ƒåˆ¶
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/2.4-1.png"
loading="lazy"
alt="2.4-1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/2.4-2.png"
loading="lazy"
alt="2.4-2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/2.4-3.png"
loading="lazy"
alt="2.4-3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/2.4-4.png"
loading="lazy"
alt="2.4-4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/2.4-5.png"
loading="lazy"
alt="2.4-5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/2.4-6.png"
loading="lazy"
alt="2.4-6"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/2.4-7.png"
loading="lazy"
alt="2.4-7"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/2.4-8.png"
loading="lazy"
alt="2.4-8"
>&lt;/p>
&lt;h2 id="25-ä¿¡é“çš„æé™å®¹é‡">2.5 ä¿¡é“çš„æé™å®¹é‡
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/2.5-1.png"
loading="lazy"
alt="2.5-1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/2.5-2.png"
loading="lazy"
alt="2.5-2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/2.5-3.png"
loading="lazy"
alt="2.5-3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/2.5-4.png"
loading="lazy"
alt="2.5-4"
>&lt;/p>
&lt;h1 id="ç¬¬3ç« -æ•°æ®é“¾è·¯å±‚">ç¬¬3ç«  æ•°æ®é“¾è·¯å±‚
&lt;/h1>&lt;h2 id="31-æ•°æ®é“¾è·¯å±‚æ¦‚è¿°">3.1 æ•°æ®é“¾è·¯å±‚æ¦‚è¿°
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.1-1.png"
loading="lazy"
alt="2.4-1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.1-2.png"
loading="lazy"
alt="2.4-2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.1-3.png"
loading="lazy"
alt="2.4-3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.1-4.png"
loading="lazy"
alt="2.4-4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.1-5.png"
loading="lazy"
alt="2.4-5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.1-6.png"
loading="lazy"
alt="2.4-6"
>&lt;/p>
&lt;h2 id="32-å°è£…æˆå¸§">3.2 å°è£…æˆå¸§
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.2-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.2-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.2-3.png"
loading="lazy"
alt="3"
>&lt;/p>
&lt;h2 id="33-å·®é”™æ£€æµ‹">3.3 å·®é”™æ£€æµ‹
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.3-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.3-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.3-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.3-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.3-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.3-6.png"
loading="lazy"
alt="6"
>&lt;/p>
&lt;h2 id="34-å¯é ä¼ è¾“">3.4 å¯é ä¼ è¾“
&lt;/h2>&lt;h3 id="341-å¯é ä¼ è¾“çš„åŸºæœ¬æ¦‚å¿µ">3.4.1 å¯é ä¼ è¾“çš„åŸºæœ¬æ¦‚å¿µ
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.4.1-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.4.1-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.4.1-3.png"
loading="lazy"
alt="3"
>&lt;/p>
&lt;h3 id="342-åœæ­¢-ç­‰å¾…åè®®sw">3.4.2 åœæ­¢-ç­‰å¾…åè®®SW
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.4.2-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.4.2-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.4.2-3.png"
loading="lazy"
alt="3"
>&lt;/p>
&lt;h3 id="343-å›é€€nå¸§åè®®gbn">3.4.3 å›é€€Nå¸§åè®®GBN
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.4.3-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.4.3-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.4.3-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.4.3-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.4.3-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.4.3-6.png"
loading="lazy"
alt="6"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.4.3-7.png"
loading="lazy"
alt="7"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.4.3-8.png"
loading="lazy"
alt="8"
>&lt;/p>
&lt;h3 id="344-é€‰æ‹©é‡ä¼ åè®®sr">3.4.4 é€‰æ‹©é‡ä¼ åè®®SR
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.4.4-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.4.4-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.4.4-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.4.4-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.4.4-5.png"
loading="lazy"
alt="5"
>&lt;/p>
&lt;h2 id="35-ç‚¹å¯¹ç‚¹åè®®ppp">3.5 ç‚¹å¯¹ç‚¹åè®®PPP
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.5-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.5-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.5-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.5-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.5-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.5-6.png"
loading="lazy"
alt="6"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.5-7.png"
loading="lazy"
alt="7"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.5-8.png"
loading="lazy"
alt="8"
>&lt;/p>
&lt;h2 id="36-åª’ä½“æ¥å…¥æ§åˆ¶mac">3.6 åª’ä½“æ¥å…¥æ§åˆ¶MAC
&lt;/h2>&lt;h3 id="361åŸºæœ¬æ¦‚å¿µ">3.6.1åŸºæœ¬æ¦‚å¿µ
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.1-1.png"
loading="lazy"
alt="1"
>&lt;/p>
&lt;h3 id="362é™æ€åˆ’åˆ†ä¿¡é“">3.6.2é™æ€åˆ’åˆ†ä¿¡é“
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.2-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.2-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.2-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.2-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.2-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.2-6.png"
loading="lazy"
alt="6"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.2-7.png"
loading="lazy"
alt="7"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.2-8.png"
loading="lazy"
alt="8"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.2-9.png"
loading="lazy"
alt="9"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.2-10.png"
loading="lazy"
alt="10"
>&lt;/p>
&lt;h3 id="363-csmacd">3.6.3 CSMA/CD
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.3-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.3-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.3-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.3-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.3-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.3-6.png"
loading="lazy"
alt="6"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.3-7.png"
loading="lazy"
alt="7"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.3-8.png"
loading="lazy"
alt="8"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.3-9.png"
loading="lazy"
alt="9"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.3-10.png"
loading="lazy"
alt="10"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.3-11.png"
loading="lazy"
alt="11"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.3-12.png"
loading="lazy"
alt="12"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.3-13.png"
loading="lazy"
alt="13"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.3-14.png"
loading="lazy"
alt="14"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.3-15.png"
loading="lazy"
alt="15"
>&lt;/p>
&lt;h3 id="364-csmaca">3.6.4 CSMA/CA
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.4-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.4-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.4-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.4-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.4-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.4-6.png"
loading="lazy"
alt="6"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.4-7.png"
loading="lazy"
alt="7"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.4-8.png"
loading="lazy"
alt="8"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.4-9.png"
loading="lazy"
alt="9"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.4-10.png"
loading="lazy"
alt="10"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.4-11.png"
loading="lazy"
alt="11"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.4-12.png"
loading="lazy"
alt="12"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.4-13.png"
loading="lazy"
alt="13"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.4-14.png"
loading="lazy"
alt="14"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.4-15.png"
loading="lazy"
alt="15"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.4-16.png"
loading="lazy"
alt="16"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.6.4-17.png"
loading="lazy"
alt="17"
>&lt;/p>
&lt;h2 id="37-macåœ°å€ipåœ°å€ä»¥åŠarpåè®®">3.7 MACåœ°å€ã€IPåœ°å€ä»¥åŠARPåè®®
&lt;/h2>&lt;h3 id="371-macåœ°å€">3.7.1 MACåœ°å€
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.1-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.1-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.1-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.1-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.1-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.1-6.png"
loading="lazy"
alt="6"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.1-7.png"
loading="lazy"
alt="7"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.1-8.png"
loading="lazy"
alt="8"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.1-9.png"
loading="lazy"
alt="9"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.1-10.png"
loading="lazy"
alt="10"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.1-11.png"
loading="lazy"
alt="11"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.1-12.png"
loading="lazy"
alt="12"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.1-13.png"
loading="lazy"
alt="13"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.1-14.png"
loading="lazy"
alt="14"
>&lt;/p>
&lt;h3 id="372-ipåœ°å€">3.7.2 IPåœ°å€
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.2-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.2-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.2-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.2-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.2-5.png"
loading="lazy"
alt="5"
>&lt;/p>
&lt;h3 id="373-arpåè®®">3.7.3 ARPåè®®
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.3-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.3-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.3-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.3-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.3-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.3-6.png"
loading="lazy"
alt="6"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.7.3-7.png"
loading="lazy"
alt="7"
>&lt;/p>
&lt;h2 id="38-é›†çº¿å™¨ä¸äº¤æ¢æœºçš„åŒºåˆ«">3.8 é›†çº¿å™¨ä¸äº¤æ¢æœºçš„åŒºåˆ«
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.8-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.8-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.8-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.8-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.8-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.8-6.png"
loading="lazy"
alt="6"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.8-7.png"
loading="lazy"
alt="7"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.8-8.png"
loading="lazy"
alt="8"
>&lt;/p>
&lt;h2 id="39-ä»¥å¤ªç½‘äº¤æ¢æœºè‡ªå­¦ä¹ å’Œè½¬å‘å¸§çš„æµç¨‹">3.9 ä»¥å¤ªç½‘äº¤æ¢æœºè‡ªå­¦ä¹ å’Œè½¬å‘å¸§çš„æµç¨‹
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.9-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.9-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.9-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.9-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.9-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.9-6.png"
loading="lazy"
alt="6"
>&lt;/p>
&lt;h2 id="310-ä»¥å¤ªç½‘äº¤æ¢æœºçš„ç”Ÿæˆæ ‘åè®®stp">3.10 ä»¥å¤ªç½‘äº¤æ¢æœºçš„ç”Ÿæˆæ ‘åè®®STP
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.10-1.png"
loading="lazy"
alt="1"
>&lt;/p>
&lt;h2 id="311-è™šæ‹Ÿå±€åŸŸç½‘vlan">3.11 è™šæ‹Ÿå±€åŸŸç½‘VLAN
&lt;/h2>&lt;h3 id="3111æ¦‚è¿°">3.11.1æ¦‚è¿°
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.11.1-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.11.1-2.png"
loading="lazy"
alt="2"
>&lt;/p>
&lt;h3 id="3112-å®ç°æœºåˆ¶">3.11.2 å®ç°æœºåˆ¶
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.11.2-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.11.2-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.11.2-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.11.2-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.11.2-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.11.2-6.png"
loading="lazy"
alt="6"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.11.2-7.png"
loading="lazy"
alt="7"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/3.11.2-8.png"
loading="lazy"
alt="8"
>&lt;/p>
&lt;h1 id="ç¬¬4ç« -ç½‘ç»œå±‚">ç¬¬4ç«  ç½‘ç»œå±‚
&lt;/h1>&lt;h2 id="41-ç½‘ç»œå±‚æ¦‚è¿°">4.1 ç½‘ç»œå±‚æ¦‚è¿°
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.1-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.1-2.png"
loading="lazy"
alt="2"
>&lt;/p>
&lt;h2 id="42-ç½‘ç»œå±‚æä¾›çš„ä¸¤ç§æœåŠ¡">4.2 ç½‘ç»œå±‚æä¾›çš„ä¸¤ç§æœåŠ¡
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.2-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.2-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.2-3.png"
loading="lazy"
alt="3"
>&lt;/p>
&lt;h2 id="43-ipv4åœ°å€">4.3 IPv4åœ°å€
&lt;/h2>&lt;h3 id="431-ipv4åœ°å€æ¦‚è¿°">4.3.1 IPv4åœ°å€æ¦‚è¿°
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.1-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.1-2.png"
loading="lazy"
alt="2"
>&lt;/p>
&lt;h3 id="432-åˆ†ç±»ç¼–å€çš„ipv4åœ°å€">4.3.2 åˆ†ç±»ç¼–å€çš„IPv4åœ°å€
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.2-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.2-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.2-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.2-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.2-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.2-6.png"
loading="lazy"
alt="6"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.2-7.png"
loading="lazy"
alt="7"
>&lt;/p>
&lt;h3 id="433-åˆ’åˆ†å­ç½‘çš„ipv4åœ°å€">4.3.3 åˆ’åˆ†å­ç½‘çš„IPv4åœ°å€
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.3-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.3-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.3-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.3-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.3-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.3-6.png"
loading="lazy"
alt="6"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.3-7.png"
loading="lazy"
alt="7"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.3-8.png"
loading="lazy"
alt="8"
>&lt;/p>
&lt;h3 id="434-æ— åˆ†ç±»ç¼–å€çš„ipv4åœ°å€">4.3.4 æ— åˆ†ç±»ç¼–å€çš„IPv4åœ°å€
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.4-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.4-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.4-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.4-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.4-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.4-6.png"
loading="lazy"
alt="6"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.4-7.png"
loading="lazy"
alt="7"
>&lt;/p>
&lt;h3 id="435-ipv4åœ°å€çš„åº”ç”¨è§„åˆ’">4.3.5 IPv4åœ°å€çš„åº”ç”¨è§„åˆ’
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.5-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.5-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.5-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.5-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.5-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.5-6.png"
loading="lazy"
alt="6"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.5-7.png"
loading="lazy"
alt="7"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.3.5-8.png"
loading="lazy"
alt="8"
>&lt;/p>
&lt;h2 id="44-ipæ•°æ®åŒ…çš„å‘é€å’Œè½¬å‘è¿‡ç¨‹">4.4 IPæ•°æ®åŒ…çš„å‘é€å’Œè½¬å‘è¿‡ç¨‹
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.4-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.4-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.4-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.4-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.4-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.4-6.png"
loading="lazy"
alt="6"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.4-7.png"
loading="lazy"
alt="7"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.4-8.png"
loading="lazy"
alt="8"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.4-9.png"
loading="lazy"
alt="9"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.4-10.png"
loading="lazy"
alt="10"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.4-11.png"
loading="lazy"
alt="11"
>&lt;/p>
&lt;h2 id="45-é™æ€è·¯ç”±é…ç½®åŠå…¶å¯èƒ½äº§ç”Ÿçš„è·¯ç”±ç¯è·¯é—®é¢˜">4.5 é™æ€è·¯ç”±é…ç½®åŠå…¶å¯èƒ½äº§ç”Ÿçš„è·¯ç”±ç¯è·¯é—®é¢˜
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.5-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.5-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.5-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.5-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.5-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.5-6.png"
loading="lazy"
alt="6"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.5-7.png"
loading="lazy"
alt="7"
>&lt;/p>
&lt;h2 id="46-è·¯ç”±é€‰æ‹©åè®®">4.6 è·¯ç”±é€‰æ‹©åè®®
&lt;/h2>&lt;h3 id="461-è·¯ç”±é€‰æ‹©åè®®æ¦‚è¿°">4.6.1 è·¯ç”±é€‰æ‹©åè®®æ¦‚è¿°
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.1-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.1-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.1-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.1-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.1-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.1-6.png"
loading="lazy"
alt="6"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.1-7.png"
loading="lazy"
alt="7"
>&lt;/p>
&lt;h3 id="462-è·¯ç”±ä¿¡æ¯åè®®ripçš„åŸºæœ¬å·¥ä½œåŸç†">4.6.2 è·¯ç”±ä¿¡æ¯åè®®RIPçš„åŸºæœ¬å·¥ä½œåŸç†
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.2-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.2-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.2-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.2-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.2-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.2-6.png"
loading="lazy"
alt="6"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.2-7.png"
loading="lazy"
alt="7"
>&lt;/p>
&lt;h3 id="463-å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆospfçš„åŸºæœ¬å·¥ä½œåŸç†">4.6.3 å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆOSPFçš„åŸºæœ¬å·¥ä½œåŸç†
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.3-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.3-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.3-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.3-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.3-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.3-6.png"
loading="lazy"
alt="6"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.3-7.png"
loading="lazy"
alt="7"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.3-8.png"
loading="lazy"
alt="8"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.3-9.png"
loading="lazy"
alt="9"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.3-10.png"
loading="lazy"
alt="10"
>&lt;/p>
&lt;h3 id="464-è¾¹ç•Œç½‘å…³åè®®bgpçš„åŸºæœ¬å·¥ä½œåŸç†">4.6.4 è¾¹ç•Œç½‘å…³åè®®BGPçš„åŸºæœ¬å·¥ä½œåŸç†
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.4-1.png"
loading="lazy"
alt="1"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.4-2.png"
loading="lazy"
alt="2"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.4-3.png"
loading="lazy"
alt="3"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.4-4.png"
loading="lazy"
alt="4"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.4-5.png"
loading="lazy"
alt="5"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.4-6.png"
loading="lazy"
alt="6"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.4-7.png"
loading="lazy"
alt="7"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.4-8.png"
loading="lazy"
alt="8"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.4-9.png"
loading="lazy"
alt="9"
>
&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/4.6.4-10.png"
loading="lazy"
alt="10"
>&lt;/p>
&lt;h2 id="47-ipv4æ•°æ®æŠ¥çš„é¦–éƒ¨æ ¼å¼">4.7 IPv4æ•°æ®æŠ¥çš„é¦–éƒ¨æ ¼å¼
&lt;/h2>&lt;p>é‡è¦çš„æ˜¯èƒ½ç”»å‡ºIPv4æ•°æ®æŠ¥çš„é¦–éƒ¨æ ¼å¼&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/IPv4%e6%95%b0%e6%8d%ae%e6%8a%a5%e9%a6%96%e9%83%a8%e6%a0%bc%e5%bc%8f.png"
loading="lazy"
alt="image-20220220131707502"
>&lt;/p>
&lt;h2 id="48-ç½‘é™…æ§åˆ¶åè®®icmp">4.8 ç½‘é™…æ§åˆ¶åè®®ICMP
&lt;/h2>&lt;ul>
&lt;li>ç›®çš„ï¼šä¸ºäº†æ›´æœ‰æ•ˆåœ°è½¬å‘IPæ•°æ®æŠ¥å’Œæé«˜äº¤ä»˜æˆåŠŸçš„æœºä¼š&lt;/li>
&lt;li>å°è£…åœ¨IPæ•°æ®æŠ¥ä¸­&lt;/li>
&lt;li>ICMPå·®é”™æŠ¥å‘ŠæŠ¥æ–‡åˆ†ä¸º5ç§ï¼šç»ˆç‚¹ä¸å¯è¾¾ã€æºç‚¹æŠ‘åˆ¶ã€æ—¶é—´è¶…è¿‡ã€å‚æ•°é—®é¢˜ã€æ”¹å˜è·¯ç”±ï¼ˆé‡å®šå‘ï¼‰&lt;/li>
&lt;li>ä¸åº”å‘é€ICMPå·®é”™æŠ¥å‘ŠæŠ¥æ–‡ æœ‰4ç§æƒ…å†µ&lt;/li>
&lt;li>ICMPè¯¢é—®æŠ¥æ–‡
&lt;ul>
&lt;li>å›é€è¯·æ±‚å’Œå›ç­”ï¼šæµ‹è¯•ç›®çš„ç«™æ˜¯å¦å¯è¾¾&lt;/li>
&lt;li>æ—¶é—´æˆ³è¯·æ±‚å’Œå›ç­”ï¼šè¿›è¡Œæ—¶é’ŸåŒæ­¥å’Œæµ‹é‡æ—¶é—´&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ICMPåº”ç”¨
&lt;ul>
&lt;li>åˆ†ç»„ç½‘é—´æ¢æµ‹PING&lt;/li>
&lt;li>è·Ÿè¸ªè·¯ç”±&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="49-è™šæ‹Ÿä¸“ç”¨ç½‘vpnå’Œç½‘ç»œåœ°å€è½¬æ¢nat">4.9 è™šæ‹Ÿä¸“ç”¨ç½‘VPNå’Œç½‘ç»œåœ°å€è½¬æ¢NAT
&lt;/h2>&lt;ul>
&lt;li>VPNï¼šåˆ©ç”¨å…¬ç”¨çš„å› ç‰¹ç½‘ä½œä¸ºæœ¬æœºæ„å„ä¸“ç”¨ç½‘ç»œä¹‹é—´çš„é€šä¿¡è½½ä½“&lt;/li>
&lt;li>è™šæ‹Ÿä¸“ç”¨ç½‘ä¸­çš„å„ä¸»æœºæ‰€åˆ†é…çš„åœ°å€åº”è¯¥æ˜¯æœ¬æœºæ„å¯è‡ªç”±åˆ†é…çš„ä¸“ç”¨åœ°å€ã€‚æœ‰ä¸“ç”¨åœ°å€ã€‚&lt;/li>
&lt;li>NATï¼šå¯ä½¿å¤§é‡ä½¿ç”¨å†…éƒ¨ä¸“ç”¨åœ°å€çš„ç½‘ç»œç”¨æˆ·å…±äº«å°‘é‡å¤–éƒ¨å…¨çƒåœ°å€&lt;/li>
&lt;li>ç½‘ç»œåœ°å€ä¸ç«¯å£å·è½¬æ¢ï¼šNAPTï¼Œç”¨ä¸€ä¸ªå…¨çƒIPåœ°å€å°±å¯ä»¥ä½¿æœ¬åœ°åœ°å€çš„ä¸»æœºåŒæ—¶å’Œå› ç‰¹ç½‘ä¸Šçš„ä¸»æœºè¿›è¡Œé€šä¿¡ã€‚&lt;/li>
&lt;li>NATå¯¹å¤–ç½‘å±è”½äº†å†…ç½‘ä¸»æœºçš„ç½‘ç»œåœ°å€ï¼Œèƒ½ä¸ºå†…ç½‘çš„ä¸»æœºæä¾›ä¸€å®šçš„å®‰å…¨ä¿æŠ¤ã€‚&lt;/li>
&lt;/ul>
&lt;h1 id="ç¬¬5ç« -è¿è¾“å±‚">ç¬¬5ç«  è¿è¾“å±‚
&lt;/h1>&lt;h2 id="51-è¿è¾“å±‚æ¦‚è¿°">5.1 è¿è¾“å±‚æ¦‚è¿°
&lt;/h2>&lt;ul>
&lt;li>è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„ä¸­çš„ç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚å’Œç½‘ç»œå±‚å…±åŒè§£å†³äº†å°†ä¸»æœºé€šè¿‡å¼‚æ„ç½‘ç»œäº’è”èµ·æ¥è¯´é¢ä¸´çš„é—®é¢˜ï¼Œ&lt;strong>å®ç°äº†ä¸»æœºåˆ°ä¸»æœºçš„é€šä¿¡&lt;/strong>ã€‚&lt;/li>
&lt;li>è¿è¾“å±‚ä»»åŠ¡ï¼šä¸ºè¿è¡Œåœ¨ä¸åŒä¸»æœºä¸Šçš„åº”ç”¨è¿›ç¨‹æä¾›ç›´æ¥çš„é€šä¿¡æœåŠ¡&lt;/li>
&lt;li>è¿è¾“åè®®ï¼šé¢å‘è¿æ¥çš„TCPå’Œæ— è¿æ¥çš„UDP&lt;/li>
&lt;/ul>
&lt;h2 id="52-è¿è¾“å±‚ç«¯å£å·å¤ç”¨å’Œåˆ†ç”¨çš„æ¦‚å¿µ">5.2 è¿è¾“å±‚ç«¯å£å·ã€å¤ç”¨å’Œåˆ†ç”¨çš„æ¦‚å¿µ
&lt;/h2>&lt;ul>
&lt;li>TCP/IPä½“ç³»çš„è¿è¾“å±‚ä½¿ç”¨&lt;strong>ç«¯å£å·&lt;/strong>æ¥åŒºåˆ†åº”ç”¨å±‚çš„ä¸åŒè¿›ç¨‹
&lt;ul>
&lt;li>ç†ŸçŸ¥ç«¯å£å·&lt;/li>
&lt;li>ç™»è®°ç«¯å£å·&lt;/li>
&lt;li>çŸ­æš‚ç«¯å£å·&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ç«¯å£å·åªå…·æœ‰æœ¬åœ°æ„ä¹‰&lt;/li>
&lt;li>å‘é€æ–¹çš„å¤ç”¨å’Œæ¥æ”¶æ–¹çš„åˆ†ç”¨&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220220135230146.png"
loading="lazy"
alt="image-20220220135230146"
>&lt;/p>
&lt;ul>
&lt;li>ç†ŸçŸ¥ç«¯å£å·&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220220135502221.png"
loading="lazy"
alt="image-20220220135502221"
>&lt;/p>
&lt;h2 id="53-udpå’Œtcpçš„å¯¹æ¯”">5.3 UDPå’ŒTCPçš„å¯¹æ¯”
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220220142051219.png"
loading="lazy"
alt="image-20220220142051219"
>&lt;/p>
&lt;p>UDPçš„é¦–éƒ¨æ ¼å¼&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220224191840954.png"
loading="lazy"
alt="image-20220224191840954"
>&lt;/p>
&lt;h2 id="54-tcpçš„æµé‡æ§åˆ¶">5.4 TCPçš„æµé‡æ§åˆ¶
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>æ‰€è°“æµé‡æ§åˆ¶å°±æ˜¯&lt;strong>è®©å‘é€æ–¹çš„å‘é€é€Ÿç‡ä¸è¦å¤ªå¿«ï¼Œè¦è®©æ¥æ”¶æ–¹æ¥å¾—åŠæ¥æ”¶&lt;/strong>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åˆ©ç”¨&lt;strong>æ»‘åŠ¨çª—å£&lt;/strong>æœºåˆ¶å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åœ¨TCPè¿æ¥ä¸Šå®ç°å¯¹å‘é€æ–¹çš„æµé‡æ§åˆ¶ã€‚&lt;/p>
&lt;ul>
&lt;li>TCPæ¥æ”¶æ–¹åˆ©ç”¨è‡ªå·±çš„&lt;strong>æ¥æ”¶çª—å£&lt;/strong>çš„å¤§å°æ¥é™åˆ¶å‘é€æ–¹&lt;strong>å‘é€çª—å£&lt;/strong>çš„å¤§å°ã€‚&lt;/li>
&lt;li>TCPå‘é€æ–¹æ”¶åˆ°æ¥æ”¶æ–¹çš„&lt;strong>é›¶çª—å£é€šçŸ¥&lt;/strong>åï¼Œåº”å¯åŠ¨&lt;strong>æŒç»­è®¡æ—¶å™¨&lt;/strong>ã€‚æŒç»­è®¡æ—¶å™¨è¶…æ—¶åï¼Œå‘æ¥æ”¶æ–¹å‘é€&lt;strong>é›¶çª—å£æ¢æµ‹æŠ¥æ–‡&lt;/strong>ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="55-tcpçš„æ‹¥å¡æ§åˆ¶">5.5 TCPçš„æ‹¥å¡æ§åˆ¶
&lt;/h2>&lt;p>åœ¨æŸæ®µæ—¶é—´å†…ï¼Œè‹¥å¯¹ç½‘ç»œä¸­æŸä¸€èµ„æºçš„éœ€æ±‚è¶…è¿‡äº†è¯¥èµ„æºæ‰€èƒ½æä¾›çš„éƒ¨åˆ†ï¼Œç½‘ç»œæ€§èƒ½å°±è¦å˜åã€‚è¿™ç§æƒ…å†µå°±å«åšæ‹¥å¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220221191213823.png"
loading="lazy"
alt="image-20220221191213823"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220221191002197.png"
loading="lazy"
alt="image-20220221191002197"
>&lt;/p>
&lt;h2 id="56-tcpè¶…æ—¶é‡ä¼ æ—¶é—´çš„é€‰æ‹©">5.6 TCPè¶…æ—¶é‡ä¼ æ—¶é—´çš„é€‰æ‹©
&lt;/h2>&lt;p>è¶…æ—¶é‡ä¼ æ—¶é—´RTOåº”ç•¥å¤§äºåŠ æƒå¹³å‡å¾€è¿”æ—¶é—´RTTsï¼ˆåˆç§°ä¸ºå¹³æ»‘çš„å¾€è¿”æ—¶é—´ï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220221192951884.png"
loading="lazy"
alt="image-20220221192951884"
>&lt;/p>
&lt;h2 id="57-tcpå¯é ä¼ è¾“çš„å®ç°">5.7 TCPå¯é ä¼ è¾“çš„å®ç°
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/TCP%e5%8f%af%e9%9d%a0%e4%bc%a0%e8%be%93%e7%9a%84%e5%ae%9e%e7%8e%b0.png"
loading="lazy"
alt="image-20220221194903190"
>&lt;/p>
&lt;h2 id="58-tcpçš„è¿è¾“è¿æ¥ç®¡ç†">5.8 TCPçš„è¿è¾“è¿æ¥ç®¡ç†
&lt;/h2>&lt;h3 id="581-tcpçš„è¿æ¥å»ºç«‹">5.8.1 TCPçš„è¿æ¥å»ºç«‹
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/TCP%e7%9a%84%e8%bf%9e%e6%8e%a5%e5%bb%ba%e7%ab%8b.png"
loading="lazy"
alt="image-20220221200835993"
>&lt;/p>
&lt;p>å‘é€é’ˆå¯¹TCPè¿æ¥è¯·æ±‚çš„ç¡®è®¤çš„ç¡®è®¤ä¸å¤šä½™ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µçªç„¶åˆé‡ä¼ åˆ°äº†TCPæœåŠ¡å™¨ï¼Œå› è€Œå¯¼è‡´é”™è¯¯ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://www.zhihu.com/question/24853633" target="_blank" rel="noopener"
>TCP ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œä¸æ˜¯ä¸¤æ¬¡æˆ–å››æ¬¡ï¼Ÿ&lt;/a>&lt;/p>
&lt;h3 id="582-tcpçš„è¿æ¥é‡Šæ”¾">5.8.2 TCPçš„è¿æ¥é‡Šæ”¾
&lt;/h3>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/TCP%e9%87%8a%e6%94%be%e8%bf%9e%e6%8e%a5.png"
loading="lazy"
alt="image-20220221202241831"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/%e4%bf%9d%e6%b4%bb%e8%ae%a1%e6%97%b6%e5%99%a8.png"
loading="lazy"
alt="image-20220221202420969"
>&lt;/p>
&lt;p>å‚è€ƒ&lt;a class="link" href="https://blog.csdn.net/qzcsu/article/details/72861891" target="_blank" rel="noopener"
>ä¸¤å¼ åŠ¨å›¾-å½»åº•æ˜ç™½TCPçš„ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹&lt;/a>:&lt;/p>
&lt;p>ä¸ºä»€ä¹ˆå»ºç«‹è¿æ¥æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå…³é—­è¿æ¥ç¡®æ˜¯å››æ¬¡æŒ¥æ‰‹å‘¢ï¼Ÿ&lt;/p>
&lt;p>å»ºç«‹è¿æ¥çš„æ—¶å€™ï¼Œ æœåŠ¡å™¨åœ¨LISTENçŠ¶æ€ä¸‹ï¼Œæ”¶åˆ°å»ºç«‹è¿æ¥è¯·æ±‚çš„SYNæŠ¥æ–‡åï¼ŒæŠŠACKå’ŒSYNæ”¾åœ¨ä¸€ä¸ªæŠ¥æ–‡é‡Œå‘é€ç»™å®¢æˆ·ç«¯ã€‚è€Œå…³é—­è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨æ”¶åˆ°å¯¹æ–¹çš„FINæŠ¥æ–‡æ—¶ï¼Œä»…ä»…è¡¨ç¤ºå¯¹æ–¹ä¸å†å‘é€æ•°æ®äº†ä½†æ˜¯è¿˜èƒ½æ¥æ”¶æ•°æ®ï¼Œè€Œè‡ªå·±ä¹Ÿæœªå¿…å…¨éƒ¨æ•°æ®éƒ½å‘é€ç»™å¯¹æ–¹äº†ï¼Œæ‰€ä»¥å·±æ–¹å¯ä»¥ç«‹å³å…³é—­ï¼Œä¹Ÿå¯ä»¥å‘é€ä¸€äº›æ•°æ®ç»™å¯¹æ–¹åï¼Œå†å‘é€FINæŠ¥æ–‡ç»™å¯¹æ–¹æ¥è¡¨ç¤ºåŒæ„ç°åœ¨å…³é—­è¿æ¥ï¼Œå› æ­¤ï¼Œå·±æ–¹ACKå’ŒFINä¸€èˆ¬éƒ½ä¼šåˆ†å¼€å‘é€ï¼Œä»è€Œå¯¼è‡´å¤šäº†ä¸€æ¬¡ã€‚&lt;/p>
&lt;h2 id="59-tcpæŠ¥æ–‡æ®µçš„é¦–éƒ¨æ ¼å¼">5.9 TCPæŠ¥æ–‡æ®µçš„é¦–éƒ¨æ ¼å¼
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/TCP%e6%8a%a5%e6%96%87%e6%ae%b5%e7%9a%84%e9%a6%96%e9%83%a8%e6%a0%bc%e5%bc%8f.png"
loading="lazy"
alt="image-20220222143614760"
>&lt;/p>
&lt;p>åºå·ï¼šæŒ‡å‡ºæœ¬TCPæŠ¥æ–‡æ®µæ•°æ®è½½è·çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·&lt;/p>
&lt;p>ç¡®è®¤å·ï¼šæŒ‡å‡ºæœŸæœ›æ”¶åˆ°å¯¹æ–¹ä¸‹ä¸€ä¸ªTCPæŠ¥æ–‡æ®µçš„æ•°æ®è½½è·çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¯¹ä¹‹å‰æ”¶åˆ°çš„æ‰€æœ‰æ•°æ®çš„ç¡®è®¤ã€‚&lt;/p>
&lt;p>TCPè§„å®šï¼Œåœ¨è¿æ¥å»ºç«‹åæ‰€æœ‰ä¼ é€çš„TCPæŠ¥æ–‡æ®µéƒ½å¿…é¡»æŠŠACKç½®1ã€‚&lt;/p>
&lt;p>ä¿ç•™ï¼šå 6æ¯”ç‰¹&lt;/p>
&lt;p>æ ¡éªŒå’Œï¼šåœ¨è®¡ç®—æ ¡éªŒå’Œæ—¶ï¼Œè¦åœ¨TCPæŠ¥æ–‡æ®µçš„å‰é¢åŠ ä¸Š12å­—èŠ‚çš„ä¼ªé¦–éƒ¨ã€‚&lt;/p>
&lt;p>å¤ä½æ ‡è¯†ä½RSTï¼šç”¨æ¥å¤ä½TCPè¿æ¥ã€‚ä¸º1è¡¨æ˜TCPè¿æ¥å‡ºç°äº†å¼‚å¸¸ã€‚RSTç½®1è¿˜ç”¨æ¥æ‹’ç»ä¸€ä¸ªéæ³•çš„æŠ¥æ–‡æ®µæˆ–æ‹’ç»æ‰“å¼€ä¸€ä¸ªTCPè¿æ¥ã€‚&lt;/p>
&lt;p>PSHï¼šæ¨é€æ ‡å¿—ä½&lt;/p>
&lt;p>ç´§æ€¥æ ‡è®°ä½URG&lt;/p>
&lt;p>ç´§æ€¥æŒ‡é’ˆï¼šå 16æ¯”ç‰¹ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œç”¨æ¥æŒ‡æ˜ç´§æ€¥æ•°æ®çš„é•¿åº¦ã€‚&lt;/p>
&lt;p>é€‰é¡¹ï¼šæœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦MSSé€‰é¡¹ã€çª—å£æ‰©å¤§é€‰é¡¹ã€æ—¶é—´æˆ³é€‰é¡¹ï¼ˆè®¡ç®—å¾€è¿”æ—¶é—´RTTï¼Œå¤„ç†åºå·è¶…èŒƒå›´çš„æƒ…å†µï¼‰ã€é€‰æ‹©ç¡®è®¤é€‰é¡¹&lt;/p>
&lt;h1 id="ç¬¬6ç« -åº”ç”¨å±‚">ç¬¬6ç«  åº”ç”¨å±‚
&lt;/h1>&lt;h2 id="61-åº”ç”¨å±‚æ¦‚è¿°">6.1 åº”ç”¨å±‚æ¦‚è¿°
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220222150200269.png"
loading="lazy"
alt="image-20220222150200269"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220222150247501.png"
loading="lazy"
alt="image-20220222150247501"
>&lt;/p>
&lt;h2 id="62-å®¢æˆ·æœåŠ¡å™¨æ–¹å¼å’Œå¯¹ç­‰æ–¹å¼">6.2 å®¢æˆ·/æœåŠ¡å™¨æ–¹å¼å’Œå¯¹ç­‰æ–¹å¼
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220222150411463.png"
loading="lazy"
alt="image-20220222150411463"
>&lt;/p>
&lt;h2 id="63-åŠ¨æ€ä¸»æœºé…ç½®åè®®dhcp">6.3 åŠ¨æ€ä¸»æœºé…ç½®åè®®DHCP
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220222151827754.png"
loading="lazy"
alt="image-20220222151827754"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220222151905764.png"
loading="lazy"
alt="image-20220222151905764"
>&lt;/p>
&lt;h2 id="64-åŸŸåç³»ç»Ÿdnsdomain-name-system">6.4 åŸŸåç³»ç»ŸDNS(Domain Name System)
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220222153928601.png"
loading="lazy"
alt="image-20220222153928601"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220222154000857.png"
loading="lazy"
alt="image-20220222154000857"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220222154058684.png"
loading="lazy"
alt="image-20220222154058684"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220222154122175.png"
loading="lazy"
alt="image-20220222154122175"
>&lt;/p>
&lt;p>ä¸ºäº†æé«˜DNSçš„æŸ¥è¯¢æ•ˆç‡ï¼Œå¹¶å‡è½»æ ¹åŸŸåæœåŠ¡å™¨çš„è´Ÿè·å’Œå‡å°‘å› ç‰¹ç½‘ä¸ŠDNSæŸ¥è¯¢æŠ¥æ–‡çš„æ•°é‡ï¼Œåœ¨åŸŸåæœåŠ¡å™¨å’Œä¸»æœºä¸­å¹¿æ³›ä½¿ç”¨äº†&lt;strong>é«˜é€Ÿç¼“å­˜&lt;/strong>ã€‚&lt;/p>
&lt;p>DNSæŠ¥æ–‡ä½¿ç”¨è¿è¾“å±‚çš„UDPåè®®å°è£…ï¼Œè¿è¾“å±‚&lt;strong>ç«¯å£å·ä¸º53&lt;/strong>ã€‚&lt;/p>
&lt;h2 id="65-æ–‡ä»¶ä¼ é€åè®®ftp">6.5 æ–‡ä»¶ä¼ é€åè®®FTP
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220222161515570.png"
loading="lazy"
alt="image-20220222161515570"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220222161543913.png"
loading="lazy"
alt="image-20220222161543913"
>&lt;/p>
&lt;h2 id="66-ç”µå­é‚®ä»¶">6.6 ç”µå­é‚®ä»¶
&lt;/h2>&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220222173318475.png"
loading="lazy"
alt="image-20220222173318475"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220222173351178.png"
loading="lazy"
alt="image-20220222173351178"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220222173528597.png"
loading="lazy"
alt="image-20220222173528597"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220222173558645.png"
loading="lazy"
alt="image-20220222173558645"
>&lt;/p>
&lt;h2 id="67-ä¸‡ç»´ç½‘www">6.7 ä¸‡ç»´ç½‘WWW
&lt;/h2>&lt;p>ä¸‡ç»´ç½‘æ˜¯è¿è¡Œåœ¨å› ç‰¹ç½‘ä¸Šçš„ä¸€ä¸ª&lt;strong>åˆ†å¸ƒå¼åº”ç”¨&lt;/strong>ã€‚&lt;/p>
&lt;p>ä¸‡ç»´ç½‘åˆ©ç”¨ç½‘é¡µä¹‹é—´çš„&lt;strong>è¶…é“¾æ¥&lt;/strong>å°†ä¸åŒç½‘ç«™çš„ç½‘é¡µé“¾æ¥æˆä¸€å¼ é€»è¾‘ä¸Šçš„ä¿¡æ¯ç½‘ã€‚&lt;/p>
&lt;p>ä¸‡ç»´ç½‘ä½¿ç”¨&lt;strong>ç»Ÿä¸€èµ„æºå®šä½ç¬¦URL&lt;/strong>æ¥æŒ‡æ˜å› ç‰¹ç½‘ä¸Šä»»ä½•ç§ç±»â€œèµ„æºâ€çš„ä½ç½®ã€‚URLä¸€èˆ¬å½¢å¼ï¼š&lt;strong>&amp;lt;åè®®&amp;gt;://&amp;lt;ä¸»æœº&amp;gt;:&amp;lt;ç«¯å£&amp;gt;/&amp;lt;è·¯å¾„&amp;gt;&lt;/strong>&lt;/p>
&lt;p>ä¸‡ç»´ç½‘æ–‡æ¡£&lt;/p>
&lt;ul>
&lt;li>è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€HTMLï¼Œä½¿ç”¨å¤šç§æ ‡ç­¾æ¥æè¿°ç½‘é¡µçš„ç»“æ„å’Œå†…å®¹&lt;/li>
&lt;li>å±‚å æ ·å¼è¡¨CSSï¼Œä»å®¡ç¾çš„è§’åº¦æ¥æè¿°ç½‘é¡µçš„æ ·å¼&lt;/li>
&lt;li>JavaScriptï¼Œä¸€ç§è„šæœ¬è¯­è¨€ï¼Œæ§åˆ¶ç½‘é¡µè¡Œä¸º&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220223135217357.png"
loading="lazy"
alt="image-20220223135217357"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220223135245364.png"
loading="lazy"
alt="image-20220223135245364"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220223135322233.png"
loading="lazy"
alt="image-20220223135322233"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220223135804011.png"
loading="lazy"
alt="image-20220223135804011"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220223135834276.png"
loading="lazy"
alt="image-20220223135834276"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220223135913212.png"
loading="lazy"
alt="image-20220223135913212"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220223140106001.png"
loading="lazy"
alt="image-20220223140106001"
>&lt;/p>
&lt;p>Cookieæ˜¯ä¸€ç§&lt;strong>å¯¹æ— çŠ¶æ€çš„HTTPè¿›è¡ŒçŠ¶æ€åŒ–&lt;/strong>çš„æŠ€æœ¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220223140250457.png"
loading="lazy"
alt="image-20220223140250457"
>&lt;/p>
&lt;p>&lt;img src="https://wenjin1997.github.io/img/2022-03-23-internet/image-20220223140415470.png"
loading="lazy"
alt="image-20220223140415470"
>&lt;/p></description></item><item><title>vuepressé…ç½®åšå®¢æ”¯æŒæ•°å­¦å…¬å¼</title><link>https://wenjin1997.github.io/2022/03/09/mathEquationBlog/</link><pubDate>Wed, 09 Mar 2022 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2022/03/09/mathEquationBlog/</guid><description>&lt;p>ä¸»è¦å‚è€ƒ&lt;a class="link" href="https://www.1024sou.com/article/642755.html" target="_blank" rel="noopener"
>vuepress-theme-recoè®¾ç½®mathå…¬å¼&lt;/a>ã€‚&lt;/p>
&lt;h2 id="æ­¥éª¤">æ­¥éª¤
&lt;/h2>&lt;ol>
&lt;li>å®šä½åˆ°åšå®¢çš„æ ¹ç›®å½•ä¸‹ï¼Œå®‰è£…åº“&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">npm i markdown-it-texmath
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>å®‰è£…&lt;code>markdown-it&lt;/code>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">npm install markdown-it --save
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>å®‰è£…&lt;code>katex&lt;/code>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">npm install katex
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="4">
&lt;li>ä¿®æ”¹&lt;code>.vuepress/config.js&lt;/code>æ–‡ä»¶&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">markdown&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">lineNumbers&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">anchor&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">permalink&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">false&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">toc&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">includeLevel&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">extendMarkdown&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">md&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">md&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">use&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;markdown-it-texmath&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>head&lt;/code>éƒ¨åˆ†æ·»åŠ ä¸‹é¢çš„ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;link&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s2">&amp;#34;rel&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="s1">&amp;#39;stylesheet&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;href&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="s1">&amp;#39;https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css&amp;#39;&lt;/span>&lt;span class="p">}],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;link&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s2">&amp;#34;rel&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="s1">&amp;#39;stylesheet&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;href&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="s1">&amp;#39;https://gitcdn.xyz/cdn/goessner/markdown-it-texmath/master/texmath.css&amp;#39;&lt;/span>&lt;span class="p">}],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;script&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s2">&amp;#34;src&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;https://github.com/markdown-it/markdown-it/blob/master/bin/markdown-it.js&amp;#39;&lt;/span>&lt;span class="p">}],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;script&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s2">&amp;#34;src&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;https://gitcdn.xyz/cdn/goessner/markdown-it-texmath/master/texmath.js&amp;#39;&lt;/span>&lt;span class="p">}],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;script&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s2">&amp;#34;src&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js&amp;#39;&lt;/span>&lt;span class="p">}]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="5">
&lt;li>æ›´æ–°æäº¤åï¼Œå°±å¤§åŠŸå‘Šæˆäº†ã€‚&lt;/li>
&lt;/ol></description></item><item><title>æ•°å€¼æ±‚è§£çƒ­ä¼ å¯¼æ–¹ç¨‹</title><link>https://wenjin1997.github.io/2021/05/24/heat-equation/</link><pubDate>Mon, 24 May 2021 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2021/05/24/heat-equation/</guid><description>&lt;h1 id="æœ€ç®€æ˜¾æ ¼å¼">æœ€ç®€æ˜¾æ ¼å¼
&lt;/h1>&lt;p>å¯¹äºå¦‚ä¸‹çƒ­ä¼ å¯¼æ–¹ç¨‹ï¼š
&lt;/p>
$$
\begin{cases}
\frac{\partial u}{\partial t} =\frac{\partial ^2 u}{\partial t} \quad 0&lt;t&lt;0.03,0&lt;x&lt;1 \\\
u(x,0)=\sin(4\pi x) \quad 0 \le x \le 1 \\\
u(0,t) = 0 \quad 0 \le t \le 0.03 \\\
u(1,t) = 0 \quad 0 \le t \le 0.03
\end{cases}
$$&lt;p>è¯¥æ–¹ç¨‹çš„ç²¾ç¡®è§£ä¸º$u(t,x)=e^{-(4\pi)^2t}\sin (4 \pi x),0\le t \le 0.03, 0 \le x \le 1.$&lt;/p>
&lt;p>é¦–å…ˆå¯¹æ—¶é—´åŠç©ºé—´è¿›è¡Œåˆ’åˆ†ï¼Œå°†æ—¶é—´åˆ’åˆ†ä¸º$m-1$ä»½ï¼Œå°†ç©ºé—´åˆ’åˆ†ä¸º$n-1$ä»½ï¼Œåˆ™$\tau=\frac{0.03}{m-1},h=\frac{1}{n-1}$ã€‚
æ ¹æ®æœ€ç®€æ˜¾æ ¼å¼å¯ä»¥å¾—åˆ°ï¼š
&lt;/p>
$$
u_j^{i+1}=\frac{\tau}{h^2}(u_{j+1}^{i}-2u_j^i+u_{j-1}^i)+u_j^{i},
$$&lt;p>
å…¶ä¸­$i=0,1,\cdots,m-1$ï¼Œ$j=0,1,\cdots,n-1$ã€‚&lt;/p>
&lt;h1 id="ç¼–ç¨‹å®ç°">ç¼–ç¨‹å®ç°
&lt;/h1>&lt;p>æ ¹æ®ç†è®ºæ¨å¯¼ï¼Œç”¨pythonç¼–å†™ç¨‹åºå¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -*- coding: utf-8 -*-&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">Created on Sun May 23 11:16:13 2021
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">@author: XieWenjin
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">math&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">numpy&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">np&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">matplotlib&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">pyplot&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">plt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">mpl_toolkits.mplot3d&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Axes3D&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">t&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mf">0.03&lt;/span> &lt;span class="c1"># æ—¶é—´èŒƒå›´&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mf">1.0&lt;/span> &lt;span class="c1"># ç©ºé—´èŒƒå›´&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">m&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">input&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;è¯·è¾“å…¥mï¼š&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">m&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">int&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">input&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;è¯·è¾“å…¥nï¼š&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">int&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># m = 320 # æ—¶é—´æ–¹å‘åˆ†ä¸º320ä¸ªæ ¼å­&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># n = 64 # ç©ºé—´æ–¹å‘çš„æ ¼å­æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">t&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">m&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># æ—¶é—´æ­¥é•¿&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dx&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># ç©ºé—´æ­¥é•¿&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">generate_u&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">u&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zeros&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è¾¹ç•Œæ¡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">u&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">math&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sin&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">4&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">math&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pi&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">dx&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">u&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">u&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å·®åˆ†æ³•&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">u&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">j&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">dt&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">u&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">u&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">j&lt;/span>&lt;span class="p">])&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">dx&lt;/span> &lt;span class="o">**&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">u&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">j&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">u&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">drawing&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">Y&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">Z&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fig&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">plt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">figure&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ax&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Axes3D&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fig&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ax&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">plot_surface&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Y&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Z&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">rstride&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">cstride&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">cmap&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;rainbow&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">plt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">show&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">u_exact&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">err&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">abs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">u&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">u_exact&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nb">max&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">err&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">X&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">arange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">t&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">dt&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dt&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># remark:t+dt,not t&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">arange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">dx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dx&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">meshgrid&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Y&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">u_exact&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">exp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pi&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sin&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pi&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">Y&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">u&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">generate_u&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">u&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">transpose&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># æ³¨æ„è¿™é‡Œæ˜¯è½¬ç½®ï¼Œè€Œä¸æ˜¯np.reshape(u,(n,m))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># print(m,n)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">u_exact&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">drawing&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">Y&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># æ•°å€¼è§£&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># drawing(X,Y,u_exact) # ç²¾ç¡®è§£&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># drawing(X,Y,abs(u-u_exact)) # æ•°å€¼è§£ä¸ç²¾ç¡®è§£ä¹‹å·®çš„ç»å¯¹å€¼&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="ç»“æœåˆ†æ">ç»“æœåˆ†æ
&lt;/h1>&lt;p>å½“å–$m=320,n=64$æ—¶ï¼Œå¾—åˆ°æ•°å€¼è§£$[u]$å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/05/24/cMGvKnF4tpaeXAZ.png"
loading="lazy"
alt="result_u.png"
>&lt;/p>
&lt;p>ç²¾ç¡®è§£$u$å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/05/24/eRQjX5DIwOpZyu2.png"
loading="lazy"
alt="u_exact.png"
>&lt;/p>
&lt;p>ç²¾ç¡®è§£ä¸æ•°å€¼è§£ä¹‹å·®çš„ç»å¯¹å€¼$||u-[u]||$å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/05/24/8jHizxdguJyIaNS.png"
loading="lazy"
alt="abs_error.png"
>&lt;/p>
&lt;p>å½“å–ä¸åŒçš„$\tau,h$æ—¶ï¼Œè®¡ç®—å¾—åˆ°çš„è¯¯å·®å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: center">$\tau$&lt;/th>
&lt;th style="text-align: center">$h$&lt;/th>
&lt;th style="text-align: center">è¯¯å·®$e$&lt;/th>
&lt;th style="text-align: center">$e_i/e_{i+1}$&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: center">$\frac{1}{10}$&lt;/td>
&lt;td style="text-align: center">$\frac{1}{10}$&lt;/td>
&lt;td style="text-align: center">0.0428079643162558&lt;/td>
&lt;td style="text-align: center">&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">$\frac{1}{40}$&lt;/td>
&lt;td style="text-align: center">$\frac{1}{20}$&lt;/td>
&lt;td style="text-align: center">0.00951825176096948&lt;/td>
&lt;td style="text-align: center">4.4975&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">$\frac{1}{160}$&lt;/td>
&lt;td style="text-align: center">$\frac{1}{40}$&lt;/td>
&lt;td style="text-align: center">0.00244056613219328&lt;/td>
&lt;td style="text-align: center">3.9000&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">$\frac{1}{640}$&lt;/td>
&lt;td style="text-align: center">$\frac{1}{80}$&lt;/td>
&lt;td style="text-align: center">0.000606385251482932&lt;/td>
&lt;td style="text-align: center">4.0248&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">$\frac{1}{2560}$&lt;/td>
&lt;td style="text-align: center">$\frac{1}{160}$&lt;/td>
&lt;td style="text-align: center">0.000151362159712509&lt;/td>
&lt;td style="text-align: center">4.0062&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>æˆ‘ä»¬çŸ¥é“æœ€ç®€æ˜¾æ ¼å¼çš„è¯¯å·®ä¸º$||[u]^k-u^k||=O(\tau + h^2)$ï¼Œè®¾$e_i=C \times (\tau_i + h_i^2)$ï¼Œ
å–$\tau_{i+1}=\frac{1}{4} \tau_i$,$h_{i+1}=\frac{1}{2}h_i$ï¼Œå¯ä»¥å¾—åˆ°$\frac{e_i}{e_{i+1}}
=4$ï¼Œä¸ä¸Šè¡¨ç»“æœç›¸ç¬¦ï¼Œä»è€Œä¹ŸéªŒè¯äº†æœ€ç®€æ˜¾æ ¼å¼çš„è¯¯å·®é˜¶æ•°ä¸º$O(\tau + h^2)$.&lt;/p></description></item><item><title>æ¬§æ‹‰æ–¹æ³•ã€éšå¼æ¬§æ‹‰æ–¹æ³•</title><link>https://wenjin1997.github.io/2021/03/11/euler-method/</link><pubDate>Thu, 11 Mar 2021 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2021/03/11/euler-method/</guid><description>&lt;img src="https://wenjin1997.github.io/img/2021-03-11-eluer-method/background.jpg" alt="Featured image of post æ¬§æ‹‰æ–¹æ³•ã€éšå¼æ¬§æ‹‰æ–¹æ³•" />&lt;p>æ±‚è§£å¦‚ä¸‹å¸¸å¾®åˆ†æ–¹ç¨‹ï¼š&lt;br>
&lt;/p>
$$
\begin{aligned}
\begin{cases}
\frac{du}{dt}=-\frac{u}{t},1\leq t\leq 2, \\\
u(1)=1
\end{cases}
\end{aligned}
$$&lt;h2 id="ç²¾ç¡®è§£">ç²¾ç¡®è§£
&lt;/h2>&lt;p>å°†åŸæ–¹ç¨‹åŒ–ä¸º$tdu+udt=0$ï¼Œåˆ™æœ‰$d(ut)=0$ï¼Œè§£å¾—$ut=C$($C$ä¸ºå¸¸æ•°)ï¼Œä»£å…¥åˆå§‹æ¡ä»¶å¾—$C=1$ï¼Œä»è€Œè¯¥æ–¹ç¨‹çš„ç²¾ç¡®è§£ä¸ºï¼š
&lt;/p>
$$
\begin{aligned}
u=\frac{1}{t},(1\leq t \leq2).
\end{aligned}
$$&lt;h2 id="æ¬§æ‹‰æ–¹æ³•">æ¬§æ‹‰æ–¹æ³•
&lt;/h2>&lt;p>ä»£å…¥æ¬§æ‹‰æ ¼å¼å¾—ï¼š
&lt;/p>
$$
\begin{aligned}
u_{i+1}=u_{i}+hf(t_i,u_i)=u_i+h(-\frac{u_i}{t_i})
\end{aligned}
$$&lt;h2 id="éšå¼æ¬§æ‹‰æ–¹æ³•">éšå¼æ¬§æ‹‰æ–¹æ³•
&lt;/h2>&lt;p>ç”±éšå¼æ¬§æ‹‰æ ¼å¼å¾—ï¼š
&lt;/p>
$$
\begin{aligned}
u_{i+1}=u_{i}+hf(t_{i+1},u_{i+1})=u_i+h(-\frac{u_{i+1}}{t_{i+1}})ï¼Œ
\end{aligned}
$$&lt;p>
ç§»é¡¹åŒ–ç®€å¯å¾—ï¼š
&lt;/p>
$$
\begin{aligned}
u_{i+1}=\frac{t_{i+1}u_i}{t_{i+1}+h}
\end{aligned}
$$&lt;h2 id="ç¨‹åº">ç¨‹åº
&lt;/h2>&lt;p>æ ¹æ®ä¸Šè¿°æ¨å¯¼ï¼Œç”¨pythonç¼–å†™ç¨‹åºï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># implict euler method&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">numpy&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">np&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">matplotlib.pyplot&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">plt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the right term of the ODE&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">f&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">u&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">t&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">f&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the exact solution of ODE &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">fexact&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fexact&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">t&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">fexact&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">N&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">t_n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mf">2.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">t_n&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mf">1.0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">N&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">t&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">arange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">t_n&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">dt&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dt&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">u_euler&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">arange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">t_n&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">dt&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dt&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">u&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">arange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">t_n&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">dt&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dt&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">u_true&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">arange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">t_n&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">dt&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dt&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">while&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">N&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">t&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">t&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">dt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">u_euler&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">u_euler&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">dt&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">u_euler&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">u&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">t&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">dt&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">u_true&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">fexact&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">err_euler&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">max&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">abs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">u_euler&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">u_true&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">err_implict_euler&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">max&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">abs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">u&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">u_true&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;The error of euler method: &amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">err_euler&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;The error of implict euler method: &amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">err_implict_euler&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># begin drawing&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">plt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">title&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Result&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">plt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">plot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">u_euler&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">color&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;green&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">label&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;euler&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">plt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">plot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">u&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">color&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;blue&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">label&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;implict euler&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">plt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">plot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">u_true&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">color&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;red&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">label&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;exact&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">plt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">legend&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># show the legend&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">plt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">xlabel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;t&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">plt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ylabel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;u&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">plt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">show&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ç»“æœåˆ†æ">ç»“æœåˆ†æ
&lt;/h2>&lt;p>å½“å–$h=0.01$æ—¶ï¼Œæ­¤æ—¶æ¬§æ‹‰æ–¹æ³•çš„è¯¯å·®ä¸º0.02631578947368396ï¼Œéšå¼æ¬§æ‹‰æ–¹æ³•çš„è¯¯å·®ä¸º0.023809523809523836ï¼Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/03/11/pBG2osfcJ3tlvWZ.png"
loading="lazy"
alt="result.png"
>&lt;/p>
&lt;p>å½“å–ä¸åŒ$h$ï¼Œå¾—åˆ°çš„è¯¯å·®å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: center">$h$&lt;/th>
&lt;th style="text-align: center">æ¬§æ‹‰æ–¹æ³•&lt;/th>
&lt;th style="text-align: center">éšå¼æ¬§æ‹‰æ–¹æ³•&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: center">$\frac{1}{2}$&lt;/td>
&lt;td style="text-align: center">0.16666666666666663&lt;/td>
&lt;td style="text-align: center">0.09999999999999998&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">$\frac{1}{4}$&lt;/td>
&lt;td style="text-align: center">0.0714285714285714&lt;/td>
&lt;td style="text-align: center">0.05555555555555558&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">$\frac{1}{8}$&lt;/td>
&lt;td style="text-align: center">0.033333333333333215&lt;/td>
&lt;td style="text-align: center">0.02941176470588236&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">$\frac{1}{16}$&lt;/td>
&lt;td style="text-align: center">0.01612903225806467&lt;/td>
&lt;td style="text-align: center">0.015151515151515138&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">$\frac{1}{32}$&lt;/td>
&lt;td style="text-align: center">0.00793650793650813&lt;/td>
&lt;td style="text-align: center">0.007692307692307665&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">$\frac{1}{64}$&lt;/td>
&lt;td style="text-align: center">0.0039370078740155193&lt;/td>
&lt;td style="text-align: center">0.003875968992248069&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></description></item><item><title>å¦‚ä½•ç”¨gitåŒæ­¥æœ¬åœ°ä»£ç åˆ°github</title><link>https://wenjin1997.github.io/2021/01/24/git/</link><pubDate>Sun, 24 Jan 2021 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2021/01/24/git/</guid><description>&lt;h1 id="æ­¥éª¤">æ­¥éª¤
&lt;/h1>&lt;p>1.åœ¨æœ¬åœ°å»ºç«‹ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¹¶å®šä½åˆ°è¯¥æ–‡ä»¶å¤¹ä¸‹&lt;br>
2.è¾“å…¥å‘½ä»¤&lt;code>git init&lt;/code>
&lt;code>git config --global user.name &amp;quot;wenjin1997&amp;quot;&lt;/code>
&lt;code>git config --global user.email &amp;quot;wenjin1997@126.com&amp;quot;&lt;/code>
3.é…ç½®SSH&lt;code>ssh-keygen -t rsa -C &amp;quot;xxxxxxxx@163.com&amp;quot; &lt;/code>(ç™»å½•githubçš„é‚®ç®±)ï¼Œä¸­é—´éœ€è¦è®¾ç½®å¯†ç ï¼Œå¯ä»¥ç›´æ¥æŒ‰å›è½¦&lt;br>
4.æ‹·è´SSH&lt;code>pbcopy &amp;lt; ~/.ssh/id_rsa.pub&lt;/code>&lt;br>
5.åœ¨githubçš„settingsä¸­æ·»åŠ åˆšåˆšçš„SSH&lt;br>
6.æ‰“å¼€ç»ˆç«¯ï¼ŒéªŒè¯æ˜¯å¦é…ç½®æˆåŠŸ&lt;code>ssh -T git@github.com&lt;/code>&lt;br>
7.è®¾ç½®ç™»å½•ååŠé‚®ç®±&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git config --global user.name &amp;#34;your name&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git config --global user.email &amp;#34;your_email@youremail.com&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>8.å°†é¡¹ç›®å…‹éš†åˆ°æœ¬åœ°ï¼Œä¾‹å¦‚&lt;code>git clone git@github.com:wenjin1997/python-notes.git&lt;/code>&lt;/p></description></item><item><title>ã€Šç»ƒä¹ çš„å¿ƒæ€ï¼šå¦‚ä½•åŸ¹å…»è€å¿ƒã€ä¸“æ³¨å’Œè‡ªå¾‹ã€‹</title><link>https://wenjin1997.github.io/2020/03/10/Practices/</link><pubDate>Tue, 10 Mar 2020 00:00:00 +0000</pubDate><guid>https://wenjin1997.github.io/2020/03/10/Practices/</guid><description>&lt;h2 id="ä¹¦ç±ä¿¡æ¯">ä¹¦ç±ä¿¡æ¯
&lt;/h2>&lt;ul>
&lt;li>ä¹¦åï¼šã€Šç»ƒä¹ çš„å¿ƒæ€ï¼šå¦‚ä½•åŸ¹å…»è€å¿ƒã€ä¸“æ³¨å’Œè‡ªå¾‹ã€‹&lt;/li>
&lt;li>ä½œè€…ï¼šæ‰˜é©¬æ–¯ M.æ–¯ç‰¹çº³&lt;/li>
&lt;/ul>
&lt;h2 id="ä¹¦æ‘˜">ä¹¦æ‘˜
&lt;/h2>&lt;blockquote>
&lt;p>æ€»è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬åŸ¹è‚²ç»ƒä¹ çš„å¿ƒæ€ï¼Œå½’ç»“ä¸ºä¸€äº›ç®€å•çš„æ³•åˆ™ï¼š&lt;/p>
&lt;ul>
&lt;li>è®©è‡ªå·±å§‹ç»ˆä»¥è¿‡ç¨‹ä¸ºå¯¼å‘ã€‚&lt;/li>
&lt;li>é‡ç‚¹å…³æ³¨å½“å‰ã€‚&lt;/li>
&lt;li>å°†è¿‡ç¨‹ç¡®å®šä¸ºç›®æ ‡ï¼Œå¹¶ä¸”è¿ç”¨æ€»ç›®æ ‡ä½œä¸ºèˆ¹èˆµï¼Œä»¥æŒ‡å¼•è‡ªå·±çš„åŠªåŠ›ã€‚&lt;/li>
&lt;li>å¯¹è‡ªå·±æƒ³è¦åšåˆ°çš„äº‹æƒ…åˆ»æ„åœ°è®­ç»ƒï¼Œå¸¦ç€æ„å›¾è®­ç»ƒï¼Œå¹¶ä¸”è‡ªå§‹è‡³ç»ˆæ¸…é†’åœ°çŸ¥é“é‚£ç§æ„å›¾ã€‚&lt;/li>
&lt;/ul>
&lt;p>èšç„¦äºè¿‡ç¨‹æ—¶ï¼Œä½ æœŸæœ›çš„ç»“æœä¼šå¾ˆè½»æ¾ã€å¾ˆè‡ªç„¶åœ°å‡ºç°ã€‚èšç„¦äºç»“æœæ—¶ï¼Œä½ ä¾¿é©¬ä¸Šé™·å…¥çº ç»“ä¹‹ä¸­ï¼Œå¯¹è¿‡ç¨‹æ„Ÿåˆ°åŒå€¦ã€ä¸å®‰ã€å¤±è´¥å’Œä¸è€çƒ¦ã€‚&lt;/p>
&lt;p>é€šå‘è€å¿ƒçš„ç¬¬ä¸€æ­¥æ˜¯æ„è¯†åˆ°ä½ çš„å†…å¿ƒç‹¬ç™½æ˜¯ä»€ä¹ˆæ—¶å€™å¼€å§‹ç–¯ç‹‚å¥”èµ°ï¼Œå¹¶ä¸”æ‹–ç€ä½ ä¸€è·¯ç‹‚å¥”ã€‚&lt;br>
åŸ¹å…»è€å¿ƒçš„ç¬¬äºŒæ­¥æ˜¯ç†è§£å’Œæ¥å—è¿™æ ·ä¸€ä¸ªç°å®ï¼šä¸è®ºä»€ä¹ˆäº‹æƒ…ï¼Œéƒ½ä¸ä¼šå°½å–„å°½ç¾ã€‚çœŸæ­£çš„å®Œç¾ï¼Œä¸€æ–¹é¢æ€»åœ¨ä¸åœæ¼”å˜ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿæ€»åœ¨ä½ çš„å†…å¿ƒå‡ºç°ï¼Œæ­£å¦‚ä¹‹å‰ä¾‹ä¸¾è¿‡çš„ç»½æ”¾çš„é²œèŠ±é‚£æ ·ã€‚&lt;/p>
&lt;p>è·å¾—ä»»ä½•ä¸œè¥¿æ‰€å¸¦æ¥çš„çœŸæ­£çš„å…´å¥‹æ„Ÿï¼Œä¸è®ºè¿™æ ·ä¸œè¥¿æ˜¯ä¸€ä»¶ç‰©å“è¿˜æ˜¯ä¸€ä¸ªä¸ªäººç›®æ ‡ï¼Œå…¶å®æ˜¯ä½ å¯¹è·å¾—å®ƒé‚£ä¸€åˆ»çš„é¢„æµ‹ã€‚çœŸæ­£çš„æ„‰æ‚¦å–å†³äºä½ äº§ç”Ÿå’Œä¿æŒçš„æ¯…åŠ›ä¸è€å¿ƒã€‚å®ƒä»¬æ­£æ˜¯ä½ åœ¨é•¿æ—¶é—´å†…ä¸ºäº‰å–æ‹¥æœ‰è¿™æ ·ä¸œè¥¿è€ŒåŠªåŠ›å·¥ä½œæ—¶æ‰€éœ€è¦çš„ã€‚&lt;/p>
&lt;p>åˆ¤æ–­ï¼Œå¯¹æˆ‘ä»¬ç”Ÿæ´»çš„è¿è½¬æ˜¯å¿…è¦çš„ï¼Œä½†ä¹Ÿæœ‰ä¸€ä¸ªä¸åˆ©çš„æ–¹é¢ï¼šå®ƒä»¬å¹¶ä¸ä¼šä»¥ä¸€ç§è¶…ç„¶çš„ç‰¹æ€§æ¥æ‰§è¡Œã€‚é€šå¸¸å…¶ä¸­åŒ…å«ç€æŸç§æƒ…ç»ªï¼Œè€Œæƒ…ç»ªçš„æ•°é‡ä¸æˆ‘ä»¬å¯¹åˆ¤æ–­çš„é‡è¦æ€§çš„æ„ŸçŸ¥ç¨‹åº¦æ˜¯æˆæ¯”ä¾‹çš„ã€‚&lt;/p>
&lt;p>ä½ æ¥åˆ°è¿™ä¸ªä¸–ç•Œä¸Šçš„æ—¶å€™ï¼Œåªå¸¦ç€ä½ çœŸæ­£çš„è‡ªæˆ‘è€Œæ¥ï¼›è€Œä½ ç¦»å¼€è¿™ä¸ªä¸–ç•Œæ—¶ï¼Œä¹Ÿåªèƒ½å¸¦èµ°ä½ æœ€çœŸå®çš„è‡ªæˆ‘ã€‚ä½ åœ¨ç²¾ç¥ä¸Šè·å¾—çš„ä¸€åˆ‡ï¼Œå°†ä¸°å¯Œå’Œå‘å±•ä½ çš„çœŸå®è‡ªæˆ‘ï¼Œå˜æˆä½ æ°¸æ’çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="è¯»åæ„Ÿ">è¯»åæ„Ÿ
&lt;/h2>&lt;p>é˜…è¯»å®Œè¿™æœ¬ä¹¦å¹¶æ²¡æœ‰èŠ±è´¹æˆ‘å¤šå°‘æ—¶é—´ï¼Œå‡ ä¹æ˜¯ä¸€å£æ°”å°±è¯»å®Œäº†ã€‚ä½†æ˜¯å…¶ä¸­çš„æ€æƒ³æ–¹æ³•å€¼å¾—æ…¢æ…¢å­¦ä¹ å¹¶åœ¨ç”Ÿæ´»ä¸­å»å®è·µã€‚&lt;br>
æœ€é‡è¦çš„å°±æ˜¯ä¸ºäº†è¾¾æˆæŸä¸ªç›®æ ‡æˆ–è€…å®ŒæˆæŸä»¶äº‹æƒ…æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥æ›´åŠ æ³¨é‡è¿‡ç¨‹è€Œä¸æ˜¯ç»“æœã€‚æˆ‘ä»¬å¸¸å¸¸è¯´â€œå°½åŠ›å°±å¥½äº†ï¼Œä¸è¦å¼ºæ±‚è‡ªå·±â€ï¼Œæˆ‘è®¤ä¸ºè¿™ç®—æ˜¯è®©è‡ªå·±å·æ‡’çš„ä¸€ä¸ªå€Ÿå£æˆ–è€…æ˜¯ç»“æœä¸ç†æƒ³æ—¶çš„ä¸€ä¸ªå®‰æ…°ï¼Œä¸æ³¨é‡è¿‡ç¨‹è¿˜æ˜¯æœ‰æ‰€ä¸åŒã€‚æˆ‘ä»¬éœ€è¦æ´»åœ¨å½“ä¸‹ï¼Œè€Œä¸æ˜¯è¿‡å»æˆ–è€…æœªæ¥ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æˆ‘ä»¬æœŸæœ›çš„æœªæ¥ï¼Œå®ƒåº”å½“æ˜¯æŒ‡å¼•æˆ‘ä»¬è¡ŒåŠ¨çš„æ–¹å‘ï¼Œç¡®ä¿è‡ªå·±æ²¡æœ‰èµ°åï¼Œæˆ‘ä»¬åº”è¯¥ä½“éªŒä¸æ„Ÿå—ç°åœ¨ï¼Œä¸è¦è¿‡å¤šçš„å…³æ³¨äºç°åœ¨è·ç¦»ç›®æ ‡è¿˜æœ‰å¤šè¿œå¤šè¿œï¼Œè¿™åªä¼šå¾’å¢è‡ªå·±çš„ç„¦è™‘ä¸æ‹…å¿§ï¼Œåè€Œä¼šå½±å“å‰è¿›çš„é€Ÿåº¦ã€‚&lt;br>
ä¹¦ä¸­æåˆ°äº†ä¸€ä¸ªæ–¹æ³•æ˜¯DOCï¼Œå³Doã€Observeã€Correctï¼Œæˆ‘è®¤ä¸ºéå¸¸æœ‰å¸®åŠ©ã€‚æ¯”å¦‚æˆ‘ä»¬æ³¨æ„åˆ°è‡ªå·±ä¸ºæŸä»¶äº‹æƒ…æ‹…å¿ƒæ—¶ï¼Œè¿™å°±å®ç°äº†åšï¼ˆDoï¼‰çš„éƒ¨åˆ†ã€‚ç°åœ¨ï¼Œè§‚å¯Ÿï¼ˆObserveï¼‰è‡ªå·±æƒ³è¦çš„è¡Œä¸ºï¼Œåœ¨å¯¹è‡ªå·±ä¸ºé‚£ä»¶äº‹æƒ…æ‹…å¿ƒçš„è§‚å¯Ÿä¸­ï¼Œå°†è‡ªå·±ä¸æ‹…å¿ƒé‚£ä¸€ä¸¾åŠ¨éš”ç¦»å¼€æ¥ã€‚å½“è‡ªå·±æ„è¯†åˆ°è‡ªå·±æ‹…å¿ƒçš„æƒ…ç»ªå¯¹äºæ‹…å¿ƒçš„é—®é¢˜å¹¶æ²¡æœ‰å½±å“æ—¶ï¼Œå°½å¯èƒ½åœ°è®©è‡ªå·±ä»è¿™ç§æƒ…ç»ªä¸­è§£è„±å‡ºæ¥ï¼ˆå°±æ˜¯çº æ­£ï¼ˆCorrectï¼‰çš„è¿‡ç¨‹ï¼‰ã€‚&lt;br>
æˆ‘è®¤ä¸ºä¹¦ä¸­è¿˜æœ‰ä¸€ä¸ªå¯¹æˆ‘æœ‰å¯å‘çš„è§‚ç‚¹æ˜¯ï¼Œä¸è®ºä»€ä¹ˆäº‹æƒ…ï¼Œéƒ½ä¸ä¼šå°½å–„å°½ç¾ã€‚æˆ‘ä¸€ç›´åœ¨å¹»æƒ³ç€ä¸€ä¸ªç†æƒ³çš„è‡ªå·±ï¼Œå¥¹å¾ˆå‹¤å¥‹ï¼Œè‡ªå¾‹ï¼Œçƒ­çˆ±å­¦ä¹ ï¼Œçƒ­çˆ±ç”Ÿæ´»ï¼Œå–„äºäº¤æµï¼Œå¼€æœ—ç§¯æï¼Œå¥½åƒä¸€ç›´éƒ½æ˜¯é‚£ä¹ˆé˜³å…‰ç§¯æï¼Œå…¶å®è¿™çœŸçš„å°±æ˜¯å¹»æƒ³ï¼Œå¯¹ç°å®æ— æµäºäº‹ï¼Œç”šè‡³å½“è‡ªå·±å‡ºç°è´Ÿé¢æƒ…ç»ªæˆ–è€…å˜å¾—æ‡’æƒ°æ—¶ï¼Œå°±ä¼šäº§ç”Ÿæ„§ç–šè‡ªè´£ï¼Œç¦»é‚£ä¸ªç†æƒ³ä¸­çš„è‡ªå·±æ›´åŠ é¥è¿œäº†ï¼Œè¿™å®Œå®Œå…¨å…¨ä¼šå½±å“å½“ä¸‹çš„è¡Œä¸ºã€‚ä¸å¦‚åœ¨ä¸€å¼€å§‹å°±æ„è¯†åˆ°ï¼Œæ²¡æœ‰ä»€ä¹ˆæ˜¯å®Œç¾çš„ï¼Œè‡ªå·±å°±æ˜¯è¿™æ ·å­˜åœ¨çš„ï¼Œè¿™æ‰æ˜¯çœŸå®çš„è‡ªå·±ï¼Œè‡³äºæƒ³è¦æ”¹å˜ä»€ä¹ˆï¼Œé‚£å°±å¤šå…³æ³¨å¦‚ä½•åšåˆ°ï¼Œè€Œä¸æ˜¯æ‰¹åˆ¤ä¸€ä¸ªè¿‡å»çš„è‡ªå·±ï¼Œè¿™å®Œå…¨æ˜¯ä¸å€¼å¾—çš„ã€‚&lt;br>
å¦‚æœè¯´è¦å»æ€è€ƒä»€ä¹ˆæ˜¯äººç”Ÿçš„ç›®æ ‡ï¼Œæˆ‘ä»¬æ˜¯ä¸ºäº†ä»€ä¹ˆè€Œæ´»ã€‚æˆ‘è®¤ä¸ºè¿™æœ¬ä¹¦ç»™æˆ‘çš„ä¸€ä¸ªæƒ³æ³•å°±æ˜¯ï¼Œæ²¡æœ‰ä»€ä¹ˆç›®æ ‡ï¼Œé‡è¦çš„å°±æ˜¯è‡ªå·±ä½“éªŒåˆ°äº†ä»€ä¹ˆã€‚å…³æ³¨äºç°åœ¨åœ¨åšä»€ä¹ˆï¼Œç°åœ¨ä½“éªŒåˆ°äº†ä»€ä¹ˆï¼Œè¿™äº›å°±æ„æˆäº†æ•´ä¸ªè‡ªå·±çš„ä¸€ç”Ÿã€‚å¯èƒ½è‡ªå·±æ‰€æœ‰çš„åŠªåŠ›ä¸ä»˜å‡ºå¹¶ä¸æ˜¯ä¸ºäº†è·å¾—ç‰©è´¨ä¸çŸ­æš‚çš„å¿«ä¹ï¼Œè€Œæ˜¯å¯»å¾—è‡ªå·±å†…å¿ƒçš„å¹³é™ã€‚å•Šå•Š~~ è‡ªå·±è¿˜æ²¡è¾¾åˆ°ä»€ä¹ˆç‰©è´¨æ¡ä»¶å‘¢ï¼Œè¯´è¿™ä¸ªæœ‰äº›å¤§äº†ï¼Œå¯Œäººçš„å¿«ä¹ä½ ä½“ä¼šä¸åˆ°~~ å“ˆå“ˆ~~~&lt;/p></description></item></channel></rss>